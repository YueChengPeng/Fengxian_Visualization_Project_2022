<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <script src="https://d3js.org/d3.v6.js"></script>
    <script type="text/javascript" src="js/lib/jquery.min.js"></script>
    <script type="text/javascript" src="js/scrollmagic/uncompressed/ScrollMagic.js"></script>
    <script type="text/javascript" src="js/scrollmagic/uncompressed/plugins/debug.addIndicators.js"></script>
    <script type="text/javascript" src="js/lib/greensock/TweenMax.min.js"></script>
    <script type="text/javascript" src="js/scrollmagic/uncompressed/plugins/animation.gsap.js"></script>
    <script src="https://use.typekit.net/nlq1kdt.js"></script>


    <!-- BOOTSTRAP5 最新编译并压缩的 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <!-- 最新编译的 JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
            crossorigin="anonymous"></script>

    <script src="js/fisheye/fisheye.js" charset="utf-8"></script>


    <style>
        html {
            font-size: 22px; /*rem（font size of the root element）是指相对于根元素的字体大小的单位*/
        }

        body {
            background: #141414;
        }

        @font-face {
            font-family: impact;
            src: url("asset/font/Impact.ttf");
        }

        @font-face {
            font-family: hand;
            src: url("asset/font/Hand_Of_Sean.ttf");
        }

        .h1title {
            font-family: impact;
            font-size: 4rem;
        }

        .h2title {
            font-family: impact;
            font-size: 2rem;
        }

        .h3title {
            font-family: impact;
            font-size: 1.2rem;
        }

        .h4title {
            font-family: impact;
            font-size: 1rem;
        }

        .fontGrad45 {
            background-image: -webkit-linear-gradient(45deg, #da7d1e, #ffc000);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .cataGrad {
            background: linear-gradient(45deg, #da7d1e, #ffc000);
            border-radius: 10px;
        }


        .fontWhite {
            color: rgba(255, 255, 255, 0.84);
        }


        .fontWhite_light {
            color: rgba(255, 255, 255, 0.75);

        }

        .fontHighlight {
            color: rgba(255, 192, 0, 0.9);
        }

        .normalContent {
            font-family: noto-sans, sans-serif;
            font-weight: 300;
            font-style: normal;
            font-size: .7rem;
            color: rgba(255, 255, 255, 0.71);
        }

        .normalContentSmallWord {
            font-family: noto-sans, sans-serif;
            font-weight: 300;
            font-style: normal;
            font-size: .6rem;
            color: rgba(255, 255, 255, 0.71);
        }



        .handContent {
            font-family: hand;
            font-weight: 300;
            font-style: normal;
            font-size: 1rem;
            color: rgba(255, 192, 0, 0.9);
        }

        .captionContent {
            font-family: noto-sans, sans-serif;
            font-weight: 200;
            font-style: normal;
            font-size: .4rem;
            color: rgba(255, 255, 255, 0.71);
        }

        .normalContentBigword {
            font-family: noto-sans, sans-serif;
            font-weight: 500;
            font-style: normal;
            font-size: 1rem;
            color: rgba(255, 255, 255, 0.71);
        }

        .normalContentBigwordHighlight {
            font-family: noto-sans, sans-serif;
            font-weight: 500;
            font-style: normal;
            font-size: 1rem;
            color: rgba(255, 192, 0, 0.9);
        }

        .bigNumbers {
            font-family: noto-sans, sans-serif;
            font-weight: 600;
            font-style: normal;
            font-size: 1.2rem;
            color: rgba(255, 192, 0, 0.9);
        }

        .normalContentHighlightLink {
            font-family: noto-sans, sans-serif;
            font-weight: 600;
            font-style: normal;
            font-size: .8rem;
            text-decoration: underline;
            color: rgba(255, 192, 0, 0.9);
        }


        .normalContentHighlight {
            font-family: noto-sans, sans-serif;
            font-weight: 500;
            font-style: normal;
            font-size: .7rem;
            color: rgba(255, 192, 0, 0.9);
        }

        .buttonSelected {
            background-color: #282828;
            border-radius: 4rem;

            border: 1px rgba(68, 68, 68, 0) solid;
            padding: 10px 30px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
        }

        .buttonUnSelected {
            background-color: rgba(40, 40, 40, 0);
            opacity: .4;
            border-radius: 4rem;

            border: 1px rgba(68, 68, 68, 0.9) solid;
            padding: 10px 30px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
        }

        .questionSelected {
            background-color: #282828;
            border-radius: 4rem;

            border: 1px rgba(68, 68, 68, 0) solid;
            padding: 10px 18px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 16px;
        }

        .questionUnSelected {
            background-color: rgba(40, 40, 40, 0);
            opacity: .4;
            border-radius: 4rem;

            border: 1px rgba(68, 68, 68, 0.9) solid;
            padding: 10px 18px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 16px;
        }

        .heading {
            font-size: 8rem;
            text-align: center;
            margin-top: 18%;
            margin-bottom: 18%;
        }

        .description {
            font-size: 0.8rem;
            text-align: left;
            margin-left: 30%;
            margin-right: 30%;
            margin-bottom: 1.2rem;
        }

        .descriptionWithSvg { /*左边文字，右边svg类型*/
            font-size: 0.8rem;
            text-align: left;
            margin-top: 0;
            margin-left: 30%;
            margin-right: 10%;
            margin-bottom: 2rem;
        }

        video {
            display: block;
            min-height: 100%;
            min-width: 100%;
            position: absolute;
            top: 50%; /*水平、竖直都居中？*/
            left: 50%;
            transform: translate(-50%, -50%);
        }

        #scrollViewBox {
            position: fixed;
            top: 10px;
            right: 20px;
            height: 50px;
            width: 100px;
            box-sizing: border-box; /*改为内侧描边*/
            background-color: rgba(255, 255, 255, 0.4);
            border: 2px solid rgba(255, 202, 54, 0.4);
            border-radius: 10px;

            /*cursor: move;*/
            /*-webkit-box-shadow: black;*/
        }

        .seedTooltip {
            position: fixed;
            top: 20px;
            left: 20px;
            padding: 5px;
            width: 300px;
            /*max-width: 500px;*/
            /*height: 300px;*/

            -webkit-box-shadow: #c0bbb4 0px 0px 10px;
            -moz-box-shadow: #c0bbb4 0px 0px 10px;
            box-shadow: #c0bbb4 0px 0px 10px;
            border-radius: 8px;
            background-color: #FFFCF7;
        }

        .svgDiv {
            display: inline-flex;
            line-height: 24px;
            text-align: center;
            height: 24px;
            vertical-align: top
        }

        .divider-flex {
            height: 1px;
            border-top: 1px solid #e5e5e5;
            margin-top: 8px;
            margin-bottom: 8px;
            /*border-radius: 0.5px;*/
            text-align: center;
        }

        .emotionScale {
            height: 8px;
            width: 4px;
            background: none;
            border: 1px solid #000;
            position: relative;
            top: 8px;
            -webkit-box-shadow: #c0bbb4 0px 0px 6px;
            -moz-box-shadow: #c0bbb4 0px 0px 6px;
            box-shadow: #c0bbb4 0px 0px 6px;
        }

        .tooltip { /*bs5的tooltip样式*/
            font-size: 0.4em;
        }

        .tooltip .tooltip-inner {
            max-width: 152px;
        }

        .keyEventCir {
            position: fixed;
            right: 120px;
            top: 50px;
            width: 12px;
            height: 12px;
            border-top-right-radius: 6px;
            border-bottom-right-radius: 6px;
            border-bottom-left-radius: 6px;
            border-top-left-radius: 6px;
            background: #ffc000;
        }

        #overlayTooltip {
            position: fixed;
            background: #FFF9F0;
            padding: 0px;

            -webkit-box-shadow: #c0bbb4 0px 0px 10px;
            -moz-box-shadow: #c0bbb4 0px 0px 10px;
            box-shadow: #c0bbb4 0px 0px 10px;
            border-radius: 8px;
            z-index: 2;
        }

        #overlayTooltipIntroPart {
            background: #FFF9F0;
            padding: 0px;

            -webkit-box-shadow: #c0bbb4 0px 0px 10px;
            -moz-box-shadow: #c0bbb4 0px 0px 10px;
            box-shadow: #c0bbb4 0px 0px 10px;
            border-radius: 8px;
            z-index: 2;
        }

        #overlayTooltipIntroPart_wind {
            background: #FFF9F0;
            padding: 0px;

            -webkit-box-shadow: #c0bbb4 0px 0px 10px;
            -moz-box-shadow: #c0bbb4 0px 0px 10px;
            box-shadow: #c0bbb4 0px 0px 10px;
            border-radius: 8px;
            z-index: 2;
        }


        .overlayTooltipcontent {
            font-size: 0.7em;
            color: #656565;
            margin-bottom: 10px;
            text-align: justify;
        }

        span.tphighlight {
            color: #eeb106;
        }
    </style>
</head>
<body>
<div>
    <div id="trigger0"></div>
    <h1 class="h1title ">Title</h1>
    <p class="description">Chained by neck, in rags, toothless, poor food. This happens to a women in 2022, Xuzhou(徐州),
        one of the most well-being cities in China. How ironic.
    </p>

    <p class="description">
        At the end of 2021, a story about an eight-children father at Fengxian(丰县), Xuzhou attracted many vloggers to
        visit and record videos to propagate father's love and local poverty alleviation policies.
    </p>

    <p class="description">
        On Jan 27 2022, <a href="javascript:void(0);" rel="external nofollow"
                           onclick="showHideVideo()" style="color:#eeb106;">a TikTok video</a> went viral and sparked
        outrage and shock. In this video, the mother was tied to her neck by a chain in a worn-out hub and was only
        wearing thin clothing despite the freezing winter.
    </p>

    <p class="description">
        This video triggered fevered discussion on social media about human trafficking, the abuse of women and their
        limited rights in China’s impoverished rural areas. Under public pressure from social media, the county, city
        and provincial authorities successively conducted several investigations into this incident and finally
        confirmed that this woman was a victim of human trafficking.
    </p>

    <p class="description" style="margin-bottom: 3em">
        By collecting and analyzing 4725 relevant popular posts from Jan 28 to Feb 28 on Weibo, one of the largest
        Chinese social media platforms, including six investigation reports posted by authorities, this project intends
        to visually demonstrate the key role public opinion played in this incident.
    </p>

    <p class="description" style="font-size: 0.6rem; color: #a1a1a1">
        * Online discussion of this case has been heavily censored since it flared up, and a huge number of posts on
        Weibo was removed by authorities. Therefore, "4725" did not represent the accurate number of posts discussing
        this case on Weibo.
    </p>

    <!--遮挡div-->
    <div onclick="showHideVideo()" id="newsVideoDivBlock"
         style="display: none; position: fixed;top: 0px; left: 0px; background-color: black; opacity: 0.6"></div>

    <!--铁链女链接视频-->
    <div id="newsVideoDiv" style="display: none; position:fixed; z-index: 2">
        <iframe width="702" height="395" src="https://www.youtube.com/embed/5npkIJ6NRr4" title="YouTube video player"
                frameborder="0"
                allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                allowfullscreen></iframe>
    </div>
</div>

<div id="trigger1"></div>

<!--more info (tooltip panel) icon -->
<!--<div>-->
<!--    <img id="showTooltipOverlayImgIntro" src="svg/info.svg" style="position:fixed;width:50px; top: 0px; right: 0px; z-index: 1; opacity: 0" onclick="showTooltipOverlayIntro()"/>-->
<!--</div>-->

<!--Intro部分整体tooltip-->
<div id="overlayTooltipIntroPart" style="display: none; position:fixed; padding: 30px; z-index: 3">
    <p class="overlayTooltipcontent" style="margin-bottom: 2em">
        Each seed represents a popular Weibo post with the keyword “丰县(Fengxian)” from Jan 28, 2022 to Feb 28, 2022.
    </p>
    <div class="row">
        <div class="col-lg">
            <!--follower Tooltip-->
            <div style="margin-bottom: 20px">
                <p style="font-size: 0.8em; font-weight: bold; margin-bottom: 10px"> Followers </p>
                <p class="overlayTooltipcontent" style="font-size: 0.7em">The size of the seed head shows how many
                    followers the poster had at the time.</p>
                <div id="followerTooltipIntro"></div>
                <div class="overlayTooltipcontent"
                     style="font-size: 0.3em; display: flex; justify-content: space-between; padding-left: 100px; padding-right: 100px">
                    <p style="display: inline-flex; margin-bottom: 0px">≤10K</p>
                    <p style="display: inline-flex; margin-bottom: 0px">10K-1M</p>
                    <p style="display: inline-flex; margin-bottom: 0px">>1M</p>
                </div>
            </div>

            <!--retweet Tooltip-->
            <div style="margin-bottom: 20px">
                <p style="font-size: 0.8em; font-weight: bold; margin-bottom: 10px"> Retweets </p>
                <p class="overlayTooltipcontent" style="font-size: 0.7em">The length of the seed stem represents the
                    number of retweets.</p>
                <div id="retweetTooltipIntro"></div>
                <div class="overlayTooltipcontent"
                     style="font-size: 0.3em; display: flex; justify-content: space-between; padding-left: 100px; padding-right: 100px">
                    <p style="display: inline-flex; margin-bottom: 0px; user-select: none;">≤500</p>
                    <div style="display: inline-flex;">
                        <p style="margin-bottom: 0px; user-select: none;">>500:</p>
                        <div id="retweetDragBgIntro"
                             style="background: #e5e1d9; opacity: 0.6; width:120px; height:6px; border-radius: 3px; justify-content: center; align-self: center; margin-left: 15px">
                            <div id="retweetDragBoxIntro"
                                 style="position: relative; top: -1px; left: 0px; width: 12px; height: 8px; border-radius: 4px; background: #FFCA36; ">
                                <p id="retweetNumIntro"
                                   style="position:relative; top: 6px; user-select: none;display: none">500</p>
                            </div>
                        </div>
                    </div>

                </div>
            </div>

            <!--comment Tooltip-->
            <div style="margin-bottom: 20px">
                <p style="font-size: 0.8em; font-weight: bold; margin-bottom: 10px"> Comments </p>
                <p class="overlayTooltipcontent" style="font-size: 0.7em">The wing pattern shows the number of comments.
                    (hover on the seed head to see patterns)</p>
                <div id="commentTooltipIntro"></div>
                <div class="overlayTooltipcontent"
                     style="font-size: 0.3em; display: flex; justify-content: space-between; padding-left: 100px; padding-right: 100px">
                    <p style="display: inline-flex; margin-bottom: 0px">≤10</p>
                    <p style="display: inline-flex; margin-bottom: 0px">10-100</p>
                    <p style="display: inline-flex; margin-bottom: 0px">>100</p>
                </div>
            </div>


        </div>

        <div class="col-lg">
            <!--vlevel tooltip-->
            <div style="margin-bottom: 20px">
                <p style="font-size: 0.8em; font-weight: bold; margin-bottom: 10px"> Account Type </p>
                <p class="overlayTooltipcontent" style="font-size: 0.7em">The dot(s) near the seed head indicates Weibo
                    account type of the poster.</p>
                <div id="vlevelTooltipIntro"></div>
                <div class="overlayTooltipcontent"
                     style="font-size: 0.3em; display: flex; justify-content: space-between; padding-left: 10px; padding-right: 10px">
                    <p class="col-3 text-center" style="display: inline-flex; margin-bottom: 0px">Individual Lv.1</p>
                    <p class="col-3 text-center" style="display: inline-flex; margin-bottom: 0px">Individual Lv.2</p>
                    <p class="col-3 text-center" style="display: inline-flex; margin-bottom: 0px">Individual Lv.3</p>
                    <p class="col-3 text-center" style="display: inline-flex; margin-bottom: 0px">Enterprise Account</p>
                </div>
            </div>

            <!--like tooltip-->
            <div style="margin-bottom: 20px">
                <p style="font-size: 0.8em; font-weight: bold; margin-bottom: 10px"> Likes </p>
                <p class="overlayTooltipcontent" style="font-size: 0.7em">The width of the seed wing represents the
                    number of likes.</p>
                <div id="likeTooltipIntro"></div>
                <div class="overlayTooltipcontent"
                     style="font-size: 0.3em; display: flex; justify-content: space-between; padding-left: 100px; padding-right: 100px">
                    <p style="display: inline-flex; margin-bottom: 0px; user-select: none;">≤5000</p>
                    <div style="display: inline-flex;">
                        <p style="margin-bottom: 0px; user-select: none;">>5000:</p>
                        <div id="likeDragBgIntro"
                             style="background: #e5e1d9; opacity: 0.6; width:120px; height:6px; border-radius: 3px; justify-content: center; align-self: center; margin-left: 15px">
                            <div id="likeDragBoxIntro"
                                 style="position: relative; top: -1px; left: 0px; width: 12px; height: 8px; border-radius: 4px; background: #FFCA36; ">
                                <p id="likeNumIntro" style="position:relative; top: 6px; user-select: none;display: none">
                                    5000</p>
                            </div>
                        </div>
                    </div>

                </div>
            </div>

            <!--emotion Tooltip-->
            <div style="margin-bottom: 20px">
                <p style="font-size: 0.8em; font-weight: bold; margin-bottom: 10px"> Sentiment </p>
                <p class="overlayTooltipcontent" style="font-size: 0.7em">The color of the the seed head represents the
                    sentiment of the post text. (hover to see the animation)</p>
                <div id="emotionTooltipIntro"></div>
                <div class="overlayTooltipcontent"
                     style="font-size: 0.3em; display: flex; justify-content: space-between; padding-left: 100px; padding-right: 240px">
                    <p style="display: inline-flex; margin-bottom: 0px; user-select: none">negative</p>
                    <div style="display: inline-flex;">
                        <div id="emotionDragBgIntro"
                             style="background: #e5e1d9; opacity: 0.6; width:120px; height:6px; border-radius: 3px; justify-content: center; align-self: center; margin: 0px">
                            <div id="emotionDragBoxIntro"
                                 style="position: relative; top: -1px; left: 54px; width: 12px; height: 8px; border-radius: 4px; background: #FFCA36; ">
                                <p id="emotionNumIntro"
                                   style="position:relative; top: 6px; user-select: none;display: none"></p>
                            </div>
                        </div>
                    </div>
                    <p style="display: inline-flex; margin-bottom: 0px; user-select: none">positive</p>


                </div>
            </div>
        </div>
    </div>
</div>

<!--Intro部分tooltip遮挡div-->
<div id="invisibleBlock_Intro" style="display: none; position: fixed; top: 0px; left: 0px; z-index: 2"
     onclick="invisibleBlock_Intro_click()"></div>

<!--添加视频的地方-->
<div id="windvideoEnter"
     style="position: fixed; top: 0px; left: 0px; background-color: #FFF9F0; display: none; z-index: 0">
    <!--设置z-index：使得视频覆盖原来的svg-->
    <!--    <div height = "100%" width = "100%" style="margin: 0 auto;">-->
    <video id="videoclipEnter" height="100%" muted="muted"> <!--设置为muted就不用先interact with DOM了-->
        <source src="asset/mp4/curve5.mp4" type="video/mp4"/>
    </video>
</div>

<div id="windvideoExit"
     style="position: fixed; top: 0px; left: 0px; background-color: #FFF9F0; display: none; z-index: 0">
    <!--设置z-index：使得视频覆盖原来的svg-->
    <!--    <div height = "100%" width = "100%" style="margin: 0 auto;">-->
    <video id="videoclipExit" height="100%" muted="muted"> <!--设置为muted就不用先interact with DOM了-->
        <source src="asset/mp4/curve_out.mp4" type="video/mp4"/>
    </video>
</div>

<div class="row" style="width: 96%; margin: 0 auto;">
    <div class="col-lg-5">
        <article>
            <p class="descriptionWithSvg" id="seedIntro1" style="opacity: 0;">Later, the form of samara seeds will be
                used to visualize posts on social media.
                <br><br>
                This visual metaphor is selected due to its ability to spread and take hold like posts on social media,
                and
                its representation of freedom.</p>
            <p class="descriptionWithSvg" id="seedIntro2" style="opacity: 0;">Each seed encodes 6 attributes of post
                data.<br>
                Click <img src="asset/svg/info.svg" style="height: 1rem; display: inline-flex"
                           onclick="showTooltipOverlayIntro()" data-toggle="tooltip" data-bs-placement="bottom"
                           title="detailed information"/> to see detailed information of encoding rules.
            </p>

            <p class="descriptionWithSvg" id="seedIntro3" style="opacity: 0;">But firstly, to set these seeds FREE, we
                need... <br><br>
                <span style="font-size: 1.2em"> WISPS OF WIND</span></p>
            <!--            <p class="descriptionWithSvg" id="seedIntro4" style="opacity: 0;">Are WISPS OF WIND...</p>-->
            <div id="windIntro1Div" style="opacity: 0">
                <p class="descriptionWithSvg" id="windIntro1" style="opacity: 0;text-align: justify">Posts are categorized
                    into 8 groups by the similarity of their hashtags, which are represented by 8 “wisps of wind”,
                    because wind carries samara seeds just as hashtag groups contains posts. This visualization thus gives a
                    vivid overview of all hashtag groups.<br><br>
                    Click each wisp of wind to explore more.
                    <br>
                    Click <img src="asset/svg/info.svg" style="height: 1rem; display: inline-flex"
                               onclick="showTooltipOverlayIntro_wind()" data-toggle="tooltip" data-bs-placement="bottom"
                               title="detailed information"/> to see detailed information of encoding rules.

                    <!--                Because there are parallels between wind carrying samara seeds and hashtag group containing posts, the form of wind is selected to represent different hashtag groups.-->
                </p>
            </div>

            <p class="descriptionWithSvg" id="windIntro2" style="opacity: 0;">
                <!--                This visualization offers an overview of these 8 groups in terms of number of view, number of discussion, number of originals, average sentiment and active time duration of each hashtag group.-->
                Now let's move closer, to see seeds carried in these wisps of wind...
            </p>


            <div id="overlayTooltipIntroPart_wind" style="display: none; position:fixed; padding: 30px; padding-left: 50px; z-index: 3">

                <p style=" margin-bottom: 0px; margin-bottom: 6px">
                    <span style="font-weight: bold; font-size: 0.8em; ">Shape</span>
                </p>


                <div class="row" style="margin-bottom: 20px">
                    <div class="col-lg-2" style="">
                        <img src="asset/svg/curve_shape1.svg"
                             style="display: block; width:4rem;height:auto;margin-top: 2rem; margin-bottom: 1.2rem"/>
                        <img src="asset/svg/curve_shape2.svg"
                             style="display: block; width:4rem;height:auto;margin-bottom: 1.2rem"/>
                        <img src="asset/svg/curve_shape3.svg" style="display: block; width:4rem;height:auto;"/>

                    </div>

                    <div class="col-lg" style="">
                        <p style="font-size: 0.7em; color: #656565; text-align: center;">Number of view</p>

                        <p style="font-size: 0.5em; color: #656565; text-align: center; margin-bottom: 1.8rem;">
                            <500M</p>
                        <p style="font-size: 0.5em; color: #656565; text-align: center; margin-bottom: 1.8rem;">
                            500M-4B</p>
                        <p style="font-size: 0.5em; color: #656565; text-align: center; margin-bottom: 1.8rem;">>4B</p>


                    </div>

                    <div class="col-lg" style="">
                        <p style="font-size: 0.7em; color: #656565; text-align: center;">Number of discussion</p>

                        <p style="font-size: 0.5em; color: #656565; text-align: center; margin-bottom: 1.8rem;">
                            <200K</p>
                        <p style="font-size: 0.5em; color: #656565; text-align: center; margin-bottom: 1.8rem;">
                            200K-2M</p>
                        <p style="font-size: 0.5em; color: #656565; text-align: center; margin-bottom: 1.8rem;">>2M</p>

                    </div>
                    <div class="col-lg" style="">
                        <p style="font-size: 0.7em; color: #656565; text-align: center;">Number of originals</p>

                        <p style="font-size: 0.5em; color: #656565; text-align: center; margin-bottom: 1.8rem;"><5K</p>
                        <p style="font-size: 0.5em; color: #656565; text-align: center; margin-bottom: 1.8rem;">
                            5K-50K</p>
                        <p style="font-size: 0.5em; color: #656565; text-align: center; margin-bottom: 1.8rem;">>50K</p>
                    </div>
                </div>

                <div class="row">
                    <div class="col-lg">
                        <p style="margin-bottom: 0px; margin-bottom: 1rem">
                            <span style="font-weight: bold; font-size: 0.8em;">Wind tail color</span>
                            <span style="display: inline-flex;color: #656565; font-size: 0.7em; margin:0px; margin-left: 30px">- average sentiment</span>
                        </p>
                        <div style="display: flex; align-items: center; ">
                            <img src="asset/svg/curve_shape6.svg"
                                 style="display:inline-flex;width:6rem;height:auto;margin-right: 5px"/>

                            <div style="display: inline-flex; justify-content: space-between; align-items: center; margin-left: 0px">
                                <p style="display: inline-flex; font-size: 0.5em; color: #656565; margin-bottom: 0px; margin-right: 0.6rem">
                                    negative</p>
                                <img src="asset/svg/gradient.svg" style="width: 6rem">
                                <p style="display: inline-flex; font-size: 0.5em; color: #656565; margin-bottom: 0px; margin-left: 0.6rem">
                                    positive</p>
                            </div>

                        </div>
                    </div>

                    <div class="col-lg">
                        <p style="margin-bottom: 0px; margin-bottom: 0.7rem">
                            <span style="font-weight: bold; font-size: 0.8em;">Length</span>
                            <span style="display: inline-flex;color: #656565; font-size: 0.7em; margin:0px; margin-left: 30px">- active time duration</span>

                        </p>
                        <div style="display: flex; align-items: center; ">
                            <img src="asset/svg/curve_shape5.svg"
                                 style="display:inline-flex;width:4rem;height:auto;margin-right: 5px"/>
                        </div>

                    </div>
                </div>

            </div>

            <p class="descriptionWithSvg" id="windIntro4" style="opacity: 0;">
            </p>

        </article>
    </div>
    <div class="col-lg-7">
        <div id="samaraIntro" style="display: block"></div>     <!--放第一次出现的Samara Seed, 放d3 svg的地方-->
    </div>
</div>

<!--wind部分 hashtag的tooltip-->

<!--阻挡wind tooltip的div-->
<div id="tooltipInvisibleBlockDiv_wind" style="display:none; z-index: 1; position:fixed;top: 0px; left: 0px"
     onclick="tooltipInvisibleBlockDiv_wind_click()">

</div>

<!--hashtag的tooltip-->
<div class="seedTooltip" id="hashtagTooltip_wind"
     style="left: 150px; display: none; flex-direction: column; user-select: none; z-index: 2; width: 350px">

    <div style="margin: 10px; font-size: 1em; display: flex; align-items: flex-end; flex-wrap: wrap; color: #eeb106">
        <div id="hashtagGroupNum_wind" style="font-weight: bold; padding-right: 8px; line-height: 1.2;"> Hashtag Group ·
            1
        </div>
    </div>

    <div id="hashtagGroupSubtitle_wind" style="font-size: 0.7em; line-height: 1.2; margin: 10px; margin-top: 5px"> This
        hashtag group contains hashtags related to investigation report 1 (the first announcement of Fengxian)
    </div>

    <div id="hashtagGroupInclude_wind"
         style="font-size: 0.4em; color: #b7b7b7;margin-left: 10px; margin-right: 10px; margin-bottom: 20px; max-height: 150px; overflow: auto"
         content="123">
        included hashtags:<br>
        #丰县辟谣被拴破屋八孩母亲系拐卖 <br>
        #丰县回应八孩母亲被拴破屋 <br>
        #江苏丰县回应八孩母亲被拴破屋 <br>
        #官方回应八孩母亲被拴破屋疑遭家暴 <br>
        #官方回应徐州八孩母亲被拴破屋 <br>
        #官方通报生育八孩女子情况 <br>
        #丰县官方通报生育八孩女子情况 <br>
        #官方通报徐州丰县生育八孩女子情况 <br>
        #官方救治江苏八孩母亲 <br>
        #江苏丰县回应生育八孩女子情况 <br>
        #官方通报丰县生育8孩女子事件 <br>
    </div>

    <div style="margin-left: 10px; padding-left: 0px; padding-right: 0px; margin-right: 10px; margin-top: 10px; display: flex; justify-content: space-between;">
        <!--display: flex-->
        <div style="vertical-align: top; display: inline-flex;  line-height:24px; text-align:center; height: 24px">
            <div style="font-size: 0.4em; color: #b7b7b7; display: inline">negative</div>
        </div>

        <div style="vertical-align: top; display: inline-flex; height: 24px; position: relative">
            <div class="emotionScale" id="emotionScaleBox_wind"
                 style="left:160px;position: absolute; margin-top: -1px; height: 10px; width: 6px; "></div>
            <img src="asset/svg/gradient.svg" style="display:inline;width:180px;height:auto;"/>
        </div>

        <div style="vertical-align: top; display: inline-flex;  line-height:24px; text-align:center; height: 24px">
            <div style="font-size: 0.4em; color: #b7b7b7; display: inline">positive</div>
        </div>
    </div>

    <a id="showFullHashtag_wind" href="javascript:void(0);" rel="external nofollow" onclick="showFullHashtag_wind()"
       style="font-size: 0.4em; margin-left: 10px; color: #eeb106; display: inline-flex; margin-bottom: 8px">show
        more</a>
    <div class="divider-flex"></div>
    <div style="display: flex; justify-content:center;/*水平居中*/">
        <div style="display: inline;  margin-left: 20px; margin-right: 20px">
            <div class="svgDiv" data-toggle="tooltip" data-bs-placement="bottom" title="Number of views">
                <img src="asset/svg/view.svg" style="display:inline;width:20px;height:20px"/>
            </div>
            <div style="display: inline-flex; line-height:24px; text-align:center; height: 24px; vertical-align: top">
                <div id="windView" style="font-size: 0.4em; color: #b7b7b7; display: inline; ">123</div>
            </div>
        </div>

        <div style="display: inline; margin-left: 20px; margin-right: 20px">
            <div class="svgDiv" data-toggle="tooltip" data-bs-placement="bottom" title="Number of comments">
                <img src="asset/svg/comment.svg" style="display:inline;width:20px;height:20px"/>
            </div>
            <div style="display: inline-flex; line-height:24px; text-align:center; height: 24px; vertical-align: top">
                <div id="windComment" style="font-size: 0.4em; color: #b7b7b7; display: inline; ">123</div>
            </div>
        </div>

        <div style="display: inline;  margin-left: 20px; margin-right: 20px">
            <div class="svgDiv" data-toggle="tooltip" data-bs-placement="bottom" title="Number of originals">
                <img src="asset/svg/originals.svg" style="display:inline;width:20px;height:20px"/>
            </div>
            <div style="display: inline-flex; line-height:24px; text-align:center; height: 24px; vertical-align: top">
                <div id="windOriginal" style="font-size: 0.4em; color: #b7b7b7; display: inline; ">123</div>
            </div>
        </div>
    </div>

</div>


<!--&lt;!&ndash;主体时间线部分&ndash;&gt;-->
<!--<div id="samaraTimeline" style="width: 96%; margin: 0 auto;">-->

<!--    &lt;!&ndash;右侧滑条&ndash;&gt;-->
<!--    <div id="streamGraphScroll" style="display:none; position: fixed; top:0px; right:20px"></div>-->
<!--</div>-->


<!--原scrollPage2.html内容-->
<!--不可点击部分-->
<div id="gradRectBg" style="position: fixed; top: 0"></div>
<div id="gradRectBg2" style="position: fixed; bottom: 0"></div>
<!--    最后一个div是遮脚线     -->
<div id="gradRectBg3" style="background: #FFF9F0; position: fixed; bottom: 0"></div>


<div style="position: fixed; display: flex; top: 24px; right: 0px; font-size: 0.7em; line-height: 1.2; width: 120px; margin-right: 10px; user-select: none">

    <img src="asset/svg/left_arrow.svg" style="display:inline-flex;width:10px;height:auto;margin-right: 5px" onclick="streamGraphTitlesLeftArr()"/>

    <p id="streamGraphTitle" style="display: inline-flex; margin: 0px; text-align: center; max-width: 90px">number of hot posts</p>
    <!--   "number of hot posts" “times of view”, “times of discussion” and “number of originals-->

    <img src="asset/svg/right_arrow.svg" style="display:inline-flex;width:10px;height:auto;margin-left: 5px" onclick="streamGraphTitlesRightArr()"/>


</div>
<!--右侧滑条-->
<div id="streamGraphScroll" style="display:block; position: fixed; top:0px; right:20px">
    <div id="scrollViewBox"></div>
    <div class="keyEventCir" id="keyEventCir0" style="opacity: 1" onclick="keyEventCirClick(0)" data-toggle="tooltip" data-bs-placement="left" title="Investigation Report 1 · county level"></div>
    <div class="keyEventCir" id="keyEventCir1" style="opacity: 0.4" onclick="keyEventCirClick(1)" data-toggle="tooltip" data-bs-placement="left" title="Investigation Report 2 · county level"></div>
    <div class="keyEventCir" id="keyEventCir2" style="opacity: 0.4" onclick="keyEventCirClick(2)" data-toggle="tooltip" data-bs-placement="left" title="Investigation Report 3 · city level"></div>
    <div class="keyEventCir" id="keyEventCir3" style="opacity: 0.4" onclick="keyEventCirClick(3)" data-toggle="tooltip" data-bs-placement="left" title="Investigation Report 4 · city level"></div>
    <div class="keyEventCir" id="keyEventCir4" style="opacity: 0.4" onclick="keyEventCirClick(4)" data-toggle="tooltip" data-bs-placement="left" title="Investigation Report 5 · provincial level"></div>
    <div class="keyEventCir" id="keyEventCir5" style="opacity: 0.4" onclick="keyEventCirClick(5)" data-toggle="tooltip" data-bs-placement="left" title="Investigation Report 6 · provincial level"></div>
</div>

<!--主体时间线部分-->
<div id="samaraTimeline" style="margin: 0 auto;">

    <!--    user-select: none; 设置无法选中文字；防止在拖动div操作的时候误操作   -->
    <div class="seedTooltip" id="seedTooltip" style="display: none; user-select: none; flex-direction: column">
        <!--display: flex-->
        <div style="margin: 10px; font-size: 1em; display: flex; align-items: flex-end; flex-wrap: wrap;">
            <!--            <p style="margin: 0px">-->
            <!--                <span id="posterName" style="font-weight: bold">@poster</span>-->
            <!--                <span id="postFollower" style="color: #b7b7b7;font-size: 0.6em"> &nbsp 5.6M followers</span>-->
            <!--            </p>-->
            <div id="posterName" style="font-weight: bold; padding-right: 8px; line-height: 1.2;">@poster</div>
            <div id="postFollower" style="color: #b7b7b7;font-size: 0.6em"> 5.6M followers</div>
        </div>
        <div id="postContent"
             style="font-size: 0.4em; color: #b7b7b7; margin-left: 10px; margin-bottom: 0px; margin-right: 10px; max-height: 160px; overflow:auto;"
             content="#丰县将对失职渎职工作人员依法依规处理#很明显徐州丰县实力不如西安市，前者撤不了热搜，炸不了号，禁不了言。你看人家西安的骚操作，现在大家是不是都忘了地铁男保安扒光妇女，小伙儿买馒头被打、馒头撒一地，孕妇流产胎死腹中，拖延治疗心脏病患者致死，保安拒绝病人家属探望致父亲死前没见到女儿最后一面，和接诊病人的私立医院受到惩罚被关停整改、而拒诊病人的公立医院却正常营业的事件了？">
            123123123
        </div>
        <div id="emotionScaleDiv"
             style="margin-left: 10px; margin-right: 10px; margin-top: 10px; display: none; justify-content: space-between; ">
            <!--display: flex-->
            <div style="vertical-align: top; display: inline-flex;  line-height:24px; text-align:center; height: 24px">
                <div style="font-size: 0.4em; color: #b7b7b7; display: inline">negative</div>
            </div>
            <div style="vertical-align: top; display: inline-flex; height: 24px; position: relative">
                <div class="emotionScale" id="emotionScaleBox"
                     style="left:160px;position: absolute; margin-top: -1px"></div>
                <img src="asset/svg/gradient.svg" style="display:inline;width:160px;height:auto;"/>
            </div>
            <div style="vertical-align: top; display: inline-flex;  line-height:24px; text-align:center; height: 24px">
                <div style="font-size: 0.4em; color: #b7b7b7; display: inline">positive</div>
            </div>
        </div>
        <a id="showFullaTag" href="javascript:void(0);" rel="external nofollow" onclick="showFull()"
           style="font-size: 0.4em; margin-left: 10px; color: #eeb106; display: inline-flex">show more</a>
        <p id="postTime" style="font-size: 0.4em; color: #b7b7b7; display: inline-flex; float: right;
    margin: 10px 30px 0px 10px;">7:23 PM · Apr 14, 2022</p>


        <div class="divider-flex"></div>
        <div style="display: flex; justify-content:center;/*水平居中*/">
            <div style="display: inline;  margin-left: 20px; margin-right: 20px">
                <div class="svgDiv">
                    <img src="asset/svg/retweet.svg" style="display:inline;width:20px;height:20px"/>
                </div>
                <div style="display: inline-flex; line-height:24px; text-align:center; height: 24px; vertical-align: top">
                    <div id="postRetweet" style="font-size: 0.4em; color: #b7b7b7; display: inline; ">123</div>
                </div>
            </div>

            <div style="display: inline; margin-left: 20px; margin-right: 20px">
                <div class="svgDiv">
                    <img src="asset/svg/like.svg" style="display:inline;width:20px;height:20px"/>
                </div>
                <div style="display: inline-flex; line-height:24px; text-align:center; height: 24px; vertical-align: top">
                    <div id="postLike" style="font-size: 0.4em; color: #b7b7b7; display: inline; ">123</div>
                </div>
            </div>

            <div style="display: inline;  margin-left: 20px; margin-right: 20px">
                <div class="svgDiv">
                    <img src="asset/svg/comment.svg" style="display:inline;width:20px;height:20px"/>
                </div>
                <div style="display: inline-flex; line-height:24px; text-align:center; height: 24px; vertical-align: top">
                    <div id="postComment" style="font-size: 0.4em; color: #b7b7b7; display: inline; ">123</div>
                </div>
            </div>
        </div>
    </div>

    <!--vane的tooltip-->
    <div class="seedTooltip" id="vaneTooltip"
         style="left: 150px; display: none; flex-direction: column; user-select: none; z-index: 1; width: 300px">

        <div style="margin: 10px; font-size: 1em; display: flex; align-items: flex-end; flex-wrap: wrap; color: #eeb106">
            <!--            <p style="margin: 0px">-->
            <!--                <span id="posterName" style="font-weight: bold">@poster</span>-->
            <!--                <span id="postFollower" style="color: #b7b7b7;font-size: 0.6em"> &nbsp 5.6M followers</span>-->
            <!--            </p>-->
            <div id="vaneTitle" style="font-weight: bold; padding-right: 8px; line-height: 1.2; width: 235px">Key Event · 1</div>
            <img id="hashtagLinkSvg" src="asset/svg/hashtag2.svg"
                 style="display:inline; width:26.4px; height:auto; margin-left: 5px" data-toggle="tooltip"
                 data-placement="right" title="click to jump to related hashtag" onclick="jumpToHashtag()"/>

        </div>

        <!--        <div id="vaneTitle" style="font-size: 0.9em; line-height: 1.2; font-weight: bold; margin: 10px 10px 0px;color: #eeb106"> Key Event · 1 </div>-->


        <div id="vaneSubTitle" style="font-size: 0.7em; line-height: 1.2; font-weight: bold; margin: 10px;"> 丰县第一次通报
        </div>
        <div id="vaneContent"
             style="font-size: 0.4em; color: #b7b7b7;margin-left: 10px; margin-right: 10px; max-height: 150px; overflow: auto">
            发现网民反映“生育八孩女子”相关信息后，丰县县委、县政府迅速成立联合调查组进行全面调查。经初步调查核实，网民反映的女子为杨某侠，1998年8月与丰县欢口镇董某民领证结婚，<span
                style="color: #818181">不存在拐卖行为</span>。家人和邻居反映，杨某侠经常无故殴打孩子和老人。经医疗机构诊断，杨某侠患有精神疾病，目前，已对其进行救治，并对其家庭开展进一步救助，确保过上温暖的春节。具体情况正在进一步调查核实中。
        </div>

        <a id="showFullVane" href="javascript:void(0);" rel="external nofollow" onclick="showFullVane()"
           style="font-size: 0.4em; margin-left: 10px; color: #eeb106; display: inline-flex">show more</a>

        <div style="font-size: 0.4em; color: #b7b7b7; float: right; margin: 10px;">
            <p id="vaneFrom" style="text-align: right; margin: 3px">中共丰县县委宣传部</p>
            <p id="vaneDate" style="text-align: right; margin: 3px">Jan 28, 2022</p>
        </div>

    </div>

    <!--hashtag的tooltip-->
    <div class="seedTooltip" id="hashtagTooltip"
         style="left: 150px; display: none; flex-direction: column; user-select: none; z-index: 1; width: 300px">

        <div style="margin: 10px; font-size: 1em; display: flex; align-items: flex-end; flex-wrap: wrap; color: #eeb106">
            <div id="hashtagGroupNum" style="font-weight: bold; padding-right: 8px; line-height: 1.2;"> Hashtag Group ·
                1
            </div>
            <img id="jumpToKeyEventSvg" src="asset/svg/vane2.svg" style="display:inline; width:26.4px; height:auto; margin-left: 50px"
                 data-toggle="tooltip" data-placement="right" title="click to jump to related investigation report" onclick="jumpToKeyEvent()"/>
        </div>


        <div id="hashtagGroupSubtitle" style="font-size: 0.7em; line-height: 1.2; margin: 10px; margin-top: 5px"> This
            hashtag group contains hashtags related to key event 1 (the first announcement of Fengxian)
        </div>
        <div id="hashtagGroupInclude"
             style="font-size: 0.4em; color: #b7b7b7;margin-left: 10px; margin-right: 10px; max-height: 150px; overflow: auto">
            included hashtags:<br>
            #丰县辟谣被拴破屋八孩母亲系拐卖 <br>
            #丰县回应八孩母亲被拴破屋 <br>
            #江苏丰县回应八孩母亲被拴破屋 <br>
            #官方回应八孩母亲被拴破屋疑遭家暴 <br>
            #官方回应徐州八孩母亲被拴破屋 <br>
            #官方通报生育八孩女子情况 <br>
            #丰县官方通报生育八孩女子情况 <br>
            #官方通报徐州丰县生育八孩女子情况 <br>
            #官方救治江苏八孩母亲 <br>
            #江苏丰县回应生育八孩女子情况 <br>
            #官方通报丰县生育8孩女子事件 <br>
        </div>

        <a id="showFullHashtag" href="javascript:void(0);" rel="external nofollow" onclick="showFullHashtag()"
           style="font-size: 0.4em; margin-left: 10px; color: #eeb106; display: inline-flex; margin-bottom: 8px">show
            more</a>

    </div>

    <!--日期div-->
    <div id="dateDiv" style="position: fixed; font-size: 0.75em; color: #eeb106; user-select: none">
        Jan 28, 2022
    </div>

    <!--    隐形div，用于点击seed事件之后阻隔与svg的交互   -->
    <div id="invisibleBlock" style="display: none; position: fixed;" onclick="blockDivOnClick()"></div>


</div>

<div id="windLineBg" style="width: 96%; display: block; position: fixed; z-index: -1; opacity: 0"></div>
<!--z-index设置为-1，不然会影响tooltip的响应-->

<!--more info (tooltip panel) icon -->
<div>
    <img id="showTooltipOverlayImg" src="asset/svg/info.svg" style="position:fixed;width:50px; top: 0px; right: 0px" onclick="showTooltipOverlay()"/>
</div>

<!--覆盖的详细tooltip-->
<div id="overlayTooltip" style="display: none">
    <h1 style="font-size: 1.5em; margin: 30px; margin-top: 20px; margin-bottom: 15px; color: #2d2d2d">How to read</h1>
    <div class="row" style=" margin-left: 30px; margin-right: 30px">
        <div class="col-lg" style="padding: 0px; padding-right: 30px">
            <div style="margin-bottom: 40px;">
                <h2 style="font-size: 1em; color: #2d2d2d"> <img src="asset/svg/hashtag.svg" style="display:inline-flex;width:40px;height:auto;"/> Hashtag groups</h2>

                <p class="overlayTooltipcontent">
                    <!--                    There are 8 hashtag groups in total, marked with<img src="svg/hashtag.svg" style="display:inline-flex;width:30px;height:auto;"/>icons. Hover on these icons to see detailed information of each group.-->
                    <!--                    Click the <img src="svg/vane2.svg" style="display:inline-flex;width:30px;height:auto;margin-left: 4px; margin-right: 4px"/>  icon on the tooltip to jump to related investigation reports.-->
                    <!--                    There is an additional group on the far right, containing posts without hashtags.-->
                    Corresponding to "8 wisps of wind" mentioned before, posts are categorized into 8 groups by the similarity of their hashtags.
                    The ninth group on the right is for posts without hashtags.
                    All the posts from each group are presented in a vertical timeline, the more posts clustered at some time means more discussion under this hashtag topic at the moment.
                    <br>
                    Click the hashtag icon to explore details.

                </p>

                <!--                <p class="overlayTooltipcontent">-->
                <!--                    Each group has a corresponding vertical timeline, to which posts within this group are attached.-->
                <!--                </p>-->

            </div>

            <div style="margin-bottom: 40px; margin-top: 30px">
                <h2 style="font-size: 1em"> <img src="asset/svg/vane.svg" style="display:inline-flex;width:46px;height:auto;"/> Investigation reports</h2>

                <p class="overlayTooltipcontent">
                    <!--                    While scrolling through the timeline, there are 6 investigation reports from government, which are represented by a wind vane icon<img src="svg/vane.svg" style="display:inline-flex;width:46px;height:auto;"/>.-->
                    <!--                为什么是kv；官方通报；县级市级不断升级；升级因为舆论推动；顺带解释风向标含义      -->
                    <!--                    Hover on these icons to see detailed information of each investigation report. Click the  <img src="svg/hashtag2.svg" style="display:inline-flex;width:28px;height:auto;margin-left: 4px; margin-right: 4px"/>  icon on the tooltip to jump to related hashtag group.-->
                    <!--            It’s also noteworthy that key events has a close relation with the first six hashtag groups.-->

                    While scrolling the timeline, the report that was released by authorities at that time shows up on the left and next to the posts.
                    <br>
                    Click the wind vane icon to see details.

                </p>
            </div>

            <div style="margin-bottom: 40px; margin-top: 30px">
                <h2 style="font-size: 1em"> <img src="asset/svg/stream_graph.svg" style="display:inline-flex;height:46px;width:auto;margin-right: 8px"/> Stream graph</h2>

                <p class="overlayTooltipcontent">
                    The stream graph on the right offers a global view of all hashtag groups throughout 32 days in terms of “number of hot posts”, “times of view”, “times of discussion” and “number of originals”
                </p>

                <p class="overlayTooltipcontent">
                    All the investigation reports are represented as circles near the stream graph. Click these circles to directly scroll to corresponding investigation report.
                </p>
            </div>

        </div>

        <div class="col-lg" style="padding-left: 30px">
            <h2 style="font-size: 1em">Samara seeds</h2>
            <p class="overlayTooltipcontent">
                Each seed represents a popular Weibo post with the keyword “丰县(Fengxian)” from Jan 28, 2022 to Feb 28, 2022.
            </p>
            <div class="row">
                <div class="col-lg">
                    <!--follower Tooltip-->
                    <div style="margin-bottom: 38px">
                        <p style="font-size: 0.7em; font-weight: bold; margin-bottom: 10px"> Followers </p>
                        <p class="overlayTooltipcontent"style="font-size: 0.4em">The size of the seed head shows how many followers the poster had at the time.</p>
                        <div id="followerTooltip"></div>
                        <div class="overlayTooltipcontent" style="font-size: 0.3em; display: flex; justify-content: space-between; padding-left: 30px; padding-right: 30px">
                            <p style="display: inline-flex; margin-bottom: 0px">≤10K</p>
                            <p style="display: inline-flex; margin-bottom: 0px">10K-1M</p>
                            <p style="display: inline-flex; margin-bottom: 0px">>1M</p>
                        </div>
                    </div>

                    <!--retweet Tooltip-->
                    <div style="margin-bottom: 20px">
                        <p style="font-size: 0.7em; font-weight: bold; margin-bottom: 10px"> Retweets </p>
                        <p class="overlayTooltipcontent"style="font-size: 0.4em">The length of the seed stem represents the number of retweets.</p>
                        <div id="retweetTooltip"></div>
                        <div class="overlayTooltipcontent" style="font-size: 0.3em; display: flex; justify-content: space-between; padding-left: 30px; padding-right: 30px">
                            <p style="display: inline-flex; margin-bottom: 0px; user-select: none;">≤500</p>
                            <div style="display: inline-flex;">
                                <p style="margin-bottom: 0px; user-select: none;">>500:</p>
                                <div id="retweetDragBg" style="background: #e5e1d9; opacity: 0.6; width:120px; height:6px; border-radius: 3px; justify-content: center; align-self: center; margin-left: 15px">
                                    <div id="retweetDragBox" style="position: relative; top: -1px; left: 0px; width: 12px; height: 8px; border-radius: 4px; background: #FFCA36; ">
                                        <p id="retweetNum" style="position:relative; top: 6px; user-select: none;display: none">500</p>
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>

                    <!--comment Tooltip-->
                    <div style="margin-bottom: 20px">
                        <p style="font-size: 0.7em; font-weight: bold; margin-bottom: 10px"> Comments </p>
                        <p class="overlayTooltipcontent"style="font-size: 0.4em">The wing pattern shows the number of comments. (hover on the head of seeds to see patterns)</p>
                        <div id="commentTooltip"></div>
                        <div class="overlayTooltipcontent" style="font-size: 0.3em; display: flex; justify-content: space-between; padding-left: 30px; padding-right: 30px">
                            <p style="display: inline-flex; margin-bottom: 0px">≤10</p>
                            <p style="display: inline-flex; margin-bottom: 0px">10-100</p>
                            <p style="display: inline-flex; margin-bottom: 0px">>100</p>
                        </div>
                    </div>


                </div>

                <div class="col-lg">
                    <!--vlevel tooltip-->
                    <div style="margin-bottom: 20px">
                        <p style="font-size: 0.7em; font-weight: bold; margin-bottom: 10px"> Account Type </p>
                        <p class="overlayTooltipcontent"style="font-size: 0.4em">The dots near the seed head indicates Weibo account type of the poster.</p>
                        <div id="vlevelTooltip"></div>
                        <div class="overlayTooltipcontent" style="font-size: 0.3em; display: flex; justify-content: space-between; padding-left: 10px; padding-right: 10px">
                            <p class="col-3 text-center" style="display: inline-flex; margin-bottom: 0px">Individual Lv.1</p>
                            <p class="col-3 text-center" style="display: inline-flex; margin-bottom: 0px">Individual Lv.2</p>
                            <p class="col-3 text-center" style="display: inline-flex; margin-bottom: 0px">Individual Lv.3</p>
                            <p class="col-3 text-center" style="display: inline-flex; margin-bottom: 0px">Enterprise Account</p>
                        </div>
                    </div>

                    <!--like tooltip-->
                    <div style="margin-bottom: 20px">
                        <p style="font-size: 0.7em; font-weight: bold; margin-bottom: 10px"> Likes </p>
                        <p class="overlayTooltipcontent"style="font-size: 0.4em">The width of the seed wing represents the number of likes.</p>
                        <div id="likeTooltip"></div>
                        <div class="overlayTooltipcontent" style="font-size: 0.3em; display: flex; justify-content: space-between; padding-left: 30px; padding-right: 30px">
                            <p style="display: inline-flex; margin-bottom: 0px; user-select: none;">≤5000</p>
                            <div style="display: inline-flex;">
                                <p style="margin-bottom: 0px; user-select: none;">>5000:</p>
                                <div id="likeDragBg" style="background: #e5e1d9; opacity: 0.6; width:120px; height:6px; border-radius: 3px; justify-content: center; align-self: center; margin-left: 15px">
                                    <div id="likeDragBox" style="position: relative; top: -1px; left: 0px; width: 12px; height: 8px; border-radius: 4px; background: #FFCA36; ">
                                        <p id="likeNum" style="position:relative; top: 6px; user-select: none;display: none">5000</p>
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>

                    <!--emotion Tooltip-->
                    <div style="margin-bottom: 20px">
                        <p style="font-size: 0.7em; font-weight: bold; margin-bottom: 10px"> Sentiment </p>
                        <p class="overlayTooltipcontent"style="font-size: 0.4em">The color of the seed head represents the sentiment of the post text. (hover to see the animation)</p>
                        <div id="emotionTooltip"></div>
                        <div class="overlayTooltipcontent" style="font-size: 0.3em; display: flex; justify-content: space-between; padding-left: 30px; padding-right: 30px">
                            <p style="display: inline-flex; margin-bottom: 0px">negative</p>
                            <div style="display: inline-flex;">
                                <div id="emotionDragBg" style="background: #e5e1d9; opacity: 0.6; width:120px; height:6px; border-radius: 3px; justify-content: center; align-self: center; margin: 0px">
                                    <div id="emotionDragBox" style="position: relative; top: -1px; left: 54px; width: 12px; height: 8px; border-radius: 4px; background: #FFCA36; ">
                                        <p id="emotionNum" style="position:relative; top: 6px; user-select: none;display: none"></p>
                                    </div>
                                </div>
                            </div>
                            <p style="display: inline-flex; margin-bottom: 0px">positive</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>



<!--bootstrap5 tooltip 属性设置-->
<script>
    $(function () {
        $("[data-toggle='tooltip']").tooltip();

        //设置tooltip为点击之后隐藏
        $('[data-toggle="tooltip"]').click(function () {
            $('[data-toggle="tooltip"]').tooltip("hide");

        });
    });
</script>

<!--基本函数设置-->
<script>
    function transNum(x) //转化数字格式
    {
        if (x < 1000)
            return x.toString();
        else if (x < 10000)
            return x.toString()[0] + ',' + x.toString().substring(1); //补上千位的逗号
        else if (x < 1000000)
            if ((x / 1000).toFixed(1)[(x / 1000).toFixed(1).length - 1] == "0") //如果末尾为0，舍去最后两位
                return (x / 1000).toFixed(1).substring(0, (x / 1000).toFixed(1).length - 2) + "K"
            else
                return (x / 1000).toFixed(1) + "K"
        else if (x < 1000000000)
            if ((x / 1000000).toFixed(1)[(x / 1000000).toFixed(1).length - 1] == "0") //如果末尾为0，舍去最后两位
                return (x / 1000000).toFixed(1).substring(0, (x / 1000000).toFixed(1).length - 2) + "M"
            else
                return (x / 1000000).toFixed(1) + "M"
        else if ((x / 1000000000).toFixed(1)[(x / 1000000000).toFixed(1).length - 1] == "0") //如果末尾为0，舍去最后两位
            return (x / 1000000000).toFixed(1).substring(0, (x / 1000000000).toFixed(1).length - 2) + "B"
        else
            return (x / 1000000000).toFixed(1) + "B"
    }
</script>

<!--设置铁链女视频属性-->
<script>
    //设置视频位置
    d3.select("#newsVideoDiv")
        .style("top", `${(window.innerHeight - 395) / 2}px`)
        .style("left", `${(window.innerWidth - 702) / 2}px`)

    //设置遮挡div位置与大小
    d3.select("#newsVideoDivBlock")
        .style("width", `${window.innerWidth}px`)
        .style("height", `${window.innerHeight}px`);

    var isVideoShow = false;

    var showHideVideo = function () {
        console.log("jode")
        if (!isVideoShow) {
            d3.select("#newsVideoDiv")
                .style("display", "block");
            d3.select("#newsVideoDivBlock")
                .style("display", "block");

            isVideoShow = true;

            //禁止页面滑动
            let mo = function (e) {
                passive: false;
            };
            document.body.style.overflow = 'hidden';
            document.addEventListener("touchmove", mo, false);
        } else {
            d3.select("#newsVideoDiv")
                .style("display", "none");
            d3.select("#newsVideoDivBlock")
                .style("display", "none");

            isVideoShow = false;

            //允许页面滑动
            let mo = function (e) {
                passive: false
            };
            document.body.style.overflow = '';
            document.removeEventListener("touchmove", mo, false);
        }

    }
</script>

<!--设置整体tooltip-->
<script>
    //右下角图标
    // d3.select("#showTooltipOverlayImgIntro")
    //     .style("right", `${160 / 1728 * window.innerWidth}px`)
    //     .style("top", `${0.91 * window.innerHeight}px`)

    //整体tooltip大小
    d3.select("#overlayTooltipIntroPart")
        .style("width", `${0.74 * window.innerWidth}px`)
        .style("height", `${640 / 886 * window.innerHeight}px`)
        .style("top", `${123 / 886 * window.innerHeight}px`)
        .style("left", `${0.13 * window.innerWidth}px`);

    d3.select("#overlayTooltipIntroPart_wind")
        .style("width", `${0.54 * window.innerWidth}px`)
        .style("height", `${450 / 886 * window.innerHeight}px`)
        .style("top", `${218 / 886 * window.innerHeight}px`)
        .style("left", `${0.23 * window.innerWidth}px`);

    //设置遮挡div
    d3.select("#invisibleBlock_Intro")
        .style("height", `${window.innerHeight}px`)
        .style("width", `${window.innerWidth}px`)
        .style("opacity", 0.3)
        .style("background-color", "#000")


    var isShowTooltipOverlayIntro = false;
    //点击右下角图标事件
    var showTooltipOverlayIntro = function () {
        if (!isShowTooltipOverlayIntro) {
            d3.select("#invisibleBlock_Intro")
                .style("display", "block");

            d3.select("#overlayTooltipIntroPart")
                .style("display", "block");
            isShowTooltipOverlayIntro = true;

        }
    }

    var isShowTooltipOverlayIntro_wind = false;
    //点击右下角图标事件
    var showTooltipOverlayIntro_wind = function () {
        if (!isShowTooltipOverlayIntro_wind) {
            d3.select("#invisibleBlock_Intro")
                .style("display", "block");

            d3.select("#overlayTooltipIntroPart_wind")
                .style("display", "block");
            isShowTooltipOverlayIntro_wind = true;

        }
    }

    var invisibleBlock_Intro_click = function () {
        if (isShowTooltipOverlayIntro) {
            d3.select("#invisibleBlock_Intro")
                .style("display", "none");

            d3.select("#overlayTooltipIntroPart")
                .style("display", "none");

            isShowTooltipOverlayIntro = false;
        }

        if (isShowTooltipOverlayIntro_wind) {
            d3.select("#invisibleBlock_Intro")
                .style("display", "none");

            d3.select("#overlayTooltipIntroPart_wind")
                .style("display", "none");

            isShowTooltipOverlayIntro_wind = false;
        }

    }


    //follower部分tooltip
    var followerSvg = d3.select("#followerTooltipIntro")
        .append("svg")
        .attr("width", `100%`)
        .attr("height", `${50}px`)

    var followerDefs = followerSvg.append("defs");

    geneSeed_Tp_Intro(followerSvg, followerDefs, 1, 100, 30, 1, 0.5, 1, false, "normal", 0.3, 1, 1, 1);
    geneSeed_Tp_Intro(followerSvg, followerDefs, 2, 280, 27.5, 2, 0.5, 1, false, "yellow", 0.3, 1, 1, 1);
    geneSeed_Tp_Intro(followerSvg, followerDefs, 3, 460, 25, 3, 0.5, 1, false, "yellow", 0.3, 1, 1, 1);


    //vlevel部分tooltip
    var vlevelSvg = d3.select("#vlevelTooltipIntro")
        .append("svg")
        .attr("width", `100%`)
        .attr("height", `${50}px`)

    var vlevelDefs = vlevelSvg.append("defs");

    geneSeed_Tp_Intro(vlevelSvg, vlevelDefs, 4, 42, 30, 1, 0.5, 1, true, "normal", 0.3, 1, 1, 1);
    geneSeed_Tp_Intro(vlevelSvg, vlevelDefs, 5, 170, 30, 1, 0.5, 1, true, "yellow", 0.3, 1, 1, 1);
    geneSeed_Tp_Intro(vlevelSvg, vlevelDefs, 6, 320, 30, 1, 0.5, 1, true, "gold", 0.3, 1, 1, 1);
    geneSeed_Tp_Intro(vlevelSvg, vlevelDefs, 7, 470, 30, 1, 0.5, 1, true, "blue", 0.3, 1, 1, 1);

    //retweet部分tooltip
    var retweetSvg = d3.select("#retweetTooltipIntro")
        .append("svg")
        .attr("width", `100%`)
        .attr("height", `${50}px`)

    var retweetDefs = retweetSvg.append("defs");

    geneSeed_Tp_Intro(retweetSvg, retweetDefs, 8, 100, 30, 1, 0.5, 1, false, "normal", 0.3, 1, 1, 1);
    geneSeed_Tp_Intro(retweetSvg, retweetDefs, 9, 320, 32, 1, 0.5, 1, false, "yellow", 0.3, 1, 1, 500);
    //滑条：cy从30到42；retweet从500到5k

    //likes部分tooltip
    var likeSvg = d3.select("#likeTooltipIntro")
        .append("svg")
        .attr("width", `100%`)
        .attr("height", `${50}px`)

    var likeDefs = likeSvg.append("defs");

    geneSeed_Tp_Intro(likeSvg, likeDefs, 10, 100, 30, 1, 0.5, 1, false, "normal", 0.3, 1, 1, 1);
    geneSeed_Tp_Intro(likeSvg, likeDefs, 11, 320, 32, 1, 0.5, 1, false, "yellow", 0.3, 1, 1, 500);

    //comment部分tooltip
    var commentSvg = d3.select("#commentTooltipIntro")
        .append("svg")
        .attr("width", `100%`)
        .attr("height", `${50}px`)

    var commentDefs = commentSvg.append("defs");

    geneSeed_Tp_Intro(commentSvg, commentDefs, 12, 100, 30, 1, 0.5, 1, false, "normal", 0.3, 1, 1, 1);
    geneSeed_Tp_Intro(commentSvg, commentDefs, 13, 270, 30, 1, 0.5, 2, false, "yellow", 0.3, 1, 100, 1);
    geneSeed_Tp_Intro(commentSvg, commentDefs, 14, 460, 30, 1, 0.5, 3, false, "yellow", 0.3, 1, 200, 1);

    //emotion部分tooltip
    var emotionSvg = d3.select("#emotionTooltipIntro")
        .append("svg")
        .attr("width", `100%`)
        .attr("height", `${50}px`)

    var emotionDefs = emotionSvg.append("defs");

    geneSeed_Tp_Intro(emotionSvg, emotionDefs, 15, 210, 30, 1, 0.5, 3, false, "yellow", 0.3, 1, 200, 1);


    function geneSeed_Tp_Intro(tooltipSvg, tooltipDef, index, cx, cy, followercat, emo_neg_prob, commentCat, isVlevelOn, vlevel, gScale, like, comment, retweet,) {
        var scaleLengthId;
        var scaleWidthId;

        //like的映射计算; like的max值为2457804; 计算scaleWidthId
        let likeScale = d3.scaleLinear()
            .domain([0, 2.7])
            .range([1, 3]); //映射到的scaleWid范围
        if (like <= 5000) {
            scaleWidthId = 1;
        } else {
            scaleWidthId = likeScale(Math.log(like / 5000) / Math.log(10)) //取以10为底的对数
        }

        //retweet的映射计算；retweet的max值为418438；计算scaleLengthId
        let retweetScale = d3.scaleLinear()
            .domain([0, 3])
            .range([1, 3]); //映射到的scaleLen范围
        if (retweet <= 500) {
            scaleLengthId = 1;
        } else {
            scaleLengthId = retweetScale(Math.log(retweet / 500) / Math.log(10)) //取以10为底的对数
        }


        var group1 = tooltipSvg
            .append("g")
            .attr("id", `Tp_seed_Intro${index}`)
            .attr("transform", `translate(${cx}, ${cy}), rotate(-30) ,scale(${gScale})`) //rotate(-20,300,400)
        //.attr("transform","rotate(30,600,400)");

        //叶子宽度参数调整
        group1.append("path")
            .attr("d", `M ${185.11 * scaleLengthId} 23 ` +
                `C ${192.21 * scaleLengthId} 34.23 ${156.54 * 1.2 * scaleLengthId} ${57.89 * scaleWidthId} ${132.11 * scaleLengthId} ${57.89 * scaleWidthId} ` +
                `C ${100.6 * scaleLengthId} ${57.89 * scaleWidthId} ${75.04 * 0.8 * scaleLengthId} 30.79 38.58 30.79 ` +
                "C 50.93 16.55 69 8.67 69 8.67 " +
                `S ${162.94 * scaleLengthId} -12.13 ${185.11 * scaleLengthId} 23 ` +
                "Z")
            .style("fill", "#FFCA36")
            .style("opacity", "0.2")
            .style("stroke", "none");

        //评论数量调整纹理
        if (commentCat == 1) {

            group1.append("path")
                .attr("d", `M ${92.56 * (1.2 - 0.2 * scaleLengthId) * scaleLengthId} ${4.3} C ${109.32 * (1.2 - 0.2 * scaleLengthId) * scaleLengthId} ${4.3} ${119.8 * (1.2 - 0.2 * scaleLengthId) * scaleLengthId} ${18.52 * scaleWidthId} ${121.61 * (1.2 - 0.2 * scaleLengthId) * scaleLengthId} ${32.74 * scaleWidthId}`)
                .style("stroke-linecap", "round")
                .attr("stroke-width", "2")
                .attr("opacity", "0.2")
                .attr("fill", "none")
                .attr("class", `Tp_seedleaf_Intro${index}`)
                .style("stroke", "#FFCA36");

            group1.append("path")
                .attr("d", `M${125.75 * scaleLengthId},2.55 C ${142.51 * scaleLengthId},2.55,${153 * scaleLengthId},${16.77 * scaleWidthId},${154.8 * scaleLengthId},${31 * scaleWidthId}`)
                // .attr("stroke", "#FFCA36")
                .style("stroke-linecap", "round")
                .attr("stroke-width", "2")
                .attr("opacity", "0.2")
                .attr("fill", "none")
                .attr("class", `Tp_seedleaf_Intro${index}`)
                .style("stroke", "#FFCA36");

        } else if (commentCat == 2) {

            group1.append("path")
                .attr("d", `M ${83.27 * (1.2 - 0.2 * scaleLengthId) * scaleLengthId} ${5.93 - Math.min(2, 2 * (scaleLengthId - 1))} C ${100.04 * (1.2 - 0.2 * scaleLengthId) * scaleLengthId} ${5.93 - Math.min(2, 2 * (scaleLengthId - 1))} ${110.52 * (1.2 - 0.2 * scaleLengthId) * scaleLengthId} ${20.15 * 0.8 * scaleWidthId} ${112.33 * (1.2 - 0.2 * scaleLengthId) * scaleLengthId} ${34.37 * 0.8 * scaleWidthId}`)
                .style("stroke-linecap", "round")
                .attr("stroke-width", "2")
                .attr("opacity", "0.2")
                .attr("fill", "none")
                .attr("class", `Tp_seedleaf_Intro${index}`)
                .style("stroke", "#FFCA36");

            group1.append("path")
                .attr("d", `M ${107.93 * (1.1 - 0.1 * scaleLengthId) * scaleLengthId} 2.55 C ${124.7 * (1.1 - 0.1 * scaleLengthId) * scaleLengthId} 2.55 ${138.45 * (1.1 - 0.1 * scaleLengthId) * scaleLengthId} ${16.77 * scaleWidthId} ${140.99 * (1.1 - 0.1 * scaleLengthId) * scaleLengthId} ${39.41 * scaleWidthId}`)
                .style("stroke-linecap", "round")
                .attr("stroke-width", "2")
                .attr("opacity", "0.2")
                .attr("fill", "none")
                .attr("class", `Tp_seedleaf_Intro${index}`)
                .style("stroke", "#FFCA36");

            group1.append("path")
                .attr("d", `M ${134 * scaleLengthId} 2.55 C ${150.76 * scaleLengthId} 2.55 ${159.2 * scaleLengthId} ${16.77 * scaleWidthId} ${161 * scaleLengthId} ${30.99 * scaleWidthId}`)
                .style("stroke-linecap", "round")
                .attr("stroke-width", "2")
                .attr("opacity", "0.2")
                .attr("fill", "none")
                .attr("class", `Tp_seedleaf_Intro${index}`)
                .style("stroke", "#FFCA36");


        } else {

            group1.append("path")
                .attr("d", `M ${71.86 * scaleLengthId} ${7.82 - Math.min(4, 4 * (scaleLengthId - 1))} C ${88.62 * scaleLengthId} 7.82 ${97.72 * scaleLengthId} ${24 * scaleWidthId} ${99.53 * scaleLengthId} ${38.19 * scaleWidthId}`)
                .style("stroke-linecap", "round")
                .attr("stroke-width", "2")
                .attr("opacity", "0.2")
                .attr("fill", "none")
                .attr("class", `Tp_seedleaf_Intro${index}`)
                .style("stroke", "#FFCA36");

            group1.append("path")
                .attr("d", `M ${97.8 * scaleLengthId} ${4.3 - Math.min(1.2, 1.2 * (scaleLengthId - 1))} C ${114.57 * scaleLengthId} 4.3 ${122.31 * scaleLengthId} ${29.05 * scaleWidthId} ${124.12 * scaleLengthId} ${43.3 * scaleWidthId}`)
                .style("stroke-linecap", "round")
                .attr("stroke-width", "2")
                .attr("opacity", "0.2")
                .attr("fill", "none")
                .attr("class", `Tp_seedleaf_Intro${index}`)
                .style("stroke", "#FFCA36");

            group1.append("path")
                .attr("d", `M ${119.78 * scaleLengthId} 2.55 C ${136.55 * scaleLengthId} 2.55 ${144.29 * scaleLengthId} ${27.3 * scaleWidthId} ${146.09 * scaleLengthId} ${41.55 * scaleWidthId}`)
                .style("stroke-linecap", "round")
                .attr("stroke-width", "2")
                .attr("opacity", "0.2")
                .attr("fill", "none")
                .attr("class", `Tp_seedleaf_Intro${index}`)
                .style("stroke", "#FFCA36");

            group1.append("path")
                .attr("d", `M ${140.49 * scaleLengthId} ${2.55 + Math.min(2.5, 2.5 * (scaleLengthId - 1))} C ${157.26 * scaleLengthId} 2.55 ${163.49 * scaleLengthId} ${22.83 * scaleWidthId} ${164.84 * scaleLengthId} ${33.67 * scaleWidthId}`)
                .style("stroke-linecap", "round")
                .attr("stroke-width", "2")
                .attr("opacity", "0.2")
                .attr("fill", "none")
                .attr("class", `Tp_seedleaf_Intro${index}`)
                .style("stroke", "#FFCA36");
        }

        //悬停交互
        var mouseover = function (d) {
            console.log(d3.select(this)
                .attr("id")
                .split("Tp_tooltipCircle_Intro")[1]
            )

            d3.select(`#Tp_emo_grad_end_Intro${d3.select(this)
                .attr("id")
                .split("Tp_tooltipCircle_Intro")[1]}`)
                .transition()
                .duration(500)
                .attr("offset", "1")
                .style("stop-opacity", "100%")

            d3.select(`#Tp_emo_grad_start_Intro${d3.select(this)
                .attr("id")
                .split("Tp_tooltipCircle_Intro")[1]}`)
                .transition()
                .duration(500)
                // .attr("offset", "1")
                .style("stop-color", "#ffca36");

            d3.selectAll(`.Tp_seedleaf_Intro${d3.select(this)
                .attr("id")
                .split("Tp_tooltipCircle_Intro")[1]}`)
                .transition()
                .duration(500)
                // .attr("offset", "1")
                .attr("opacity", "100%");

        }
        var mousemove = function (d) {

        }
        var mouseleave = function (d) {

            d3.select(`#Tp_emo_grad_end_Intro${d3.select(this)
                .attr("id")
                .split("Tp_tooltipCircle_Intro")[1]}`)
                .transition()
                .duration(500)
                .attr("offset", "0.1")
                .style("stop-opacity", "0")

            d3.select(`#Tp_emo_grad_start_Intro${d3.select(this)
                .attr("id")
                .split("Tp_tooltipCircle_Intro")[1]}`)
                .transition()
                .duration(500)
                // .attr("offset", "1")
                .style("stop-color", d3.select(
                    `#Tp_emo_grad_end_Intro${d3.select(this)
                        .attr("id")
                        .split("Tp_tooltipCircle_Intro")[1]}`)
                    .style("stop-color"));

            d3.selectAll(`.Tp_seedleaf_Intro${d3.select(this)
                .attr("id")
                .split("Tp_tooltipCircle_Intro")[1]}`)
                .transition()
                .duration(500)
                // .attr("offset", "1")
                .attr("opacity", "0.2");
        }


        //叶子长度参数调整; 粉丝数影响头部大小
        if (followercat == 1) {
            group1.append("path")
                .attr("d", "M 57.6 6.89 " +
                    "C 46 7.89 29.85 6.42 20.6 6.77 " +
                    `C 9.22 7.2 ${-1.68} 9.24 ${0.22} 18.61` +
                    `C 2.28 28.77 8.25 ${37} 21.44 ${37} ` +
                    "C 44 37 57.07 12.5 75 8.92 " +
                    `S ${162.06 * scaleLengthId} -6 ${185.11 * scaleLengthId} 23 ` +
                    `C ${181.44 * scaleLengthId} ${11.63 + 1 * scaleLengthId} ${157.88 * scaleLengthId} 0 ${126.41 * (1.2 - 0.2 * scaleLengthId) * (scaleLengthId)} 0 ` +
                    "S 81.12 4.86 57.6 6.89 " +
                    "Z")
                .attr("id", `Tp_seedStem_Intro${index}`)
                .style("fill", "#FFCA36")
                .style("stroke", "none");

            group1.append("circle")
                .attr("cx", 24)
                .attr("cy", 26)
                .attr("r", 18)
                .attr("id", `Tp_tooltipCircle_Intro${index}`)
                .attr("fill", "#000")
                .attr("opacity", "0")
                .on("mouseover", mouseover)
                .on("mousemove", mousemove)
                .on("mouseleave", mouseleave);

        } else if (followercat == 2) {

            group1.append("path")
                .attr("d", "M 57.6 6.89 " +
                    "C 46 7.89 29.85 6.42 20.6 6.77 " +
                    "C 9.22 7.2 -16.088 6.503 -14.043 25.517 " +
                    "C -12.048 39.53 -3.46 53.836 19.941 52.99 " +
                    "C 48.698 50.735 57.07 12.5 75 8.92 " +
                    `S ${162.06 * scaleLengthId} -6 ${185.11 * scaleLengthId} 23 ` +
                    `C ${181.44 * scaleLengthId} ${11.63 + 1 * scaleLengthId} ${157.88 * scaleLengthId} 0 ${126.41 * (1.2 - 0.2 * scaleLengthId) * (scaleLengthId)} 0 ` +
                    "S 81.12 4.86 57.6 6.89 " +
                    "Z")
                .attr("id", `Tp_seedStem_Intro${index}`)
                .style("fill", "#FFCA36")
                .style("stroke", "none");

            group1.append("circle")
                .attr("cx", 18)
                .attr("cy", 32)
                .attr("r", 25)
                .attr("id", `Tp_tooltipCircle_Intro${index}`)
                .attr("fill", "#000")
                .attr("opacity", "0")
                .on("mouseover", mouseover)
                .on("mousemove", mousemove)
                .on("mouseleave", mouseleave);

        } else {

            group1.append("path")
                .attr("d", "M 57.6 6.89 C 46 7.89 29.85 6.42 20.6 6.77 C 9.22 7.2 -41.583 4.467 -40.905 37.759 C -39.289 56.31 -25.731 82.914 10.897 81.111 C 57.311 75.993 52.579 16.323 75 8.92" +
                    `S ${162.06 * scaleLengthId} -6 ${185.11 * scaleLengthId} 23 ` +
                    `C ${181.44 * scaleLengthId} ${11.63 + 1 * scaleLengthId} ${157.88 * scaleLengthId} 0 ${126.41 * (1.2 - 0.2 * scaleLengthId) * (scaleLengthId)} 0 ` +
                    "S 81.12 4.86 57.6 6.89 " +
                    "Z")
                .attr("id", `Tp_seedStem_Intro${index}`)
                .style("fill", "#FFCA36")
                .style("stroke", "none");

            group1.append("circle")
                .attr("cx", 15)
                .attr("cy", 35)
                .attr("r", 30)
                .attr("id", `Tp_tooltipCircle_Intro${index}`)
                .attr("fill", "#000")
                .attr("opacity", "0")
                .on("mouseover", mouseover)
                .on("mousemove", mousemove)
                .on("mouseleave", mouseleave);
        }

        //定义情感的线性渐变
        {
            //目前：为每一个帖子定制一个defs：长度不同（x2不同）；末端颜色不同
            let emo_grad = tooltipDef.append("linearGradient")
                .attr("id", `Tp_emo_grad_Intro${index}`)
                .attr("gradientUnits", "userSpaceOnUse")
                .attr("x1", "57.6")
                .attr("y1", "6.89")
                .attr("x2", `${185.11 * scaleLengthId}`)
                .attr("y2", "23");

            //内容情感
            if (emo_neg_prob <= 0.5) {
                // console.log("a")
                let a = d3.rgb(129, 233, 59);	//积极一端的颜色
                let b = d3.rgb(255, 202, 54);	//橙色
                let linear = d3.scaleLinear()
                    .domain([0, 0.5])
                    .range([0, 1])
                let compute = d3.interpolate(a, b);
                let endColor = compute(linear(emo_neg_prob))

                let stop1 = emo_grad.append("stop")
                    .attr("id", `Tp_emo_grad_start_Intro${index}`)
                    .attr("offset", "0")
                    .style("stop-color", endColor);

                let stop2 = emo_grad.append("stop")
                    .attr("id", `Tp_emo_grad_end_Intro${index}`)
                    .attr("offset", "0.1")
                    .style("stop-opacity", "0")
                    .style("stop-color", endColor);

                d3.select(`#Tp_seedStem_Intro${index}`)
                    .style("fill", "url(#" + emo_grad.attr("id") + ")");

            } else {
                let a = d3.rgb(237, 28, 36);	//消极一端的颜色
                let b = d3.rgb(255, 202, 54);	//橙色
                let linear = d3.scaleLinear()
                    .domain([0.5, 1])
                    .range([0, 1])
                let compute = d3.interpolate(b, a);
                let endColor = compute(linear(emo_neg_prob))

                let stop1 = emo_grad.append("stop")
                    .attr("id", `Tp_emo_grad_start_Intro${index}`)
                    .attr("offset", "0")
                    .style("stop-color", endColor);

                let stop2 = emo_grad.append("stop")
                    .attr("id", `Tp_emo_grad_end_Intro${index}`)
                    .attr("offset", "0.1")
                    .style("stop-opacity", "0")
                    .style("stop-color", endColor);

                d3.select(`#Tp_seedStem_Intro${index}`)
                    .style("fill", "url(#" + emo_grad.attr("id") + ")");

            }
        }


        if (isVlevelOn) {
            // 微博等级
            if (vlevel == "normal") {
                group1.append("circle")
                    .attr("cx", "8")
                    .attr("cy", "-5")
                    .attr("r", "10")
                    .attr("stroke", "none")
                    .attr("fill", "#FFCA36")
                    .attr("opacity", "0.3")
            } else if (vlevel == "yellow") {
                group1.append("circle")
                    .attr("cx", "8")
                    .attr("cy", "-5")
                    .attr("r", "10")
                    .attr("stroke", "none")
                    .attr("fill", "#FFCA36")
                    .attr("opacity", "0.5")
                group1.append("circle")
                    .attr("cx", "32")
                    .attr("cy", "-8")
                    .attr("r", "10")
                    .attr("stroke", "none")
                    .attr("fill", "#FFCA36")
                    .attr("opacity", "0.3")
            } else if (vlevel == "gold") {
                group1.append("circle")
                    .attr("cx", "8")
                    .attr("cy", "-5")
                    .attr("r", "10")
                    .attr("stroke", "none")
                    .attr("fill", "#FFCA36")
                    .attr("opacity", "0.8")
                group1.append("circle")
                    .attr("cx", "32")
                    .attr("cy", "-8")
                    .attr("r", "10")
                    .attr("stroke", "none")
                    .attr("fill", "#FFCA36")
                    .attr("opacity", "0.5")
                group1.append("circle")
                    .attr("cx", "56")
                    .attr("cy", "-8")
                    .attr("r", "10")
                    .attr("stroke", "none")
                    .attr("fill", "#FFCA36")
                    .attr("opacity", "0.3")
            } else {
                group1.append("circle")
                    .attr("cx", "8")
                    .attr("cy", "-5")
                    .attr("r", "10")
                    .attr("stroke", "none")
                    .attr("fill", "#3694ff")
                    .attr("opacity", "0.8")
            }
        }

    }


</script>

<!--读取hashtag 的json数据-->
<script>
    let hashtagNodes_wind;

    //读取hashtag相关数据
    d3.json("asset/json/hashtagGroup_unlinked.json").then(function (data) {

        hashtagNodes_wind = d3.range(1, 8 + 1).map(function (d, i) {
            return {
                event: data[d.toString()]["event"],
                hashtags: data[d.toString()]["hashtags"],
                sentiment: data[d.toString()]["sentiment"],
                view: data[d.toString()]["view"],
                discussion: data[d.toString()]["discussion"],
                original: data[d.toString()]["original"],
            }
        });

    });

</script>

<!--wind部分tooltip; windBlockDiv点击-->
<script>

    d3.select("#tooltipInvisibleBlockDiv_wind")
        .style("height", `${window.innerHeight}px`)
        .style("width", `${window.innerWidth}px`);


    var tooltipInvisibleBlockDiv_wind_click = function () {
        isTooltipFixed_wind = false;
        //隐藏div阻挡栏
        d3.select("#tooltipInvisibleBlockDiv_wind")
            .style("display", "none")
        //隐藏tooltip
        d3.select("#hashtagTooltip_wind")
            .style("display", "none")

        //初始化为show more
        isshowFullHashtag_wind = false;
        d3.select("#showFullHashtag_wind").html("show more");
    }

    var isTooltipFixed_wind = false;

    var isshowFullHashtag_wind = false;
    var showFullHashtag_wind = function () {
        if (!isshowFullHashtag_wind) {
            //交换长短内容的位置
            let str = d3.select("#hashtagGroupInclude_wind").attr("content");

            d3.select("#hashtagGroupInclude_wind")
                .attr("content", d3.select("#hashtagGroupInclude_wind").html());

            d3.select("#hashtagGroupInclude_wind")
                .html(str);

            d3.select("#showFullHashtag_wind").html("show less");

            isshowFullHashtag_wind = true;
        } else {
            //交换长短内容的位置
            let str = d3.select("#hashtagGroupInclude_wind").attr("content");

            d3.select("#hashtagGroupInclude_wind")
                .attr("content", d3.select("#hashtagGroupInclude_wind").html());

            d3.select("#hashtagGroupInclude_wind")
                .html(str);

            d3.select("#showFullHashtag_wind").html("show more");

            isshowFullHashtag_wind = false;
        }

    }
</script>

<!--Intro 部分 dragbox 拖动-->
<!--retweet dragbox 拖动-->
<script>
    var retweetDragBox = document.getElementById("retweetDragBoxIntro")
    retweetDragBox.onmousedown = function (e) {

        //显示tooltip
        d3.select("#retweetNumIntro")
            .style("display", "block")

        var e = e || window.event // 兼容ie浏览器

        console.log(retweetDragBox.offsetLeft)
        // var diffX = e.clientX - retweetDragBox.offsetLeft

        /* 低版本ie bug:物体被拖出浏览器可是窗口外部时，还会出现滚动条，
                解决方法是采用ie浏览器独有的2个方法setCapture()\releaseCapture(),这两个方法，
                可以让鼠标滑动到浏览器外部也可以捕获到事件，而我们的bug就是当鼠标移出浏览器的时候，
                限制超过的功能就失效了。用这个方法，即可解决这个问题。注：这两个方法用于onmousedown和onmouseup中 */
        if (typeof retweetDragBox.setCapture !== 'undefined') {
            retweetDragBox.setCapture()
        }

        document.onmousemove = function (e) {
            var e = e || window.event // 兼容ie浏览器
            // var left = e.clientX - diffX
            var left = e.clientX - document.getElementById("retweetDragBgIntro").getBoundingClientRect().left  //这里为什么需要-90需要再测试一下不同长宽条件下

            if (left < 0)
                left = 0;
            if (left > 108)
                left = 108;

            let retweetNumScale = d3.scaleLinear()
                .domain([0, 108])
                .range([500, 5000])
            let retweetYScale = d3.scaleLinear()
                .domain([0, 108])
                .range([32, 42])

            //更改tooltip内容
            d3.select("#retweetNumIntro")
                .html(parseInt(retweetNumScale(left)))

            //刷新seed
            d3.select("#Tp_seed_Intro9")
                .remove();
            geneSeed_Tp_Intro(retweetSvg, retweetDefs, 9, 320, retweetYScale(left), 1, 0.5, 1, false, "yellow", 0.3, 1, 1, parseInt(retweetNumScale(left)));


            // 移动时重新得到物体的距离，解决拖动时出现晃动的现象
            retweetDragBox.style.left = left + 'px'

            //改变viewBox
            // timelineSvg
            //     .attr("viewBox", `0 ${scrollReverseBoxScale(top)} ${windowWid * 0.96} ${windowHei * 0.98}`);

        }


        document.onmouseup = function (e) { // 当鼠标弹起来的时候不再移动
            // console.log('this', this)

            d3.select("#retweetNumIntro")
                .style("display", "none")

            this.onmousemove = null
            this.onmouseup = null // 预防鼠标弹起来后还会循环（即预防鼠标放上去的时候还会移动）

            // 修复低版本ie bug
            if (typeof retweetDragBox.releaseCapture !== 'undefined') {
                retweetDragBox.releaseCapture()
            }
        }

    }
</script>

<!--like dragbox 拖动-->
<script>
    var likeDragBox = document.getElementById("likeDragBoxIntro")
    likeDragBox.onmousedown = function (e) {

        //显示tooltip
        d3.select("#likeNumIntro")
            .style("display", "block")

        var e = e || window.event // 兼容ie浏览器

        console.log(likeDragBox.offsetLeft)
        // var diffX = e.clientX - retweetDragBox.offsetLeft

        /* 低版本ie bug:物体被拖出浏览器可是窗口外部时，还会出现滚动条，
                解决方法是采用ie浏览器独有的2个方法setCapture()\releaseCapture(),这两个方法，
                可以让鼠标滑动到浏览器外部也可以捕获到事件，而我们的bug就是当鼠标移出浏览器的时候，
                限制超过的功能就失效了。用这个方法，即可解决这个问题。注：这两个方法用于onmousedown和onmouseup中 */
        if (typeof likeDragBox.setCapture !== 'undefined') {
            likeDragBox.setCapture()
        }

        document.onmousemove = function (e) {
            var e = e || window.event // 兼容ie浏览器
            // var left = e.clientX - diffX
            var left = e.clientX - document.getElementById("likeDragBgIntro").getBoundingClientRect().left  //这里为什么需要-90需要再测试一下不同长宽条件下

            if (left < 0)
                left = 0;
            if (left > 108)
                left = 108;

            let likeNumScale = d3.scaleLinear()
                .domain([0, 108])
                .range([5000, 50000])
            // let likeYScale = d3.scaleLinear()
            //     .domain([0, 108])
            //     .range([32, 42])

            //更改tooltip内容
            d3.select("#likeNumIntro")
                .html(parseInt(likeNumScale(left)))

            //刷新seed
            d3.select("#Tp_seed_Intro11")
                .remove();
            geneSeed_Tp_Intro(likeSvg, likeDefs, 11, 320, 32, 1, 0.5, 1, false, "yellow", 0.3, parseInt(likeNumScale(left)), 1, 1);


            // 移动时重新得到物体的距离，解决拖动时出现晃动的现象
            likeDragBox.style.left = left + 'px'

            //改变viewBox
            // timelineSvg
            //     .attr("viewBox", `0 ${scrollReverseBoxScale(top)} ${windowWid * 0.96} ${windowHei * 0.98}`);

        }


        document.onmouseup = function (e) { // 当鼠标弹起来的时候不再移动
            // console.log('this', this)

            d3.select("#likeNumIntro")
                .style("display", "none")

            this.onmousemove = null
            this.onmouseup = null // 预防鼠标弹起来后还会循环（即预防鼠标放上去的时候还会移动）

            // 修复低版本ie bug
            if (typeof likeDragBox.releaseCapture !== 'undefined') {
                likeDragBox.releaseCapture()
            }
        }

    }
</script>

<!--emotion dragbox 拖动-->
<script>
    var emotionDragBox = document.getElementById("emotionDragBoxIntro")
    emotionDragBox.onmousedown = function (e) {

        var e = e || window.event // 兼容ie浏览器

        console.log(emotionDragBox.offsetLeft)
        // var diffX = e.clientX - retweetDragBox.offsetLeft

        /* 低版本ie bug:物体被拖出浏览器可是窗口外部时，还会出现滚动条，
                解决方法是采用ie浏览器独有的2个方法setCapture()\releaseCapture(),这两个方法，
                可以让鼠标滑动到浏览器外部也可以捕获到事件，而我们的bug就是当鼠标移出浏览器的时候，
                限制超过的功能就失效了。用这个方法，即可解决这个问题。注：这两个方法用于onmousedown和onmouseup中 */
        if (typeof emotionDragBox.setCapture !== 'undefined') {
            emotionDragBox.setCapture()
        }

        document.onmousemove = function (e) {
            var e = e || window.event // 兼容ie浏览器
            // var left = e.clientX - diffX
            var left = e.clientX - document.getElementById("emotionDragBgIntro").getBoundingClientRect().left  //这里为什么需要-90需要再测试一下不同长宽条件下

            if (left < 0)
                left = 0;
            if (left > 108)
                left = 108;

            let emotionNumScale = d3.scaleLinear()
                .domain([0, 108])
                .range([1, 0])
            // let likeYScale = d3.scaleLinear()
            //     .domain([0, 108])
            //     .range([32, 42])

            // //更改tooltip内容
            // d3.select("#likeNum")
            //     .html(parseInt(likeNumScale(left)))

            //刷新seed
            d3.select("#Tp_seed_Intro15")
                .remove();
            d3.select("#Tp_emo_grad_Intro15")
                .remove(); //删除渐变
            console.log(`emo${emotionNumScale(left)}`)
            geneSeed_Tp_Intro(emotionSvg, emotionDefs, 15, 210, 30, 1, emotionNumScale(left), 1, false, "yellow", 0.3, 1, 200, 1);


            // 移动时重新得到物体的距离，解决拖动时出现晃动的现象
            emotionDragBox.style.left = left + 'px'

            //改变viewBox
            // timelineSvg
            //     .attr("viewBox", `0 ${scrollReverseBoxScale(top)} ${windowWid * 0.96} ${windowHei * 0.98}`);

        }


        document.onmouseup = function (e) { // 当鼠标弹起来的时候不再移动
            // console.log('this', this)


            this.onmousemove = null
            this.onmouseup = null // 预防鼠标弹起来后还会循环（即预防鼠标放上去的时候还会移动）

            // 修复低版本ie bug
            if (typeof emotionDragBox.releaseCapture !== 'undefined') {
                emotionDragBox.releaseCapture()
            }
        }

    }
</script>


<script>
    //给滑动文本添加屏幕高度的margin
    var windowHei = window.innerHeight;
    $("#seedIntro1").css("margin-top", windowHei * 0.7);
    $("#seedIntro2").css("margin-top", windowHei * 0.4);
    $("#seedIntro3").css("margin-top", windowHei * 0.38);
    // $("#seedIntro4").css("margin-top", windowHei * 0.5);
    $("#windIntro1").css("margin-top", windowHei * 0.48);
    $("#windIntro2").css("margin-top", windowHei * 0.44);
    // $("#windIntro3").css("margin-top", windowHei * 0.3);
    $("#windIntro4").css("margin-top", windowHei * 0.7);
</script>

<!--绘制Samara Seed Intro-->
<script>
    var windowHei = window.innerHeight;
    var windowWid = window.innerWidth;
    var svgWid = 400 / 1728 * windowWid //svgHeight就是windowHei
    var centerX = 220 / 400 * svgWid; //种子在画布上中心点的位置
    var centerY = windowHei / 2.5;
    var scaleId = 1 / 400 * svgWid;

    //绘制椭圆形的比例参数
    var baseradius = 3;
    var radiusX = 5 * baseradius;
    var radiusY = 3.2 * baseradius;

    var samaraSeedSvg = d3.select("#samaraIntro")
        .append("svg")
        .attr("width", svgWid * 2)
        .attr("height", windowHei) // 自适应高宽
        .attr("id", "mainSvg")
        .style("float", "right")
    // .style("margin-right", "40%") // 相对于column的宽度比例

    var samaraSeedGroup = samaraSeedSvg.append("g")
        .attr("id", "samaraSeedGroupIntro")
        .attr("transform", "translate(" + centerX + ", " + centerY + "), scale(" + scaleId + ")")
        .attr("opacity", "0");

    var windcenterX = 70 / 400 * svgWid; //种子在画布上中心点的位置
    var windcenterY = windowHei / 2.7;
    var windscaleId = svgWid * 1.5 * 1728 / 400 * 1 / windowWid

    var windCurve1 = samaraSeedSvg.append("g")
        .attr("transform", "translate(" + windcenterX + ", " + windcenterY + "), scale(" + windscaleId + ")")
        .attr("stroke", "#FFCA36")
        .attr("stroke-width", "2")
        .attr("stroke-dasharray", "1000")
        .attr("stroke-dashoffset", "-1000")
        .attr("stroke-linecap", "round")
        .attr("opacity", "0.6")
        .attr("fill", "none");

    windCurve1.append("path")
        .attr("d", "M.1,4.82C168.21-12.49,216.21,32.53,112,69.17s-115.58-1-45.58-12.53c64.8-10.73,124.52,26.89-4.4,62.12")


    samaraSeedGroup.append("path")
        .attr("d", "M36.32,79.91c-7.55,8.86-20.08,19.16-26.39,25.88C2.1,114.11-4.35,123.4,3.71,128.56s21.2,6.75,29.65-3.37c15.39-18.45,7.59-42.64,16.76-56S98.8-2.4,138.39,1.8c-10.6-5.51-34.64,1.31-57.92,24.88C60.43,47,51.64,62,36.32,79.91Z")
        .attr("stroke", "none")
        .attr("fill", "#FFCA36");

    samaraSeedGroup.append("path")
        .attr("d", "M46.55,70.15c7-8.87,25.45-9.81,34.68-4a17.31,17.31,0,0,1,4,3.42c-8.68-8.45-30.33-8-38.73.59Z")
        .attr("stroke", "none")
        .attr("fill", "#FFCA36");

    samaraSeedGroup.append("path")
        .attr("d", "M61.08,51.4C64,47.83,68.57,46.08,73,45.05c11.08-2.32,23.46-.71,32.83,5.89a24.15,24.15,0,0,1,4.88,4.75,26.41,26.41,0,0,0-5.16-4.35c-11-7.44-34.25-9.54-44.42.06Z")
        .attr("stroke", "none")
        .attr("fill", "#FFCA36");

    samaraSeedGroup.append("path")
        .attr("d", "M76.88,32.76c10.68-10.94,36.77-7.23,46.64,3.45a27,27,0,0,0-5.13-3.58c-11.16-6.09-31.19-8.61-41.51.13Z")
        .attr("stroke", "none")
        .attr("fill", "#FFCA36");

    samaraSeedGroup.append("path")
        .attr("d", "M94.73,16.27c8.94-7.66,25.41-9.23,35.37-2.76.68.48,1.3,1,1.94,1.56a23.33,23.33,0,0,0-4.31-2.4c-10.3-4-23.79-2.51-33,3.6Z")
        .attr("stroke", "none")
        .attr("fill", "#FFCA36");

    samaraSeedGroup.append("path")
        .attr("d", "M138.39,1.8c13,2.88,9.93,41.93-16.56,65.12C97.27,88.42,61,85.31,35.3,113.75l10.41-40.6S94.93-7.83,138.39,1.8Z")
        .attr("stroke", "none")
        .attr("fill", "#FFCA36")
        .attr("opacity", "0.2");

    samaraSeedGroup.append("circle")
        .attr("cx", -12)
        .attr("cy", 102)
        .attr("r", 10)
        .attr("fill", "#FFCA36")
        .attr("opacity", "0.5")

    samaraSeedGroup.append("circle")
        .attr("cx", 8)
        .attr("cy", 80)
        .attr("r", 10)
        .attr("fill", "#FFCA36")
        .attr("opacity", "0.3")

    //第一个出现的种子tooltip
    {
        var seedTp1 = samaraSeedSvg.append("g")
            .attr("opacity", 0)
            .attr("id", "seedTp1");

        var seedTp1_txt = seedTp1.append("g")
            .attr("id", "seedTp1_txt")
            .attr("transform", `translate(0,${525 / 886 * window.innerHeight}), scale(0.16)`)

        d3.xml("asset/svg/size_of_head.svg")
            .then(data => {
                d3.select("#seedTp1_txt").node().append(data.documentElement)
            });

        var seedTp1_arr = seedTp1.append("g")
            .attr("id", "seedTp1_arr")
            .attr("transform", `translate(${145 / 1728 * window.innerWidth},${525 / 886 * window.innerHeight}), scale(0.098)`)

        d3.xml("asset/svg/arr_1.svg")
            .then(data => {
                d3.select("#seedTp1_arr").node().append(data.documentElement)
            });
    }

    //第二个出现的种子tooltip
    {
        var seedTp2 = samaraSeedSvg.append("g")
            .attr("opacity", 0)
            .attr("id", "seedTp2");

        var seedTp2_txt = seedTp2.append("g")
            .attr("id", "seedTp2_txt")
            .attr("transform", `translate(${280 / 1728 * window.innerWidth},${560 / 886 * window.innerHeight}), scale(0.19)`)

        d3.xml("asset/svg/color_of_head.svg")
            .then(data => {
                d3.select("#seedTp2_txt").node().append(data.documentElement)
            });

        var seedTp2_arr = seedTp2.append("g")
            .attr("id", "seedTp2_arr")
            .attr("transform", `translate(${250 / 1728 * window.innerWidth},${525 / 886 * window.innerHeight}), scale(0.098)`)

        d3.xml("asset/svg/arr_2.svg")
            .then(data => {
                d3.select("#seedTp2_arr").node().append(data.documentElement)
            });
    }

    //第三个出现的种子tooltip
    {
        var seedTp3 = samaraSeedSvg.append("g")
            .attr("opacity", 0)
            .attr("id", "seedTp3");

        var seedTp3_txt = seedTp3.append("g")
            .attr("id", "seedTp3_txt")
            .attr("transform", `translate(${380 / 1728 * window.innerWidth},${416 / 886 * window.innerHeight}), scale(0.16)`)

        d3.xml("asset/svg/width_of_wing.svg")
            .then(data => {
                d3.select("#seedTp3_txt").node().append(data.documentElement)
            });

        var seedTp3_arr = seedTp3.append("g")
            .attr("id", "seedTp3_arr")
            .attr("transform", `translate(${300 / 1728 * window.innerWidth},${405 / 886 * window.innerHeight}), scale(0.08), rotate(10)`)

        d3.xml("asset/svg/arr_3.svg")
            .then(data => {
                d3.select("#seedTp3_arr").node().append(data.documentElement)
            });
    }

    //第四个出现的种子tooltip
    {
        var seedTp4 = samaraSeedSvg.append("g")
            .attr("opacity", 0)
            .attr("id", "seedTp4");

        var seedTp4_txt = seedTp4.append("g")
            .attr("id", "seedTp4_txt")
            .attr("transform", `translate(${410 / 1728 * window.innerWidth},${270 / 886 * window.innerHeight}), scale(0.18)`)

        d3.xml("asset/svg/pattern_on_wing.svg")
            .then(data => {
                d3.select("#seedTp4_txt").node().append(data.documentElement)
            });

        var seedTp4_arr = seedTp4.append("g")
            .attr("id", "seedTp4_arr")
            .attr("transform", `translate(${350 / 1728 * window.innerWidth},${350 / 886 * window.innerHeight}), scale(0.08), rotate(0)`)

        d3.xml("asset/svg/arr_4.svg")
            .then(data => {
                d3.select("#seedTp4_arr").node().append(data.documentElement)
            });
    }

    //第五个出现的种子tooltip
    {
        var seedTp5 = samaraSeedSvg.append("g")
            .attr("opacity", 0)
            .attr("id", "seedTp5");

        var seedTp5_txt = seedTp5.append("g")
            .attr("id", "seedTp5_txt")
            .attr("transform", `translate(${130 / 1728 * window.innerWidth},${290 / 886 * window.innerHeight}), scale(0.18)`)

        d3.xml("asset/svg/length_of_stem.svg")
            .then(data => {
                d3.select("#seedTp5_txt").node().append(data.documentElement)
            });

        var seedTp5_arr = seedTp5.append("g")
            .attr("id", "seedTp5_arr")
            .attr("transform", `translate(${250 / 1728 * window.innerWidth},${370 / 886 * window.innerHeight}), scale(0.09), rotate(0)`)

        d3.xml("asset/svg/arr_5.svg")
            .then(data => {
                d3.select("#seedTp5_arr").node().append(data.documentElement)
            });
    }

    //第六个出现的种子tooltip
    {
        var seedTp6 = samaraSeedSvg.append("g")
            .attr("opacity", 0)
            .attr("id", "seedTp6");

        var seedTp6_txt = seedTp6.append("g")
            .attr("id", "seedTp6_txt")
            .attr("transform", `translate(${10 / 1728 * window.innerWidth},${400 / 886 * window.innerHeight}), scale(0.16)`)

        d3.xml("asset/svg/type_of_dots.svg")
            .then(data => {
                d3.select("#seedTp6_txt").node().append(data.documentElement)
            });

        var seedTp6_arr = seedTp6.append("g")
            .attr("id", "seedTp6_arr")
            .attr("transform", `translate(${150 / 1728 * window.innerWidth},${440 / 886 * window.innerHeight}), scale(0.063), rotate(0)`)

        d3.xml("asset/svg/arr_6.svg")
            .then(data => {
                d3.select("#seedTp6_arr").node().append(data.documentElement)
            });
    }


</script>

<!--scroll magic 动画-->
<script>
    var controller = new ScrollMagic.Controller();
    var windowHei = window.innerHeight;

    //text渐变出入设置的时间轴动画关键帧
    var tweenIntroTxt1 = new TimelineMax().to("#seedIntro1", 2, {opacity: 1}).to("#seedIntro1", 1, {opacity: 0}); // 显示和隐藏是3：1的关系
    var tweenIntroTxt2 = new TimelineMax().to("#seedIntro2", 1, {opacity: 1}); // 显示和隐藏是3：1的关系
    var tweenIntroTxt2_1 = new TimelineMax().to("#seedIntro2", 1, {opacity: 0}); // 显示和隐藏是3：1的关系
    var tweenIntroTxt3 = new TimelineMax().to("#seedIntro3", 2, {opacity: 1}).to("#seedIntro3", 1, {opacity: 0}); // 显示和隐藏是3：1的关系
    // var tweenIntroTxt4 = new TimelineMax().to("#seedIntro4", 2, {opacity: 1}).to("#seedIntro4", 1, {opacity: 0}); // 显示和隐藏是3：1的关系
    var tweenIntroTxt5 = new TimelineMax().to("#windIntro1", 2, {opacity: 1}).to("#windIntro1", 1, {opacity: 0}); // 显示和隐藏是3：1的关系
    var tweenIntroTxt6 = new TimelineMax().to("#windIntro2", 2, {opacity: 1}).to("#windIntro2", 1, {opacity: 0}); // 显示和隐藏是3：1的关系
    // var tweenIntroTxt7 = new TimelineMax().to("#windIntro3", 2, {opacity: 1}).to("#windIntro3", 1, {opacity: 0}); // 显示和隐藏是3：1的关系
    var tweenIntroTxt8 = new TimelineMax().to("#windIntro4", 2, {opacity: 1}).to("#windIntro4", 1, {opacity: 0}); // 显示和隐藏是3：1的关系
    // var tweenIntroTpIcon = new TimelineMax().to("#showTooltipOverlayImgIntro", 0.5, {opacity: 1}).to("#showTooltipOverlayImgIntro", 1, {opacity: 1}).to("#showTooltipOverlayImgIntro", 0.5, {opacity: 0}); // 显示和隐藏是3：1的关系

    // $(function () { // wait for document ready
    //svg seed加载动画触发
    var windAnim = new ScrollMagic.Scene({
        triggerElement: "#trigger1",
        duration: 3 / 8 * windowHei, //设置的比videoEnter更下面，保证视频出现的时候种子相对屏幕还是固定的，让种子的位置是唯一确定的，不会乱动
        offset: 1 / 8 * windowHei
    })
        .on("progress", function (event) {
            var windowHei = window.innerHeight;
            var windowWid = window.innerWidth;
            var svgWid = 400 / 1728 * windowWid //svgHeight就是windowHei
            var windcenterX = 70 / 400 * svgWid; //种子在画布上中心点的位置
            var windcenterY = windowHei / 4;
            var windscaleId = svgWid * 1.5 * 1728 / 400 * 1 / windowWid

            windCurve1.attr("stroke-dashoffset", 1000 - event.progress * 1800)
                .attr("transform", "translate(" + windcenterX + ", " + (windcenterY + event.progress / 10 * windowHei) + "), scale(" + windscaleId + ")")
        }) //可以使用progress添加d3的动画
        // .addIndicators({name: "x (duration: windowHei)"}) // add indicators (requires plugin)
        .addTo(controller);


    // svg页面相对固定触发
    var svgStayedScene = new ScrollMagic.Scene({
        triggerElement: "#trigger1",
        duration: 16.5 / 4 * windowHei, //设置的比videoEnter更下面，保证视频出现的时候种子相对屏幕还是固定的，让种子的位置是唯一确定的，不会乱动
        offset: windowHei / 2
    })
        .setPin("#samaraIntro")  // 种子相对页面静止不动
        // .addIndicators({name: "1 (duration: windowHei)"}) // add indicators (requires plugin)
        .addTo(controller);

    // 种子入场动画
    var seedIntoScene = new ScrollMagic.Scene({
        triggerElement: "#trigger1",
        duration: 2.5 / 4 * windowHei, //设置的比videoEnter更下面，保证视频出现的时候种子相对屏幕还是固定的，让种子的位置是唯一确定的，不会乱动
        offset: windowHei / 2
    })
        .on("progress", function (event) {
            var windowHei = window.innerHeight;
            var windowWid = window.innerWidth;
            var svgWid = 400 / 1728 * windowWid //svgHeight就是windowHei 1728是目前屏幕宽度大小
            var centerX = 220 / 400 * svgWid; //种子在画布上中心点的位置
            var centerY = windowHei / 2.5;
            var scaleId = 1 / 400 * svgWid;

            samaraSeedGroup
                .attr("opacity", (event.progress))
                .attr("transform", "translate(" + centerX + ", " + (centerY + event.progress * 0.1 / 2 * windowHei) + "), scale(" + (scaleId / 2 + event.progress * scaleId / 2) + "," + scaleId + ")")
        }) //可以使用progress添加d3的动画
        .addTo(controller);


    var seed_Tp1_Timeline = new TimelineMax().to("#seedTp1", 1, {opacity: 1}).to("#seedTp1", 1, {opacity: 0}); // 显示和隐藏是3：1的关系

    //size_of_head tooltip 头部大小图例注释
    var seed_Tp1_scene = new ScrollMagic.Scene({
        triggerElement: "#trigger1",
        duration: windowHei * 3 / 8, //设置的比videoEnter更下面，保证视频出现的时候种子相对屏幕还是固定的，让种子的位置是唯一确定的，不会乱动
        offset: windowHei * 10 / 8
    })
        .setTween(seed_Tp1_Timeline)
        // .addIndicators({name: "1 (duration: windowHei)"}) // add indicators (requires plugin)
        .addTo(controller);

    //color_of_head tooltip 头部颜色图例注释
    var seed_Tp2_Timeline = new TimelineMax().to("#seedTp2", 1, {opacity: 1}).to("#seedTp2", 1, {opacity: 0}); // 显示和隐藏是3：1的关系

    var seed_Tp2_scene = new ScrollMagic.Scene({
        triggerElement: "#trigger1",
        duration: windowHei * 3 / 8, //设置的比videoEnter更下面，保证视频出现的时候种子相对屏幕还是固定的，让种子的位置是唯一确定的，不会乱动
        offset: windowHei * 11 / 8
    })
        .setTween(seed_Tp2_Timeline)
        // .addIndicators({name: "1 (duration: windowHei)"}) // add indicators (requires plugin)
        .addTo(controller);

    //width of wing tooltip 叶子宽度注释
    var seed_Tp3_Timeline = new TimelineMax().to("#seedTp3", 1, {opacity: 1}).to("#seedTp3", 1, {opacity: 0}); // 显示和隐藏是3：1的关系

    var seed_Tp3_scene = new ScrollMagic.Scene({
        triggerElement: "#trigger1",
        duration: windowHei * 3 / 8, //设置的比videoEnter更下面，保证视频出现的时候种子相对屏幕还是固定的，让种子的位置是唯一确定的，不会乱动
        offset: windowHei * 12 / 8
    })
        .setTween(seed_Tp3_Timeline)
        // .addIndicators({name: "1 (duration: windowHei)"}) // add indicators (requires plugin)
        .addTo(controller);

    //pattern on wing tooltip 叶子纹理注释
    var seed_Tp4_Timeline = new TimelineMax().to("#seedTp4", 1, {opacity: 1}).to("#seedTp4", 1, {opacity: 0}); // 显示和隐藏是3：1的关系

    var seed_Tp4_scene = new ScrollMagic.Scene({
        triggerElement: "#trigger1",
        duration: windowHei * 3 / 8, //设置的比videoEnter更下面，保证视频出现的时候种子相对屏幕还是固定的，让种子的位置是唯一确定的，不会乱动
        offset: windowHei * 13 / 8
    })
        .setTween(seed_Tp4_Timeline)
        // .addIndicators({name: "1 (duration: windowHei)"}) // add indicators (requires plugin)
        .addTo(controller);

    //length of stem tooltip 叶子长度注释
    var seed_Tp5_Timeline = new TimelineMax().to("#seedTp5", 1, {opacity: 1}).to("#seedTp5", 1, {opacity: 0}); // 显示和隐藏是3：1的关系

    var seed_Tp5_scene = new ScrollMagic.Scene({
        triggerElement: "#trigger1",
        duration: windowHei * 3 / 8, //设置的比videoEnter更下面，保证视频出现的时候种子相对屏幕还是固定的，让种子的位置是唯一确定的，不会乱动
        offset: windowHei * 14 / 8
    })
        .setTween(seed_Tp5_Timeline)
        // .addIndicators({name: "1 (duration: windowHei)"}) // add indicators (requires plugin)
        .addTo(controller);

    //type of dots tooltip 叶子点点注释
    var seed_Tp6_Timeline = new TimelineMax().to("#seedTp6", 1, {opacity: 1}).to("#seedTp6", 1, {opacity: 0}); // 显示和隐藏是3：1的关系

    var seed_Tp5_scene = new ScrollMagic.Scene({
        triggerElement: "#trigger1",
        duration: windowHei * 3 / 8, //设置的比videoEnter更下面，保证视频出现的时候种子相对屏幕还是固定的，让种子的位置是唯一确定的，不会乱动
        offset: windowHei * 15 / 8
    })
        .setTween(seed_Tp6_Timeline)
        // .addIndicators({name: "1 (duration: windowHei)"}) // add indicators (requires plugin)
        .addTo(controller);

    //判断当前页面位置
    var curPagePos = "Intro";
    var isEnterWindVideoPlayed = false;

    //判断Intro部分和wind部分倒退问题
    //两个文档的onscroll需要合并一下
    window.onscroll = function () {
        let topdis = document.documentElement.scrollTop || document.body.scrollTop;
        // console.log(topdis)

        // //稳定状态风glyph距离顶部的距离
        // let winddis_max = 4000 / 886 * window.innerHeight
        // let winddis_min = 3875 / 886 * window.innerHeight
        //
        // if(curPagePos == "wind" && (topdis >= winddis_min) && (topdis <= winddis_max))
        // {
        //     let opacityScale = d3.scaleLinear()
        //         .domain([0, winddis_max - winddis_min])
        //         .range([0, 1])
        //
        //     //风的glyph渐变退场
        //     d3.select("#windsvg_overlay")
        //         .style("opacity", opacityScale(topdis - winddis_min));
        //
        // }

        let seeddis_max = 3870 / 886 * window.innerHeight
        let seeddis_min = 3800 / 886 * window.innerHeight

        // if(curPagePos == "Intro" && !isEnterWindVideoPlayed && (topdis >= seeddis_min) && (topdis <= seeddis_max))
        // {
        //     let opacityScale = d3.scaleLinear()
        //         .domain([0, seeddis_max - seeddis_min])
        //         .range([1, 0])
        //
        //     //seed的glyph渐变进场
        //     samaraSeedGroup
        //         .style("opacity", opacityScale(topdis - seeddis_min));
        //
        //     var windowHei = window.innerHeight;
        //     var windowWid = window.innerWidth;
        //     var svgWid = 400 / 1728 * windowWid //svgHeight就是windowHei
        //     var centerX = 150 / 400 * svgWid; //种子在画布上中心点的位置
        //     var centerY = windowHei / 2.5;
        //     var scaleId = 1 / 400 * svgWid;
        //     samaraSeedGroup
        //         .attr("transform", "translate(" + (centerX * 3) + ", " + centerY + "), scale(" + (scaleId / 1.5) + "," + scaleId + ")")
        // }

        // if(curPagePos == "wind" && (topdis < winddis_min - 30))
        // {
        //     curPagePos = "Intro"
        //
        //     //wind删除
        //     d3.select("#windsvg_overlay")
        //         .remove();
        // }
        // if(curPagePos == "Intro" && (topdis < 19/4 * window.innerHeight) && (topdis > 18.5/4 * window.innerHeight))
        // {
        //     let seedOpacityScale = d3.scaleLinear()
        //         .domain([0, 1/8 * window.innerHeight])
        //         .range([0, 1])
        //
        //
        //     samaraSeedGroup
        //         .attr("transform", "translate(" + (centerX) + ", " + centerY + "), scale(" + (scaleId) + "," + scaleId + ")")
        //
        //     samaraSeedGroup
        //         .attr("opacity", seedOpacityScale(topdis - 13.5/4 * window.innerHeight)); //动画终点对象的attr属性
        //
        // }
    }


    var videoEnter = new ScrollMagic.Scene({
        triggerElement: "#trigger1",
        duration: 10 / 4 * windowHei,
        offset: windowHei * 2.6 / 4
    })
        .on("end", function (event) { // 移到seed的最后部分，出现视频
            // console.log("end!");

            //设置进场视频只播放一次
            if (curPagePos == "Intro" && !isEnterWindVideoPlayed) {
                isEnterWindVideoPlayed = true;
                curPagePos = "wind";

                //介绍文字渐变进入
                d3.select("#windIntro1Div")
                    .transition()
                    .duration(4000)
                    .style("opacity", 1);

                window.scrollTo({
                    top: 4100 / 886 * window.innerHeight, //初始稳定状态风glyph距离顶部的距离
                    behavior: "instant"
                });

                //禁止页面滑动
                var mo = function (e) {
                    passive: false;
                };
                document.body.style.overflow = 'hidden';
                document.addEventListener("touchmove", mo, false);

                //显示视频的div
                $("#windvideoEnter").css("display", "block");
                //调整div大小：全屏
                let windowHei = window.innerHeight;
                let windowWid = window.innerWidth;
                $("#windvideoEnter").css("height", windowHei);
                $("#windvideoEnter").css("width", windowWid);
                //设置视频自动播放
                // $("#videoclipEnter").attr("autoplay", "true")
                // $("#videoclipEnter").attr("muted", "muted")
                Media = document.getElementById("videoclipEnter");
                Media.currentTime = 0;
                Media.play();


                let svgWid = 400 / 1728 * windowWid //svgHeight就是windowHei
                let centerX = 220 / 400 * svgWid; //种子在画布上中心点的位置
                let centerY = windowHei / 2.5 + 0.1 / 2 * windowHei;
                let scaleId = 1 / 400 * svgWid;

                //seedHead3.svg svg退场
                samaraSeedGroup.transition() //transition表示动画
                    .duration(3000) //动画持续时间
                    // .delay(function(d, i) { return i * 1000; }) //延迟几秒再开始动画
                    .attr("transform", "translate(" + (centerX * 3) + ", " + centerY + "), scale(" + (scaleId / 1.5) + "," + scaleId + ")")
                    .attr("opacity", "0"); //动画终点对象的attr属性


                console.log(`topdis ${document.documentElement.scrollTop || document.body.scrollTop}`)

            }


        })
        // .addIndicators({name: "3 (duration: windowHei)"}) // add indicators (requires plugin)
        .addTo(controller);



    // var videoExit = new ScrollMagic.Scene({
    //     triggerElement: "#trigger1",
    //     duration: 25 / 4 * windowHei, //设置的比videoEnter更下面，保证视频出现的时候种子相对屏幕还是固定的，让种子的位置是唯一确定的，不会乱动
    //     offset: windowHei / 2
    // })
    //
    //     .addTo(controller);

    var sceneIntroTxt1 = new ScrollMagic.Scene({
        triggerElement: "#trigger1",
        duration: windowHei * 2.5 / 4,
        offset: windowHei * 2 / 4
    })
        .setTween(tweenIntroTxt1)
        // .addIndicators({name: "2 (duration: windowHei)"}) // add indicators (requires plugin)
        .addTo(controller);

    var sceneIntroTxt2 = new ScrollMagic.Scene({
        triggerElement: "#trigger1",
        duration: windowHei * 2 / 3,
        offset: windowHei * 4 / 4
    })
        .setTween(tweenIntroTxt2)
        // .addIndicators({name: "3 (duration: windowHei)"}) // add indicators (requires plugin)
        .addTo(controller);

    var sceneIntroTxt2_stay = new ScrollMagic.Scene({
        triggerElement: "#trigger1",
        duration: windowHei * 7.5 / 8,
        offset: windowHei * 2 / 3 + windowHei * 2.5 / 4
    })
        .setPin("#seedIntro2")
        // .addIndicators({name: "3 (duration: windowHei)"}) // add indicators (requires plugin)
        .addTo(controller);

    var sceneIntroTxt2_fade = new ScrollMagic.Scene({
        triggerElement: "#trigger1",
        duration: windowHei * 1 / 3,
        offset: windowHei * 2 / 3 + windowHei * 2.5 / 4 + windowHei * 7.5 / 8
    })
        .setTween(tweenIntroTxt2_1)
        // .addIndicators({name: "3 (duration: windowHei)"}) // add indicators (requires plugin)
        .addTo(controller);

    //Tooltip Icon出现
    // var sceneIntroTpIcon = new ScrollMagic.Scene({
    //     triggerElement: "#trigger1",
    //     duration: windowHei * 5.5 / 4,
    //     offset: windowHei
    // })
    //     .setTween(tweenIntroTpIcon)
    //     // .addIndicators({name: "3 (duration: windowHei)"}) // add indicators (requires plugin)
    //     .addTo(controller);

    var sceneIntroTxt3 = new ScrollMagic.Scene({
        triggerElement: "#trigger1",
        duration: windowHei * 2.5 / 4,
        offset: windowHei * 10.2 / 4
    })
        .setTween(tweenIntroTxt3)
        // .addIndicators({name: "3 (duration: windowHei)"}) // add indicators (requires plugin)
        .addTo(controller);

    // var sceneIntroTxt4 = new ScrollMagic.Scene({
    //     triggerElement: "#trigger1",
    //     duration: windowHei * 2.5 / 4,
    //     offset: windowHei * 11 / 4
    // })
    //     .setTween(tweenIntroTxt4)
    //     // .addIndicators({name: "3 (duration: windowHei)"}) // add indicators (requires plugin)
    //     .addTo(controller);

    var sceneIntroTxt5 = new ScrollMagic.Scene({
        triggerElement: "#trigger0",
        duration: windowHei * 2.5 / 4,
        offset: 4000 / 886 * windowHei
    })
        .setTween(tweenIntroTxt5)
        .addIndicators({name: "3 (duration: windowHei)"}) // add indicators (requires plugin)
        .addTo(controller);

    var isExitWindVideoPlayed = false;

    var sceneIntroTxt6 = new ScrollMagic.Scene({
        triggerElement: "#trigger1",
        duration: windowHei * 2.5 / 4,
        offset: windowHei * 29.5 / 8
    })
        .setTween(tweenIntroTxt6)
        .on("end", function (event) { // 移到seed的最后部分，出现视频
            console.log("end!");

            if (curPagePos == "wind" && !isExitWindVideoPlayed) {
                isExitWindVideoPlayed = true;
                curPagePos = "main"

                console.log("121212")

                // d3.select("#windLineBg")
                //     .transition()
                //     .duration(2000)
                //     .style("opacity", 1);

                //隐藏原来风的svg
                d3.select("#windsvg_overlay")
                    .style("opacity", "0");

                //禁止页面滑动
                var mo = function (e) {
                    passive: false;
                };
                document.body.style.overflow = 'hidden';
                document.addEventListener("touchmove", mo, false);

                //显示视频的div
                $("#windvideoExit").css("display", "block");
                //调整div大小：全屏
                var windowHei = window.innerHeight;
                var windowWid = window.innerWidth;
                $("#windvideoExit").css("height", windowHei);
                $("#windvideoExit").css("width", windowWid);


                //屏幕自动下移
                window.scrollTo({
                    top: 5200,
                    // behavior: "smooth"
                });

                //设置视频自动播放
                // $("#videoclipEnter").attr("autoplay", "true")
                // $("#videoclipEnter").attr("muted", "muted")
                Media = document.getElementById("videoclipExit");
                Media.currentTime = 0;
                Media.play();
            }
        })
        .addIndicators({name: "yy (duration: windowHei)"}) // add indicators (requires plugin)
        .addTo(controller);

    // var sceneIntroTxt7 = new ScrollMagic.Scene({
    //     triggerElement: "#trigger1",
    //     duration: windowHei * 2.5 / 4,
    //     offset: windowHei * 17.5 / 4
    // })
    //     .setTween(tweenIntroTxt7)
    //     // .addIndicators({name: "3 (duration: windowHei)"}) // add indicators (requires plugin)
    //     .addTo(controller);

    var sceneIntroTxt8 = new ScrollMagic.Scene({
        triggerElement: "#trigger1",
        duration: windowHei,
        offset: windowHei * 21 / 4
    })
        .setTween(tweenIntroTxt8)
        // .addIndicators({name: "3 (duration: windowHei)"}) // add indicators (requires plugin)
        .addTo(controller);


    var windLineBgScene = new ScrollMagic.Scene({
        triggerElement: "#trigger0",
        duration: windowHei / 8,
        offset: 5200 / 886 * window.innerHeight
    })
        .on("progress", function (event){
            // d3.select("#windLineBg")
            //     .style("opacity", event.progress)
        })
        .addIndicators({name: "zz (duration: windowHei)"}) // add indicators (requires plugin)
        .addTo(controller);
    // });
</script>

<!--监听视频播放是否结束-->
<script>
    var windvideoIntro = document.getElementById("videoclipEnter");
    windvideoIntro.addEventListener('ended', function () { //结束
        // console.log("播放结束");

        var windowHei = window.innerHeight;

        var translateX = windowHei / 886 * 4;
        var translateY = windowHei / 886 * 72;
        var scaleId = windowHei / 886 * 0.79;
        //加载覆盖的svg
        overlaywindgroup = d3.select("#mainSvg")
            .append("g")
            .attr("id", "windsvg_overlay")
            .attr("transform", "translate(" + translateX + ", " + translateY + ") scale(" + scaleId + ")");

        d3.xml("asset/svg/wind3.svg")
            .then(data => {
                d3.select("#windsvg_overlay").node().append(data.documentElement);

                d3.select("#mainSvg")
                    .append("rect")
                    .attr("id", "blockWindRect")
                    .attr("x", 0)
                    .attr("y", 270)
                    .attr("width", 500)
                    .attr("height", 350)
                    .attr("opacity", "0")
                    .attr("fill", `url(#blockWindGradRect)`)

                let blockWindGrad = d3.select("#mainSvg")
                    .append("defs")
                    .append("linearGradient")
                    .attr("id", `blockWindGradRect`)
                    .attr("gradientUnits", "userSpaceOnUse")
                    .attr("x1", "0")
                    .attr("y1", "270")
                    .attr("x2", `500`)
                    .attr("y2", "270");

                let stop1 = blockWindGrad.append("stop")
                    .attr("id", "blockWindGradRect_start")
                    .attr("offset", "0")
                    .style("stop-color", "#FFF9F0");

                let stop2 = blockWindGrad.append("stop")
                    .attr("id", "blockWindGradRect_end")
                    .attr("offset", "1")
                    .style("stop-color", "#FFF9F0")
                    .style("stop-opacity", "0");

                // var windGlyphScene1 = new TimelineMax().to("#windsvg_overlay", 1, {opacity: 1}); // 显示和隐藏是3：1的关系

                //添加风的渐变进出
                var windGlyphScene = new ScrollMagic.Scene({
                    triggerElement: "#trigger0",
                    duration: 125 / 886 * window.innerHeight,
                    offset: 3900 / 886 * window.innerHeight
                })
                    .on("progress", function (event) {

                        d3.select("#windsvg_overlay")
                            .style("opacity", event.progress)

                        let windOffsetScale = d3.scaleLinear()
                            .domain([0, 1])
                            .range([-100, 0]);

                        let translateX = windowHei / 886 * 4;
                        let translateY = windowHei / 886 * 72;
                        let scaleId = windowHei / 886 * 0.79;
                        d3.select("#windsvg_overlay")
                            .attr("transform", `translate(${translateX + windOffsetScale(event.progress)}, ${translateY}) scale(${scaleId})`);

                    })

                    // .addIndicators({name: "wind"}) // add indicators (requires plugin)
                    .addTo(controller);


                //添加遮挡风的矩形的渐变进出
                // var tweenRectBlk = new TimelineMax().to("#blockWindRect", 5, {opacity: 1}).to("#blockWindRect", 1, {opacity: 0}); // 显示和隐藏是3：1的关系
                var blockWindRectScene = new ScrollMagic.Scene({
                    triggerElement: "#trigger0",
                    duration: 175 / 886 * window.innerHeight, //duration与offset 是风的渐变的范围设置，前后各加25
                    offset: 3875 / 886 * window.innerHeight
                })
                    .on("start", function(){
                        //将遮挡矩形透明度调为0
                        d3.select("#blockWindRect")
                            .attr("opacity", 0);
                    })
                    .on("progress", function (event){
                        if(event.progress < 25 / 175)
                        {
                            d3.select("#blockWindRect")
                                .attr("opacity", 1 - (25 / 175 - event.progress) / (25 / 175));

                        }
                        if(event.progress >= 25 / 175 && event.progress <= 150 / 175)
                        {
                            d3.select("#blockWindRect")
                                .attr("opacity", 1);

                        }
                        if(event.progress > 150 / 175)
                        {
                            d3.select("#blockWindRect")
                                .attr("opacity", 1 - (event.progress - 150 / 175) / (25 / 175));

                        }
                    })
                    // .addIndicators({name: "blk"}) // add indicators (requires plugin)
                    .addTo(controller);


                //添加遮挡风的矩形的隐藏与显示
                var blockWindRectHidShowScene = new ScrollMagic.Scene({
                    triggerElement: "#trigger0",
                    duration: 10 / 886 * window.innerHeight, //duration与offset 是风的渐变的范围设置，前后各加25
                    offset: (3875 + 175) / 886 * window.innerHeight
                })
                    .on("start", function (){
                        d3.select("#blockWindRect")
                            .style("display", "block")
                    })
                    .on("end", function (){
                        d3.select("#blockWindRect")
                            .style("display", "none")
                    })
                    .addTo(controller);


                //添加seed的渐变进出
                var seedGlyphScene = new ScrollMagic.Scene({
                    triggerElement: "#trigger1",
                    duration: 0.8 / 4 * window.innerHeight,
                    offset: 11.5 / 4 * window.innerHeight
                })
                    .on("progress", function (event) {
                        console.log(`progress${event.progress}`)
                        samaraSeedGroup
                            .attr("opacity", 1 - event.progress)

                        let windowHei = window.innerHeight;
                        let windowWid = window.innerWidth;
                        let svgWid = 400 / 1728 * windowWid //svgHeight就是windowHei
                        let centerX = 220 / 400 * svgWid; //种子在画布上中心点的位置
                        let centerY = windowHei / 2.5 + 0.1 / 2 * windowHei;
                        let scaleId = 1 / 400 * svgWid;
                        let centerxScale = d3.scaleLinear()
                            .domain([0, 1])
                            .range([centerX, centerX * 2])
                        let scaleIdScale = d3.scaleLinear()
                            .domain([0, 1])
                            .range([scaleId, scaleId / 1.5])

                        samaraSeedGroup
                            .attr("transform", "translate(" + (centerxScale(event.progress)) + ", " + centerY + "), scale(" + (scaleIdScale(event.progress)) + "," + scaleId + ")")
                    })
                    // .addIndicators({name: "x (duration: windowHei)"}) // add indicators (requires plugin)
                    .addTo(controller);


                //给每一缕风绑定tooltip

                for (let index = 1; index <= 8; index++) {
                    d3.select(`#windCat${index}`)
                        .on("mouseover", function (d, i) {
                            d3.select("#hashtagTooltip_wind")
                                .style("display", "block")
                                .style("top", `${d3.pointer(d)[1]}px`)
                                .style("left", `${d3.pointer(d)[0]}px`)

                            //更改名称：Hashtag Group · X
                            d3.select("#hashtagGroupNum_wind")
                                .html(`Hashtag Group · ${index}`);

                            //改变简介内容
                            d3.select("#hashtagGroupSubtitle_wind")
                                .html(hashtagNodes_wind[index - 1]["event"])


                            //改变view数量
                            d3.select("#windView")
                                .html(transNum(hashtagNodes_wind[index - 1]["view"]))

                            //改变discussion数量
                            d3.select("#windComment")
                                .html(transNum(hashtagNodes_wind[index - 1]["discussion"]))

                            //改变original数量
                            d3.select("#windOriginal")
                                .html(transNum(hashtagNodes_wind[index - 1]["original"]))


                            //改变hashtag内容
                            d3.select("#hashtagGroupInclude_wind")
                                .html(function () {
                                    let res = "";
                                    for (let j = 0; j < 4; j++) {
                                        res += hashtagNodes_wind[index - 1]["hashtags"][j]
                                        res += "<br>"
                                    }
                                    return res;
                                })
                                .attr("content", function () {
                                    let res = "";
                                    for (let j = 0; j < hashtagNodes_wind[index - 1]["hashtags"].length; j++) {
                                        res += hashtagNodes_wind[index - 1]["hashtags"][j]
                                        res += "<br>"
                                    }
                                    return res;
                                })

                            //改变emotion scaleBox位置
                            let emoScale = d3.scaleLinear()
                                .domain([1, 0])
                                .range([0, 175]);

                            d3.select("#emotionScaleBox_wind")
                                .style("left", `${emoScale(parseFloat(hashtagNodes_wind[index - 1]["sentiment"]))}px`)

                        })

                        .on("mousemove", function (d, i) {
                            let posScaleWid = d3.scaleLinear()
                                .domain([0, window.innerWidth])
                                .range([500 / 1726 * window.innerWidth, 1400 / 1726 * window.innerWidth]);

                            let posScaleHei = d3.scaleLinear()
                                .domain([0, window.innerHeight])
                                .range([100 / 1726 * window.innerWidth, 500 / 1726 * window.innerWidth]);

                            d3.select("#hashtagTooltip_wind")
                                .style("top", `${posScaleHei(d3.pointer(d)[1])}px`)
                                .style("left", `${posScaleWid(d3.pointer(d)[0])}px`)
                        })

                        .on("mouseleave", function () {
                            if (!isTooltipFixed_wind) {
                                d3.select("#hashtagTooltip_wind")
                                    .style("display", "none")
                            }

                        })
                        .on("click", function () {
                            isTooltipFixed_wind = true;
                            d3.select("#tooltipInvisibleBlockDiv_wind")
                                .style("display", "block")
                        });
                }

            });

        //隐藏视频div
        setTimeout("hidevideo()", "15"); //15ms 后执行隐藏video: 防止闪一下

        // window.scrollTo({
        //     top: 4100 / 886 * window.innerHeight, //初始稳定状态风glyph距离顶部的距离
        //     behavior: "instant"
        // });

        //允许滚动
        var mo = function (e) {
            passive: false
        };
        document.body.style.overflow = '';//出现滚动条
        document.removeEventListener("touchmove", mo, false);


    }, false);

    function hidevideo() {
        document.getElementById("windvideoEnter").style.display = "none";
    }

    var windvideoIntro = document.getElementById("videoclipExit");
    windvideoIntro.addEventListener('ended', function () {
        //隐藏视频div
        document.getElementById("windvideoExit").style.display = "none";

        //出现动画
        d3.select("#testcir")
            .transition()
            .duration(1000)
            .attr("opacity", "100%");

        //出现滑条
        $("#streamGraphScroll").css("display", "block");
        //滑条渐变出现
        d3.select("#svgStreamScrollGroup")
            .transition()
            .duration(1000)
            .attr("opacity", "100");

        //允许滚动
        var mo = function (e) {
            passive: false
        };
        document.body.style.overflow = '';//出现滚动条
        document.removeEventListener("touchmove", mo, false);
    }, false);

</script>




<!--更改窗口大小函数-->
<script>
    d3.select(window).on('resize', resize); // 现在是一次刷新"一次性"的自适应，如果需要实时自适应需要在resize函数里面添加对应的变化
    function resize() {
        //更改视频大小；视频的比例为 1920：1080
        var windowHei = window.innerHeight;
        var windowWid = window.innerWidth;
        $("#windvideoEnter").attr("width", windowWid);
        $("#windvideoEnter").attr("height", windowHei);
        //根据窗口长宽比确定视频长宽比
        if (windowWid / windowHei > 1920 / 1080) {
            $("#videoclipEnter").attr("height", "100%");
            $("#videoclipEnter").removeAttr("width");
        } else {
            $("#videoclipEnter").attr("width", "100%");
            $("#videoclipEnter").removeAttr("height");
        }

        $("#windvideoExit").attr("width", windowWid);
        $("#windvideoExit").attr("height", windowHei);
        //根据窗口长宽比确定视频长宽比
        if (windowWid / windowHei > 1920 / 1080) {
            $("#videoclipExit").attr("height", "100%");
            $("#videoclipExit").removeAttr("width");
        } else {
            $("#videoclipExit").attr("width", "100%");
            $("#videoclipExit").removeAttr("height");
        }


        //这部分是调整滑条的响应
        {
            d3.select("#svgStreamScroll").attr("width", 100 / 1728 * window.innerWidth);  //改变svg宽度
            d3.select("#streamGraphScroll").style("right", (20 / 1728 * window.innerWidth).toString() + "px");  //调整滑条和窗口右边的距离
            d3.selectAll(".myArea").remove(); // 先把之前绘制的删除
            d3.select("#scrollrectBackground")
                .attr("width", 100 / 1728 * window.innerWidth)
                .attr("height", window.innerHeight * 0.96);

            d3.csv("asset/阅读数.csv").then(function (data) {
                console.log(data)
                // List of groups = header of the csv files
                const keys = data.columns.slice(1)//从第二个开始往后切片
                console.log(keys)

                // Add X axis, 纵向
                const x = d3.scaleLinear()
                    .domain(d3.extent(data, function (d) {
                        return parseInt(d.time);
                    }))  // 返回data中的year属性，并求值域
                    .range([0, window.innerHeight * 0.96]);


                // Add Y axis， 横向宽度
                const y = d3.scaleLinear()
                    .domain([0, 200000000])
                    .range([5 / 1728 * window.innerWidth, 0]); //映射范围

                var colorrange = ["#FAAC0F", "#FBB323", "#FBBA37", "#FBC14B", "#FCC85F", "#FCCE73", "#FDD587", "#FDDC9B",];
                // color palette
                const color = d3.scaleOrdinal()
                    .domain(keys)
                    .range(colorrange); //d3.schemeDark2

                //stack the data?
                const stackedData = d3.stack()
                    .offset(d3.stackOffsetSilhouette)
                    .keys(keys) //这样用stack创造出的是函数！还要给他参数（data）
                    (data)

                // create a tooltip
                const Tooltip = svgStreamScrollGroup
                    .append("text")
                    .attr("x", 0)
                    .attr("y", 0)
                    .style("opacity", 0)
                    .style("font-size", 17) //在0，0位置显示悬停的名称

                // Three function that change the tooltip when user hover / move / leave a cell
                const mouseover = function (event, d) {
                    Tooltip.style("opacity", 1)
                    d3.selectAll(".myArea").style("opacity", .2) //其他变半透明
                    d3.select(this)
                        //.style("stroke", "black")
                        .style("opacity", 1)
                    grp = d.key
                    Tooltip.text(grp)
                }
                const mousemove = function (event, d, i) {

                }
                const mouseleave = function (event, d) {
                    Tooltip.style("opacity", 0)
                    d3.selectAll(".myArea").style("opacity", 1).style("stroke", "none")  // 恢复正常
                }

                // Area generator
                const area = d3.area()
                    .curve(d3.curveMonotoneY)  //.curve(d3.curveCatmullRom.alpha(0))
                    .y(function (d) {
                        return x(d.data.time);
                    })
                    .x0(function (d) {
                        return y(d[0]);
                    })
                    .x1(function (d) {
                        return y(d[1]);
                    })

                // Show the areas
                svgStreamScrollGroup
                    .selectAll("mylayers")
                    .data(stackedData)
                    .join("path")
                    .attr("class", "myArea")
                    .attr("transform", `translate(${44 / 1728 * window.innerWidth}, 0)`)
                    .style("fill", function (d) {
                        return color(d.key);
                    })
                    .attr("d", area)
                    .on("mouseover", mouseover)
                    .on("mousemove", mousemove)
                    .on("mouseleave", mouseleave)
            })
        }

    }
</script>

<script>
    // var winWid = window.innerWidth;
    // winWid *= 0.99;          //用户实际所用到的地方要小一些，所以要分别缩小一点，不然会超出用户的页面可用范围、
    // var main_svg = d3.select("body")
    //     .append("svg")
    //     .attr("width", winWid)
    //     .attr("height", "5000");
    // d3.select(window).on('resize', resize);

    //标题
    // var header1 = main_svg.append("text")
    //     .text("Title")
    //     .attr("stroke", "black")
    //     .attr("font-size", "200")
    //     .attr("text-anchor", "middle")  // 对齐锚点设置在中点
    //     .attr("x", winWid / 2)
    //     .attr("y", "400");

    // 背景
    // var bglines = ["bg1bg1bg1bg1bg1bg1bg1bg1", "bg2bg2bg2bg2bg2bg2bg2bg2", "bg3bg3bg3bg3bg3bg3bg3bg3","bg4bg4bg4bg4bg4bg4bg4bg4","bg4bg4bg4bg4bg4bg4bg4bg4"]
    // var bg1 = main_svg.append("g")
    //     .append("text")
    //     .selectAll("tspan")
    //     .data(bglines)
    //     .enter()
    //     .append("tspan")
    //     .attr("text-anchor", "middle")
    //     .text(function (d, i) {
    //         return d;
    //     })
    //     .attr("font-size", "25")
    //     .attr("x", winWid / 2)
    //     .attr("y", function (d, i) {
    //         return 500 + 40 * i;
    //     }) //40为行间距

    // function resize() {
    //     var winWid = window.innerWidth;
    //     winWid *= 0.99;
    //     main_svg.attr("width", winWid); // 刷新画布大小
    //
    //     // header1.attr("x", winWid / 2); //header调整位置
    //     // bg1.attr("x", winWid / 2); //背景居中
    // }
</script>

<!--scrollPage2.html部分js代码-->

<!--jump to related hashtag tooltip-->
<script>
    $(function () {
        $("[data-toggle='tooltip']").tooltip();

        //设置tooltip为点击之后隐藏
        $('[data-toggle="tooltip"]').click(function () {
            $('[data-toggle="tooltip"]').tooltip("hide");

        });

    });
</script>

<!--seedtooltip的拖动操作设置-->
<script>
    // 拖拽功能(主要是触发三个事件：onmousedown\onmousemove\onmouseup)
    var drag = document.getElementById('seedTooltip')

    // 点击某物体时，用drag对象即可，move和up是全局区域，也就是整个文档通用，应该使用document对象而不是drag对象(否则，采用drag对象时物体只能往右方或下方移动)
    drag.onmousedown = function (e) {
        var e = e || window.event // 兼容ie浏览器
        var diffX = e.clientX - drag.offsetLeft // 鼠标点击物体那一刻相对于物体左侧边框的距离=点击时的位置相对于浏览器最左边的距离-物体左边框相对于浏览器最左边的距离
        var diffY = e.clientY - drag.offsetTop

        /* 低版本ie bug:物体被拖出浏览器可是窗口外部时，还会出现滚动条，
                解决方法是采用ie浏览器独有的2个方法setCapture()\releaseCapture(),这两个方法，
                可以让鼠标滑动到浏览器外部也可以捕获到事件，而我们的bug就是当鼠标移出浏览器的时候，
                限制超过的功能就失效了。用这个方法，即可解决这个问题。注：这两个方法用于onmousedown和onmouseup中 */
        if (typeof drag.setCapture !== 'undefined') {
            drag.setCapture()
        }

        document.onmousemove = function (e) {
            var e = e || window.event // 兼容ie浏览器
            var left = e.clientX - diffX
            var top = e.clientY - diffY

            // 控制拖拽物体的范围只能在浏览器视窗内，不允许出现滚动条
            if (left < 0) {
                left = 0
            } else if (left > window.innerWidth - drag.offsetWidth) {
                left = window.innerWidth - drag.offsetWidth
            }
            if (top < 0) {
                top = 0
            } else if (top > window.innerHeight - drag.offsetHeight) {
                top = window.innerHeight - drag.offsetHeight
            }

            // 移动时重新得到物体的距离，解决拖动时出现晃动的现象
            drag.style.left = left + 'px'
            drag.style.top = top + 'px'
        }
        document.onmouseup = function (e) { // 当鼠标弹起来的时候不再移动
            console.log('this', this)
            this.onmousemove = null
            this.onmouseup = null // 预防鼠标弹起来后还会循环（即预防鼠标放上去的时候还会移动）

            // 修复低版本ie bug
            if (typeof drag.releaseCapture !== 'undefined') {
                drag.releaseCapture()
            }
        }
    }


</script>

<!--vaneTooltip拖动操作设置-->
<script>
    // 拖拽功能(主要是触发三个事件：onmousedown\onmousemove\onmouseup)
    var dragVane = document.getElementById('vaneTooltip')

    // 点击某物体时，用drag对象即可，move和up是全局区域，也就是整个文档通用，应该使用document对象而不是drag对象(否则，采用drag对象时物体只能往右方或下方移动)
    dragVane.onmousedown = function (e) {
        var e = e || window.event // 兼容ie浏览器
        var diffX = e.clientX - dragVane.offsetLeft // 鼠标点击物体那一刻相对于物体左侧边框的距离=点击时的位置相对于浏览器最左边的距离-物体左边框相对于浏览器最左边的距离
        var diffY = e.clientY - dragVane.offsetTop

        /* 低版本ie bug:物体被拖出浏览器可是窗口外部时，还会出现滚动条，
                解决方法是采用ie浏览器独有的2个方法setCapture()\releaseCapture(),这两个方法，
                可以让鼠标滑动到浏览器外部也可以捕获到事件，而我们的bug就是当鼠标移出浏览器的时候，
                限制超过的功能就失效了。用这个方法，即可解决这个问题。注：这两个方法用于onmousedown和onmouseup中 */
        if (typeof dragVane.setCapture !== 'undefined') {
            dragVane.setCapture()
        }

        document.onmousemove = function (e) {
            var e = e || window.event // 兼容ie浏览器
            var left = e.clientX - diffX
            var top = e.clientY - diffY

            // 控制拖拽物体的范围只能在浏览器视窗内，不允许出现滚动条
            if (left < 0) {
                left = 0
            } else if (left > window.innerWidth - dragVane.offsetWidth) {
                left = window.innerWidth - dragVane.offsetWidth
            }
            if (top < 0) {
                top = 0
            } else if (top > window.innerHeight - dragVane.offsetHeight) {
                top = window.innerHeight - dragVane.offsetHeight
            }

            // 移动时重新得到物体的距离，解决拖动时出现晃动的现象
            dragVane.style.left = left + 'px'
            dragVane.style.top = top + 'px'
        }
        document.onmouseup = function (e) { // 当鼠标弹起来的时候不再移动
            console.log('this', this)
            this.onmousemove = null
            this.onmouseup = null // 预防鼠标弹起来后还会循环（即预防鼠标放上去的时候还会移动）

            // 修复低版本ie bug
            if (typeof dragVane.releaseCapture !== 'undefined') {
                dragVane.releaseCapture()
            }
        }
    }


</script>

<!--隐形div点击事件：收回所有tooltip-->
<script>
    var keyEventSelectedId;
    var isOverlayTooltipShow = false;

    var blockDivOnClick = function () {
        //如果是overlay Tooltip的收回
        if(isOverlayTooltipShow)
        {
            isOverlayTooltipShow = false;

            d3.select("#overlayTooltip")
                .style("display", "none");

            if(showFixedTooltip) //如果还有其他tooltip展开的
            {
                $("#invisibleBlock")
                    .css("width", 1480 / 1728 * window.innerWidth)
                    .css("height", 773.28 / 886 * window.innerHeight)
                    .css("top", 60 / 886 * window.innerHeight)
                    .css("left", 110 / 1728 * window.innerWidth)
                    .css("opacity", 0)
                    .css("z-index", 0);


            }else if(isVaneTooltipFixed)
            {
                //如果是点击vane出现tooltip，设置隐形div阻挡vane栏
                $("#invisibleBlock")
                    .css("height", 773.28 / 886 * window.innerHeight)
                    .css("top", 60 / 886 * window.innerHeight)
                    .css("width", 1550 / 1728 * window.innerWidth)
                    .css("left", 32 / 1728 * window.innerWidth)
                    .css("opacity", 0)
                    .css("z-index", 0)

            }
            else if(isHashtagTooltipFixed)
            {
                //如果是点击hashtag出现tooltip，设置隐形div阻挡hashtag栏
                $("#invisibleBlock")
                    .css("width", 1480 / 1728 * window.innerWidth)
                    .css("height", 850 / 886 * window.innerHeight)
                    .css("top", 20 / 886 * window.innerHeight)
                    .css("left", 110 / 1728 * window.innerWidth)
                    .css("opacity", 0)
                    .css("z-index", 0)

            }
            else{
                $("#invisibleBlock")
                    .css("display", "none")
                    .css("opacity", 0)
                    .css("z-index", 0)
            }
            return;
        }

        //点击其他部分，退出聚焦div模式
        $("#invisibleBlock").css("display", "none");

        //如果seed内容是展开的，收回
        if (isShowFull) {
            showFull();
        }

        //如果风向标内容是展开的，收回
        if (isShowFullVane) {
            showFullVane();
        }

        //如果hashtag内容是展开的，收回；并且hashtag取消点击状态
        if (isshowFullHashtag) {
            showFullHashtag();
        }


        if (isHashtagTooltipFixed) // 如果是话题tooltip的阻挡
        {
            //streamGraph取消高亮
            d3.selectAll(".myArea").style("opacity", 1).style("stroke", "none")  // 恢复正常

            isHashtagTooltipFixed = false;
            d3.select("#hashtagTooltip")
                .style("display", "none");

            //返回图标未选中的样子
            for(let i = 0; i <=7; i++)
            {
                console.log("aa")
                d3.select(`#hashtagCir${i}`)
                    .attr("fill", "#FFF9F0")
                    .attr("opacity", 0);

                //图标变成前景色
                d3.select(`#hashtag${i}`)
                    .attr("fill", "#ffc000")
                    .attr("opacity", 1);
            }
        }

        if (isVaneTooltipFixed) // 如果是风向标的阻挡
        {
            isVaneTooltipFixed = false;
            d3.select("#vaneTooltip")
                .style("display", "none");
        }

        if (showFixedTooltip) // 如果是因为要阻挡种子
        {
            showFixedTooltip = false; //取消显示fixed div

            Tooltip
                .style("opacity", 0)
                .style("display", "none")
                .style("z-index", "-10")

            TooltipLine
                .style("opacity", 0);

            d3.select(`#emo_grad_end${selectedSeed
                .attr("id")
                .split("interactCircle")[1]}`)
                .transition()
                .duration(500)
                .attr("offset", "0.1")
                .style("stop-opacity", "0")

            d3.select(`#emo_grad_start${selectedSeed
                .attr("id")
                .split("interactCircle")[1]}`)
                .transition()
                .duration(500)
                // .attr("offset", "1")
                .style("stop-color", d3.select(
                    `#emo_grad_end${selectedSeed
                        .attr("id")
                        .split("interactCircle")[1]}`)
                    .style("stop-color"));

            d3.selectAll(`.seedleaf${selectedSeed
                .attr("id")
                .split("interactCircle")[1]}`)
                .transition()
                .duration(500)
                // .attr("offset", "1")
                .attr("opacity", "0.2");

            //seed叶面渐变动画
            d3.select(`#seedWid${selectedSeed
                .attr("id")
                .split("interactCircle")[1]}`)
                .transition()
                .duration(500)
                .style("opacity", "0.2");

            //streamGraph对应地方取消高亮
            d3.selectAll(".myArea").style("opacity", 1).style("stroke", "none")  // 恢复正常
        }


        //vane图标背景隐藏
        d3.select(`#windVaneBg${keyEventSelectedId}`)
            .attr("opacity", 0);
        //图标颜色更改
        d3.select(`#windVaneBody${keyEventSelectedId}`)
            .attr("fill", "#ffc000")

        d3.select(`#windVaneEye${keyEventSelectedId}`)
            .attr("fill", "#fff8ef")

        d3.select(`#windVaneWing${keyEventSelectedId}`)
            .attr("fill", "#fff8ef")

    }
</script>

<!--隐形div的设置：点击show more之后出现隐形div阻挡鱼眼交互-->
<!--show more 的点击交互函数-->
<script>
    $("#invisibleBlock")
        .css("width", 1480 / 1728 * window.innerWidth)
        .css("height", 773.28 / 886 * window.innerHeight)
        .css("top", 60 / 886 * window.innerHeight)
        .css("left", 110 / 1728 * window.innerWidth);

    var isShowFull = false;
    var showFull = function () {
        if (!isShowFull) //展开全部
        {
            //交换长短内容的位置
            let str = d3.select("#postContent").attr("content");

            d3.select("#postContent")
                .attr("content", d3.select("#postContent").html());

            d3.select("#postContent")
                .html(str);

            d3.select("#showFullaTag").html("show less");

            $("#emotionScaleDiv").css("display", "flex");


            //处理如果展开内容会超出浏览器视口情况
            if (document.getElementById("seedTooltip").offsetHeight + parseFloat(d3.select("#seedTooltip").style("top").split("px")[0]) > window.innerHeight)
                d3.select("#seedTooltip").style("top", `${window.innerHeight - document.getElementById("seedTooltip").offsetHeight - 10}px`)

            isShowFull = true;
        } else { //收回全部
            let str = d3.select("#postContent").attr("content");

            d3.select("#postContent")
                .attr("content", d3.select("#postContent").html());

            d3.select("#postContent")
                .html(str);

            d3.select("#showFullaTag").html("show more")

            $("#emotionScaleDiv").css("display", "none");

            isShowFull = false;
        }

    }

    var isShowFullVane = false;
    //风向标的全部显示
    var showFullVane = function () {
        if (!isShowFullVane) {
            //交换长短内容的位置
            let str = d3.select("#vaneContent").attr("content");

            d3.select("#vaneContent")
                .attr("content", d3.select("#vaneContent").html());

            d3.select("#vaneContent")
                .html(str);

            d3.select("#showFullVane").html("show less");

            isShowFullVane = true;
        } else {

            //交换长短内容的位置
            let str = d3.select("#vaneContent").attr("content");

            d3.select("#vaneContent")
                .attr("content", d3.select("#vaneContent").html());

            d3.select("#vaneContent")
                .html(str);

            d3.select("#showFullVane").html("show more");

            isShowFullVane = false;
        }
    }

    var isshowFullHashtag = false;
    var showFullHashtag = function () {
        if (!isshowFullHashtag) {
            //交换长短内容的位置
            let str = d3.select("#hashtagGroupInclude").attr("content");

            d3.select("#hashtagGroupInclude")
                .attr("content", d3.select("#hashtagGroupInclude").html());

            d3.select("#hashtagGroupInclude")
                .html(str);

            d3.select("#showFullHashtag").html("show less");

            isshowFullHashtag = true;
        } else {
            //交换长短内容的位置
            let str = d3.select("#hashtagGroupInclude").attr("content");

            d3.select("#hashtagGroupInclude")
                .attr("content", d3.select("#hashtagGroupInclude").html());

            d3.select("#hashtagGroupInclude")
                .html(str);

            d3.select("#showFullHashtag").html("show more");

            isshowFullHashtag = false;
        }

    }
</script>

<!--滑条视口代码-->
<script>
    $("#scrollViewBox").css("top", window.innerHeight * 0.08);
    $("#scrollViewBox").css("height", window.innerHeight * 0.96 / 32);
</script>

<!--滑动视口支持拖动-->
<script>

    // 拖拽功能(主要是触发三个事件：onmousedown\onmousemove\onmouseup)
    var dragViewBox = document.getElementById('scrollViewBox')

    //判断是否在拖动viewBox
    var isDragViewBox = false;

    // 点击某物体时，用drag对象即可，move和up是全局区域，也就是整个文档通用，应该使用document对象而不是drag对象(否则，采用drag对象时物体只能往右方或下方移动)
    dragViewBox.onmousedown = function (e) {
        var e = e || window.event // 兼容ie浏览器

        var diffY = e.clientY - dragViewBox.offsetTop

        var scrollReverseBoxScale = d3.scaleLinear()  // 反向，滚动窗口映射到画布
            .domain([0.08 * window.innerHeight, (0.94 * window.innerHeight - (window.innerHeight * 0.96 / 32))])
            .range([0, 31 * 0.98 * window.innerHeight])


        /* 低版本ie bug:物体被拖出浏览器可是窗口外部时，还会出现滚动条，
                解决方法是采用ie浏览器独有的2个方法setCapture()\releaseCapture(),这两个方法，
                可以让鼠标滑动到浏览器外部也可以捕获到事件，而我们的bug就是当鼠标移出浏览器的时候，
                限制超过的功能就失效了。用这个方法，即可解决这个问题。注：这两个方法用于onmousedown和onmouseup中 */
        if (typeof dragViewBox.setCapture !== 'undefined') {
            dragViewBox.setCapture()
        }

        document.onmousemove = function (e) {
            var e = e || window.event // 兼容ie浏览器
            // var left = e.clientX - diffX
            var top = e.clientY - diffY

            // 控制拖拽物体的范围只能在浏览器视窗内，不允许出现滚动条
            //0.02和0.98为滚动条背景的高度范围
            if (top < 0.08 * window.innerHeight) {
                top = 0.08 * window.innerHeight
            } else if (top > 0.94 * window.innerHeight - dragViewBox.offsetHeight) {
                top = 0.94 * window.innerHeight - dragViewBox.offsetHeight
            }

            // 移动时重新得到物体的距离，解决拖动时出现晃动的现象
            dragViewBox.style.top = top + 'px'

            //更新date显示的时间
            let minTopDelta = ((0.94 * window.innerHeight - dragViewBox.offsetHeight) - 0.08 * window.innerHeight) / 32;
            let dateLst = ["Jan 28", "Jan 29", "Jan 30", "Jan 31"]
            for(let i=1; i<=28; i++)
                dateLst.push(`Feb ${i}`)
            dateLst.push("Feb 28")

            d3.select("#dateDiv")
                .html(dateLst[parseInt((top - 0.08 * window.innerHeight) / minTopDelta)] + " ,2022")


            //改变viewBox
            // timelineSvg
            //     .attr("viewBox", `0 ${scrollReverseBoxScale(top)} ${windowWid * 0.96} ${windowHei * 0.98}`);

            window.scrollTo({
                top: scrollReverseBoxScale(top),
                behavior: "instant"
            });
            scrolledDis = scrollReverseBoxScale(top);

            //正在拖动viewbox
            isDragViewBox = true;
        }
        document.onmouseup = function (e) { // 当鼠标弹起来的时候不再移动
            // console.log('this', this)
            this.onmousemove = null
            this.onmouseup = null // 预防鼠标弹起来后还会循环（即预防鼠标放上去的时候还会移动）

            // 修复低版本ie bug
            if (typeof dragViewBox.releaseCapture !== 'undefined') {
                dragViewBox.releaseCapture()
            }

            //停止拖动viewbox
            isDragViewBox = false;
        }
    }

</script>

<!--渐变条绘制-->
<script>
    var windlineSvg = d3.select("#windLineBg")
        .append("svg")
        .attr("height", window.innerHeight * 0.98)
        .attr("width", "100%");
    // .style("top", 0.01 * window.innerHeight)

    //改变fixed元素的上边距
    $("#windLineBg").css("top", 0.01 * window.innerHeight);
    $("#windLineBg").css("left", 0.02 * window.innerWidth);


    // {
    //     var gradRectSvg = d3.select("#gradRectBg")
    //         .append("svg")
    //         .attr("height", window.innerHeight * 0.1)
    //         .attr("width", "100%");
    //     // .style("top", 0.01 * window.innerHeight)
    //
    //     //改变fixed元素的上边距
    //     $("#gradRectBg").css("top", 0);
    //     $("#gradRectBg").css("left", 0.02 * window.innerWidth);
    //
    //     gradRectSvg.append("rect")
    //         .attr("x", 0)
    //         .attr("y", 0)
    //         .attr("width", window.innerWidth)
    //         .attr("height", window.innerHeight)
    // }


    var windPosX = [];
    var deltaXOffset = (1 - 0.02 - 120 / 1728) / 10; //0.02是左边距；120/1728是右边距（100是背景条宽度；20是背景条距离右侧边距）；等分为10份

    for (let i = 1; i <= 9; i++) {
        windPosX.push((i * deltaXOffset) * window.innerWidth)
    }

    //绘制渐变条
    {
        function linearAddStop(gradient) {
            var stop1 = gradient.append("stop")
                .attr("offset", "0")
                .style("stop-color", "#ffca36")
                .style("stop-opacity", "0");

            var stop2 = gradient.append("stop")
                .attr("offset", "0.3")
                .style("stop-color", "#ffca36")
                .style("stop-opacity", "0.4");

            var stop3 = gradient.append("stop")
                .attr("offset", "0.5")
                .style("stop-color", "#ffca36")
                .style("stop-opacity", "0.5");

            var stop2 = gradient.append("stop")
                .attr("offset", "0.7")
                .style("stop-color", "#ffca36")
                .style("stop-opacity", "0.4");

            var stop1 = gradient.append("stop")
                .attr("offset", "1")
                .style("stop-color", "#ffca36")
                .style("stop-opacity", "0");

        }

        function linearAddStopNoTag(gradient) {
            var stop1 = gradient.append("stop")
                .attr("offset", "0")
                .style("stop-color", "#bebebe")
                .style("stop-opacity", "0");

            var stop2 = gradient.append("stop")
                .attr("offset", "0.3")
                .style("stop-color", "#bebebe")
                .style("stop-opacity", "0.4");

            var stop3 = gradient.append("stop")
                .attr("offset", "0.5")
                .style("stop-color", "#bebebe")
                .style("stop-opacity", "0.5");

            var stop2 = gradient.append("stop")
                .attr("offset", "0.7")
                .style("stop-color", "#bebebe")
                .style("stop-opacity", "0.4");

            var stop1 = gradient.append("stop")
                .attr("offset", "1")
                .style("stop-color", "#bebebe")
                .style("stop-opacity", "0");
        }


        var defs = windlineSvg.append("defs");

        var windlineGrad = defs.append("linearGradient")
            .attr("id", "windlineGrad")
            .attr("gradientUnits", "userSpaceOnUse");
        linearAddStop(windlineGrad);

        windlineGrad
            .attr("x1", 0.2 * window.innerWidth)
            .attr("x2", 0.2 * window.innerWidth)
            .attr("y1", 0.05 * window.innerHeight)
            .attr("y2", 0.95 * window.innerHeight);


        var noTagGrad = defs.append("linearGradient")
            .attr("id", "noTagGrad")
            .attr("gradientUnits", "userSpaceOnUse");
        linearAddStopNoTag(noTagGrad);

        noTagGrad
            .attr("x1", 0.2 * window.innerWidth)
            .attr("x2", 0.2 * window.innerWidth)
            .attr("y1", 0.05 * window.innerHeight)
            .attr("y2", 0.95 * window.innerHeight);


        var wind1 = windlineSvg.append("line")
            .attr("x1", windPosX[0])
            .attr("x2", windPosX[0])
            .attr("y1", 0.05 * window.innerHeight)
            .attr("y2", 0.95 * window.innerHeight)
            .attr("stroke-width", "2")
            .attr("stroke", "url(#" + windlineGrad.attr("id") + ")")

        var wind2 = windlineSvg.append("line")
            .attr("x1", windPosX[1])
            .attr("x2", windPosX[1])
            .attr("y1", 0.05 * window.innerHeight)
            .attr("y2", 0.95 * window.innerHeight)
            .attr("stroke-width", "2")
            .attr("stroke", "url(#" + windlineGrad.attr("id") + ")")

        var wind3 = windlineSvg.append("line")
            .attr("x1", windPosX[2])
            .attr("x2", windPosX[2])
            .attr("y1", 0.05 * window.innerHeight)
            .attr("y2", 0.95 * window.innerHeight)
            .attr("stroke-width", "2")
            .attr("stroke", "url(#" + windlineGrad.attr("id") + ")")

        var wind4 = windlineSvg.append("line")
            .attr("x1", windPosX[3])
            .attr("x2", windPosX[3])
            .attr("y1", 0.05 * window.innerHeight)
            .attr("y2", 0.95 * window.innerHeight)
            .attr("stroke-width", "2")
            .attr("stroke", "url(#" + windlineGrad.attr("id") + ")")

        var wind5 = windlineSvg.append("line")
            .attr("x1", windPosX[4])
            .attr("x2", windPosX[4])
            .attr("y1", 0.05 * window.innerHeight)
            .attr("y2", 0.95 * window.innerHeight)
            .attr("stroke-width", "2")
            .attr("stroke", "url(#" + windlineGrad.attr("id") + ")")

        var wind6 = windlineSvg.append("line")
            .attr("x1", windPosX[5])
            .attr("x2", windPosX[5])
            .attr("y1", 0.05 * window.innerHeight)
            .attr("y2", 0.95 * window.innerHeight)
            .attr("stroke-width", "2")
            .attr("stroke", "url(#" + windlineGrad.attr("id") + ")")

        var wind7 = windlineSvg.append("line")
            .attr("x1", windPosX[6])
            .attr("x2", windPosX[6])
            .attr("y1", 0.05 * window.innerHeight)
            .attr("y2", 0.95 * window.innerHeight)
            .attr("stroke-width", "2")
            .attr("stroke", "url(#" + windlineGrad.attr("id") + ")")

        var wind8 = windlineSvg.append("line")
            .attr("x1", windPosX[7])
            .attr("x2", windPosX[7])
            .attr("y1", 0.05 * window.innerHeight)
            .attr("y2", 0.95 * window.innerHeight)
            .attr("stroke-width", "2")
            .attr("stroke", "url(#" + windlineGrad.attr("id") + ")")


        var wind9NoTag = windlineSvg.append("line")
            .attr("x1", windPosX[8])
            .attr("x2", windPosX[8])
            .attr("y1", 0.05 * window.innerHeight)
            .attr("y2", 0.95 * window.innerHeight)
            .attr("stroke-width", "2")
            .attr("stroke", "url(#" + noTagGrad.attr("id") + ")")

    }
</script>

<!--绘制时间标识-->
<script>
    d3.select("#dateDiv")
        .style("top", `${0.04 * window.innerHeight}px`)
        .style("right", `${0.18 * window.innerHeight}px`)
</script>

<!--绘制主要时间线-->
<script>
    var windowHei = window.innerHeight;
    var windowWid = window.innerWidth;

    //设置主div的宽度
    $("#samaraTimeline").css("width", windowWid * 0.96);

    var timelineSvg = d3.select("#samaraTimeline")
        .append("svg")
        .attr("id", "timelineSvg")
        .attr("width", "100%") //使用viewBox参数，就不用height width了
        .attr("height", windowHei * 32 * 0.98)

    var seedGroup = timelineSvg.append("g")
        .attr("id", "seedGroup"); //存放生成seed的group

    //绘制顶部和底部的过渡渐变矩形
    {//设置渐变过度条高度
        $("#gradRectBg").css("width", windowWid * 0.96);
        $("#gradRectBg").css("left", windowWid * 0.02);

        $("#gradRectBg2").css("width", windowWid * 0.96);
        $("#gradRectBg2").css("left", windowWid * 0.02);


        var gradRectSvg1 = d3.select("#gradRectBg")
            .attr("id", "gradRectSvg1")
            .append("svg")
            .attr("width", "100%")
            .attr("height", 0.12 * windowHei)

        var gradRectSvg2 = d3.select("#gradRectBg2")
            .attr("id", "gradRectSvg2")
            .append("svg")
            .attr("width", "100%")
            .attr("height", 0.1 * windowHei)

        //遮脚线div设置
        d3.select("#gradRectBg3")
            .append("svg")
            .attr("width", 0.92 * windowWid)
            .attr("height", 0.02 * windowHei)
            .append("rect")
            .attr("x", "0")
            .attr("y", "0")
            .attr("width", 0.92 * windowWid)
            .attr("height", 0.02 * windowHei)
            .attr("fill", "#FFF9F0")


        //设置过渡矩形渐变
        var gradRect1 = defs.append("linearGradient")
            .attr("id", "gradRect1")
            .attr("gradientUnits", "userSpaceOnUse")
            .attr("x1", "0")
            .attr("x2", "0")
            .attr("y1", "0")
            .attr("y2", 0.12 * windowHei);

        gradRect1.append("stop")
            .attr("offset", "0.5")
            .style("stop-color", "#FFF9F0")
            .style("stop-opacity", "1");

        gradRect1.append("stop")
            .attr("offset", "1")
            .style("stop-color", "#FFF9F0")
            .style("stop-opacity", "0");


        var gradRect2 = defs.append("linearGradient")
            .attr("id", "gradRect2")
            .attr("gradientUnits", "userSpaceOnUse")
            .attr("x1", "0")
            .attr("x2", "0")
            .attr("y1", 0.1 * windowHei)
            .attr("y2", 0);

        gradRect2.append("stop")
            .attr("offset", "0.5")
            .style("stop-color", "#FFF9F0")
            .style("stop-opacity", "1");

        gradRect2.append("stop")
            .attr("offset", "1")
            .style("stop-color", "#FFF9F0")
            .style("stop-opacity", "0");


        //过渡矩形设置
        gradRectSvg1.append("rect")
            .attr("x", "0")
            .attr("y", "0")
            .attr("width", 0.92 * windowWid)
            .attr("height", 0.12 * windowHei)
            .attr("fill", "url(#" + gradRect1.attr("id") + ")")

        gradRectSvg2.append("rect")
            .attr("x", "0")
            .attr("y", "0")
            .attr("width", 0.92 * windowWid)
            .attr("height", 0.1 * windowHei)
            .attr("fill", "url(#" + gradRect2.attr("id") + ")")
    }


    var interactCirGroup = timelineSvg.append("g")
        .attr("id", "interactCirGroup"); //存放生成seed的group

    // var defsSeed = timelineSvg.append("defs");
    var scrolledDis = 0;
    var scrollBoxScale = d3.scaleLinear()
        .domain([0, 31 * 0.98 * window.innerHeight])
        .range([0.08 * window.innerHeight, (0.94 * window.innerHeight - (window.innerHeight * 0.96 / 32))])
    //svg响应滚动事件
    timelineSvg.on("wheel", function (d) {
        {
            //     // console.log(parseFloat( timelineSvg.attr("viewBox").split(" ")[1]))
            //     //改变viewBox， 固定渐变条
            //     // 能够滚动的条件: 不越界，或者越界了但是是往反方向滑动的
            //     if ((parseFloat(timelineSvg.attr("viewBox").split(" ")[1]) >= 0 && parseFloat(timelineSvg.attr("viewBox").split(" ")[1]) <= 31 * 0.98 * window.innerHeight) || (timelineSvg.attr("viewBox").split(" ")[1] < 0 && d.deltaY > 0) || (parseFloat(timelineSvg.attr("viewBox").split(" ")[1]) > 31 * 0.98 * window.innerHeight && d.deltaY < 0)) {
            //         //滚动视口改变位置
            //         scrolledDis += d.deltaY / 2;
            //         $("#scrollViewBox").css("top", scrollBoxScale(scrolledDis));
            //
            //         //改变viewBox
            //         timelineSvg
            //             .attr("viewBox", `0 ${parseFloat(timelineSvg.attr("viewBox").split(" ")[1]) + d.deltaY / 2} ${windowWid * 0.96} ${windowHei * 0.98}`);
            //
            //         //将背景的wind渐变线固定在原地
            //
            //         windlineGrad
            //             .attr("y1", (parseFloat(wind1.attr("y1")) + d.deltaY / 2).toString())
            //             .attr("y2", (parseFloat(wind1.attr("y2")) + d.deltaY / 2).toString());
            //
            //         noTagGrad
            //             .attr("y1", (parseFloat(wind9NoTag.attr("y1")) + d.deltaY / 2).toString())
            //             .attr("y2", (parseFloat(wind9NoTag.attr("y2")) + d.deltaY / 2).toString());
            //
            //
            //         wind1.attr("y1", (parseFloat(wind1.attr("y1")) + d.deltaY / 2).toString());
            //         wind1.attr("y2", (parseFloat(wind1.attr("y2")) + d.deltaY / 2).toString());
            //
            //         wind2.attr("y1", (parseFloat(wind2.attr("y1")) + d.deltaY / 2).toString());
            //         wind2.attr("y2", (parseFloat(wind2.attr("y2")) + d.deltaY / 2).toString());
            //
            //         wind3.attr("y1", (parseFloat(wind3.attr("y1")) + d.deltaY / 2).toString());
            //         wind3.attr("y2", (parseFloat(wind3.attr("y2")) + d.deltaY / 2).toString());
            //
            //         wind4.attr("y1", (parseFloat(wind4.attr("y1")) + d.deltaY / 2).toString());
            //         wind4.attr("y2", (parseFloat(wind4.attr("y2")) + d.deltaY / 2).toString());
            //
            //         wind5.attr("y1", (parseFloat(wind5.attr("y1")) + d.deltaY / 2).toString());
            //         wind5.attr("y2", (parseFloat(wind5.attr("y2")) + d.deltaY / 2).toString());
            //
            //         wind6.attr("y1", (parseFloat(wind6.attr("y1")) + d.deltaY / 2).toString());
            //         wind6.attr("y2", (parseFloat(wind6.attr("y2")) + d.deltaY / 2).toString());
            //
            //         wind7.attr("y1", (parseFloat(wind7.attr("y1")) + d.deltaY / 2).toString());
            //         wind7.attr("y2", (parseFloat(wind7.attr("y2")) + d.deltaY / 2).toString());
            //
            //         wind8.attr("y1", (parseFloat(wind8.attr("y1")) + d.deltaY / 2).toString());
            //         wind8.attr("y2", (parseFloat(wind8.attr("y2")) + d.deltaY / 2).toString());
            //
            //         wind9NoTag.attr("y1", (parseFloat(wind9NoTag.attr("y1")) + d.deltaY / 2).toString());
            //         wind9NoTag.attr("y2", (parseFloat(wind9NoTag.attr("y2")) + d.deltaY / 2).toString());
            //
            //     }
        } //原方案：改变viewBox
        // console.log(d.deltaY)
    });

</script>

<!--hashtag绘制-->
<script>
    let hashtagNodes;

    //读取hashtag相关数据
    d3.json("asset/json/hashtagGroup.json").then(function (data) {

        hashtagNodes = d3.range(1, 8 + 1).map(function (d, i) {
            return {
                event: data[d.toString()]["event"],
                hashtags: data[d.toString()]["hashtags"],
            }
        });

    });


    var hashtagTooltip = d3.select("#hashtagTooltip")

    let hashtagTooltipMouseover = function (d) {

        let hashtagGroupIndex;

        if (d3.select(this).attr("id").indexOf("hashtagCir") > -1) // id是hashtagCir__
        {
            hashtagGroupIndex = parseInt(d3.select(this).attr("id").split("hashtagCir")[1]);

        } else {
            hashtagGroupIndex = parseInt(d3.select(this).attr("id").split("hashtag")[1]);
        }

        //高亮streamGraph
        d3.selectAll(".myArea").style("opacity", .2) //其他变半透明
        d3.select(`#streamGraph${hashtagGroupIndex}`)
            //.style("stroke", "black")
            .style("opacity", 1)

        //如果是最后两个话题，不显示jump to key event
        if(hashtagGroupIndex == 6 || hashtagGroupIndex == 7)
        {
            d3.select("#jumpToKeyEventSvg")
                .style("display", "none")
        }
        else{
            d3.select("#jumpToKeyEventSvg")
                .style("display", "inline")
        }

        //显示tooltip，定位
        hashtagTooltip
            .style("left", `${windPosX[hashtagGroupIndex] - 116}px`)
            .style("top", `${windowWid * 0.04}px`)
            .style("display", "block");

        //更改名称：Hashtag Group · X
        d3.select("#hashtagGroupNum")
            .html(`Hashtag Group · ${hashtagGroupIndex + 1}`);

        //subtitle内容更新
        d3.select("#hashtagGroupSubtitle")
            .html(hashtagNodes[hashtagGroupIndex]["event"]);

        let fullHashtags;
        let maxNumofHashtag = 4;

        fullHashtags = "included hashtags:<br>"
        for (let i = 0; i < hashtagNodes[hashtagGroupIndex]["hashtags"].length; i++) {
            fullHashtags += hashtagNodes[hashtagGroupIndex]["hashtags"][i]
            fullHashtags += "<br>"
        }
        if (hashtagNodes[hashtagGroupIndex]["hashtags"].length <= maxNumofHashtag) { //内容最多显示4条
            d3.select("#hashtagGroupInclude")
                .html(fullHashtags)
                .attr("content", fullHashtags);
        } else {
            d3.select("#hashtagGroupInclude")
                .attr("content", fullHashtags);

            d3.select("#hashtagGroupInclude")
                .html(function () {
                    let res;

                    res = "included hashtags:<br>"
                    for (let i = 0; i < 4; i++) {
                        res += hashtagNodes[hashtagGroupIndex]["hashtags"][i]
                        if (i != 3) // 最后不加换行了
                            res += "<br>"
                    }
                    return res;

                })
        }


    }

    var isHashtagTooltipFixed = false;

    let hashtagTooltipMouseleave = function (d) {
        if (!isHashtagTooltipFixed) {
            hashtagTooltip
                .style("display", "none");
            //streamGraph取消高亮
            d3.selectAll(".myArea").style("opacity", 1).style("stroke", "none")  // 恢复正常

        }


    }

    let hashtagTooltipMouseClick = function (d) {

        //先收回所有tooltip
        blockDivOnClick();

        $("#invisibleBlock").css("display", "block");
        isHashtagTooltipFixed = true;

        //如果是点击hashtag出现tooltip，设置隐形div阻挡hashtag栏
        $("#invisibleBlock")
            .css("width", 1480 / 1728 * window.innerWidth)
            .css("height", 850 / 886 * window.innerHeight)
            .css("top", 20 / 886 * window.innerHeight)
            .css("left", 110 / 1728 * window.innerWidth);



        //点击hashtag图标，图标更改为选中状态

        let hashtagGroupIndex;

        if (d3.select(this).attr("id").indexOf("hashtagCir") > -1) // id是hashtagCir__
        {
            hashtagGroupIndex = parseInt(d3.select(this).attr("id").split("hashtagCir")[1]);

        } else {
            hashtagGroupIndex = parseInt(d3.select(this).attr("id").split("hashtag")[1]);
        }

        //高亮streamGraph
        d3.selectAll(".myArea").style("opacity", .2) //其他变半透明
        d3.select(`#streamGraph${hashtagGroupIndex}`)
            //.style("stroke", "black")
            .style("opacity", 1)

        //标记当前选中的hashtagId
        hashtagSelectedId = hashtagGroupIndex;

        //背景变成填充色
        d3.select(`#hashtagCir${hashtagGroupIndex}`)
            .attr("fill", "#ffc000")
            .attr("opacity", 1);

        //图标变成前景色
        d3.select(`#hashtag${hashtagGroupIndex}`)
            .attr("fill", "#FFF9F0")
            .attr("opacity", 1);

    }

    for (let i = 0; i <= 7; i++) {

        //背景的圆形
        gradRectSvg1.append("circle")
            .attr("id", `hashtagCir${i}`)
            .attr("cx", windPosX[i])
            .attr("cy", windowWid * 0.015 + 28.5 / 2)  //井号svg高为28.5
            .attr("r", windowWid * 0.012)
            .attr("fill", "#ffc000")
            .attr("opacity", 0)
            .on("mouseover", hashtagTooltipMouseover)
            .on("mouseleave", hashtagTooltipMouseleave)
            .on("click", hashtagTooltipMouseClick);


        gradRectSvg1.append("g")
            .attr("transform", `translate(${windPosX[i] - 10}, ${windowWid * 0.015})`) // 井号svg的宽度为20， /2 =10
            .append("path")
            .attr("id", `hashtag${i}`)
            .attr("d", "M3.32,20.09H0V16.43H3.74l.66-5.29H.89V7.44h4L5.82,0H9.1L8.21,7.44h4.86L14,0h3.31l-.89,7.44h3.48v3.7H16l-.65,5.29h3.7v3.66H14.92l-1,8.37H10.53l1-8.37H6.71l-1,8.37H2.31ZM12,16.43l.66-5.29H7.75l-.66,5.29Z")
            .attr("fill", "#ffc000")
            .on("mouseover", hashtagTooltipMouseover)
            .on("mouseleave", hashtagTooltipMouseleave)
            .on("click", hashtagTooltipMouseClick)
    }


    let keyEventYIndexScale = 1 / 886 * window.innerHeight;

    //制作点击跳转到相关key event的链接
    var keyEventYIndex = [0 * keyEventYIndexScale, 2150 * keyEventYIndexScale,
        9050 * keyEventYIndexScale, 11460 * keyEventYIndexScale, 17100 * keyEventYIndexScale,
        22200 * keyEventYIndexScale]; // 点击需要跳转到的页面高度

    var hashtagSelectedId;
    var jumpToKeyEvent = function (){

        //如果是点击vane出现tooltip，设置隐形div阻挡vane栏
        $("#invisibleBlock")
            .css("height", 773.28 / 886 * window.innerHeight)
            .css("top", 60 / 886 * window.innerHeight)
            .css("width", 1550 / 1728 * window.innerWidth)
            .css("left", 32 / 1728 * window.innerWidth);

        //收回tooltip；相当于点击了一下隐形div
        blockDivOnClick();

        //展开新的tooltip
        {
            let maxLength = 100;

            isVaneTooltipFixed = true;

            d3.select("#vaneTooltip")
                .style("opacity", 0)
                .transition()
                .duration(1000)
                .style("opacity", 1); //制作渐入动画


            d3.select("#vaneTooltip")
                .style("display", "flex");

            let vanetitleGroup = ["Investigation Report 1 · county level", "Investigation Report 2 · county level",
                "Investigation Report 3 · city level", "Investigation Report 4 · city level",
                "Investigation Report 5 · provincial level", "Investigation Report 6 · provincial level"]

            d3.select("#vaneTitle")
                .html(`${vanetitleGroup[hashtagSelectedId]}`);

            d3.select("#vaneSubTitle")
                .html(keyEvents[hashtagSelectedId].subtitle);

            //关键事件内容填充
            if (keyEvents[hashtagSelectedId].content.length > maxLength) {
                d3.select("#showFullVane")
                    .style("display", "inline-flex");

                d3.select("#vaneContent")
                    .attr("content", keyEvents[hashtagSelectedId].content);

                d3.select("#vaneContent")
                    .html(keyEvents[hashtagSelectedId].content.substring(0, maxLength + 1) + "...");
            } else {
                d3.select("#showFullVane")
                    .style("display", "none");

                d3.select("#vaneContent")
                    .attr("content", keyEvents[hashtagSelectedId].content);

                d3.select("#vaneContent")
                    .html(keyEvents[hashtagSelectedId].content);
            }

            d3.select("#vaneFrom")
                .html(keyEvents[hashtagSelectedId].from);

            d3.select("#vaneDate")
                .html(keyEvents[hashtagSelectedId].date);


            $("#invisibleBlock").css("display", "block");

            d3.select("#vaneTooltip")
                .style("display", "flex");

        }

        //更改vane图标的颜色
        d3.select(`#windVaneBg${hashtagSelectedId}`)
            .attr("opacity", 1)

        d3.select(`#windVaneBody${hashtagSelectedId}`)
            .attr("fill", "#fff8ef")

        d3.select(`#windVaneEye${hashtagSelectedId}`)
            .attr("fill", "#ffc000")

        d3.select(`#windVaneWing${hashtagSelectedId}`)
            .attr("fill", "#ffc000")



        //更新选中的key event id
        keyEventSelectedId = hashtagSelectedId;

        //窗口滚动
        window.scrollTo({
            top: keyEventYIndex[hashtagSelectedId],
            // behavior: "smooth"
        });

        let scrollTop = document.documentElement.scrollTop || document.body.scrollTop;

        if(hashtagSelectedId == 0) //如果是第一个标签；顶部挡住了不能居中，所以tooltip显示在上端
        {
            d3.select("#vaneTooltip")
                .style("top", `${ 100 }px`) // 选择悬停物体的父元素（g标签）
        }else{
            d3.select("#vaneTooltip")
                .style("top", `${window.innerHeight / 2 - 150}px`) // 选择悬停物体的父元素（g标签）
        }


    }
</script>

<!--风向标绘制-->
<script>
    var vaneDis = [100, 2550, 9450, 11850, 17480, 22580]
    var keyEvents;
    var isVaneTooltipFixed = false; // 是否被隐形div阻挡

    //读取key event 数据
    d3.json("asset/json/key_event.json").then(function (data) {
        keyEvents = d3.range(1, 6 + 1).map(function (d, i) {
            return {
                subtitle: data[d.toString()]["subtitle"],
                content: data[d.toString()]["content"],
                from: data[d.toString()]["from"],
                date: data[d.toString()]["date"],
            }
        });
    });

    var vanemouseover = function (d) {

        let maxLength = 100;

        d3.select("#vaneTooltip")
            .style("display", "flex");

        let scrollTop = document.documentElement.scrollTop || document.body.scrollTop;

        d3.select("#vaneTooltip")
            .style("top", `${vaneDis[parseInt(d3.select(this.parentNode).attr("id").split("vane")[1])] - scrollTop}px`) // 选择悬停物体的父元素（g标签）

        let vanetitleGroup = ["Investigation Report 1 · county level", "Investigation Report 2 · county level",
            "Investigation Report 3 · city level", "Investigation Report 4 · city level",
            "Investigation Report 5 · provincial level", "Investigation Report 6 · provincial level"]

        d3.select("#vaneTitle")
            .html(`${vanetitleGroup[parseInt(d3.select(this.parentNode).attr("id").split("vane")[1])]}`);

        d3.select("#vaneSubTitle")
            .html(keyEvents[parseInt(d3.select(this.parentNode).attr("id").split("vane")[1])].subtitle);

        //关键事件内容填充
        if (keyEvents[parseInt(d3.select(this.parentNode).attr("id").split("vane")[1])].content.length > maxLength) {
            d3.select("#showFullVane")
                .style("display", "inline-flex");

            d3.select("#vaneContent")
                .attr("content", keyEvents[parseInt(d3.select(this.parentNode).attr("id").split("vane")[1])].content);

            d3.select("#vaneContent")
                .html(keyEvents[parseInt(d3.select(this.parentNode).attr("id").split("vane")[1])].content.substring(0, maxLength + 1) + "...");
        } else {
            //隐藏show more
            d3.select("#showFullVane")
                .style("display", "none");

            d3.select("#vaneContent")
                .attr("content", keyEvents[parseInt(d3.select(this.parentNode).attr("id").split("vane")[1])].content);

            d3.select("#vaneContent")
                .html(keyEvents[parseInt(d3.select(this.parentNode).attr("id").split("vane")[1])].content);
        }

        d3.select("#vaneFrom")
            .html(keyEvents[parseInt(d3.select(this.parentNode).attr("id").split("vane")[1])].from);

        d3.select("#vaneDate")
            .html(keyEvents[parseInt(d3.select(this.parentNode).attr("id").split("vane")[1])].date);


    }

    var vanemouseleave = function (d) {
        if (!isVaneTooltipFixed) {
            d3.select("#vaneTooltip")
                .style("display", "none");
        }

    }

    var vanmouseclick = function (d) {

        //先收回所有tooltip
        blockDivOnClick();

        keyEventSelectedId = parseInt(d3.select(this.parentNode).attr("id").split("vane")[1])//设置当前选中的keyEvent

        isVaneTooltipFixed = true;

        $("#invisibleBlock").css("display", "block");

        //如果是点击vane出现tooltip，设置隐形div阻挡vane栏
        $("#invisibleBlock")
            .css("height", 773.28 / 886 * window.innerHeight)
            .css("top", 60 / 886 * window.innerHeight)
            .css("width", 1550 / 1728 * window.innerWidth)
            .css("left", 32 / 1728 * window.innerWidth);

        //显示tooltip
        d3.select("#vaneTooltip")
            .style("display", "flex");

        //图标背景出现
        d3.select(`#windVaneBg${keyEventSelectedId}`)
            .attr("opacity", 1);
        //图标颜色更改
        d3.select(`#windVaneBody${keyEventSelectedId}`)
            .attr("fill", "#fff8ef")

        d3.select(`#windVaneEye${keyEventSelectedId}`)
            .attr("fill", "#ffc000")

        d3.select(`#windVaneWing${keyEventSelectedId}`)
            .attr("fill", "#ffc000")


    }

    for (let i = 0; i < vaneDis.length; i++) {


        let windVaneGroup = d3.select("#timelineSvg")
            .append("g")
            .attr("transform", `translate(0, ${vaneDis[i]})`)
            .attr("id", `vane${i}`)

        //vane图标背景色块
        windVaneGroup.append("path")
            .attr("id", `windVaneBg${i}`)
            .attr("d", "M0,0H60.79a29,29,0,0,1,29,29v0a29,29,0,0,1-29,29H0a0,0,0,0,1,0,0V0A0,0,0,0,1,0,0Z")
            .attr("fill", "#ffc000")
            .attr("opacity", 0)
            .attr("transform", "translate(0, -2)")

        windVaneGroup.append("path")
            .attr("id", `windVaneBody${i}`)
            .attr("d", "M80.8,37.28a1,1,0,0,1-1,1H76.72l2.15,2.16a1,1,0,0,1,0,1.41,1,1,0,0,1-1.41,0l-2.22-2.22a4.54,4.54,0,0,1-3.88,2.18h-.45v3.85a1.5,1.5,0,0,1-3,0V41.81H60a15.28,15.28,0,0,1-15.11-13H37V48.49l3.09-1.12A26.08,26.08,0,0,0,36,54.72a25.83,25.83,0,0,0-4.09-7.35L35,48.49V28.86H26.54a4.47,4.47,0,0,1-8.42,0H0v-3H18.12a4.47,4.47,0,0,1,8.42,0H35V6.5a7.48,7.48,0,0,0-1.55-1.31V0A8.86,8.86,0,0,1,36,2.45,9,9,0,0,1,38.57,0V5.19A6.7,6.7,0,0,0,37,6.5V25.86h7.66A15.28,15.28,0,0,1,60,11.22h1.49V32.71h9.92a4.54,4.54,0,0,1,3.89,2.21l2.21-2.21a1,1,0,0,1,1.41,0,1,1,0,0,1,0,1.42l-2.15,2.15H79.8A1,1,0,0,1,80.8,37.28Z")
            .attr("fill", "#ffc000")
            .on("mouseover", vanemouseover)
            .on("mouseleave", vanemouseleave)
            .on("click", vanmouseclick);

        windVaneGroup.append("circle")
            .attr("id", `windVaneEye${i}`)
            .attr("cx", "69.96")
            .attr("cy", "37.3")
            .attr("r", "2")
            .attr("fill", "#fff8ef")
            .on("mouseover", vanemouseover)
            .on("mouseleave", vanemouseleave)
            .on("click", vanmouseclick);

        windVaneGroup.append("path")
            .attr("id", `windVaneWing${i}`)
            .attr("d", "M54.88,30.74a5.29,5.29,0,1,1,0-10.58.75.75,0,0,1,0,1.5,3.79,3.79,0,1,0,0,7.58.75.75,0,0,1,0,1.5Z")
            .attr("fill", "#fff8ef")
            .on("mouseover", vanemouseover)
            .on("mouseleave", vanemouseleave)
            .on("click", vanmouseclick);

    }

    var jumpToHashtag = function (){

        //图标背景出现
        d3.select(`#windVaneBg${keyEventSelectedId}`)
            .attr("opacity", 0);
        //图标颜色更改
        d3.select(`#windVaneBody${keyEventSelectedId}`)
            .attr("fill", "#ffc000")

        d3.select(`#windVaneEye${keyEventSelectedId}`)
            .attr("fill", "#fff8ef")

        d3.select(`#windVaneWing${keyEventSelectedId}`)
            .attr("fill", "#fff8ef")

        //如果是点击hashtag出现tooltip，设置隐形div阻挡hashtag栏
        $("#invisibleBlock")
            .css("width", 1480 / 1728 * window.innerWidth)
            .css("height", 850 / 886 * window.innerHeight)
            .css("top", 20 / 886 * window.innerHeight)
            .css("left", 110 / 1728 * window.innerWidth);

        //隐藏当前vane的tooltip
        d3.select("#vaneTooltip")
            .style("display", "none");

        //显示hashtag，相当于hashtag图标的悬停事件
        {
            //如果是最后两个话题，不显示jump to key event
            if(keyEventSelectedId == 6 || keyEventSelectedId == 7)
            {
                d3.select("#jumpToKeyEventSvg")
                    .style("display", "none")
            }
            else{
                d3.select("#jumpToKeyEventSvg")
                    .style("display", "inline")
            }

            //显示tooltip，定位
            hashtagTooltip
                .style("left", `${windPosX[keyEventSelectedId] - 116}px`)
                .style("top", `${windowWid * 0.04}px`)
                .style("display", "block");

            //更改名称：Hashtag Group · X
            d3.select("#hashtagGroupNum")
                .html(`Hashtag Group · ${keyEventSelectedId + 1}`);

            //subtitle内容更新
            d3.select("#hashtagGroupSubtitle")
                .html(hashtagNodes[keyEventSelectedId]["event"]);

            let fullHashtags;
            let maxNumofHashtag = 4;

            fullHashtags = "included hashtags:<br>"
            for (let i = 0; i < hashtagNodes[keyEventSelectedId]["hashtags"].length; i++) {
                fullHashtags += hashtagNodes[keyEventSelectedId]["hashtags"][i]
                fullHashtags += "<br>"
            }

            if (hashtagNodes[keyEventSelectedId]["hashtags"].length <= maxNumofHashtag) { //内容最多显示4条
                d3.select("#hashtagGroupInclude")
                    .html(fullHashtags)
                    .attr("content", fullHashtags);
            } else {
                d3.select("#hashtagGroupInclude")
                    .attr("content", fullHashtags);

                d3.select("#hashtagGroupInclude")
                    .html(function () {
                        let res;

                        res = "included hashtags:<br>"
                        for (let i = 0; i < 4; i++) {
                            res += hashtagNodes[keyEventSelectedId]["hashtags"][i]
                            if (i != 3) // 最后不加换行了
                                res += "<br>"
                        }
                        return res;

                    })
            }


        }

        //固定hashtag，相当于hashtag图标的点击事件
        {
            $("#invisibleBlock").css("display", "block");
            isHashtagTooltipFixed = true;

            //点击hashtag图标，图标更改为选中状态

            //背景变成填充色
            d3.select(`#hashtagCir${keyEventSelectedId}`)
                .attr("fill", "#ffc000")
                .attr("opacity", 1);

            //图标变成前景色
            d3.select(`#hashtag${keyEventSelectedId}`)
                .attr("fill", "#FFF9F0")
                .attr("opacity", 1);
        }

        //更新选中的hashtag id
        hashtagSelectedId = keyEventSelectedId;

    }


</script>

<!--右侧滑块滚动; 判断是否滑动到圆形，是否高亮显示-->
<script>
    window.onscroll = function () {
        //为了保证兼容性，这里取两个值，哪个有值取哪一个
        //scrollTop就是触发滚轮事件时滚轮的高度
        var scrollTop = document.documentElement.scrollTop || document.body.scrollTop;
        // console.log("滚动距离" + scrollTop);

        //右侧滚动视口改变位置
        if(!isDragViewBox)  // 如果没有在拖动viewbox
            $("#scrollViewBox").css("top", scrollBoxScale(scrollTop));


        //更新date显示的时间
        let minTopDelta = ((0.94 * window.innerHeight - dragViewBox.offsetHeight) - 0.08 * window.innerHeight) / 32;
        let dateLst = ["Jan 28", "Jan 29", "Jan 30", "Jan 31"]
        for(let i=1; i<=28; i++)
            dateLst.push(`Feb ${i}`)
        dateLst.push("Feb 28")

        d3.select("#dateDiv")
            .html(dateLst[parseInt((scrollBoxScale(scrollTop) - 0.08 * window.innerHeight) / minTopDelta)] + " ,2022")




        //滑条滑到keyevent的时候圆形高亮
        let deltaRange = 300; //正副deltaRange的范围内认为是在这个circle内

        for(let i = 0; i < 6 ; i++)
        {
            if( keyEventYIndex[i] - deltaRange < scrollTop && scrollTop < keyEventYIndex[i] + deltaRange )
                d3.select(`#keyEventCir${i}`)
                    .style("border-bottom-left-radius", "2px")
                    .style("border-top-left-radius", "2px")
                    .style("opacity", 1);
            else
                d3.select(`#keyEventCir${i}`)
                    .style("border-bottom-left-radius", "6px")
                    .style("border-top-left-radius", "6px")
                    .style("opacity", 0.4);
        }



    }
</script>

<!--读取json数据，绘制可视化主体部分-->
<script>
    var lineGravity = 100; // 相对基准线的偏移：(0.5 - 消极概率) * 置信度 * lineGravity；MAX偏移值为 0.5 * 1 * lineGravity
    var numNodes = 4725;
    var nodes;
    var deltaXOffset = 0.08;
    var rightStrat = 0.84;

    //生成[m, n]的随机数
    function randomNum(minNum, maxNum) {
        switch (arguments.length) {
            case 1:
                return parseInt(Math.random() * minNum + 1, 10);
                break;
            case 2:
                return parseInt(Math.random() * (maxNum - minNum + 1) + minNum, 10);
                break;
            default:
                return 0;
                break;
        }
    }


    //读取json数据，返回nodes，计算力引导布局
    var samaraGroups; //存储生成samara seed的groups
    var circleGroups; //存储交互圆形的groups

    d3.json("asset/json/data_final.json").then(function (data) {
        var xDimScalelow = d3.scaleLinear()
            .domain([0, 11])
            .range([windowHei * 0.98 * 0, windowHei * 0.98 * 0 + windowHei * 0.98 * 0.1]);

        var xDimScalehigh = d3.scaleLinear()
            .domain([11, 24])
            .range([windowHei * 0.98 * 0 + windowHei * 0.98 * 0.1, windowHei * 0.98 * 1]);

        var corDate = ["01月28", "01月29", "01月30", "01月31", "02月01", "02月02", "02月03", "02月04", "02月05",
            "02月06", "02月07", "02月08", "02月09", "02月10", "02月11", "02月12", "02月13", "02月14", "02月15", "02月16",
            "02月17", "02月18", "02月19", "02月20", "02月21", "02月22", "02月23", "02月24", "02月25", "02月26", "02月27", "02月28"];


        nodes = d3.range(1, numNodes + 1).map(function (d, i) {

            // 找到数组中对应日期的下标
            var dateId = corDate.findIndex((element) => element == data[d.toString()]["time"].split("日")[0]);

            //根据是第几天更改线性映射; 11点前发布占10%；后发布占90%
            xDimScalelow.range([windowHei * 0.98 * dateId, windowHei * 0.98 * dateId + windowHei * 0.98 * 0.1]);
            xDimScalehigh.range([windowHei * 0.98 * dateId + windowHei * 0.98 * 0.1, windowHei * 0.98 * (dateId + 1)]);

            //消极情绪概率
            let negaEmo = data[d.toString()]["negative_prob"];
            let confidence = data[d.toString()]["senti_confidence"];
            let gravity = 80;
            let vlevel = data[d.toString()]["vlevel"];
            let like = data[d.toString()]["like"];
            let comment = data[d.toString()]["comment"];
            let retweet = data[d.toString()]["retweet"];
            let follower = data[d.toString()]["followers"];
            let hashtagfirstcat = data[d.toString()]["hashtagfirstcat"];
            let content = data[d.toString()]["content"];
            let time = data[d.toString()]["time"];
            let postname = data[d.toString()]["postname"];

            //计算是几点发布的
            var yIndex = parseFloat(data[d.toString()]["time"].split("日")[1].split(":")[0]) + parseFloat(data[d.toString()]["time"].split("日")[1].split(":")[1] / 60);
            //计算点的y坐标
            if (yIndex <= 11)  // 早于11点发布的
            {
                yIndex = xDimScalelow(yIndex);
                if (yIndex < 100) //处理最上面无法交互的点
                    yIndex = 150;
            } else  // 晚于11点发布点
            {
                yIndex = xDimScalehigh(yIndex);
            }

            var xIndex;
            if (negaEmo <= 0.5) {
                xIndex = windPosX[(data[d.toString()]["hashtagfirstcat"] + 8) % 9] + (0.7 - negaEmo) * (gravity + randomNum(20, 30)); // firsttag = 0时，数组下标需要 = 8; 加入随机化因数
            } else {
                xIndex = windPosX[(data[d.toString()]["hashtagfirstcat"] + 8) % 9] + (0.5 - negaEmo) * (gravity + randomNum(10, 20)); // firsttag = 0时，数组下标需要 = 8; 加入随机化因数
            }

            var hashtagXIndex = windPosX[(data[d.toString()]["hashtagfirstcat"] + 8) % 9];

            return {
                xIndex: xIndex,
                yIndex: yIndex,
                negaEmo: negaEmo,
                confidence: confidence,
                vlevel: vlevel,
                like: like,
                comment: comment,
                retweet: retweet,
                follower: follower,
                hashtagXIndex: hashtagXIndex,
                hashtagfirstcat: hashtagfirstcat,
                content: content,
                time: time,
                postname: postname,
            }
        });

        var simulation = d3.forceSimulation(nodes)
            .force('charge', d3.forceManyBody().strength(0))
            .force('x', d3.forceX().x(function (d) {
                return d.xIndex;
            }))
            .force('y', d3.forceY().y(function (d) {
                return d.yIndex;
            }))
            .force('collision', d3.forceCollide().radius(function (d) {
                return 8;
                // let scaleLengthId;
                // let retweetScale = d3.scaleLinear()
                //     .domain([0, 3])
                //     .range([1, 3]); //映射到的scaleLen范围
                // if(d.retweet <= 500)
                //     scaleLengthId = 1;
                // else
                //     scaleLengthId = retweetScale(Math.log(d.retweet / 500) / Math.log(10)) //取以10为底的对数
                // return 16 * scaleLengthId;
            }))
            .on('tick', ticked)
            .on('end', drawSeed); // 迭代结束后，绘制种子

        //每次迭代刷新
        function ticked() {
            samaraGroups = d3.select('#seedGroup')
                .selectAll('g.samaraSeed')
                .data(nodes)
                .join('g')
                .attr("class", "samaraSeed")
                .attr('cx', function (d) {
                    return d.x;
                })
                .attr('cy', function (d) {
                    return d.y;
                })
                .attr("id", function (d, i) {
                    return `seed${i}`
                })

            circleGroups = d3.select('#interactCirGroup')
                .selectAll('g.interactCircle')
                .data(nodes)
                .join('g')
                .attr("class", "interactCircle")
                .attr('cx', function (d) {
                    return d.x;
                })
                .attr('cy', function (d) {
                    return d.y;
                })
                .attr("id", function (d, i) {
                    return `interactCircle${i}`
                })


            //不把静态量放在attr内，直接用nodes数组访问
            // .attr("nega", function (d){
            //     return d.negaEmo;
            // })
            // .attr("confidence", function (d){
            //     return d.confidence;
            // })
            // .attr("vlevel", function (d){
            //     return d.vlevel;
            // })
            // .attr("like", function (d){
            //     return d.like;
            // })
            // .attr("retweet", function (d){
            //     return d.retweet;
            // })
            // .attr("followerCat", function (d){
            //     return d.followerCat;
            // })
            // .attr("hashtagXIndex", function (d){
            //     return d.hashtagXIndex;
            // });
        }

        function drawSeed() {
            console.log("end!")
            for (let i = 0; i < 4725; i++) {
                // console.log($(`#seedHead3.svg${i}`).attr("vlevel"))
                geneSeed(i, $(`#seed${i}`).attr("cx"), $(`#seed${i}`).attr("cy"), nodes[i].negaEmo, nodes[i].confidence, nodes[i].vlevel, nodes[i].like, nodes[i].comment, nodes[i].retweet,
                    nodes[i].follower, nodes[i].hashtagXIndex, nodes[i].hashtagfirstcat);

                geneCir(i, $(`#seed${i}`).attr("cx"), $(`#seed${i}`).attr("cy"), nodes[i].negaEmo, nodes[i].confidence, nodes[i].follower, nodes[i].hashtagfirstcat, nodes[i].hashtagXIndex);
                console.log("finish")
            }
            updateSvgOnMouseMove();
        }

    })

    //制作鱼眼效果
    var fisheye = d3.fisheye.circular().radius(100);

    function updateSvgOnMouseMove() {
        //界面生成完之后再进行移动事件的绑定
        timelineSvg.on("mousemove", function () {
            fisheye.focus(d3.pointer(event, this));

            // 位置一起变化
            // groups.each(function(d) { d.fisheye = fisheye(d); })
            //         .attr("transform", function (d){ return `translate(${d.fisheye.x}, ${d.fisheye.y}),scale(${d.fisheye.z})`; })

            samaraGroups.each(function (d) {
                d.fisheye = fisheye(d);
            })
                //.attr("transform", `translate(${cx}, ${cy}),rotate(${negascale(negaEmo * confidence)}),scale(-0.1, 0.1)`) //rotate(-20,300,400)
                .attr("transform", function (d) {
                    if (d3.select(this).attr("transform").split("scale")[1].indexOf(",") != -1) // 存在scale(-0.1, 0.1)的情况
                    {
                        let rotStr = d3.select(this).attr("transform").split("rotate")[1].split(",")[0]
                        return `translate(${d.fisheye.x}, ${d.fisheye.y}),` + `rotate${rotStr},` + `scale(${-0.12 * d.fisheye.z}, ${0.12 * d.fisheye.z})`
                    } else {
                        let rotStr = d3.select(this).attr("transform").split("rotate")[1].split(",")[0]
                        return `translate(${d.fisheye.x}, ${d.fisheye.y}),` + `rotate${rotStr},` + `scale(${0.12 * d.fisheye.z})`
                    }

                });

            circleGroups.each(function (d) {
                d.fisheye = fisheye(d);
            })
                .attr("transform", function (d) {
                    if (d3.select(this).attr("transform").split("scale")[1].indexOf(",") != -1) // 存在scale(-0.1, 0.1)的情况
                    {
                        return d3.select(this).attr("transform").split("scale")[0] + `scale(${-0.12 * d.fisheye.z}, ${0.12 * d.fisheye.z})`
                    } else {
                        return d3.select(this).attr("transform").split("scale")[0] + `scale(${0.12 * d.fisheye.z})`
                    }

                });


        });

        //在上方过渡矩形内移动，取消鱼眼效果
        gradRectSvg1.on("mousemove", function () {
            fisheye.focus(d3.pointer(event, this));

            // 位置一起变化
            // groups.each(function(d) { d.fisheye = fisheye(d); })
            //         .attr("transform", function (d){ return `translate(${d.fisheye.x}, ${d.fisheye.y}),scale(${d.fisheye.z})`; })

            samaraGroups.each(function (d) {
                d.fisheye = fisheye(d);
            })
                //.attr("transform", `translate(${cx}, ${cy}),rotate(${negascale(negaEmo * confidence)}),scale(-0.1, 0.1)`) //rotate(-20,300,400)
                .attr("transform", function (d) {
                    if (d3.select(this).attr("transform").split("scale")[1].indexOf(",") != -1) // 存在scale(-0.1, 0.1)的情况
                    {
                        let rotStr = d3.select(this).attr("transform").split("rotate")[1].split(",")[0]
                        return `translate(${d.fisheye.x}, ${d.fisheye.y}),` + `rotate${rotStr},` + `scale(${-0.12 * d.fisheye.z}, ${0.12 * d.fisheye.z})`
                    } else {
                        let rotStr = d3.select(this).attr("transform").split("rotate")[1].split(",")[0]
                        return `translate(${d.fisheye.x}, ${d.fisheye.y}),` + `rotate${rotStr},` + `scale(${0.12 * d.fisheye.z})`
                    }

                });

            circleGroups.each(function (d) {
                d.fisheye = fisheye(d);
            })
                .attr("transform", function (d) {
                    if (d3.select(this).attr("transform").split("scale")[1].indexOf(",") != -1) // 存在scale(-0.1, 0.1)的情况
                    {
                        return d3.select(this).attr("transform").split("scale")[0] + `scale(${-0.12 * d.fisheye.z}, ${0.12 * d.fisheye.z})`
                    } else {
                        return d3.select(this).attr("transform").split("scale")[0] + `scale(${0.12 * d.fisheye.z})`
                    }

                });

        });

    }


</script>

<!--绘制种子函数-->
<script>
    //定义tooltip
    // var Tooltip = d3.select("#samaraTimeline")
    //     .append("div")
    //     .style("opacity", 0)
    //     .attr("class", "tooltip")
    //     // .style("border", "solid")
    //     // .style("border-width", "2px")
    //     .style("width", `${window.innerWidth * 0.1}px`)
    //     .style("height", `${window.innerWidth * 0.1}px`)

    var Tooltip = d3.select("#seedTooltip")

    var TooltipLine = d3.select("#timelineSvg")
        .append("line")
        .attr("stroke", "#ffc000")
        .attr("stroke-width", 2)
        .attr("stroke-dasharray", "5,5")
        .style("opacity", 0);

    //定义moveToFront 置于顶层
    d3.selection.prototype.moveToFront = function () {
        return this.each(function () {
            this.parentNode.appendChild(this);
        });
    };

    function transNum(x) //转化数字格式
    {
        if (x < 1000)
            return x.toString();
        else if (x < 10000)
            return x.toString()[0] + ',' + x.toString().substring(1); //补上千位的逗号
        else if (x < 1000000)
            if ((x / 1000).toFixed(1)[(x / 1000).toFixed(1).length - 1] == "0") //如果末尾为0，舍去最后两位
                return (x / 1000).toFixed(1).substring(0, (x / 1000).toFixed(1).length - 2) + "K"
            else
                return (x / 1000).toFixed(1) + "K"
        else if (x < 1000000000)
            if ((x / 1000000).toFixed(1)[(x / 1000000).toFixed(1).length - 1] == "0") //如果末尾为0，舍去最后两位
                return (x / 1000000).toFixed(1).substring(0, (x / 1000000).toFixed(1).length - 2) + "M"
            else
                return (x / 1000000).toFixed(1) + "M"
        else if ((x / 1000000000).toFixed(1)[(x / 1000000000).toFixed(1).length - 1] == "0") //如果末尾为0，舍去最后两位
            return (x / 1000000000).toFixed(1).substring(0, (x / 1000000000).toFixed(1).length - 2) + "B"
        else
            return (x / 1000000000).toFixed(1) + "B"
    }

    function transDate(x) //转化日期格式
    {
        //01月28日19:01
        //&nbsp 7:23 PM · Apr 14, 2022

        //取月份缩写值：Jan Feb
        let month;
        if (x.split("月")[0] == "01")
            month = "Jan"
        else
            month = "Feb"
        let date = x.split("月")[1].split("日")[0]
        let time = x.split("日")[1]

        return ` ${time} · ${month} ${date}, 2022`
    }

    function transContent(x) //内容缩略
    {
        let maxPostLen = 100; //定义帖子显示的最长长度

        if (x.length <= maxPostLen)
            return x
        else
            return x.substring(0, maxPostLen) + "..."
    }

    function geneSeed(index, cx, cy, negaEmo, confidence, vlevel, like, comment, retweet, follower, hashtagXIndex, hashtagfirstcat) {
        //帖子可视化的关键参数
        var scaleLengthId;
        var scaleWidthId;
        // var vlevel = "blue"

        //like的映射计算; like的max值为2457804; 计算scaleWidthId
        let likeScale = d3.scaleLinear()
            .domain([0, 2.7])
            .range([1, 3]); //映射到的scaleWid范围
        if (like <= 5000) {
            scaleWidthId = 1;
        } else {
            scaleWidthId = likeScale(Math.log(like / 5000) / Math.log(10)) //取以10为底的对数
        }

        //comment分类
        let commentCat; //评论数量分在第几类
        //comment的分组
        if (comment <= 10)
            commentCat = 1
        else if (comment <= 100)
            commentCat = 2
        else
            commentCat = 3

        //粉丝数分类
        let followerCat;
        //粉丝数的分组
        if (follower <= 10000)
            followerCat = 1
        else if (follower <= 1000000)
            followerCat = 2
        else
            followerCat = 3


        //retweet的映射计算；retweet的max值为418438；计算scaleLengthId
        let retweetScale = d3.scaleLinear()
            .domain([0, 3])
            .range([1, 3]); //映射到的scaleLen范围
        if (retweet <= 500) {
            scaleLengthId = 1;
        } else {
            scaleLengthId = retweetScale(Math.log(retweet / 500) / Math.log(10)) //取以10为底的对数
        }


        var group1;

        //消极在负半轴，积极在正半轴，确定g的位置以及旋转参数
        if (negaEmo <= 0.5) {
            let negascale = d3.scaleLinear()
                .domain([0, 1])
                .range([-30, -10]); //积极：30度，消极：10度

            group1 = d3.select(`#seed${index}`)
                .attr("transform", `translate(${cx}, ${cy}),rotate(${negascale(negaEmo * confidence)}),scale(0.12)`) //rotate(-20,300,400)
        } else {
            let negascale = d3.scaleLinear()
                .domain([0, 1])
                .range([30, 10]); //积极：30度，消极：10度

            group1 = d3.select(`#seed${index}`)
                .attr("transform", `translate(${cx}, ${cy}),rotate(${negascale(negaEmo * confidence)}),scale(-0.12, 0.12)`) //rotate(-20,300,400)
        }

        //叶面绘制；叶子宽度参数调整
        group1.append("path")
            .attr("d", `M ${185.11 * scaleLengthId} 23 ` +
                `C ${192.21 * scaleLengthId} 34.23 ${156.54 * 1.2 * scaleLengthId} ${57.89 * scaleWidthId} ${132.11 * scaleLengthId} ${57.89 * scaleWidthId} ` +
                `C ${100.6 * scaleLengthId} ${57.89 * scaleWidthId} ${75.04 * 0.8 * scaleLengthId} 30.79 38.58 30.79 ` +
                "C 50.93 16.55 69 8.67 69 8.67 " +
                `S ${162.94 * scaleLengthId} -12.13 ${185.11 * scaleLengthId} 23 ` +
                "Z")
            .attr("id", `seedWid${index}`)
            .style("fill", "#ffe7a1")
            .style("opacity", "0.2")
            .style("stroke", "none");


        //评论数量调整纹理
        if (commentCat == 1) {

            group1.append("path")
                .attr("d", `M ${92.56 * (1.2 - 0.2 * scaleLengthId) * scaleLengthId} ${4.3} C ${109.32 * (1.2 - 0.2 * scaleLengthId) * scaleLengthId} ${4.3} ${119.8 * (1.2 - 0.2 * scaleLengthId) * scaleLengthId} ${18.52 * scaleWidthId} ${121.61 * (1.2 - 0.2 * scaleLengthId) * scaleLengthId} ${32.74 * scaleWidthId}`)
                .style("stroke-linecap", "round")
                .attr("stroke-width", "2")
                .attr("opacity", "0.2")
                .attr("fill", "none")
                .attr("class", `seedleaf${index}`)
                .style("stroke", "#FFCA36");

            group1.append("path")
                .attr("d", `M${125.75 * scaleLengthId},2.55 C ${142.51 * scaleLengthId},2.55,${153 * scaleLengthId},${16.77 * scaleWidthId},${154.8 * scaleLengthId},${31 * scaleWidthId}`)
                // .attr("stroke", "#FFCA36")
                .style("stroke-linecap", "round")
                .attr("stroke-width", "2")
                .attr("opacity", "0.2")
                .attr("fill", "none")
                .attr("class", `seedleaf${index}`)
                .style("stroke", "#FFCA36");

        } else if (commentCat == 2) {

            group1.append("path")
                .attr("d", `M ${83.27 * (1.2 - 0.2 * scaleLengthId) * scaleLengthId} ${5.93 - Math.min(2, 2 * (scaleLengthId - 1))} C ${100.04 * (1.2 - 0.2 * scaleLengthId) * scaleLengthId} ${5.93 - Math.min(2, 2 * (scaleLengthId - 1))} ${110.52 * (1.2 - 0.2 * scaleLengthId) * scaleLengthId} ${20.15 * 0.8 * scaleWidthId} ${112.33 * (1.2 - 0.2 * scaleLengthId) * scaleLengthId} ${34.37 * 0.8 * scaleWidthId}`)
                .style("stroke-linecap", "round")
                .attr("stroke-width", "2")
                .attr("opacity", "0.2")
                .attr("fill", "none")
                .attr("class", `seedleaf${index}`)
                .style("stroke", "#FFCA36");

            group1.append("path")
                .attr("d", `M ${107.93 * (1.1 - 0.1 * scaleLengthId) * scaleLengthId} 2.55 C ${124.7 * (1.1 - 0.1 * scaleLengthId) * scaleLengthId} 2.55 ${138.45 * (1.1 - 0.1 * scaleLengthId) * scaleLengthId} ${16.77 * scaleWidthId} ${140.99 * (1.1 - 0.1 * scaleLengthId) * scaleLengthId} ${39.41 * scaleWidthId}`)
                .style("stroke-linecap", "round")
                .attr("stroke-width", "2")
                .attr("opacity", "0.2")
                .attr("fill", "none")
                .attr("class", `seedleaf${index}`)
                .style("stroke", "#FFCA36");

            group1.append("path")
                .attr("d", `M ${134 * scaleLengthId} 2.55 C ${150.76 * scaleLengthId} 2.55 ${159.2 * scaleLengthId} ${16.77 * scaleWidthId} ${161 * scaleLengthId} ${30.99 * scaleWidthId}`)
                .style("stroke-linecap", "round")
                .attr("stroke-width", "2")
                .attr("opacity", "0.2")
                .attr("fill", "none")
                .attr("class", `seedleaf${index}`)
                .style("stroke", "#FFCA36");


        } else {

            group1.append("path")
                .attr("d", `M ${71.86 * scaleLengthId} ${7.82 - Math.min(4, 4 * (scaleLengthId - 1))} C ${88.62 * scaleLengthId} 7.82 ${97.72 * scaleLengthId} ${24 * scaleWidthId} ${99.53 * scaleLengthId} ${38.19 * scaleWidthId}`)
                .style("stroke-linecap", "round")
                .attr("stroke-width", "2")
                .attr("opacity", "0.2")
                .attr("fill", "none")
                .attr("class", `seedleaf${index}`)
                .style("stroke", "#FFCA36");

            group1.append("path")
                .attr("d", `M ${97.8 * scaleLengthId} ${4.3 - Math.min(1.2, 1.2 * (scaleLengthId - 1))} C ${114.57 * scaleLengthId} 4.3 ${122.31 * scaleLengthId} ${29.05 * scaleWidthId} ${124.12 * scaleLengthId} ${43.3 * scaleWidthId}`)
                .style("stroke-linecap", "round")
                .attr("stroke-width", "2")
                .attr("opacity", "0.2")
                .attr("fill", "none")
                .attr("class", `seedleaf${index}`)
                .style("stroke", "#FFCA36");

            group1.append("path")
                .attr("d", `M ${119.78 * scaleLengthId} 2.55 C ${136.55 * scaleLengthId} 2.55 ${144.29 * scaleLengthId} ${27.3 * scaleWidthId} ${146.09 * scaleLengthId} ${41.55 * scaleWidthId}`)
                .style("stroke-linecap", "round")
                .attr("stroke-width", "2")
                .attr("opacity", "0.2")
                .attr("fill", "none")
                .attr("class", `seedleaf${index}`)
                .style("stroke", "#FFCA36");

            group1.append("path")
                .attr("d", `M ${140.49 * scaleLengthId} ${2.55 + Math.min(2.5, 2.5 * (scaleLengthId - 1))} C ${157.26 * scaleLengthId} 2.55 ${163.49 * scaleLengthId} ${22.83 * scaleWidthId} ${164.84 * scaleLengthId} ${33.67 * scaleWidthId}`)
                .style("stroke-linecap", "round")
                .attr("stroke-width", "2")
                .attr("opacity", "0.2")
                .attr("fill", "none")
                .attr("class", `seedleaf${index}`)
                .style("stroke", "#FFCA36");
        }
        ;


        //叶子长度参数调整; 粉丝数影响头部大小
        if (followerCat == 1) {
            group1.append("path")
                .attr("d", "M 57.6 6.89 " +
                    "C 46 7.89 29.85 6.42 20.6 6.77 " +
                    `C 9.22 7.2 ${-1.68} 9.24 ${0.22} 18.61` +
                    `C 2.28 28.77 8.25 ${37} 21.44 ${37} ` +
                    "C 44 37 57.07 12.5 75 8.92 " +
                    `S ${162.06 * scaleLengthId} -6 ${185.11 * scaleLengthId} 23 ` +
                    `C ${181.44 * scaleLengthId} ${11.63 + 1 * scaleLengthId} ${157.88 * scaleLengthId} 0 ${126.41 * (1.2 - 0.2 * scaleLengthId) * (scaleLengthId)} 0 ` +
                    "S 81.12 4.86 57.6 6.89 " +
                    "Z")
                .attr("id", `seedStem${index}`)
                .style("fill", "#FFCA36")
                .style("stroke", "none");

        } else if (followerCat == 2) {

            group1.append("path")
                .attr("d", "M 57.6 6.89 " +
                    "C 46 7.89 29.85 6.42 20.6 6.77 " +
                    "C 9.22 7.2 -16.088 6.503 -14.043 25.517 " +
                    "C -12.048 39.53 -3.46 53.836 19.941 52.99 " +
                    "C 48.698 50.735 57.07 12.5 75 8.92 " +
                    `S ${162.06 * scaleLengthId} -6 ${185.11 * scaleLengthId} 23 ` +
                    `C ${181.44 * scaleLengthId} ${11.63 + 1 * scaleLengthId} ${157.88 * scaleLengthId} 0 ${126.41 * (1.2 - 0.2 * scaleLengthId) * (scaleLengthId)} 0 ` +
                    "S 81.12 4.86 57.6 6.89 " +
                    "Z")
                .attr("id", `seedStem${index}`)
                .style("fill", "#FFCA36")
                .style("stroke", "none");


        } else {

            group1.append("path")
                .attr("d", "M 57.6 6.89 C 46 7.89 29.85 6.42 20.6 6.77 C 9.22 7.2 -41.314 7.718 -40.555 33.026 C -39.289 56.31 -25.731 82.914 10.897 81.111 C 57.311 75.993 52.579 16.323 75 8.92 "+
                    `S ${162.06 * scaleLengthId} -6 ${185.11 * scaleLengthId} 23 ` +
                    `C ${181.44 * scaleLengthId} ${11.63 + 1 * scaleLengthId} ${157.88 * scaleLengthId} 0 ${126.41 * (1.2 - 0.2 * scaleLengthId) * (scaleLengthId)} 0 ` +
                    "S 81.12 4.86 57.6 6.89 " +
                    "Z")
                .attr("id", `seedStem${index}`)
                .style("fill", "#FFCA36")
                .style("stroke", "none");

        }

        //定义情感的线性渐变
        {
            //目前：为每一个帖子定制一个defs：长度不同（x2不同）；末端颜色不同
            let emo_grad = defs.append("linearGradient")
                .attr("id", `emo_grad${index}`)
                .attr("gradientUnits", "userSpaceOnUse")
                .attr("x1", "57.6")
                .attr("y1", "6.89")
                .attr("x2", `${185.11 * scaleLengthId}`)
                .attr("y2", "23");


            // let stop1 = emo_grad.append("stop")
            //     .attr("offset", "0")
            //     .attr("")
            //     .style("stop-color", "#ffca36");


            //内容情感
            if (negaEmo <= 0.5) {
                // console.log("a")
                let a = d3.rgb(129, 233, 59);	//积极一端的颜色
                let b = d3.rgb(255, 202, 54);	//橙色
                let linear = d3.scaleLinear()
                    .domain([0, 0.5])
                    .range([0, 1])
                let compute = d3.interpolate(a, b);
                let endColor = compute(linear(negaEmo))

                let stop1 = emo_grad.append("stop")
                    .attr("id", `emo_grad_start${index}`)
                    .attr("offset", "0")
                    .style("stop-color", endColor);

                let stop2 = emo_grad.append("stop")
                    .attr("id", `emo_grad_end${index}`)
                    .attr("offset", "0.1")
                    .style("stop-opacity", "0")
                    .style("stop-color", endColor);

                d3.select(`#seedStem${index}`)
                    .style("fill", "url(#" + emo_grad.attr("id") + ")");

            } else {
                let a = d3.rgb(237, 28, 36);	//消极一端的颜色
                let b = d3.rgb(255, 202, 54);	//橙色
                let linear = d3.scaleLinear()
                    .domain([0.5, 1])
                    .range([0, 1])
                let compute = d3.interpolate(b, a);
                let endColor = compute(linear(negaEmo))

                let stop1 = emo_grad.append("stop")
                    .attr("id", `emo_grad_start${index}`)
                    .attr("offset", "0")
                    .style("stop-color", endColor);

                let stop2 = emo_grad.append("stop")
                    .attr("id", `emo_grad_end${index}`)
                    .attr("offset", "0.1")
                    .style("stop-opacity", "0")
                    .style("stop-color", endColor);

                d3.select(`#seedStem${index}`)
                    .style("fill", "url(#" + emo_grad.attr("id") + ")");

            }
        }


        //微博等级
        if (vlevel == "normal") {
            group1.append("circle")
                .attr("cx", "8")
                .attr("cy", "-5")
                .attr("r", "10")
                .attr("stroke", "none")
                .attr("fill", "#FFCA36")
                .attr("opacity", "0.3")
        } else if (vlevel == "yellow") {
            group1.append("circle")
                .attr("cx", "8")
                .attr("cy", "-5")
                .attr("r", "10")
                .attr("stroke", "none")
                .attr("fill", "#FFCA36")
                .attr("opacity", "0.5")
            group1.append("circle")
                .attr("cx", "32")
                .attr("cy", "-8")
                .attr("r", "10")
                .attr("stroke", "none")
                .attr("fill", "#FFCA36")
                .attr("opacity", "0.3")
        } else if (vlevel == "gold") {
            group1.append("circle")
                .attr("cx", "8")
                .attr("cy", "-5")
                .attr("r", "10")
                .attr("stroke", "none")
                .attr("fill", "#FFCA36")
                .attr("opacity", "0.8")
            group1.append("circle")
                .attr("cx", "32")
                .attr("cy", "-8")
                .attr("r", "10")
                .attr("stroke", "none")
                .attr("fill", "#FFCA36")
                .attr("opacity", "0.5")
            group1.append("circle")
                .attr("cx", "56")
                .attr("cy", "-8")
                .attr("r", "10")
                .attr("stroke", "none")
                .attr("fill", "#FFCA36")
                .attr("opacity", "0.3")
        } else {
            group1.append("circle")
                .attr("cx", "8")
                .attr("cy", "-5")
                .attr("r", "10")
                .attr("stroke", "none")
                .attr("fill", "#3694ff")
                .attr("opacity", "0.8")
        }


    }

    var showFixedTooltip = false
    var selectedSeed;

    function geneCir(index, cx, cy, negaEmo, confidence, follower, hashtagfirstcat, hashtagXIndex) {
        //粉丝数分类
        let followerCat;
        //粉丝数的分组
        if (follower <= 10000)
            followerCat = 1
        else if (follower <= 1000000)
            followerCat = 2
        else
            followerCat = 3

        //悬停交互
        var mouseover = function (d) {
            console.log(d3.select(this)
                    .attr("id")
                // .split("interactCircle")[1]
            )

            d3.select(`#seed${d3.select(this)
                .attr("id")
                .split("interactCircle")[1]
            }`).moveToFront();

            var scrollTop = document.documentElement.scrollTop || document.body.scrollTop;

            //获取话题类别以及消极情绪概率
            let hashtagfirstcat = nodes[d3.select(this)
                .attr("id")
                .split("interactCircle")[1]].hashtagfirstcat
            let negaEmo = nodes[d3.select(this)
                .attr("id")
                .split("interactCircle")[1]].negaEmo

            //显示retweet数量
            d3.select("#postRetweet")
                .html(transNum(nodes[d3.select(this)
                    .attr("id")
                    .split("interactCircle")[1]].retweet))

            //显示like数量
            d3.select("#postLike")
                .html(transNum(nodes[d3.select(this)
                    .attr("id")
                    .split("interactCircle")[1]].like))

            //显示comment数量
            d3.select("#postComment")
                .html(transNum(nodes[d3.select(this)
                    .attr("id")
                    .split("interactCircle")[1]].comment))

            //显示帖子内容
            d3.select("#postContent")
                .html(transContent(nodes[d3.select(this)
                    .attr("id")
                    .split("interactCircle")[1]].content));

            //帖子全部内容展示
            d3.select("#postContent")
                .attr("content", nodes[d3.select(this)
                    .attr("id")
                    .split("interactCircle")[1]].content);

            //显示时间
            d3.select("#postTime")
                .html(transDate(nodes[d3.select(this)
                    .attr("id")
                    .split("interactCircle")[1]].time))

            //情感映射
            let emotionScale = d3.scaleLinear()
                .domain([0, 1])
                .range([154, 0]); //最左位置：4px；最右位置：160px

            //加载情感刻度条
            d3.select("#emotionScaleBox")
                .style("left", `${emotionScale(negaEmo)}px`)

            //显示发帖人名字
            d3.select("#posterName")
                .html(`@${nodes[d3.select(this)
                    .attr("id")
                    .split("interactCircle")[1]].postname}`)
            //显示粉丝数量
            d3.select("#postFollower")
                .html(`${transNum(nodes[d3.select(this)
                    .attr("id")
                    .split("interactCircle")[1]].follower)} followers`)

            //显示tooltip框
            Tooltip.style("display", "flex"); // 先设置为flex之后，才能获取offsetHeight属性

            let divHeight = document.getElementById("seedTooltip").offsetHeight;
            // console.log(`divHei:${divHeight}`);
            // console.log(`divTopDis:${parseFloat(cy) - scrollTop - 50 + divHeight}`);

            let divTopDistance = (parseFloat(cy) - scrollTop - 50 + divHeight > window.innerHeight) ? window.innerHeight - divHeight - 50 : parseFloat(cy) - scrollTop - 50;

            if (hashtagfirstcat == 0 || (hashtagfirstcat == 8 && negaEmo < 0.5)) //最后两个话题类别
                Tooltip
                    .style("left", `${parseFloat(cx) - 350}px`)
                    .style("top", `${divTopDistance}px`)
                    .style("opacity", 1)
                    .style("z-index", "1");
            else
                Tooltip
                    .style("left", `${parseFloat(cx) + 90}px`)
                    .style("top", `${divTopDistance}px`)
                    .style("opacity", 1)
                    .style("z-index", "1");


            //显示对应线条
            TooltipLine
                .attr("x1", cx)
                .attr("y1", (cy))
                .attr("x2", hashtagXIndex)
                .attr("y2", (cy))
                .style("opacity", 1);

            //seed主干渐变动画
            d3.select(`#emo_grad_end${d3.select(this)
                .attr("id")
                .split("interactCircle")[1]}`)
                .transition()
                .duration(500)
                .attr("offset", "1")
                .style("stop-opacity", "100%")

            d3.select(`#emo_grad_start${d3.select(this)
                .attr("id")
                .split("interactCircle")[1]}`)
                .transition()
                .duration(500)
                // .attr("offset", "1")
                .style("stop-color", "#ffca36");

            //seed纹理渐变动画
            d3.selectAll(`.seedleaf${d3.select(this)
                .attr("id")
                .split("interactCircle")[1]}`)
                .transition()
                .duration(500)
                // .attr("offset", "1")
                .attr("opacity", "100%");

            //seed叶面渐变动画
            d3.select(`#seedWid${d3.select(this)
                .attr("id")
                .split("interactCircle")[1]}`)
                .transition()
                .duration(500)
                .style("opacity", "1");

        }

        var mousemove = function (d) {
            // console.log(d3.pointer(event, this))
            // Tooltip
            //     .style("opacity", 1)
            //     .style("display", "block")
            //     .style("left", `${cx + 200}px`)
            //     .style("top", `${cy}px`);

            // streamGraph高亮显示
            d3.selectAll(".myArea").style("opacity", 0.2) //其他变半透明
            d3.select(`#streamGraph${(hashtagfirstcat + 8) % 9}`)  // hashtagfirstcat=0时，id为streamGraph8（other是最后一类标签）
                // .style("stroke", "black")
                // .style("stroke-width", "2")
                .style("opacity", 1)


        }
        var mouseleave = function (d) {
            if (!showFixedTooltip) //如果鼠标离开，并且不是显示固定tooltip的时候
            {
                Tooltip
                    .style("opacity", 0)
                    .style("display", "none")
                    .style("z-index", "-10")

                TooltipLine
                    .style("opacity", 0);

                d3.select(`#emo_grad_end${d3.select(this)
                    .attr("id")
                    .split("interactCircle")[1]}`)
                    .transition()
                    .duration(500)
                    .attr("offset", "0.1")
                    .style("stop-opacity", "0")

                d3.select(`#emo_grad_start${d3.select(this)
                    .attr("id")
                    .split("interactCircle")[1]}`)
                    .transition()
                    .duration(500)
                    // .attr("offset", "1")
                    .style("stop-color", d3.select(
                        `#emo_grad_end${d3.select(this)
                            .attr("id")
                            .split("interactCircle")[1]}`)
                        .style("stop-color"));

                d3.selectAll(`.seedleaf${d3.select(this)
                    .attr("id")
                    .split("interactCircle")[1]}`)
                    .transition()
                    .duration(500)
                    // .attr("offset", "1")
                    .attr("opacity", "0.2");

                //seed叶面渐变动画
                d3.select(`#seedWid${d3.select(this)
                    .attr("id")
                    .split("interactCircle")[1]}`)
                    .transition()
                    .duration(500)
                    .style("opacity", "0.2");

                //streamGraph对应地方取消高亮
                d3.selectAll(".myArea").style("opacity", 1).style("stroke", "none")  // 恢复正常
            }

        }
        var mouseclick = function (d) {
            selectedSeed = d3.select(this);
            showFixedTooltip = true;
            // mousemove(d);
            $("#invisibleBlock").css("display", "block");
        }


        let group1;

        if (negaEmo <= 0.5) {
            let negascale = d3.scaleLinear()
                .domain([0, 1])
                .range([-30, -10]); //积极：30度，消极：10度

            group1 = d3.select(`#interactCircle${index}`)
                .attr("transform", `translate(${cx}, ${cy}),rotate(${negascale(negaEmo * confidence)}),scale(0.12)`) //rotate(-20,300,400)
        } else {
            let negascale = d3.scaleLinear()
                .domain([0, 1])
                .range([30, 10]); //积极：30度，消极：10度

            group1 = d3.select(`#interactCircle${index}`)
                .attr("transform", `translate(${cx}, ${cy}),rotate(${negascale(negaEmo * confidence)}),scale(-0.12, 0.12)`) //rotate(-20,300,400)
        }

        //叶子长度参数调整; 粉丝数影响头部大小
        if (followerCat == 1) {
            group1.append("circle")
                .attr("cx", 24)
                .attr("cy", 26)
                .attr("r", 20)
                .attr("id", `interactCircle${index}`)
                .attr("fill", "#000")
                .attr("opacity", "0")
                .on("mouseover", mouseover)
                .on("mousemove", mousemove)
                .on("mouseleave", mouseleave)
                .on("click", mouseclick);

        } else if (followerCat == 2) {

            group1.append("circle")
                .attr("cx", 18)
                .attr("cy", 32)
                .attr("r", 28)
                .attr("id", `interactCircle${index}`)
                .attr("fill", "#000")
                .attr("opacity", "0")
                .on("mouseover", mouseover)
                .on("mousemove", mousemove)
                .on("mouseleave", mouseleave)
                .on("click", mouseclick);


        } else {

            group1.append("circle")
                .attr("cx", 15)
                .attr("cy", 35)
                .attr("r", 34)
                .attr("id", `interactCircle${index}`)
                .attr("fill", "#000")
                .attr("opacity", "0")
                .on("mouseover", mouseover)
                .on("mousemove", mousemove)
                .on("mouseleave", mouseleave)
                .on("click", mouseclick);

        }
    }
</script>

<!--滑动条部分圆形hint提示-->
<script>

    //滚动条总高度为0.96windowHei
    // var vaneDis = [100, 2550, 9450, 11850, 17480, 22580]

    // let keyEventCirScale = d3.scaleLinear()
    //     .domain([0, 31 * 0.98 * window.innerHeight]) //一共31天，mainSvg的高度为0.98windowHei
    //     .range([0.02 * window.innerHeight, 0.98 * window.innerHeight]);

    let keyEventCirScaleId = 1 / 886 * windowHei; //缩放的比例系数

    var keyEventCirDis = [78 * keyEventCirScaleId, 137 * keyEventCirScaleId, 325 * keyEventCirScaleId, 391 * keyEventCirScaleId, 545 * keyEventCirScaleId, 685 * keyEventCirScaleId];

    $(".keyEventCir")
        .css("right", 108 / 1728 * window.innerWidth) //距离右边界124px，根据窗口宽度自动调整

    for(let i=0; i<6; i++)
    {
        $(`#keyEventCir${i}`).css("top", keyEventCirDis[i]);
    }

    var keyEventCirClick = function (CirNum){

        //图标背景出现
        d3.select(`#windVaneBg${CirNum}`)
            .attr("opacity", 1);
        //图标颜色更改
        d3.select(`#windVaneBody${CirNum}`)
            .attr("fill", "#fff8ef")

        d3.select(`#windVaneEye${CirNum}`)
            .attr("fill", "#ffc000")

        d3.select(`#windVaneWing${CirNum}`)
            .attr("fill", "#ffc000")

        hashtagSelectedId = CirNum; //相当于选中这个对应的hashtag，并跳转到对应的KeyEvent
        jumpToKeyEvent();

    }

</script>

<!--绘制滑条-->
<script>
    let domain_max_scale = [40, 200000000, 150000, 3500] //切换stream graph的时候需要用到不同的比例尺
    let trans_hori_ = [46, 46, 46, 46]
    var streamGraphTitlesId = 0;

    d3.select("#streamGraphScroll")
        .style("top", `${0.08 * window.innerHeight}px`) //总高度0.9Hei, 上面距离0.08Hei, 下面距离0.02Hei

    // set the dimensions and margins of the graph
    const margin = {top: 20, right: 30, bottom: 0, left: 10},
        width = 800 - margin.left - margin.right,
        height = 100 - margin.top - margin.bottom;
    var windowHei = window.innerHeight;
    var windowWid = window.innerWidth;

    const svgStreamScroll = d3.select("#streamGraphScroll")
        .append("svg")
        .attr("width", 100 / 1728 * windowWid)
        .attr("height", 0.9 * windowHei)
        .attr("id", "svgStreamScroll");

    //绘制stream graph图例
    const legendGroup = svgStreamScroll.append("g")
        .attr("transform", `translate(0, ${0.87 * window.innerHeight})`)

    //绘制对应图例线条
    legendGroup
        .append("line")
        .attr("x1", 20)
        .attr("x2", 80)
        .attr("y1", 15)
        .attr("y2", 15)
        .attr("stroke-width", 2)
        .attr("stroke", "#455A64")

    legendGroup
        .append("line")
        .attr("x1", 20)
        .attr("x2", 20)
        .attr("y1", 10)
        .attr("y2", 16)
        .attr("stroke-width", 2)
        .attr("stroke", "#455A64")

    legendGroup
        .append("line")
        .attr("x1", 80)
        .attr("x2", 80)
        .attr("y1", 10)
        .attr("y2", 16)
        .attr("stroke-width", 2)
        .attr("stroke", "#455A64")

    //绘制数字
    legendGroup
        .append("text")
        .attr("id", "streamGraphLegendTxt")
        .attr("text-anchor", "middle")
        .style("user-select", "none")
        .attr("x", 50)
        .attr("y", 8)
        .attr("font-size", 10)
        .text(transNum(domain_max_scale[streamGraphTitlesId] * 8))

    var geneStreamGraph = function(path, domain_max, trans_hori){
        // append the svg object to the body of the page
        const svgStreamScrollGroup = svgStreamScroll
            .append("g")
            // .attr("opacity", "0")
            .attr("id", "svgStreamScrollGroup")


        scrollrect = svgStreamScrollGroup.append("rect")
            .attr("x", "0")
            .attr("y", "0")
            .attr("width", 100 / 1728 * windowWid)
            .attr("height", windowHei * 0.86)
            .attr("rx", "10")
            .attr("ry", "10")
            .attr("fill", "#B0BEC5")
            .attr("opacity", "0.1")
            .attr("id", "scrollrectBackground");


        // Parse the Data
        d3.csv(`${path}.csv`).then(function (data) {
            // console.log(data)
            // List of groups = header of the csv files
            const keys = data.columns.slice(1)//从第二个开始往后切片
            // console.log(keys)

            // Add X axis, 纵向
            const x = d3.scaleLinear()
                .domain(d3.extent(data, function (d) {
                    return parseInt(d.time);
                }))  // 返回data中的year属性，并求值域
                .range([0, windowHei * 0.86]);


            // Add Y axis， 横向宽度
            const y = d3.scaleLinear()
                .domain([0, domain_max])
                .range([5, 0]); //映射范围

            //阅读数：domain[0, 200000000]


            var colorrange = ["#455A64",
                "#455A64", //少区域
                "#78909C",
                "#B0BEC5",
                "#455A64",
                "#78909C",
                "#B0BEC5",
                "#455A64", //少区域
            ];
            // color palette
            const color = d3.scaleOrdinal()
                .domain(keys)
                .range(colorrange); //d3.schemeDark2

            //stack the data?
            const stackedData = d3.stack()
                .offset(d3.stackOffsetSilhouette)
                .keys(keys) //这样用stack创造出的是函数！还要给他参数（data）
                (data)

            // create a tooltip
            // const Tooltip = svgStreamScrollGroup
            //     .append("text")
            //     .attr("x", 0)
            //     .attr("y", 0)
            //     .style("opacity", 0)
            //     .style("font-size", 17) //在0，0位置显示悬停的名称

            // Three function that change the tooltip when user hover / move / leave a cell
            const mouseover = function (event, d) {
                // Tooltip.style("opacity", 1)
                d3.selectAll(".myArea").style("opacity", .2) //其他变半透明
                d3.select(this)
                    //.style("stroke", "black")
                    .style("opacity", 1)
                // grp = d.key
                // Tooltip.text(grp)
            }
            const mousemove = function (event, d, i) {

            }
            const mouseleave = function (event, d) {
                // Tooltip.style("opacity", 0)
                d3.selectAll(".myArea").style("opacity", 1).style("stroke", "none")  // 恢复正常
            }

            // Area generator
            const area = d3.area()
                .curve(d3.curveMonotoneY)  //.curve(d3.curveCatmullRom.alpha(0))
                .y(function (d) {
                    return x(d.data.time);
                })
                .x0(function (d) {
                    return y(d[0]);
                })
                .x1(function (d) {
                    return y(d[1]);
                })

            console.log(stackedData)

            // Show the areas
            svgStreamScrollGroup
                .selectAll("mylayers")
                .data(stackedData)
                .join("path")
                .attr("class", "myArea")
                .attr("id", function (d, i) {
                    return `streamGraph${i}`;
                })
                .attr("transform", `translate(${trans_hori / 1728 * windowWid}, ${0})`)
                .style("fill", function (d) {
                    return color(d.key);
                })
                .attr("d", area)
                .on("mouseover", mouseover)
                .on("mousemove", mousemove)
                .on("mouseleave", mouseleave)

        })
    }

    geneStreamGraph("asset/csv/postNum_StreamGraph", domain_max_scale[0], trans_hori_[0]); //一开始默认在postNum_StreamGraph栏目
</script>

<!--切换滑条-->
<script>
    let streamGraphTitles= ["number of hot posts", "number of view", "number of discussion", "number of originals"];
    let streamGraphPath = ["asset/csv/postNum_StreamGraph", "asset/csv/阅读数", "asset/csv/讨论数", "asset/csv/原创数"]

    var streamGraphTitlesLeftArr = function (){
        //更新id值
        if(streamGraphTitlesId == 0)
            streamGraphTitlesId = 3;
        else
            streamGraphTitlesId -= 1;

        d3.select("#streamGraphTitle")
            .html(streamGraphTitles[streamGraphTitlesId])

        //删除现有的图
        d3.select("#svgStreamScrollGroup").remove();
        //绘制更新的图
        geneStreamGraph(streamGraphPath[streamGraphTitlesId], domain_max_scale[streamGraphTitlesId], trans_hori_[streamGraphTitlesId])

        //更新图例
        d3.select("#streamGraphLegendTxt")
            .text(transNum(domain_max_scale[streamGraphTitlesId] * 8));

    }

    var streamGraphTitlesRightArr = function (){
        //更新id值
        if(streamGraphTitlesId == 3)
            streamGraphTitlesId = 0;
        else
            streamGraphTitlesId += 1;

        d3.select("#streamGraphTitle")
            .html(streamGraphTitles[streamGraphTitlesId])

        //删除现有的图
        d3.select("#svgStreamScrollGroup").remove();
        //绘制更新的图
        geneStreamGraph(streamGraphPath[streamGraphTitlesId], domain_max_scale[streamGraphTitlesId], trans_hori_[streamGraphTitlesId])

        //更新图例
        d3.select("#streamGraphLegendTxt")
            .text(transNum(domain_max_scale[streamGraphTitlesId] * 8));
    }
</script>

<!--retweet dragbox 拖动-->
<script>
    var retweetDragBox = document.getElementById("retweetDragBox")
    retweetDragBox.onmousedown = function (e){

        //显示tooltip
        d3.select("#retweetNum")
            .style("display", "block")

        var e = e || window.event // 兼容ie浏览器

        console.log(retweetDragBox.offsetLeft)
        // var diffX = e.clientX - retweetDragBox.offsetLeft

        /* 低版本ie bug:物体被拖出浏览器可是窗口外部时，还会出现滚动条，
                解决方法是采用ie浏览器独有的2个方法setCapture()\releaseCapture(),这两个方法，
                可以让鼠标滑动到浏览器外部也可以捕获到事件，而我们的bug就是当鼠标移出浏览器的时候，
                限制超过的功能就失效了。用这个方法，即可解决这个问题。注：这两个方法用于onmousedown和onmouseup中 */
        if (typeof retweetDragBox.setCapture !== 'undefined') {
            retweetDragBox.setCapture()
        }

        document.onmousemove = function (e) {
            var e = e || window.event // 兼容ie浏览器
            // var left = e.clientX - diffX
            var left = e.clientX - document.document.getElementById("retweetDragBg").getBoundingClientRect().left  //这里为什么需要-90需要再测试一下不同长宽条件下

            if(left < 0)
                left = 0;
            if(left > 108)
                left = 108;

            let retweetNumScale = d3.scaleLinear()
                .domain([0, 108])
                .range([500, 5000])
            let retweetYScale = d3.scaleLinear()
                .domain([0, 108])
                .range([32, 42])

            //更改tooltip内容
            d3.select("#retweetNum")
                .html(parseInt(retweetNumScale(left)))

            //刷新seed
            d3.select("#Tp_seed9")
                .remove();
            geneSeed_Tp(retweetSvg, retweetDefs, 9, 200, retweetYScale(left), 1, 0.5, 1, false, "yellow", 0.3, 1, 1, parseInt(retweetNumScale(left)));


            // 移动时重新得到物体的距离，解决拖动时出现晃动的现象
            retweetDragBox.style.left = left + 'px'

            //改变viewBox
            // timelineSvg
            //     .attr("viewBox", `0 ${scrollReverseBoxScale(top)} ${windowWid * 0.96} ${windowHei * 0.98}`);

        }


        document.onmouseup = function (e) { // 当鼠标弹起来的时候不再移动
            // console.log('this', this)

            d3.select("#retweetNum")
                .style("display", "none")

            this.onmousemove = null
            this.onmouseup = null // 预防鼠标弹起来后还会循环（即预防鼠标放上去的时候还会移动）

            // 修复低版本ie bug
            if (typeof retweetDragBox.releaseCapture !== 'undefined') {
                retweetDragBox.releaseCapture()
            }
        }

    }
</script>

<!--like dragbox 拖动-->
<script>
    var likeDragBox = document.getElementById("likeDragBox")
    likeDragBox.onmousedown = function (e){

        //显示tooltip
        d3.select("#likeNum")
            .style("display", "block")

        var e = e || window.event // 兼容ie浏览器

        console.log(likeDragBox.offsetLeft)
        // var diffX = e.clientX - retweetDragBox.offsetLeft

        /* 低版本ie bug:物体被拖出浏览器可是窗口外部时，还会出现滚动条，
                解决方法是采用ie浏览器独有的2个方法setCapture()\releaseCapture(),这两个方法，
                可以让鼠标滑动到浏览器外部也可以捕获到事件，而我们的bug就是当鼠标移出浏览器的时候，
                限制超过的功能就失效了。用这个方法，即可解决这个问题。注：这两个方法用于onmousedown和onmouseup中 */
        if (typeof likeDragBox.setCapture !== 'undefined') {
            likeDragBox.setCapture()
        }

        document.onmousemove = function (e) {
            var e = e || window.event // 兼容ie浏览器
            // var left = e.clientX - diffX
            var left = e.clientX - document.getElementById("likeDragBg").getBoundingClientRect().left  //这里为什么需要-90需要再测试一下不同长宽条件下

            if(left < 0)
                left = 0;
            if(left > 108)
                left = 108;

            let likeNumScale = d3.scaleLinear()
                .domain([0, 108])
                .range([5000, 50000])
            // let likeYScale = d3.scaleLinear()
            //     .domain([0, 108])
            //     .range([32, 42])

            //更改tooltip内容
            d3.select("#likeNum")
                .html(parseInt(likeNumScale(left)))

            //刷新seed
            d3.select("#Tp_seed11")
                .remove();
            geneSeed_Tp(likeSvg, likeDefs, 11, 200, 32, 1, 0.5, 1, false, "yellow", 0.3, parseInt(likeNumScale(left)), 1, 1);


            // 移动时重新得到物体的距离，解决拖动时出现晃动的现象
            likeDragBox.style.left = left + 'px'

            //改变viewBox
            // timelineSvg
            //     .attr("viewBox", `0 ${scrollReverseBoxScale(top)} ${windowWid * 0.96} ${windowHei * 0.98}`);

        }


        document.onmouseup = function (e) { // 当鼠标弹起来的时候不再移动
            // console.log('this', this)

            d3.select("#likeNum")
                .style("display", "none")

            this.onmousemove = null
            this.onmouseup = null // 预防鼠标弹起来后还会循环（即预防鼠标放上去的时候还会移动）

            // 修复低版本ie bug
            if (typeof likeDragBox.releaseCapture !== 'undefined') {
                likeDragBox.releaseCapture()
            }
        }

    }
</script>

<!--emotion dragbox 拖动-->
<script>
    var emotionDragBox = document.getElementById("emotionDragBox")
    emotionDragBox.onmousedown = function (e){

        var e = e || window.event // 兼容ie浏览器

        console.log(emotionDragBox.offsetLeft)
        // var diffX = e.clientX - retweetDragBox.offsetLeft

        /* 低版本ie bug:物体被拖出浏览器可是窗口外部时，还会出现滚动条，
                解决方法是采用ie浏览器独有的2个方法setCapture()\releaseCapture(),这两个方法，
                可以让鼠标滑动到浏览器外部也可以捕获到事件，而我们的bug就是当鼠标移出浏览器的时候，
                限制超过的功能就失效了。用这个方法，即可解决这个问题。注：这两个方法用于onmousedown和onmouseup中 */
        if (typeof emotionDragBox.setCapture !== 'undefined') {
            emotionDragBox.setCapture()
        }

        document.onmousemove = function (e) {
            var e = e || window.event // 兼容ie浏览器
            // var left = e.clientX - diffX
            var left = e.clientX - document.getElementById("emotionDragBg").getBoundingClientRect().left  //这里为什么需要-90需要再测试一下不同长宽条件下

            if(left < 0)
                left = 0;
            if(left > 108)
                left = 108;

            let emotionNumScale = d3.scaleLinear()
                .domain([0, 108])
                .range([1, 0])
            // let likeYScale = d3.scaleLinear()
            //     .domain([0, 108])
            //     .range([32, 42])

            // //更改tooltip内容
            // d3.select("#likeNum")
            //     .html(parseInt(likeNumScale(left)))

            //刷新seed
            d3.select("#Tp_seed15")
                .remove();
            d3.select("#Tp_emo_grad15")
                .remove(); //删除渐变
            console.log(`emo${emotionNumScale(left)}`)
            geneSeed_Tp(emotionSvg, emotionDefs, 15, 140, 30, 1, emotionNumScale(left), 1, false, "yellow", 0.3, 1,200, 1);


            // 移动时重新得到物体的距离，解决拖动时出现晃动的现象
            emotionDragBox.style.left = left + 'px'

            //改变viewBox
            // timelineSvg
            //     .attr("viewBox", `0 ${scrollReverseBoxScale(top)} ${windowWid * 0.96} ${windowHei * 0.98}`);

        }


        document.onmouseup = function (e) { // 当鼠标弹起来的时候不再移动
            // console.log('this', this)


            this.onmousemove = null
            this.onmouseup = null // 预防鼠标弹起来后还会循环（即预防鼠标放上去的时候还会移动）

            // 修复低版本ie bug
            if (typeof emotionDragBox.releaseCapture !== 'undefined') {
                emotionDragBox.releaseCapture()
            }
        }

    }
</script>

<!--tooltip面板绘制-->
<script>
    //info icon 绘制
    d3.select("#showTooltipOverlayImg")
        .style("right", `${160 / 1728 * window.innerWidth}px`)
        .style("top", `${0.91 * window.innerHeight}px`)

    //点击后tooltip显示
    var showTooltipOverlay = function ()
    {
        isOverlayTooltipShow = true;

        d3.select("#overlayTooltip")
            .style("display", "block");

        $("#invisibleBlock")
            .css("width", window.innerWidth)
            .css("height", window.innerHeight)
            .css("top", 0)
            .css("left", 0)
            .css("display", "block")
            .css("background-color", "#000")
            .css("opacity", 0.3)
            .css("z-index", 1)

    }


    //设置overlay tooltip大小
    d3.select("#overlayTooltip")
        .style("width", `${window.innerWidth - 0.2 * window.innerHeight}px`)
        .style("height", `${0.8 * window.innerHeight}px`)
        .style("top", `${0.1 * window.innerHeight}px`)
        .style("left", `${0.1 * window.innerHeight}px`)

    //follower部分tooltip
    var followerSvg = d3.select("#followerTooltip")
        .append("svg")
        .attr("width", `100%`)
        .attr("height", `${50}px`)

    var followerDefs = followerSvg.append("defs");

    geneSeed_Tp(followerSvg, followerDefs, 1, 36, 30, 1, 0.5, 1, false, "normal", 0.3, 1, 1, 1);
    geneSeed_Tp(followerSvg, followerDefs, 2, 165, 27.5, 2, 0.5, 1, false, "yellow", 0.3, 1, 1, 1);
    geneSeed_Tp(followerSvg, followerDefs, 3, 280, 25, 3, 0.5, 1, false, "yellow", 0.3, 1, 1, 1);


    //vlevel部分tooltip
    var vlevelSvg = d3.select("#vlevelTooltip")
        .append("svg")
        .attr("width", `100%`)
        .attr("height", `${50}px`)

    var vlevelDefs = vlevelSvg.append("defs");

    geneSeed_Tp(vlevelSvg, vlevelDefs, 4, 42, 30, 1, 0.5, 1, true, "normal", 0.3, 1, 1, 1);
    geneSeed_Tp(vlevelSvg, vlevelDefs, 5, 120, 30, 1, 0.5, 1, true, "yellow", 0.3, 1, 1, 1);
    geneSeed_Tp(vlevelSvg, vlevelDefs, 6, 202, 30, 1, 0.5, 1, true, "gold", 0.3, 1, 1, 1);
    geneSeed_Tp(vlevelSvg, vlevelDefs, 7, 280, 30, 1, 0.5, 1, true, "blue", 0.3, 1, 1, 1);

    //retweet部分tooltip
    var retweetSvg = d3.select("#retweetTooltip")
        .append("svg")
        .attr("width", `100%`)
        .attr("height", `${50}px`)

    var retweetDefs = retweetSvg.append("defs");

    geneSeed_Tp(retweetSvg, retweetDefs, 8, 42, 30, 1, 0.5, 1, false, "normal", 0.3, 1, 1, 1);
    geneSeed_Tp(retweetSvg, retweetDefs, 9, 200, 32, 1, 0.5, 1, false, "yellow", 0.3, 1, 1, 500);
    //滑条：cy从30到42；retweet从500到5k

    //likes部分tooltip
    var likeSvg = d3.select("#likeTooltip")
        .append("svg")
        .attr("width", `100%`)
        .attr("height", `${50}px`)

    var likeDefs = likeSvg.append("defs");

    geneSeed_Tp(likeSvg, likeDefs, 10, 42, 30, 1, 0.5, 1, false, "normal", 0.3, 1, 1, 1);
    geneSeed_Tp(likeSvg, likeDefs, 11, 200, 32, 1, 0.5, 1, false, "yellow", 0.3, 1, 1, 500);

    //comment部分tooltip
    var commentSvg = d3.select("#commentTooltip")
        .append("svg")
        .attr("width", `100%`)
        .attr("height", `${50}px`)

    var commentDefs = commentSvg.append("defs");

    geneSeed_Tp(commentSvg, commentDefs, 12, 24, 30, 1, 0.5, 1, false, "normal", 0.3, 1, 1, 1);
    geneSeed_Tp(commentSvg, commentDefs, 13, 155, 30, 1, 0.5, 2, false, "yellow", 0.3, 1, 100, 1);
    geneSeed_Tp(commentSvg, commentDefs, 14, 274, 30, 1, 0.5, 3, false, "yellow", 0.3, 1, 200, 1);

    //emotion部分tooltip
    var emotionSvg = d3.select("#emotionTooltip")
        .append("svg")
        .attr("width", `100%`)
        .attr("height", `${50}px`)

    var emotionDefs = emotionSvg.append("defs");

    geneSeed_Tp(emotionSvg, emotionDefs, 15, 140, 30, 1, 0.5, 3, false, "yellow", 0.3, 1, 200, 1);




    function geneSeed_Tp(tooltipSvg, tooltipDef, index, cx, cy, followercat, emo_neg_prob, commentCat, isVlevelOn, vlevel, gScale, like, comment, retweet,) {
        var scaleLengthId;
        var scaleWidthId;

        //like的映射计算; like的max值为2457804; 计算scaleWidthId
        let likeScale = d3.scaleLinear()
            .domain([0, 2.7])
            .range([1, 3]); //映射到的scaleWid范围
        if (like <= 5000) {
            scaleWidthId = 1;
        } else {
            scaleWidthId = likeScale(Math.log(like / 5000) / Math.log(10)) //取以10为底的对数
        }

        //retweet的映射计算；retweet的max值为418438；计算scaleLengthId
        let retweetScale = d3.scaleLinear()
            .domain([0, 3])
            .range([1, 3]); //映射到的scaleLen范围
        if (retweet <= 500) {
            scaleLengthId = 1;
        } else {
            scaleLengthId = retweetScale(Math.log(retweet / 500) / Math.log(10)) //取以10为底的对数
        }


        var group1 = tooltipSvg
            .append("g")
            .attr("id", `Tp_seed${index}`)
            .attr("transform", `translate(${cx}, ${cy}), rotate(-30) ,scale(${gScale})`) //rotate(-20,300,400)
        //.attr("transform","rotate(30,600,400)");

        //叶子宽度参数调整
        group1.append("path")
            .attr("d", `M ${185.11 * scaleLengthId} 23 ` +
                `C ${192.21 * scaleLengthId} 34.23 ${156.54 * 1.2 * scaleLengthId} ${57.89 * scaleWidthId} ${132.11 * scaleLengthId} ${57.89 * scaleWidthId} ` +
                `C ${100.6 * scaleLengthId} ${57.89 * scaleWidthId} ${75.04 * 0.8 * scaleLengthId} 30.79 38.58 30.79 ` +
                "C 50.93 16.55 69 8.67 69 8.67 " +
                `S ${162.94 * scaleLengthId} -12.13 ${185.11 * scaleLengthId} 23 ` +
                "Z")
            .style("fill", "#FFCA36")
            .style("opacity", "0.2")
            .style("stroke", "none");

        //评论数量调整纹理
        if (commentCat == 1) {

            group1.append("path")
                .attr("d", `M ${92.56 * (1.2 - 0.2 * scaleLengthId) * scaleLengthId} ${4.3} C ${109.32 * (1.2 - 0.2 * scaleLengthId) * scaleLengthId} ${4.3} ${119.8 * (1.2 - 0.2 * scaleLengthId) * scaleLengthId} ${18.52 * scaleWidthId} ${121.61 * (1.2 - 0.2 * scaleLengthId) * scaleLengthId} ${32.74 * scaleWidthId}`)
                .style("stroke-linecap", "round")
                .attr("stroke-width", "2")
                .attr("opacity", "0.2")
                .attr("fill", "none")
                .attr("class", `Tp_seedleaf${index}`)
                .style("stroke", "#FFCA36");

            group1.append("path")
                .attr("d", `M${125.75 * scaleLengthId},2.55 C ${142.51 * scaleLengthId},2.55,${153 * scaleLengthId},${16.77 * scaleWidthId},${154.8 * scaleLengthId},${31 * scaleWidthId}`)
                // .attr("stroke", "#FFCA36")
                .style("stroke-linecap", "round")
                .attr("stroke-width", "2")
                .attr("opacity", "0.2")
                .attr("fill", "none")
                .attr("class", `Tp_seedleaf${index}`)
                .style("stroke", "#FFCA36");

        } else if (commentCat == 2) {

            group1.append("path")
                .attr("d", `M ${83.27 * (1.2 - 0.2 * scaleLengthId) * scaleLengthId} ${5.93 - Math.min(2, 2 * (scaleLengthId - 1))} C ${100.04 * (1.2 - 0.2 * scaleLengthId) * scaleLengthId} ${5.93 - Math.min(2, 2 * (scaleLengthId - 1))} ${110.52 * (1.2 - 0.2 * scaleLengthId) * scaleLengthId} ${20.15 * 0.8 * scaleWidthId} ${112.33 * (1.2 - 0.2 * scaleLengthId) * scaleLengthId} ${34.37 * 0.8 * scaleWidthId}`)
                .style("stroke-linecap", "round")
                .attr("stroke-width", "2")
                .attr("opacity", "0.2")
                .attr("fill", "none")
                .attr("class", `Tp_seedleaf${index}`)
                .style("stroke", "#FFCA36");

            group1.append("path")
                .attr("d", `M ${107.93 * (1.1 - 0.1 * scaleLengthId) * scaleLengthId} 2.55 C ${124.7 * (1.1 - 0.1 * scaleLengthId) * scaleLengthId} 2.55 ${138.45 * (1.1 - 0.1 * scaleLengthId) * scaleLengthId} ${16.77 * scaleWidthId} ${140.99 * (1.1 - 0.1 * scaleLengthId) * scaleLengthId} ${39.41 * scaleWidthId}`)
                .style("stroke-linecap", "round")
                .attr("stroke-width", "2")
                .attr("opacity", "0.2")
                .attr("fill", "none")
                .attr("class", `Tp_seedleaf${index}`)
                .style("stroke", "#FFCA36");

            group1.append("path")
                .attr("d", `M ${134 * scaleLengthId} 2.55 C ${150.76 * scaleLengthId} 2.55 ${159.2 * scaleLengthId} ${16.77 * scaleWidthId} ${161 * scaleLengthId} ${30.99 * scaleWidthId}`)
                .style("stroke-linecap", "round")
                .attr("stroke-width", "2")
                .attr("opacity", "0.2")
                .attr("fill", "none")
                .attr("class", `Tp_seedleaf${index}`)
                .style("stroke", "#FFCA36");


        } else {

            group1.append("path")
                .attr("d", `M ${71.86 * scaleLengthId} ${7.82 - Math.min(4, 4 * (scaleLengthId - 1))} C ${88.62 * scaleLengthId} 7.82 ${97.72 * scaleLengthId} ${24 * scaleWidthId} ${99.53 * scaleLengthId} ${38.19 * scaleWidthId}`)
                .style("stroke-linecap", "round")
                .attr("stroke-width", "2")
                .attr("opacity", "0.2")
                .attr("fill", "none")
                .attr("class", `Tp_seedleaf${index}`)
                .style("stroke", "#FFCA36");

            group1.append("path")
                .attr("d", `M ${97.8 * scaleLengthId} ${4.3 - Math.min(1.2, 1.2 * (scaleLengthId - 1))} C ${114.57 * scaleLengthId} 4.3 ${122.31 * scaleLengthId} ${29.05 * scaleWidthId} ${124.12 * scaleLengthId} ${43.3 * scaleWidthId}`)
                .style("stroke-linecap", "round")
                .attr("stroke-width", "2")
                .attr("opacity", "0.2")
                .attr("fill", "none")
                .attr("class", `Tp_seedleaf${index}`)
                .style("stroke", "#FFCA36");

            group1.append("path")
                .attr("d", `M ${119.78 * scaleLengthId} 2.55 C ${136.55 * scaleLengthId} 2.55 ${144.29 * scaleLengthId} ${27.3 * scaleWidthId} ${146.09 * scaleLengthId} ${41.55 * scaleWidthId}`)
                .style("stroke-linecap", "round")
                .attr("stroke-width", "2")
                .attr("opacity", "0.2")
                .attr("fill", "none")
                .attr("class", `Tp_seedleaf${index}`)
                .style("stroke", "#FFCA36");

            group1.append("path")
                .attr("d", `M ${140.49 * scaleLengthId} ${2.55 + Math.min(2.5, 2.5 * (scaleLengthId - 1))} C ${157.26 * scaleLengthId} 2.55 ${163.49 * scaleLengthId} ${22.83 * scaleWidthId} ${164.84 * scaleLengthId} ${33.67 * scaleWidthId}`)
                .style("stroke-linecap", "round")
                .attr("stroke-width", "2")
                .attr("opacity", "0.2")
                .attr("fill", "none")
                .attr("class", `Tp_seedleaf${index}`)
                .style("stroke", "#FFCA36");
        }

        //悬停交互
        var mouseover = function (d) {
            console.log(d3.select(this)
                .attr("id")
                .split("Tp_tooltipCircle")[1]
            )

            d3.select(`#Tp_emo_grad_end${d3.select(this)
                .attr("id")
                .split("Tp_tooltipCircle")[1]}`)
                .transition()
                .duration(500)
                .attr("offset", "1")
                .style("stop-opacity", "100%")

            d3.select(`#Tp_emo_grad_start${d3.select(this)
                .attr("id")
                .split("Tp_tooltipCircle")[1]}`)
                .transition()
                .duration(500)
                // .attr("offset", "1")
                .style("stop-color", "#ffca36");

            d3.selectAll(`.Tp_seedleaf${d3.select(this)
                .attr("id")
                .split("Tp_tooltipCircle")[1]}`)
                .transition()
                .duration(500)
                // .attr("offset", "1")
                .attr("opacity", "100%");

        }
        var mousemove = function (d) {

        }
        var mouseleave = function (d) {

            d3.select(`#Tp_emo_grad_end${d3.select(this)
                .attr("id")
                .split("Tp_tooltipCircle")[1]}`)
                .transition()
                .duration(500)
                .attr("offset", "0.1")
                .style("stop-opacity", "0")

            d3.select(`#Tp_emo_grad_start${d3.select(this)
                .attr("id")
                .split("Tp_tooltipCircle")[1]}`)
                .transition()
                .duration(500)
                // .attr("offset", "1")
                .style("stop-color", d3.select(
                    `#Tp_emo_grad_end${d3.select(this)
                        .attr("id")
                        .split("Tp_tooltipCircle")[1]}`)
                    .style("stop-color"));

            d3.selectAll(`.Tp_seedleaf${d3.select(this)
                .attr("id")
                .split("Tp_tooltipCircle")[1]}`)
                .transition()
                .duration(500)
                // .attr("offset", "1")
                .attr("opacity", "0.2");
        }


        //叶子长度参数调整; 粉丝数影响头部大小
        if (followercat == 1) {
            group1.append("path")
                .attr("d", "M 57.6 6.89 " +
                    "C 46 7.89 29.85 6.42 20.6 6.77 " +
                    `C 9.22 7.2 ${-1.68} 9.24 ${0.22} 18.61` +
                    `C 2.28 28.77 8.25 ${37} 21.44 ${37} ` +
                    "C 44 37 57.07 12.5 75 8.92 " +
                    `S ${162.06 * scaleLengthId} -6 ${185.11 * scaleLengthId} 23 ` +
                    `C ${181.44 * scaleLengthId} ${11.63 + 1 * scaleLengthId} ${157.88 * scaleLengthId} 0 ${126.41 * (1.2 - 0.2 * scaleLengthId) * (scaleLengthId)} 0 ` +
                    "S 81.12 4.86 57.6 6.89 " +
                    "Z")
                .attr("id", `Tp_seedStem${index}`)
                .style("fill", "#FFCA36")
                .style("stroke", "none");

            group1.append("circle")
                .attr("cx", 24)
                .attr("cy", 26)
                .attr("r", 18)
                .attr("id", `Tp_tooltipCircle${index}`)
                .attr("fill", "#000")
                .attr("opacity", "0")
                .on("mouseover", mouseover)
                .on("mousemove", mousemove)
                .on("mouseleave", mouseleave);

        } else if (followercat == 2) {

            group1.append("path")
                .attr("d", "M 57.6 6.89 " +
                    "C 46 7.89 29.85 6.42 20.6 6.77 " +
                    "C 9.22 7.2 -16.088 6.503 -14.043 25.517 " +
                    "C -12.048 39.53 -3.46 53.836 19.941 52.99 " +
                    "C 48.698 50.735 57.07 12.5 75 8.92 " +
                    `S ${162.06 * scaleLengthId} -6 ${185.11 * scaleLengthId} 23 ` +
                    `C ${181.44 * scaleLengthId} ${11.63 + 1 * scaleLengthId} ${157.88 * scaleLengthId} 0 ${126.41 * (1.2 - 0.2 * scaleLengthId) * (scaleLengthId)} 0 ` +
                    "S 81.12 4.86 57.6 6.89 " +
                    "Z")
                .attr("id", `Tp_seedStem${index}`)
                .style("fill", "#FFCA36")
                .style("stroke", "none");

            group1.append("circle")
                .attr("cx", 18)
                .attr("cy", 32)
                .attr("r", 25)
                .attr("id", `Tp_tooltipCircle${index}`)
                .attr("fill", "#000")
                .attr("opacity", "0")
                .on("mouseover", mouseover)
                .on("mousemove", mousemove)
                .on("mouseleave", mouseleave);

        } else {

            group1.append("path")
                .attr("d", "M 57.6 6.89 C 46 7.89 29.85 6.42 20.6 6.77 C 9.22 7.2 -41.583 4.467 -40.905 37.759 C -39.289 56.31 -25.731 82.914 10.897 81.111 C 57.311 75.993 52.579 16.323 75 8.92"+
                    `S ${162.06 * scaleLengthId} -6 ${185.11 * scaleLengthId} 23 ` +
                    `C ${181.44 * scaleLengthId} ${11.63 + 1 * scaleLengthId} ${157.88 * scaleLengthId} 0 ${126.41 * (1.2 - 0.2 * scaleLengthId) * (scaleLengthId)} 0 ` +
                    "S 81.12 4.86 57.6 6.89 " +
                    "Z")
                .attr("id", `Tp_seedStem${index}`)
                .style("fill", "#FFCA36")
                .style("stroke", "none");

            group1.append("circle")
                .attr("cx", 15)
                .attr("cy", 35)
                .attr("r", 30)
                .attr("id", `Tp_tooltipCircle${index}`)
                .attr("fill", "#000")
                .attr("opacity", "0")
                .on("mouseover", mouseover)
                .on("mousemove", mousemove)
                .on("mouseleave", mouseleave);
        }

        //定义情感的线性渐变
        {
            //目前：为每一个帖子定制一个defs：长度不同（x2不同）；末端颜色不同
            let emo_grad = tooltipDef.append("linearGradient")
                .attr("id", `Tp_emo_grad${index}`)
                .attr("gradientUnits", "userSpaceOnUse")
                .attr("x1", "57.6")
                .attr("y1", "6.89")
                .attr("x2", `${185.11 * scaleLengthId}`)
                .attr("y2", "23");

            //内容情感
            if (emo_neg_prob <= 0.5) {
                // console.log("a")
                let a = d3.rgb(129, 233, 59);	//积极一端的颜色
                let b = d3.rgb(255, 202, 54);	//橙色
                let linear = d3.scaleLinear()
                    .domain([0, 0.5])
                    .range([0, 1])
                let compute = d3.interpolate(a, b);
                let endColor = compute(linear(emo_neg_prob))

                let stop1 = emo_grad.append("stop")
                    .attr("id", `Tp_emo_grad_start${index}`)
                    .attr("offset", "0")
                    .style("stop-color", endColor);

                let stop2 = emo_grad.append("stop")
                    .attr("id", `Tp_emo_grad_end${index}`)
                    .attr("offset", "0.1")
                    .style("stop-opacity", "0")
                    .style("stop-color", endColor);

                d3.select(`#Tp_seedStem${index}`)
                    .style("fill", "url(#" + emo_grad.attr("id") + ")");

            } else {
                let a = d3.rgb(237, 28, 36);	//消极一端的颜色
                let b = d3.rgb(255, 202, 54);	//橙色
                let linear = d3.scaleLinear()
                    .domain([0.5, 1])
                    .range([0, 1])
                let compute = d3.interpolate(b, a);
                let endColor = compute(linear(emo_neg_prob))

                let stop1 = emo_grad.append("stop")
                    .attr("id", `Tp_emo_grad_start${index}`)
                    .attr("offset", "0")
                    .style("stop-color", endColor);

                let stop2 = emo_grad.append("stop")
                    .attr("id", `Tp_emo_grad_end${index}`)
                    .attr("offset", "0.1")
                    .style("stop-opacity", "0")
                    .style("stop-color", endColor);

                d3.select(`#Tp_seedStem${index}`)
                    .style("fill", "url(#" + emo_grad.attr("id") + ")");

            }
        }


        if (isVlevelOn)
        {
            // 微博等级
            if (vlevel == "normal") {
                group1.append("circle")
                    .attr("cx", "8")
                    .attr("cy", "-5")
                    .attr("r", "10")
                    .attr("stroke", "none")
                    .attr("fill", "#FFCA36")
                    .attr("opacity", "0.3")
            } else if (vlevel == "yellow") {
                group1.append("circle")
                    .attr("cx", "8")
                    .attr("cy", "-5")
                    .attr("r", "10")
                    .attr("stroke", "none")
                    .attr("fill", "#FFCA36")
                    .attr("opacity", "0.5")
                group1.append("circle")
                    .attr("cx", "32")
                    .attr("cy", "-8")
                    .attr("r", "10")
                    .attr("stroke", "none")
                    .attr("fill", "#FFCA36")
                    .attr("opacity", "0.3")
            } else if (vlevel == "gold") {
                group1.append("circle")
                    .attr("cx", "8")
                    .attr("cy", "-5")
                    .attr("r", "10")
                    .attr("stroke", "none")
                    .attr("fill", "#FFCA36")
                    .attr("opacity", "0.8")
                group1.append("circle")
                    .attr("cx", "32")
                    .attr("cy", "-8")
                    .attr("r", "10")
                    .attr("stroke", "none")
                    .attr("fill", "#FFCA36")
                    .attr("opacity", "0.5")
                group1.append("circle")
                    .attr("cx", "56")
                    .attr("cy", "-8")
                    .attr("r", "10")
                    .attr("stroke", "none")
                    .attr("fill", "#FFCA36")
                    .attr("opacity", "0.3")
            } else {
                group1.append("circle")
                    .attr("cx", "8")
                    .attr("cy", "-5")
                    .attr("r", "10")
                    .attr("stroke", "none")
                    .attr("fill", "#3694ff")
                    .attr("opacity", "0.8")
            }
        }

    }



</script>


</body>
</html>