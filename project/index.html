<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>When Wind Blows</title>

    <script type="text/javascript" src="js/lib/jquery.min.js"></script>
    <script type="text/javascript" src="js/scrollmagic/uncompressed/ScrollMagic.js"></script>
    <script type="text/javascript" src="js/scrollmagic/uncompressed/plugins/debug.addIndicators.js"></script>
    <script type="text/javascript" src="js/lib/greensock/TweenMax.min.js"></script>
    <script type="text/javascript" src="js/scrollmagic/uncompressed/plugins/animation.gsap.js"></script>
    <script src="https://use.typekit.net/nlq1kdt.js"></script>

    <script src="https://d3js.org/d3.v6.js"></script>
    <script src="https://unpkg.com/d3-simple-slider"></script>

    <script src="js/fisheye/fisheye.js" charset="utf-8"></script>



    <!-- BOOTSTRAP5 最新编译并压缩的 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <!-- 最新编译的 JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
            crossorigin="anonymous"></script>

    <link rel="stylesheet" href="https://use.typekit.net/upe5kqr.css"> <!--字体-->

    <style>

        html {
            font-size: calc(2400vw / 1728); /*rem（font size of the root element）是指相对于根元素的字体大小的单位*/
        }

        @media screen and (min-width: 1920px) {
            html {
                font-size: 30px;
            }
        }

        @media screen and (max-width: 1000px) {
            html {
                font-size: 10px;
            }
        }


        body {
            background: #141414;
        }

        @font-face {
            font-family: impact;
            src: url("asset/font/Impact.ttf");
        }

        @font-face {
            font-family: hand;
            src: url("asset/font/Hand_Of_Sean.ttf");
        }

        .h1title {
            font-family: impact;
            font-size: 4rem;
        }

        .h2title {
            font-family: impact;
            font-size: 2rem;
        }

        .h3title {
            font-family: impact;
            font-size: 1.2rem;
        }

        .h4title {
            font-family: impact;
            font-size: 1rem;
        }

        .fontGrad45 {
            background-image: -webkit-linear-gradient(45deg, #da7d1e, #ffc000);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .cataGrad {
            background: linear-gradient(45deg, #da7d1e, #ffc000);
            border-radius: 10px;
        }


        .fontWhite {
            color: rgba(255, 255, 255, 0.84);
        }


        .fontWhite_light {
            color: rgba(255, 255, 255, 0.75);

        }

        .fontHighlight {
            color: rgba(255, 192, 0, 0.9);
        }

        .normalContent {
            font-family: noto-sans, sans-serif;
            font-weight: 300;
            font-style: normal;
            font-size: .7rem;
            color: rgba(255, 255, 255, 0.71);
        }

        .normalContentSmallWord {
            font-family: noto-sans, sans-serif;
            font-weight: 300;
            font-style: normal;
            font-size: .6rem;
            color: rgba(255, 255, 255, 0.71);
        }


        .handContent {
            font-family: hand;
            font-weight: 300;
            font-style: normal;
            font-size: 1rem;
            color: rgba(255, 192, 0, 0.9);
        }

        .captionContent {
            font-family: noto-sans, sans-serif;
            font-weight: 200;
            font-style: normal;
            font-size: .4rem;
            color: rgba(255, 255, 255, 0.71);
        }

        .normalContentBigword {
            font-family: noto-sans, sans-serif;
            font-weight: 500;
            font-style: normal;
            font-size: 1rem;
            color: rgba(255, 255, 255, 0.71);
        }

        .normalContentBigwordHighlight {
            font-family: noto-sans, sans-serif;
            font-weight: 500;
            font-style: normal;
            font-size: 1rem;
            color: rgba(255, 192, 0, 0.9);
        }

        .bigNumbers {
            font-family: noto-sans, sans-serif;
            font-weight: 600;
            font-style: normal;
            font-size: 1.2rem;
            color: rgba(255, 192, 0, 0.9);
        }

        .normalContentHighlightLink {
            font-family: noto-sans, sans-serif;
            font-weight: 600;
            font-style: normal;
            font-size: .8rem;
            text-decoration: underline;
            color: rgba(255, 192, 0, 0.9);
        }


        .normalContentHighlight {
            font-family: noto-sans, sans-serif;
            font-weight: 500;
            font-style: normal;
            font-size: .7rem;
            color: rgba(255, 192, 0, 0.9);
        }

        .buttonSelected {
            background-color: #282828;
            border-radius: 4rem;

            border: 1px rgba(68, 68, 68, 0) solid;
            padding: 10px 30px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
        }

        .buttonUnSelected {
            background-color: rgba(40, 40, 40, 0);
            opacity: .4;
            border-radius: 4rem;

            border: 1px rgba(68, 68, 68, 0.9) solid;
            padding: 10px 30px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
        }

        .questionSelected {
            background-color: #282828;
            border-radius: 4rem;

            border: 1px rgba(68, 68, 68, 0) solid;
            padding: 10px 18px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 16px;
        }

        .questionUnSelected {
            background-color: rgba(40, 40, 40, 0);
            opacity: .4;
            border-radius: 4rem;

            border: 1px rgba(68, 68, 68, 0.9) solid;
            padding: 10px 18px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 16px;
        }

        .windCard {
            margin-left: 20rem;
            margin-right: 20rem;
            height: fit-content;
            background-color: rgba(24, 24, 24, 0.5);
            border-radius: 1rem;
            margin-bottom: 10rem;
            padding-top: 2rem;
            padding-bottom: 2rem;
            -webkit-box-shadow: rgba(192, 187, 180, 0.2) 0px 0px 50px;
            -moz-box-shadow: rgba(192, 187, 180, 0.2) 0px 0px 50px;
            box-shadow: rgba(192, 187, 180, 0.2) 0px 0px 50px;
        }

        .postCard {

            height: fit-content;
            background-color: rgba(46, 46, 46, 0.5);
            padding: 3rem;
            margin-top: 2rem;
            margin-bottom: 4rem;
        }

        .postName {
            font-family: noto-sans, sans-serif;
            font-weight: 700;
            font-style: normal;
            font-size: 1.2rem;
            color: rgba(255, 255, 255, 0.84);
        }

        .slider text {
            fill: rgba(255, 255, 255, .4);
        }

        .divider-flex {
            height: 1px;
            border-top: 1px solid rgba(255, 255, 255, 0.2);
            margin-top: .3rem;
            margin-bottom: .3rem;
            border-radius: 1px;
            text-align: center;
            /*stroke-linecap: round;*/
        }

        .introTooltip{
            background-color: rgba(24, 24, 24, 1);
            -webkit-box-shadow: #000000 0px 0px 50px;
            -moz-box-shadow: #000000 0px 0px 50px;
            box-shadow: #000000 0px 0px 50px;
            border-radius: 8px;

            padding: 2rem;
        }

        .seedTooltip {
            position: fixed;
            top: .9rem;
            left: .9rem;
            padding: .5rem;
            width: 16rem;
            /*max-width: 500px;*/
            /*height: 300px;*/

            background-color: rgba(24, 24, 24, 1);
            -webkit-box-shadow: #000000 0px 0px 2rem;
            -moz-box-shadow: #000000 0px 0px 2rem;
            box-shadow: #000000 0px 0px 2rem;
            border-radius: .35rem;
        }

        .tooltip { /*bs5的tooltip样式*/
            font-family: noto-sans, sans-serif;
            font-weight: 300;
            font-style: normal;
            font-size: .6rem;
            color: rgba(255, 255, 255, 0.71);
        }

        .timelineNote{
            width: 14rem;
            height: fit-content;
            background-color: rgba(35, 35, 35, .5);
            position: relative;
            padding: 1rem;
            border-radius: .2rem;
            backdrop-filter: blur(5px);

        }

        .emotionScale {
            height: .4rem;
            width: .2rem;
            background: none;
            border: 1px solid #f1f1f1;
            position: relative;
            top: .35rem;
            -webkit-box-shadow: #c0bbb4 0px 0px 6px;
            -moz-box-shadow: #c0bbb4 0px 0px 6px;
            box-shadow: #c0bbb4 0px 0px 6px;
        }

        #scrollViewBox {
            position: fixed;
            /*top: 10px;*/
            /*right: 20px;*/
            height: 2rem;
            width: calc(100rem / 24);
            box-sizing: border-box; /*改为内侧描边*/
            background-color: rgb(128, 128, 128, .4);
            border: 2px solid rgb(227, 227, 227);
            border-radius: .4rem;

            /*cursor: move;*/
            /*-webkit-box-shadow: black;*/
        }

        /*steamgraph左侧小圆形*/
        .keyEventCir{
            position: fixed;
            right: 5rem;
            top: 2rem;
            width: .5rem;
            height: .5rem;
            border-top-right-radius: .25rem;
            border-bottom-right-radius: .25rem;
            border-bottom-left-radius: .25rem;
            border-top-left-radius: .25rem;
            background: #ffc000;
        }

        .detail-basis{
            background-color: #444444;
            font-size: .6rem;
            position: relative;
            height: 1rem;
        }



        .detail-outside{
            border: 1px solid transparent;
            height: 1rem;
            position: relative;
            top:1px;
        }
        .discrete-label{
            left: 4px;
            overflow: hidden;
            padding-left: 9px;
            position: absolute;
            text-overflow: ellipsis;
            top: 0;
            white-space: nowrap;
            width: 97%;
        }

        .triangle {
            fill: #FFCA36;
            stroke: #FFCA36;
            stroke-width: 6;
        }


        .geoSubTab {
            display: flex;
            height: fit-content;
            border: rgba(255, 249, 240, 0.4) 1px solid;
            text-align: center;
            justify-content: center;
            background-color: rgba(55, 59, 79, 0.35);
            border-radius: 0.1rem;
        }

        .geoSubTabContent {
            display: flex;
            flex-direction: column;
            height: 10rem;
            width: 180px;
            border: rgba(255, 249, 240, 0.1) 1px solid;
            /*text-align: center;*/
            /*justify-content: center;*/
            background-color: rgba(55, 59, 79, .35);;
            border-radius: 0.1rem;

            font-size: 0.6rem;
            overflow: auto;
        }

        .geoSubTabContentChoice {
            margin: 0px;
            /*color: rgba(79, 79, 79, 0.6);*/

            font-family: noto-sans, sans-serif;
            font-weight: 300;
            font-style: normal;
            font-size: .6rem;
            color: rgba(255, 255, 255, 0.5);
            margin-left: 0.8rem;

            /*超出部分变成小数点*/
            text-overflow: ellipsis;
            overflow: hidden;
            /*white-space: nowrap;*/
        }

        .geoSubTabTitle {
            font-size: 0.7rem;
            color: #ffffff;
            display: flex;
            text-decoration: none;
            margin: 0px;
        }

        .geoSubTabContentChoiceDivWrap {
            flex-direction: row;
            display: flex;
            align-items: center;
            padding-left: .4rem;

        }

        .geoSubTabContentChoiceBox {
            background-color: #dee3e7;
            width: .4rem;
            height: .4rem;
            display: inline-block;
            margin-right: .4rem;
        }




    </style>
    <meta name="viewport" content="width=device-width, initial-scale=1">
</head>
<body>


<!--封面-->
<div id="pageStart"></div>


<div class="row" style="width: 100%; height: 100%;">

    <div class="col-lg-5" style="padding: 5rem; padding-left: 10rem">
        <p class="h1title fontWhite" style="">WHEN</p>
        <p class="h1title fontWhite"
           style="font-size: 4.5rem; text-align:center; margin-left: 3rem;background-image: -webkit-linear-gradient(45deg, #da7d1e, #ffc000);">
            WIND</p>
        <p class="h1title fontWhite" style="font-size: 5rem;">BLOWS</p>

    </div>

    <div class="col-lg-7" style="padding: 5rem">
        <img src="asset/img/coverBg.png" style="width: 100%">

    </div>
</div>
<div style="margin-left: 20rem; margin-right: 20rem; text-align: center; margin-bottom: 12rem">
    <p class="h3title fontHighlight">When wind blows,</p>
    <p class="h3title fontWhite">it blows away lies,</p>
    <p class="h3title fontWhite">only the truth stands.</p>
    <br>
    <p class="h3title fontHighlight">When wind blows,</p>
    <p class="h3title fontWhite">it blows away injustice,</p>
    <p class="h3title fontWhite">only peace remains.</p>
    <br>
    <p class="h3title fontHighlight">Let the wind blow.</p>
</div>

<!--背景引言-->
<div style="margin-left: 20rem; margin-right: 20rem; margin-top: 10rem; margin-bottom: 5rem">
    <p class="h2title" style="text-align: center; margin-bottom: 8rem"><span class="fontWhite">BACKGROUND</span></p>
    <p class="normalContent" style="">
        In Jan 27, 2022, a TikTok video of a Chinese mother of eight locked up in a worn-out village shed with a chain
        around her neck went viral and sparked widespread outrage.
    </p>

    <p class="normalContent">
        While authorities released <span class="normalContentHighlight">a series of conflicting reports</span> and kept official media silent, a blow of <span
            class="normalContentHighlight">ANGRY WIND</span> swept through the social media.
    </p>

</div>

<!--官方vs民意帖子-->
<div style="margin-left: 10rem; margin-right: 10rem;">

    <div class="postCard" style="margin-right: 20rem; margin-left: 2rem; border-radius:25px;">
        <div style="display: flex; align-items: flex-end;">
            <p class="postName">Investigation Report 1 · County Level</p>
        </div>
        <p class="normalContent" style="opacity: .7; margin: 0rem">After the preliminary investigation verification, the
            mother got married with Dong in August 1998, and <span class="normalContentHighlight">there is no human trafficking</span>.
            Family members and neighbors reported that Yang often beat children and elderly people for no reason.
            According to the diagnosis of medical institutions, Yang is suffering from mental illness. At present, she
            has been treated and her family has been further assisted to ensure a warm Spring Festival. The details are
            under further investigation and verification.</p>
        <div style="margin-top: 1rem">
            <p class="normalContent" style="margin: 0rem; text-align: end;">Fengxian County Publicity Department</p>
            <p class="normalContent" style="margin: 0rem; text-align: end;">Jan 28, 2022</p>
        </div>

    </div>

    <div class="postCard" style="margin-left: 20rem; margin-right: 2rem; border-radius:25px; padding-bottom: 2rem">
        <div style="display: flex; align-items: flex-end;">
            <p class="postName" style="margin-bottom: 0.8rem;">@Xiaoshe Sun</p>
            <p class="normalContent" style="margin-left: 1rem">53K followers</p>
        </div>
        <p class="normalContent" style="opacity: .7; margin: 0rem">Official reports from Fengxian has already overdrawn
            the credibility of local government. Interest groups are worried that when the “radish” is pull up by public
            opinions, the “mud” of sloth administration, concealing and lying, together with the blood and tears of
            local women and children will be revealed. <span class="normalContentHighlight">We need a higher-level investigation team to overthrow the local interest network from the outside and bring fair back.</span>
        </p>
        <div style="margin-top: 1rem">
            <!--            <p class="normalContent" style="margin: 0rem; text-align: end;">Fengxian County Publicity Department</p>-->
            <p class="normalContent" style="margin: 0rem; text-align: end;">9:15 · Jan 31, 2022</p>

            <div class="divider-flex" style="margin-top: 2rem"></div>

            <div class="normalContent"
                 style="margin: 0rem; text-align: center; display: flex; justify-content: space-around; margin-top: 1rem">
                <div style="display: flex; flex-direction: row">
                    <img src="asset/svg/retweet.svg" style="width: 1.4rem; margin-right: 1rem">
                    <p class="normalContent" style="margin: 0rem; line-height: 1.4rem">813</p>
                </div>

                <div style="display: flex; flex-direction: row">
                    <img src="asset/svg/like.svg" style="width: 1.4rem; margin-right: 1rem">
                    <p class="normalContent" style="margin: 0rem; line-height: 1.4rem">13027</p>
                </div>

                <div style="display: flex; flex-direction: row">
                    <img src="asset/svg/comment.svg" style="width: 1.4rem; margin-right: 1rem">
                    <p class="normalContent" style="margin: 0rem; line-height: 1.4rem">141</p>
                </div>
            </div>
        </div>
    </div>

</div>

<!--quote-->
<div style="margin-left: 20rem; margin-right: 20rem; margin-top: 10rem; margin-bottom: 15rem">
    <p class="fontGrad45" style="font-family: impact; font-size: 18rem; position: absolute; margin: 0px; margin-top: -10rem;
            transform: translate(-15rem, 0px)">“</p>
    <p class="normalContent" style="">
        The investigation progress of this incident is largely driven by the public opinions on the
        Internet. It proved that Internet public opinion has a great amount of positive energy and has
        become <span class="normalContentHighlight">an indispensable part of the driving force for China’s governance progress</span>.

        <!--        The progress (of this incident) is largely driven by <span class="normalContentHighlight">Internet public opinion</span>,-->
        <!--        which has enormous positivity, and has become an indispensable part of the driving force for governance-->
        <!--        progress.-->
    </p>

    <div style="float: right; display: flex;">
        <p class="normalContent" style="transform: translate(14rem, 1rem)"><span class="normalContentHighlight">@</span>
            Xijin Hu, former chief editor of <span style="font-style: italic;">Global Times</span></p>
        <img src="asset/img/huxijin.png" style="width: 3rem; transform: translate(15rem, 0px)">
    </div>
</div>

<!--motivation-->
<div style="margin-left: 20rem; margin-right: 20rem; margin-top: 10rem; margin-bottom: 5rem">

    <p class="normalContent" style="margin-top: 2rem">Through this work, I aimed to demonstrate the <span
            class="normalContentBigwordHighlight">incomparable strength of public opinion</span> visually, and call for
        more awareness and actions towards human trafficking and many other social issues alike.</p>


</div>


<!--Encode Posts and Hashtags-->
<!--<div style="margin-left: 20rem; margin-right: 20rem; margin-top: 10rem; margin-bottom: 0rem; ">-->
<!--    <p class="h2title fontWhite" style="text-align: center; margin-bottom: 0rem">ENCODE <span-->
<!--            class="fontGrad45">POSTS</span> AND <span class="fontGrad45">HASHTAGS</span></p>-->

<!--</div>-->


<!--Seed Encode-->
<div class="row" style="margin-right: 5rem; margin-left: 5rem; ">
    <div class="col-lg">
        <div style="padding: 5rem;">

            <div id="postIntroEnter"></div>
            <div style="margin-bottom: 16rem; margin-top: 18rem">
                <p class="normalContent">
                    I collected data of <span class="normalContentHighlight">4, 725 posts</span> about this incident on Weibo.
                </p>

                <p class="normalContent" style="margin-bottom: 1em">
                    Later, the form of <span class="normalContentHighlight">samara seeds</span> will be used to
                    visualize these <span class="normalContentHighlight">posts</span>, to see what voices
                    were made during this incident.
                </p>

                <p class="normalContent">
                    This visual metaphor is selected due to its ability to spread and take root as posts on social
                    media, and its representation of freedom.
                </p>

            </div>

            <div style="margin-bottom: 16rem">

                <p class="normalContent">
                    Each seed glyph encodes 6 attributes of post data.
                </p>

                <p class="normalContent">
                    Click <img src="asset/svg/info.svg" style="height: 1rem; display: inline-flex; margin: 0rem .2rem"
                               onclick="showTooltipOverlayIntro()" data-toggle="tooltip" data-bs-placement="bottom"
                               title="detailed information"/> to see detailed information of encoding rules.
                </p>

            </div>

            <div style="margin-bottom: 16rem">
                <div id="windCarryEnter"></div>

                <p class="normalContentBigword">
                    And we need wisps of <span class="normalContentBigwordHighlight">wind</span> to carry these seeds.
                </p>

                <div id="windCarryExit"></div>
            </div>

            <div style="margin-bottom: 16rem">

                <p class="normalContent">
                    I used data of <span class="normalContentHighlight">142 hashtags</span> of this incident on Weibo to visualize the overview of public voices.
                </p>

                <p class="normalContent">
                    Hashtags and posts were both categorized into 8 groups according to which official report they related to. Then I used "windlines" to represent these 8 groups and encode hashtag data.
                </p>

                <p class="normalContent">
                    Click each wisp of wind to explore more. Click <img src="asset/svg/info.svg" style="height: 1rem; display: inline-flex; margin: 0rem .2rem"
                                                                        onclick="showTooltipOverlayIntro_wind()" data-toggle="tooltip" data-bs-placement="bottom"
                                                                        title="detailed information"/> to see detailed information of encoding rules.

                </p>

            </div>

<!--            <div style="margin-bottom: 16rem">-->

<!--&lt;!&ndash;                <p class="normalContent">&ndash;&gt;-->
<!--&lt;!&ndash;                    Each windline glyph encodes 5 attributes of hashtag data.&ndash;&gt;-->
<!--&lt;!&ndash;                </p>&ndash;&gt;-->

<!--                <p class="normalContent">-->
<!--                     </p>-->

<!--            </div>-->

            <div style="margin-bottom: 0rem">

                <div id="moveCloserEnter"></div>

                <p class="normalContentBigword">
                    Now let's move closer, to see seeds carried in these wisps of wind...
                </p>
                <div id="moveCloserExit"></div>


            </div>



        </div>


    </div>

    <div class="col-lg">
        <div id="divFixedSeedIntro1" style="padding: 3rem; padding-right: 0px; padding-top: 0rem; ">
            <svg id="svg1">
            </svg>
        </div>
    </div>
</div>

<!--背景windline动画 video-->
<div style="position:fixed; top: 0rem; left: 0rem; z-index: -1">
    <video id="windAnimVideo" preload="auto" src="asset/mp4/windAnim.mp4" muted="muted" style="position:fixed; top: 0px; z-index: -1"></video>
</div>

<div id="windAnimSvgOverlayDiv" style="display: none; position:fixed; top: 0rem; left: 0rem; z-index: 3">
<!--    src="asset/svg/windGlyph.svg"-->
</div>


<!--Intro部分整体tooltip-->
<div class="introTooltip" id="overlayTooltipIntroPart_seed" style="display: none; position:fixed; z-index: 3; height: 30rem; width: 66rem">
    <p class="normalContent" style="margin-bottom: 2em">
        Each seed represents a popular Weibo post with the keyword “丰县(Fengxian)” from Jan 28, 2022 to Feb 28, 2022.
    </p>
    <div class="row" >
        <div class="col-sm">
            <!--follower Tooltip-->
            <div style="margin-bottom: 20px">
                <p class="h4title fontHighlight" style="margin-bottom: .6rem"> Followers </p>
                <p class="normalContent" style="font-size: 0.7em">Seed head size shows no. of
                    followers of the poster.</p>
                <div id="followerTooltipIntro"></div>
                <div class="normalContent"
                     style="font-size: 0.3em; display: flex; justify-content: space-between; padding-left: 4rem; padding-right: 10.5rem">
                    <p style="display: inline-flex; margin-bottom: 0px">≤10K</p>
                    <p style="display: inline-flex; margin-bottom: 0px">10K-1M</p>
                    <p style="display: inline-flex; margin-bottom: 0px">>1M</p>
                </div>
            </div>

            <!--retweet Tooltip-->
            <div style="margin-bottom: 20px">
                <p class="h4title fontHighlight" style="margin-bottom: .6rem"> Retweets </p>
                <p class="normalContent" style="font-size: 0.7em">Seed stem length represents the
                    no. of retweets.</p>
                <div id="retweetTooltipIntro"></div>
                <div class="normalContent"
                     style="font-size: 0.3em; display: flex; justify-content: space-between; padding-left: 4rem; padding-right: 10rem">
                    <p style="display: inline-flex; margin-bottom: 0px; user-select: none;">≤500</p>
                    <div style="display: inline-flex;">
                        <p style="margin-bottom: 0px; user-select: none;">>500:</p>

                        <div id="retweetDragBgIntro"
                             style="background: #e5e1d9; opacity: 0.6; width:5rem; height:0.25rem; border-radius: .2rem; justify-content: center; align-self: center; margin-left: .6rem">
                            <div id="retweetDragBoxIntro"
                                 style="position: relative; top: -0.06rem; left: 0px; width: .6rem; height: .4rem; border-radius: .2rem; background: #FFCA36; ">
                                <p id="retweetNumIntro" style="position:relative; top: 6px; user-select: none;display: none">
                                    5000</p>
                            </div>
                        </div>

                    </div>

                </div>
            </div>

            <!--comment Tooltip-->
            <div style="margin-bottom: 20px">
                <p class="h4title fontHighlight" style="margin-bottom: .6rem"> Comments </p>
                <p class="normalContent" style="font-size: 0.7em">Wing pattern shows the no. of comments.
                    (hover on the seed head to see patterns)</p>
                <div id="commentTooltipIntro"></div>
                <div class="normalContent"
                     style="font-size: 0.3em; display: flex; justify-content: space-between; padding-left: 4rem; padding-right: 10rem">
                    <p style="display: inline-flex; margin-bottom: 0px">≤10</p>
                    <p style="display: inline-flex; margin-bottom: 0px">10-100</p>
                    <p style="display: inline-flex; margin-bottom: 0px">>100</p>
                </div>
            </div>


        </div>

        <div class="col-sm">
            <!--vlevel tooltip-->
            <div style="margin-bottom: 20px">
                <p class="h4title fontHighlight" style="margin-bottom: .6rem"> Account Type </p>
                <p class="normalContent" style="font-size: 0.7em">The dot(s) near the seed head indicates Weibo
                    account type of the poster.</p>
                <div id="vlevelTooltipIntro"></div>
                <div class="normalContent"
                     style="font-size: 0.3em; display: flex; justify-content: space-between; padding-left: .5rem; padding-right: 6rem">
                    <p class="col-3 text-center" style="display: inline-flex; margin-bottom: 0px">Individual Lv.1</p>
                    <p class="col-3 text-center" style="display: inline-flex; margin-bottom: 0px">Individual Lv.2</p>
                    <p class="col-3 text-center" style="display: inline-flex; margin-bottom: 0px">Individual Lv.3</p>
                    <p class="col-3 text-center" style="display: inline-flex; margin-bottom: 0px">Enterprise Account</p>
                </div>
            </div>

            <!--like tooltip-->
            <div style="margin-bottom: 20px">
                <p class="h4title fontHighlight" style="margin-bottom: .6rem"> Likes </p>
                <p class="normalContent" style="font-size: 0.7em">Seed wing width represents the
                    no. of likes.</p>
                <div id="likeTooltipIntro"></div>
                <div class="normalContent"
                     style="font-size: 0.3em; display: flex; justify-content: space-between; padding-left: 4rem; padding-right: 10rem">
                    <p style="display: inline-flex; margin-bottom: 0px; user-select: none;">≤5000</p>
                    <div style="display: inline-flex;">
                        <p style="margin-bottom: 0px; user-select: none;">>5000:</p>
                        <div id="likeDragBgIntro"
                             style="background: #e5e1d9; opacity: 0.6; width:5rem; height:0.25rem; border-radius: .2rem; justify-content: center; align-self: center; margin-left: .6rem">
                            <div id="likeDragBoxIntro"
                                 style="position: relative; top: -0.06rem; left: 0px; width: .6rem; height: .4rem; border-radius: .2rem; background: #FFCA36; ">
                                <p id="likeNumIntro" style="position:relative; top: 6px; user-select: none;display: none">
                                    5000</p>
                            </div>
                        </div>
                    </div>

                </div>
            </div>

            <!--emotion Tooltip-->
            <div style="margin-bottom: 20px">
                <p class="h4title fontHighlight" style="margin-bottom: .6rem"> Sentiment </p>
                <p class="normalContent" style="font-size: 0.7em">Seed head color represents the
                    sentiment of the post text. (hover to see the animation)</p>
                <div id="emotionTooltipIntro"></div>
                <div class="normalContent"
                     style="font-size: 0.3em; display: flex; justify-content: space-between; padding-left: 4rem; padding-right: 14rem">
                    <p style="display: inline-flex; margin-bottom: 0px; user-select: none">negative</p>
                    <div style="display: inline-flex;">
                        <div id="emotionDragBgIntro"
                             style="background: #e5e1d9; opacity: 0.6; width:120px; height:6px; border-radius: 3px; justify-content: center; align-self: center; margin: 0px">
                            <div id="emotionDragBoxIntro"
                                 style="position: relative; top: -1px; left: 54px; width: 12px; height: 8px; border-radius: 4px; background: #FFCA36; ">
                                <p id="emotionNumIntro"
                                   style="position:relative; top: 6px; user-select: none;display: none"></p>
                            </div>
                        </div>
                    </div>
                    <p style="display: inline-flex; margin-bottom: 0px; user-select: none">positive</p>


                </div>
            </div>
        </div>
    </div>
</div>

<!--Intro部分tooltip遮挡div-->
<div id="invisibleBlock_Intro" style="display: none; position: fixed; top: 0px; left: 0px; z-index: 2"
     onclick="invisibleBlock_Intro_click()"></div>

<!--阻挡wind tooltip的div-->
<div id="tooltipInvisibleBlockDiv_wind" style="display:none; z-index: 4; position:fixed;top: 0px; left: 0px"
     onclick="tooltipInvisibleBlockDiv_wind_click()">

</div>

<!--windLine的悬停tooltip-->
<div class="seedTooltip" id="hashtagTooltip_wind"
     style="padding: 1rem; display: none; flex-direction: column; user-select: none; z-index: 5;">

    <div id="hashtagGroupNum_wind" class="h3title fontGrad45" style="margin-bottom: 1rem"> Hashtag Group ·
        1
    </div>

    <div id="hashtagGroupSubtitle_wind" class="normalContent" style="margin-bottom: 1rem">
        This hashtag group contains hashtags related to investigation report 1 (the first announcement of Fengxian)
    </div>

    <div id="hashtagGroupInclude_wind"
         class="normalContent"
         style="font-size: .6rem; overflow: auto; height: 4rem"
         content="123">
        included hashtags:<br>
        #丰县辟谣被拴破屋八孩母亲系拐卖 <br>
        #丰县回应八孩母亲被拴破屋 <br>
        #江苏丰县回应八孩母亲被拴破屋 <br>
        #官方回应八孩母亲被拴破屋疑遭家暴 <br>
        #官方回应徐州八孩母亲被拴破屋 <br>
        #官方通报生育八孩女子情况 <br>
        #丰县官方通报生育八孩女子情况 <br>
        #官方通报徐州丰县生育八孩女子情况 <br>
        #官方救治江苏八孩母亲 <br>
        #江苏丰县回应生育八孩女子情况 <br>
        #官方通报丰县生育8孩女子事件 <br>
    </div>

    <a id="showFullHashtag_wind" href="javascript:void(0);" rel="external nofollow" onclick="showFullHashtag_wind()"
       class="normalContentHighlight"
       style="font-size: 0.4em; display: inline-flex; margin-bottom: 1rem">show
        more</a>

    <div class="normalContent" style="margin-bottom: .5rem">
        Average sentiment:
    </div>

    <div style="margin-top: 0rem; margin-bottom: 1rem; display: flex; justify-content: space-between;">
        <!--display: flex-->
<!--        <div style="vertical-align: top; display: inline-flex;  line-height:1rem; text-align:center; height: 24px">-->
<!--            <div style="font-size: 0.4em; color: #b7b7b7; display: inline">negative</div>-->
<!--        </div>-->

        <p class="normalContent" style="font-size: .6rem; margin-bottom: 0rem">negative</p>

        <div style="vertical-align: top; display: flex; position: relative">
            <div class="emotionScale" id="emotionScaleBox_wind"
                 style="left:160px; position: absolute; height: .45rem; width: .25rem; margin-top: -0.1rem;"></div>
            <img src="asset/svg/gradient.svg" style="display:inline;width:8rem;height:auto;"/>
        </div>

        <p class="normalContent" style="font-size: .6rem; margin-bottom: 0rem">positive</p>


        <!--        <div style="vertical-align: top; display: inline-flex;  line-height:24px; text-align:center; height: 24px">-->
<!--            <div style="font-size: 0.4em; color: #b7b7b7; display: inline">positive</div>-->
<!--        </div>-->
    </div>



    <div class="divider-flex"></div>

    <div style="display: flex; justify-content:center;/*水平居中*/ margin-top: 1rem">

        <div style="display: flex;  margin-left: 1rem; margin-right: 1rem">
            <img data-toggle="tooltip" data-bs-placement="top" title="Number of views" src="asset/svg/view.svg" style="width:1rem;height:1rem; margin-right: .4rem"/>
            <p id="windView" class="normalContent" style="font-size: .6rem; margin-bottom: 0rem">123</p>
        </div>

        <div style="display: flex;  margin-left: 1rem; margin-right: 1rem">
            <img data-toggle="tooltip" data-bs-placement="top" title="no. of comments" src="asset/svg/comment.svg" style="width:1rem;height:1rem; margin-right: .4rem"/>
            <p id="windComment" class="normalContent" style="font-size: .6rem; margin-bottom: 0rem">123</p>
        </div>

        <div style="display: flex;  margin-left: 1rem; margin-right: 1rem">
            <img data-toggle="tooltip" data-bs-placement="top" title="no. of original posters" src="asset/svg/originals.svg" style="width:1rem;height:1rem; margin-right: .4rem"/>
            <p id="windOriginal" class="normalContent" style="font-size: .6rem; margin-bottom: 0rem">123</p>
        </div>


    </div>

</div>

<!--hashtag整体大tooltip窗口-->
<div class="introTooltip" id="overlayTooltipIntroPart_wind"
     style="display: none; position:fixed; z-index: 3; height: 24rem; width: 50rem">

    <div style="display:flex;">
        <p class="h4title fontHighlight" style="margin-bottom: 0px; margin-bottom: .6rem; line-height: 1rem">No. of views & no. of discussion & no. of original posters</p>
        <p class="normalContent" style="line-height: 1rem; margin-left: 2rem">- windline shape</p>
    </div>



    <div class="row" style="margin-bottom: 20px">
        <div class="col-lg-2" style="">
            <img src="asset/svg/curve_shape1.svg"
                 style="display: block; width:4rem;height:auto;margin-top: 2rem; margin-bottom: 1.2rem"/>
            <img src="asset/svg/curve_shape2.svg"
                 style="display: block; width:4rem;height:auto;margin-bottom: 1.2rem"/>
            <img src="asset/svg/curve_shape3.svg" style="display: block; width:4rem;height:auto;"/>

        </div>

        <div class="col-lg" style="">
            <p class="normalContent" style="text-align: center;">Number of view</p>

            <p class="normalContent" style="font-size: .6rem; text-align: center; margin-bottom: 1.8rem;">
                <500M</p>

            <p class="normalContent" style="font-size: .6rem; text-align: center; margin-bottom: 1.8rem;">
                500M-4B</p>

            <p class="normalContent" style="font-size: .6rem; text-align: center; margin-bottom: 1.8rem;">
                >4B</p>


        </div>

        <div class="col-lg" style="">
            <p class="normalContent" style="text-align: center;">Number of discussion</p>

            <p class="normalContent" style="font-size: .6rem; text-align: center; margin-bottom: 1.8rem;">
                <200K</p>

            <p class="normalContent" style="font-size: 0.6em; text-align: center; margin-bottom: 1.8rem;">
                200K-2M</p>

            <p class="normalContent"  style="font-size: 0.6em; text-align: center; margin-bottom: 1.8rem;">>2M
            </p>

        </div>
        <div class="col-lg" style="">
            <p class="normalContent" style="text-align: center;">Number of originals</p>

            <p class="normalContent" style="text-align: center; margin-bottom: 1.8rem;"><5K</p>

            <p class="normalContent" style="text-align: center; margin-bottom: 1.8rem;">
                5K-50K</p>

            <p class="normalContent" style="text-align: center; margin-bottom: 1.8rem;">>50K</p>

        </div>
    </div>

    <div class="row">
        <div class="col-lg">
            <div style="display:flex;">
                <p class="h4title fontHighlight" style="margin-bottom: 0px; margin-bottom: .6rem; line-height: 1rem">Average sentiment</p>
                <p class="normalContent" style="line-height: 1rem; margin-left: 2rem">- wind tail color</p>
            </div>

            <div style="display: flex; align-items: center; ">
                <img src="asset/svg/curve_shape6.svg"
                     style="display:inline-flex;width:6rem;height:auto;margin-right: 5px"/>

                <div style="display: inline-flex; justify-content: space-between; align-items: center; margin-left: 0px">
                    <p class="normalContent" style="font-size: .6rem; display: inline-flex; margin-bottom: 0px; margin-right: 0.6rem">
                        negative</p>
                    <img src="asset/svg/gradient.svg" style="width: 6rem">
                    <p class="normalContent" style="font-size: .6rem; display: inline-flex; margin-bottom: 0px; margin-left: 0.6rem">
                        positive</p>
                </div>

            </div>
        </div>

        <div class="col-lg">

            <div style="display:flex;">
                <p class="h4title fontHighlight" style="margin-bottom: 0px; margin-bottom: .6rem; line-height: 1rem">Active time duration</p>
                <p class="normalContent" style="line-height: 1rem; margin-left: 2rem">- windline length</p>
            </div>


            <div style="display: flex; align-items: center; ">
                <img src="asset/svg/curve_shape5.svg"
                     style="display:inline-flex;width:4rem;height:auto;margin-right: 5px"/>
            </div>

        </div>
    </div>

</div>

<!------------------------------主体时间线部分------------------------------>


<div id="samaraTimelineEnter"></div>

<!--主体时间线部分-->
<div id="samaraTimeline" style="margin: 0 auto; opacity: 0; position: relative;">

    <div id="timelineStoryDiv" style="position:absolute;">
<!--        <div id="timelineStoryBoard1" class="timelineNote" style=" top:0px; left:100px" >-->
<!--            <p  class="normalContent">-->
<!--                1231231231-->
<!--            </p>-->
<!--            <img src="asset/svg/close.svg" style="height: .8rem; position: absolute; top: .2rem; right: .2rem;" onclick="closeTimelineStoryBoard(1)">-->
<!--        </div>-->
    </div>



    <!--    user-select: none; 设置无法选中文字；防止在拖动div操作的时候误操作   -->
    <div class="seedTooltip" id="seedTooltip" style="display: none; user-select: none; flex-direction: column; position: fixed; top: 0px; left: 0px">
        <!--display: flex-->
        <div style="margin: .4rem; font-size: 1em; display: flex; align-items: flex-end; flex-wrap: wrap;">
            <!--            <p style="margin: 0px">-->
            <!--                <span id="posterName" style="font-weight: bold">@poster</span>-->
            <!--                <span id="postFollower" style="color: #b7b7b7;font-size: 0.6em"> &nbsp 5.6M followers</span>-->
            <!--            </p>-->
            <div id="posterName" class="h3title fontHighlight" style="font-weight: bold; padding-right: .4rem; line-height: 1.2;">@poster</div>
            <div id="postFollower" class="normalContent" style="font-size: 0.6em"> 5.6M followers</div>
        </div>
        <div id="postContent" class="normalContent"
             style="font-size: 0.6em; margin-left: .4rem; margin-bottom: 0px; margin-right: .4rem; max-height: 7rem; overflow:auto;"
             content="#丰县将对失职渎职工作人员依法依规处理#很明显徐州丰县实力不如西安市，前者撤不了热搜，炸不了号，禁不了言。你看人家西安的骚操作，现在大家是不是都忘了地铁男保安扒光妇女，小伙儿买馒头被打、馒头撒一地，孕妇流产胎死腹中，拖延治疗心脏病患者致死，保安拒绝病人家属探望致父亲死前没见到女儿最后一面，和接诊病人的私立医院受到惩罚被关停整改、而拒诊病人的公立医院却正常营业的事件了？">
            123123123
        </div>
        <div id="emotionScaleDiv"
             style="margin-left: .4rem; margin-right: .4rem; margin-top: .4rem; display: none; justify-content: space-between; ">
            <!--display: flex-->
            <div style="display: flex; justify-content: space-between">

                <p class="normalContent" style="font-size: 0.6em; display: inline; margin-bottom: 0rem">negative</p>

                <div style="vertical-align: top; display: inline-flex; height: 1rem; position: relative">
                    <div class="emotionScale" id="emotionScaleBox"
                         style="left:160px;position: absolute; margin-top: -1px"></div>
                    <img src="asset/svg/gradient.svg" style="display:inline;width:7rem;height:auto;"/>
                </div>

                <p class="normalContent" style="font-size: 0.6em; display: inline; margin-bottom: 0rem">positive</p>

            </div>


<!--            <div class="normalContent" style="vertical-align: top; display: inline-flex;  line-height:24px; text-align:center; height: 24px">-->
<!--            </div>-->

<!--            <div class="normalContent" style="vertical-align: top; display: inline-flex;  line-height:24px; text-align:center; height: 24px">-->
<!--            </div>-->
        </div>
        <a id="showFullaTag" class="normalContent" href="javascript:void(0);" rel="external nofollow" onclick="showFull()"
           style="font-size: 0.6em; margin-left: .4rem; color: #eeb106; display: inline-flex">show more</a>
        <p id="postTime" class="normalContent" style="font-size: 0.6em; color: #b7b7b7; display: inline-flex; float: right;
    margin: .4rem 1.2rem 0px .4rem;">7:23 PM · Apr 14, 2022</p>


        <div class="divider-flex"></div>
        <div style="display: flex; justify-content: space-around;;/*水平居中*/">

            <div>
                <img src="asset/svg/retweet.svg" style="display:inline;width:1rem;height:1rem"/>
                <div id="postRetweet" class="normalContent" style="font-size: 0.6em; display: inline; ">123</div>
            </div>

            <div>
                <img src="asset/svg/like.svg" style="display:inline;width:1rem;height:1rem"/>
                <div id="postLike" class="normalContent" style="font-size: 0.6em; display: inline; ">123</div>
            </div>

            <div>
                <img src="asset/svg/comment.svg" style="display:inline;width:1rem;height:1rem"/>
                <div id="postComment" class="normalContent" style="font-size: 0.6em; display: inline; ">123</div>
            </div>

<!--            <div style="display: inline; margin-left: 20px; margin-right: 20px">-->
<!--                <div class="svgDiv">-->
<!--                    <img src="asset/svg/retweet.svg" style="display:inline;width:20px;height:20px"/>-->
<!--                </div>-->
<!--                <div style="display: inline-flex; line-height:24px; text-align:center; height: 24px; vertical-align: top">-->
<!--                    <div id="postRetweet" style="font-size: 0.4em; color: #b7b7b7; display: inline; ">123</div>-->
<!--                </div>-->
<!--            </div>-->

<!--            <div style="display: inline; margin-left: 20px; margin-right: 20px">-->
<!--                <div class="svgDiv">-->
<!--                    <img src="asset/svg/like.svg" style="display:inline;width:20px;height:20px"/>-->
<!--                </div>-->
<!--                <div style="display: inline-flex; line-height:24px; text-align:center; height: 24px; vertical-align: top">-->
<!--                    <div id="postLike" style="font-size: 0.4em; color: #b7b7b7; display: inline; ">123</div>-->
<!--                </div>-->
<!--            </div>-->

<!--            <div style="display: inline;  margin-left: 20px; margin-right: 20px">-->
<!--                <div class="svgDiv">-->
<!--                    <img src="asset/svg/comment.svg" style="display:inline;width:20px;height:20px"/>-->
<!--                </div>-->
<!--                <div style="display: inline-flex; line-height:24px; text-align:center; height: 24px; vertical-align: top">-->
<!--                    <div id="postComment" style="font-size: 0.4em; color: #b7b7b7; display: inline; ">123</div>-->
<!--                </div>-->
<!--            </div>-->


        </div>
    </div>

    <!--vane的tooltip-->
    <div class="seedTooltip" id="vaneTooltip"
         style="left: 6rem; display: none; flex-direction: column; user-select: none; z-index: 1; width: 14rem; padding: 1rem">

        <div style="margin: 0px; font-size: 1em; display: flex; align-items: flex-end; flex-wrap: wrap; color: #eeb106">
            <!--            <p style="margin: 0px">-->
            <!--                <span id="posterName" style="font-weight: bold">@poster</span>-->
            <!--                <span id="postFollower" style="color: #b7b7b7;font-size: 0.6em"> &nbsp 5.6M followers</span>-->
            <!--            </p>-->
            <div id="vaneTitle" class="h4title fontGrad45" style="font-weight: bold; padding-right: 8px; line-height: 1.2; width: 235px">Key Event · 1</div>
            <img id="hashtagLinkSvg" src="asset/svg/hashtag2.svg"
                 style="display:inline; width:26.4px; height:auto; margin-left: 5px" data-toggle="tooltip"
                 data-placement="right" title="click to jump to related hashtag" onclick="jumpToHashtag()"/>

        </div>

        <!--        <div id="vaneTitle" style="font-size: 0.9em; line-height: 1.2; font-weight: bold; margin: 10px 10px 0px;color: #eeb106"> Key Event · 1 </div>-->


        <div id="vaneSubTitle" class="normalContent" style="font-size: 0.7em; line-height: 1.2; font-weight: 500; margin-top: .5rem; margin-bottom: .5rem"> 丰县第一次通报
        </div>
        <div id="vaneContent" class="normalContent"
             style="font-size: 0.6em; max-height: 6rem; overflow: auto; margin-bottom: .5rem">
            发现网民反映“生育八孩女子”相关信息后，丰县县委、县政府迅速成立联合调查组进行全面调查。经初步调查核实，网民反映的女子为杨某侠，1998年8月与丰县欢口镇董某民领证结婚，<span
                style="color: #818181">不存在拐卖行为</span>。家人和邻居反映，杨某侠经常无故殴打孩子和老人。经医疗机构诊断，杨某侠患有精神疾病，目前，已对其进行救治，并对其家庭开展进一步救助，确保过上温暖的春节。具体情况正在进一步调查核实中。
        </div>

        <a id="showFullVane" href="javascript:void(0);" rel="external nofollow" onclick="showFullVane()" class="normalContent"
           style="font-size: 0.6em; color: #eeb106; display: inline-flex">show more</a>

        <div class="normalContent" style="font-size: 0.6em; color: #b7b7b7; float: right; margin: 10px;">
            <p id="vaneFrom" style="text-align: right; margin: 0px">中共丰县县委宣传部</p>
            <p id="vaneDate" style="text-align: right; margin: 0px">Jan 28, 2022</p>
        </div>

    </div>

    <!--hashtag的tooltip-->
    <div class="seedTooltip" id="hashtagTooltip"
         style="display: none; flex-direction: column; user-select: none; z-index: 1; padding: 1rem">

        <div class="h4title fontGrad45" style="display: flex; align-items: flex-end; flex-wrap: wrap; color: #eeb106; margin-bottom: 1rem">
            <div id="hashtagGroupNum" style="font-weight: bold; padding-right: 8px; line-height: 1.2;"> Hashtag Group ·
                1
            </div>
            <img id="jumpToKeyEventSvg" src="asset/svg/vane2.svg" style="display:inline; width:26.4px; height:auto; margin-left: 50px"
                 data-toggle="tooltip" data-placement="right" title="click to jump to related investigation report" onclick="jumpToKeyEvent()"/>
        </div>


        <div class="normalContent" id="hashtagGroupSubtitle" style="font-size: 0.7em; line-height: 1.2; margin-bottom: 1rem"> This
            hashtag group contains hashtags related to key event 1 (the first announcement of Fengxian)
        </div>
        <div id="hashtagGroupInclude" class="normalContent"
             style="font-size: 0.6em; color: #b7b7b7; max-height: 6rem; overflow: auto">
            included hashtags:<br>
            #丰县辟谣被拴破屋八孩母亲系拐卖 <br>
            #丰县回应八孩母亲被拴破屋 <br>
            #江苏丰县回应八孩母亲被拴破屋 <br>
            #官方回应八孩母亲被拴破屋疑遭家暴 <br>
            #官方回应徐州八孩母亲被拴破屋 <br>
            #官方通报生育八孩女子情况 <br>
            #丰县官方通报生育八孩女子情况 <br>
            #官方通报徐州丰县生育八孩女子情况 <br>
            #官方救治江苏八孩母亲 <br>
            #江苏丰县回应生育八孩女子情况 <br>
            #官方通报丰县生育8孩女子事件 <br>
        </div>

        <a id="showFullHashtag" href="javascript:void(0);" rel="external nofollow" onclick="showFullHashtag()"
           class="normalContentHighlight"
           style="font-size: 0.4em; display: inline-flex; margin-bottom: 0rem">show more</a>

    </div>

    <!--日期div-->
<!--    <div id="dateDiv" style="position: fixed; font-size: 0.75em; color: #eeb106; user-select: none">-->
<!--        Jan 28, 2022-->
<!--    </div>-->

    <!--    隐形div，用于点击seed事件之后阻隔与svg的交互   -->
    <div id="invisibleBlock" style="display: none; position: fixed;" onclick="blockDivOnClick()"></div>



</div>

<!--主体时间线之上所有的fixed元素-->
<div id="timelineSvgFixedItems" style="opacity: 0; display: none">
    <!--渐变过渡的遮挡部分-->
    <div>
        <!--不可点击部分-->
        <div id="gradRectBg" style="position: fixed; top: 0"></div>
        <div id="gradRectBg2" style="position: fixed; bottom: 0"></div>
        <!--    最后一个div是遮脚线     -->
        <div id="gradRectBg3" style="background: #141414; position: fixed; bottom: 0"></div>
    </div>

    <!--右侧滑条部分-->
    <div>
        <div style="position: fixed; display: flex; top: .6rem; right: 0px; font-size: 0.7em; line-height: 1.2; width: 5rem; margin-right: .4rem; user-select: none">

            <img src="asset/svg/left_arrow.svg" style="display:inline-flex;width:.4rem;height:auto;margin-right: .2rem" onclick="streamGraphTitlesLeftArr()"/>

            <p id="streamGraphTitle" class="normalContent" style="display: inline-flex; margin: 0px; text-align: center; max-width: 3.5rem">no. of hot posts</p>
            <!--   "number of hot posts" “times of view”, “times of discussion” and “number of originals-->

            <img src="asset/svg/right_arrow.svg" style="display:inline-flex;width:.4rem;height:auto;margin-left: .2rem" onclick="streamGraphTitlesRightArr()"/>


        </div>
        <!--右侧滑条-->
        <div id="streamGraphScroll" style="display:block; position: fixed; top:0px; right:calc(20rem / 24)">
            <div id="scrollViewBox" style="position:fixed;"></div>
            <div class="keyEventCir" id="keyEventCir0" style="opacity: 1" onclick="keyEventCirClick(0)" data-toggle="tooltip" data-bs-placement="left" title="Investigation Report 1 · county level"></div>
            <div class="keyEventCir" id="keyEventCir1" style="opacity: 0.4" onclick="keyEventCirClick(1)" data-toggle="tooltip" data-bs-placement="left" title="Investigation Report 2 · county level"></div>
            <div class="keyEventCir" id="keyEventCir2" style="opacity: 0.4" onclick="keyEventCirClick(2)" data-toggle="tooltip" data-bs-placement="left" title="Investigation Report 3 · city level"></div>
            <div class="keyEventCir" id="keyEventCir3" style="opacity: 0.4" onclick="keyEventCirClick(3)" data-toggle="tooltip" data-bs-placement="left" title="Investigation Report 4 · city level"></div>
            <div class="keyEventCir" id="keyEventCir4" style="opacity: 0.4" onclick="keyEventCirClick(4)" data-toggle="tooltip" data-bs-placement="left" title="Investigation Report 5 · provincial level"></div>
            <div class="keyEventCir" id="keyEventCir5" style="opacity: 0.4" onclick="keyEventCirClick(5)" data-toggle="tooltip" data-bs-placement="left" title="Investigation Report 6 · provincial level"></div>
        </div>
    </div>

    <!--more info (tooltip panel) icon -->
    <div>
        <img id="showTooltipOverlayImg" src="asset/svg/info.svg" style="position:fixed;width:2rem; top: 0px; right: 0px" onclick="showTooltipOverlay()"/>
    </div>

    <!--retrieve all story panels icon -->
    <div>
        <img id="showStoryPanelsImg" src="asset/svg/storyPanel.svg" style="position:fixed;width:1.4rem; top: 0px; right: 0px; margin-top: .4rem; opacity: .4" onclick="showTimelineStoryBoard()" data-toggle="tooltip" data-bs-placement="left"
             title="show all supplementary panels in the timeline"/>
    </div>

    <!--背景windline-->
    <div id="windLineBg" style="width: 96%; display: block; position: fixed; z-index: -1; opacity: 1"></div>
</div>


<div id="samaraTimelineExit"></div>




<!--主体时间线部分：覆盖的详细tooltip-->
<div id="overlayTooltip" class="seedTooltip" style="padding: 1rem 3rem; display: none; position: fixed; z-index: 2; height: 30rem; width: 66rem">
    <h1 class="fontGrad45 h2title" style="width: 12rem; margin-bottom: 1rem">How to read</h1>
    <div id="timelineTooltipPage1" style="display: block" >
        <div style="">
            <div style="margin-bottom: 1rem;">
                <h2 class="h4title fontHighlight" style="margin-bottom: 0px; margin-bottom: .6rem; line-height: 1rem"> <img src="asset/svg/hashtag.svg" style="display:inline-flex;width:1.8rem;height:auto; margin-left: -.5rem"/> Hashtag groups</h2>

                <p class="normalContent" style="opacity: 0.8">
                    Posts are categorized into 8 groups by the similarity of their hashtags.
                    And the ninth group on the right is for posts without hashtags.
                    All the posts from each group are presented in a <span class="normalContentHighlight">vertical timeline</span>, the more posts clustered at some time means more discussion under this hashtag topic at the moment.
                </p>

                <p class="normalContent"  style="opacity: 0.8">
                    Click the <span class="normalContentHighlight">hashtag icon</span> to explore details.
                </p>

            </div>

            <div style="margin-bottom: 1rem; margin-top: 1rem">
                <h2 class="h4title fontHighlight" style="margin-bottom: 0px; margin-bottom: .6rem; line-height: 1rem"> <img src="asset/svg/vane.svg" style="display:inline-flex;width:2.4rem;height:auto;margin-left: -0.5rem"/> Investigation reports</h2>

                <p class="normalContent"  style="opacity: 0.8">
                    While scrolling the timeline, the report that was released by authorities at that time shows up on the left and next to the posts.
                </p>

                <p class="normalContent"  style="opacity: 0.8">
                    Click the <span class="normalContentHighlight">wind vane icon</span> to see details.
                </p>

            </div>

            <div style="margin-bottom: 1rem; margin-top: 1rem">
                <h2 class="h4title fontHighlight" style="margin-bottom: 0px; margin-bottom: .6rem; line-height: 1rem"> <img src="asset/svg/stream_graph.svg" style="display:inline-flex;height:1.8rem;margin-right: .4rem"/> Stream graph</h2>

                <p class="normalContent"  style="opacity: 0.8">
                    The stream graph on the right offers a <span class="normalContentHighlight">global view </span>of all hashtag groups throughout 32 days in terms of “no. of hot posts”, “no. of view”, “no. of discussion” and “no. of original posters”
                </p>

                <p class="normalContent"  style="opacity: 0.8">
                    All the investigation reports are represented as <span class="normalContentHighlight">circles</span> near the stream graph. Click these circles to directly scroll to corresponding investigation report.
                </p>
            </div>

        </div>
    </div>
    
    <div id="timelineTooltipPage2" style="display:none;">
        <div>
            <h2 class="h4title fontHighlight" style="margin-bottom: 0px; margin-bottom: .6rem; line-height: 1rem">Samara seeds</h2>
            <p class="normalContent" style="opacity: 0.8">
                Each seed represents a popular Weibo post with the keyword “丰县(Fengxian)” from Jan 28, 2022 to Feb 28, 2022.
            </p>
            <div class="row">
                <div class="col-lg">
                    <!--follower Tooltip-->
                    <div style="margin-bottom: 38px">
                        <p class="normalContentHighlight" style="margin-bottom: .2rem"> Followers </p>
                        <p class="normalContent" style="font-size: .6rem; opacity: .6">Seed head size shows no. of
                            followers of the poster.</p>
                        <div id="followerTooltip"></div>
                        <div class="normalContent" style="font-size: 0.3em; display: flex; justify-content: space-between; padding-left: 4rem; padding-right: 9.5rem">
                            <p style="display: inline-flex; margin-bottom: 0px">≤10K</p>
                            <p style="display: inline-flex; margin-bottom: 0px">10K-1M</p>
                            <p style="display: inline-flex; margin-bottom: 0px">>1M</p>
                        </div>
                    </div>

                    <!--retweet Tooltip-->
                    <div style="margin-bottom: 20px">
                        <p class="normalContentHighlight" style="margin-bottom: .2rem"> Retweets </p>
                        <p class="normalContent" style="font-size: .6rem; opacity: .6">Seed stem length represents the
                            no. of retweets.</p>
                        <div id="retweetTooltip"></div>
                        <div class="normalContent" style="font-size: 0.3em; display: flex; justify-content: space-between; padding-left: 4rem; padding-right: 9rem">
                            <p style="display: inline-flex; margin-bottom: 0px; user-select: none;">≤500</p>
                            <div style="display: inline-flex;">
                                <p style="margin-bottom: 0px; user-select: none;">>500:</p>
                                <div id="retweetDragBg" style="background: #e5e1d9; opacity: 0.6; width:120px; height:6px; border-radius: 3px; justify-content: center; align-self: center; margin-left: 15px">
                                    <div id="retweetDragBox" style="position: relative; top: -1px; left: 0px; width: 12px; height: 8px; border-radius: 4px; background: #FFCA36; ">
                                        <p id="retweetNum" style="position:relative; top: 6px; user-select: none;display: none">500</p>
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>

                    <!--comment Tooltip-->
                    <div style="margin-bottom: 20px">
                        <p class="normalContentHighlight" style="margin-bottom: .2rem"> Comments </p>
                        <p class="normalContent" style="font-size: .6rem; opacity: .6">Wing pattern shows the no. of comments.
                            (hover on the seed head to see patterns)</p>
                        <div id="commentTooltip"></div>
                        <div class="normalContent" class="overlayTooltipcontent" style="font-size: 0.3em; display: flex; justify-content: space-between; padding-left: 4rem; padding-right: 9rem">
                            <p style="display: inline-flex; margin-bottom: 0px">≤10</p>
                            <p style="display: inline-flex; margin-bottom: 0px">10-100</p>
                            <p style="display: inline-flex; margin-bottom: 0px">>100</p>
                        </div>
                    </div>


                </div>

                <div class="col-lg">
                    <!--vlevel tooltip-->
                    <div style="margin-bottom: 20px">
                        <p class="normalContentHighlight" style="margin-bottom: .2rem"> Account Type </p>
                        <p class="normalContent" style="font-size: .6rem; opacity: .6">The dot(s) near the seed head indicates Weibo
                            account type of the poster.</p>
                        <div id="vlevelTooltip"></div>
                        <div class="normalContent" class="overlayTooltipcontent" style="font-size: 0.3em; display: flex; justify-content: space-between; padding-left: 1.2rem; padding-right: 5.5rem">
                            <p class="col-3 text-center" style="display: inline-flex; margin-bottom: 0px">Individual Lv.1</p>
                            <p class="col-3 text-center" style="display: inline-flex; margin-bottom: 0px">Individual Lv.2</p>
                            <p class="col-3 text-center" style="display: inline-flex; margin-bottom: 0px">Individual Lv.3</p>
                            <p class="col-3 text-center" style="display: inline-flex; margin-bottom: 0px">Enterprise Account</p>
                        </div>
                    </div>

                    <!--like tooltip-->
                    <div style="margin-bottom: 20px">
                        <p class="normalContentHighlight" style="margin-bottom: .2rem"> Likes </p>
                        <p class="normalContent" style="font-size: .6rem; opacity: .6">Seed wing width represents the
                            no. of likes.</p>
                        <div id="likeTooltip"></div>
                        <div class="normalContent" style="font-size: 0.3em; display: flex; justify-content: space-between; padding-left: 4rem; padding-right: 9rem">
                            <p style="display: inline-flex; margin-bottom: 0px; user-select: none;">≤5000</p>
                            <div style="display: inline-flex;">
                                <p style="margin-bottom: 0px; user-select: none;">>5000:</p>
                                <div id="likeDragBg" style="background: #e5e1d9; opacity: 0.6; width:120px; height:6px; border-radius: 3px; justify-content: center; align-self: center; margin-left: .4rem">
                                    <div id="likeDragBox" style="position: relative; top: -1px; left: 0px; width: 12px; height: 8px; border-radius: 4px; background: #FFCA36; ">
                                        <p id="likeNum" style="position:relative; top: 6px; user-select: none;display: none">5000</p>
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>

                    <!--emotion Tooltip-->
                    <div style="margin-bottom: 20px">
                        <p class="normalContentHighlight" style="margin-bottom: .2rem"> Sentiment </p>
                        <p class="normalContent" style="font-size: .6rem; opacity: .6">Seed head color represents the
                            sentiment of the post text. (hover to see the animation)</p>
                        <div id="emotionTooltip"></div>
                        <div class="normalContent" class="overlayTooltipcontent" style="font-size: 0.3em; display: flex; justify-content: space-between; padding-left: 2rem; padding-right: 12rem">
                            <p style="display: inline-flex; margin-bottom: 0px">negative</p>
                            <div style="display: inline-flex;">
                                <div id="emotionDragBg" style="background: #e5e1d9; opacity: 0.6; width:120px; height:6px; border-radius: 3px; justify-content: center; align-self: center; margin: 0px">
                                    <div id="emotionDragBox" style="position: relative; top: -1px; left: 54px; width: 12px; height: 8px; border-radius: 4px; background: #FFCA36; ">
                                        <p id="emotionNum" style="position:relative; top: 6px; user-select: none;display: none"></p>
                                    </div>
                                </div>
                            </div>
                            <p style="display: inline-flex; margin-bottom: 0px">positive</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!---翻页--->
    <div id="timelineOverlayTooltipPage" style="position: fixed; display: flex; flex-direction: row; align-items: center; margin: 1rem">
        <img id="timelineOverlayTooltipPageLeftArr" src="asset/svg/left_arrow.svg" style="height: .7rem; opacity: 0.2" onclick="changeTimelineTooltipPage(0)">
        <p id="timelineOverlayTooltipPageTxt" class="normalContent" style="margin-bottom: 0rem; margin-left: 1rem; margin-right: 1rem">1 / 2</p>
        <img id="timelineOverlayTooltipPageRightArr" src="asset/svg/right_arrow.svg" style="height: .7rem" onclick="changeTimelineTooltipPage(1)">

    </div>
</div>


<!--------------------- CTDC可视化 ---------------------->
<div style="margin-left: 20rem; margin-right: 20rem; margin-top: 4rem; margin-bottom: 2rem; ">
    <p class="h2title fontWhite" style="text-align: center; margin-bottom: 8rem">WE NEED MORE <span class="fontGrad45">WIND</span></p>

    <p class="normalContent">
        The case of this mother of 8 children is not alone. After this TikTok video went viral, another woman in Fengxian was found also <span class="normalContentHighlight">locked up, crawling on the ground</span>. Netizens also dug up from news reports that there were <span class="normalContentHighlight">many women bodies found in rivers of Fengxian</span>.
    </p>

    <p class="normalContent" style="margin-bottom: 4rem">
        And it’s not just in China, human trafficking is an <span class="normalContentHighlight">international problem</span>. An estimated <span class="normalContentHighlight">40.3M</span> victims are trapped in modern-day slavery(ILO, 2017). We absolutely need much more awareness, voices and most importantly, actions, towards human trafficking.
    </p>

    <p class="normalContent">
        This visualization reveals the distribution of human trafficking cases globally. Larger wind glyph indicates more human trafficking cases, thus needing more awareness, public voices and actions.
    </p>

    <p class="normalContent">
        Hover on wind glyphs and change filter options below to explore more.
    </p>

    <p class="normalContent" style="opacity: .6;">(credit: this visualization used data from <a class="fontHighlight" href="https://www.ctdatacollaborative.org/global-k-anonymized-dataset">COUNTER TRAFFICKING DATA COLLABORATIVE</a>) </p>
</div>


<!-- Create an element where the map will take place -->
<div id="windGlyphBlockDiv" style="position:fixed; display: none; z-index: 2" onclick="windGlyphBlockDivOnClk()"></div>

<!--悬停的tooltip-->
<div id="geoTooltip" class="seedTooltip"
     style="height: fit-content; width: 14rem; padding-left: 1rem; padding-right: 1.5rem; display: none; z-index: 3">
    <!--    <p id="geoCountryName">USA</p>-->
    <p id="geoCTDCCases" class="h2title fontGrad45" style="margin-bottom: 0px;">192</p>
    <p id="geoCTDCCasesContinent" class="normalContent" style="margin-bottom: 0px"> cases in these countries</p>
    <div>
        <!--        <div class="divider-flex" style="position: relative; top: 34px"></div>-->
        <div id="geoTpSvgDiv"
             style="display: flex; flex-direction: row; max-width: 10rem; overflow: auto; padding-bottom: 1rem; padding-left: 1rem; padding-right: 1rem">
        </div>

        <!--        <d-->
    </div>
</div>

<!--map绘制-->
<div style="z-index: 5" onclick="hideSubTabContent()">
    <svg id="svgCTDCMap"></svg>
</div>

<!--选择框-->
<div style="margin-top: -7rem; top: -8rem; z-index: 2">
    <div id="subContentBox" style="display: flex; justify-content: center;">
        <div id="geoSubTabContentDiv"
             style="display: flex; flex-direction: row; justify-content: center; visibility: hidden">
            <!--YEAR-->
            <div class="geoSubTabContent" style="border-top-left-radius: 0.3rem; width: 5rem;">

                <div class="detail-outside" style="margin-bottom: 1px; margin-top: .4rem;" onmouseover="mouseoverTabContent(d3.select(this))"
                     onmouseleave="mouseleaveTabContent(d3.select(this))"
                     onclick="mouseclickTabContent(d3.select(this), 'year', 2015)" data-toggle="tooltip" data-bs-placement="right"
                     title="2002 - 2015: 26473 cases">

                    <div id="yearColBar0" class="detail-basis" style="width: 80%;"></div>
                    <!--    <label data-v-89716f00="" class="discrete-label label">Aarhus University</label>-->

                    <div class="geoSubTabContentChoiceDivWrap discrete-label normalContent" style="position:absolute;">
                        <div class="geoSubTabContentChoiceBox" style="position:absolute; background-color: #7da9cc"></div>
                        <p class="geoSubTabContentChoice">before 2016</p>
                    </div>

                </div>


                <div class="detail-outside" style="margin-bottom: 1px; margin-top: .4rem;" onmouseover="mouseoverTabContent(d3.select(this))"
                     onmouseleave="mouseleaveTabContent(d3.select(this))"
                     onclick="mouseclickTabContent(d3.select(this), 'year', 2016)"data-toggle="tooltip" data-bs-placement="right"
                     title="2016: 18836 cases">

                    <div id="yearColBar1" class="detail-basis" style="width: 80%;"></div>
                    <!--    <label data-v-89716f00="" class="discrete-label label">Aarhus University</label>-->

                    <div class="geoSubTabContentChoiceDivWrap discrete-label normalContent" style="position:absolute;">
                        <div class="geoSubTabContentChoiceBox" style="position:absolute; background-color: #7da9cc"></div>
                        <p class="geoSubTabContentChoice">2016</p>
                    </div>

                </div>

                <div class="detail-outside" style="margin-bottom: 1px; margin-top: .4rem;" onmouseover="mouseoverTabContent(d3.select(this))"
                     onmouseleave="mouseleaveTabContent(d3.select(this))"
                     onclick="mouseclickTabContent(d3.select(this), 'year', 2017)" data-toggle="tooltip" data-bs-placement="right"
                     title="2017: 10391 cases">

                    <div id="yearColBar2" class="detail-basis" style="width: 80%;"></div>
                    <!--    <label data-v-89716f00="" class="discrete-label label">Aarhus University</label>-->

                    <div class="geoSubTabContentChoiceDivWrap discrete-label normalContent" style="position:absolute;">
                        <div class="geoSubTabContentChoiceBox" style="position:absolute; background-color: #7da9cc"></div>
                        <p class="geoSubTabContentChoice">2017</p>
                    </div>

                </div>

                <div class="detail-outside" style="margin-bottom: 1px; margin-top: .4rem;" onmouseover="mouseoverTabContent(d3.select(this))"
                     onmouseleave="mouseleaveTabContent(d3.select(this))"
                     onclick="mouseclickTabContent(d3.select(this), 'year', 2018)" data-toggle="tooltip" data-bs-placement="right"
                     title="2018: 18265 cases">

                    <div id="yearColBar3" class="detail-basis" style="width: 80%;"></div>
                    <!--    <label data-v-89716f00="" class="discrete-label label">Aarhus University</label>-->

                    <div class="geoSubTabContentChoiceDivWrap discrete-label normalContent" style="position:absolute;">
                        <div class="geoSubTabContentChoiceBox" style="position:absolute; background-color: #7da9cc"></div>
                        <p class="geoSubTabContentChoice">2018</p>
                    </div>

                </div>

                <div class="detail-outside" style="margin-bottom: 1px; margin-top: .4rem;" onmouseover="mouseoverTabContent(d3.select(this))"
                     onmouseleave="mouseleaveTabContent(d3.select(this))"
                     onclick="mouseclickTabContent(d3.select(this), 'year', 2019)" data-toggle="tooltip" data-bs-placement="right"
                     title="2019: 21312 cases">

                    <div id="yearColBar4" class="detail-basis" style="width: 80%;"></div>
                    <!--    <label data-v-89716f00="" class="discrete-label label">Aarhus University</label>-->

                    <div class="geoSubTabContentChoiceDivWrap discrete-label normalContent" style="position:absolute;">
                        <div class="geoSubTabContentChoiceBox" style="position:absolute; background-color: #7da9cc"></div>
                        <p class="geoSubTabContentChoice">2019</p>
                    </div>

                </div>

                <div class="detail-outside" style="margin-bottom: 1px; margin-top: .4rem;" onmouseover="mouseoverTabContent(d3.select(this))"
                     onmouseleave="mouseleaveTabContent(d3.select(this))"
                     onclick="mouseclickTabContent(d3.select(this), 'year', 2020)" data-toggle="tooltip" data-bs-placement="right"
                     title="2020: 1717 cases">

                    <div id="yearColBar5" class="detail-basis" style="width: 80%;"></div>
                    <!--    <label data-v-89716f00="" class="discrete-label label">Aarhus University</label>-->

                    <div class="geoSubTabContentChoiceDivWrap discrete-label normalContent" style="position:absolute;">
                        <div class="geoSubTabContentChoiceBox" style="position:absolute; background-color: #7da9cc"></div>
                        <p class="geoSubTabContentChoice">2020</p>
                    </div>

                </div>

                <div class="detail-outside" style="margin-bottom: 1px; margin-top: .4rem;" onmouseover="mouseoverTabContent(d3.select(this))"
                     onmouseleave="mouseleaveTabContent(d3.select(this))"
                     onclick="mouseclickTabContent(d3.select(this), 'year', 2021)" data-toggle="tooltip" data-bs-placement="right"
                     title="2021: 716 cases">

                    <div id="yearColBar6" class="detail-basis" style="width: 80%;"></div>
                    <!--    <label data-v-89716f00="" class="discrete-label label">Aarhus University</label>-->

                    <div class="geoSubTabContentChoiceDivWrap discrete-label normalContent" style="position:absolute;">
                        <div class="geoSubTabContentChoiceBox" style="position:absolute; background-color: #7da9cc"></div>
                        <p class="geoSubTabContentChoice">2021</p>
                    </div>

                </div>


            </div>

            <!--GENDER-->
            <div class="geoSubTabContent" style="width: 5rem">

                <div class="detail-outside" style="margin-bottom: 1px; margin-top: .4rem;" onmouseover="mouseoverTabContent(d3.select(this))"
                     onmouseleave="mouseleaveTabContent(d3.select(this))"
                     onclick="mouseclickTabContent(d3.select(this), 'gender', 0)" data-toggle="tooltip" data-bs-placement="right"
                     title="female: 68083 cases">

                    <div id="genderCol0" class="detail-basis" style="width: 80%;"></div>
                    <!--    <label data-v-89716f00="" class="discrete-label label">Aarhus University</label>-->

                    <div class="geoSubTabContentChoiceDivWrap discrete-label normalContent" style="position:absolute;">
                        <div class="geoSubTabContentChoiceBox" style="position:absolute; background-color: #7da9cc"></div>
                        <p class="geoSubTabContentChoice">female</p>
                    </div>

                </div>

                <div class="detail-outside" style="margin-bottom: 1px; margin-top: .4rem;" onmouseover="mouseoverTabContent(d3.select(this))"
                     onmouseleave="mouseleaveTabContent(d3.select(this))"
                     onclick="mouseclickTabContent(d3.select(this), 'gender', 1)" data-toggle="tooltip" data-bs-placement="right"
                     title="male: 21465 cases">

                    <div id="genderCol1" class="detail-basis" style="width: 80%;"></div>
                    <!--    <label data-v-89716f00="" class="discrete-label label">Aarhus University</label>-->

                    <div class="geoSubTabContentChoiceDivWrap discrete-label normalContent" style="position:absolute;">
                        <div class="geoSubTabContentChoiceBox" style="position:absolute; background-color: #7da9cc"></div>
                        <p class="geoSubTabContentChoice">male</p>
                    </div>

                </div>

                <div class="detail-outside" style="margin-bottom: 1px; margin-top: .4rem;" onmouseover="mouseoverTabContent(d3.select(this))"
                     onmouseleave="mouseleaveTabContent(d3.select(this))"
                     onclick="mouseclickTabContent(d3.select(this), 'gender', 2)" data-toggle="tooltip" data-bs-placement="right"
                     title="other/unknown: 8202 cases">

                    <div id="genderCol2" class="detail-basis" style="width: 80%;"></div>
                    <!--    <label data-v-89716f00="" class="discrete-label label">Aarhus University</label>-->

                    <div class="geoSubTabContentChoiceDivWrap discrete-label normalContent" style="position:absolute;">
                        <div class="geoSubTabContentChoiceBox" style="position:absolute; background-color: #7da9cc"></div>
                        <p class="geoSubTabContentChoice">other/unknown</p>
                    </div>

                </div>


            </div>

            <!--AGE-->
            <div class="geoSubTabContent" style="width: 5rem">
                <div class="detail-outside" style="margin-bottom: 1px; margin-top: .4rem;" onmouseover="mouseoverTabContent(d3.select(this))"
                     onmouseleave="mouseleaveTabContent(d3.select(this))"
                     onclick="mouseclickTabContent(d3.select(this), 'age', 0)" data-toggle="tooltip" data-bs-placement="right"
                     title="0 - 17: 14798 cases">

                    <div id="ageCol0" class="detail-basis" style="width: 80%;"></div>
                    <!--    <label data-v-89716f00="" class="discrete-label label">Aarhus University</label>-->

                    <div class="geoSubTabContentChoiceDivWrap discrete-label normalContent" style="position:absolute;">
                        <div class="geoSubTabContentChoiceBox" style="position:absolute; background-color: #7da9cc"></div>
                        <p class="geoSubTabContentChoice">0 - 17</p>
                    </div>

                </div>

                <div class="detail-outside" style="margin-bottom: 1px; margin-top: .4rem;" onmouseover="mouseoverTabContent(d3.select(this))"
                     onmouseleave="mouseleaveTabContent(d3.select(this))"
                     onclick="mouseclickTabContent(d3.select(this), 'age', 1)" data-toggle="tooltip" data-bs-placement="right"
                     title="18 - 29: 19599 cases">

                    <div id="ageCol1" class="detail-basis" style="width: 80%;"></div>
                    <!--    <label data-v-89716f00="" class="discrete-label label">Aarhus University</label>-->

                    <div class="geoSubTabContentChoiceDivWrap discrete-label normalContent" style="position:absolute;">
                        <div class="geoSubTabContentChoiceBox" style="position:absolute; background-color: #7da9cc"></div>
                        <p class="geoSubTabContentChoice">18 - 29</p>
                    </div>

                </div>

                <div class="detail-outside" style="margin-bottom: 1px; margin-top: .4rem;" onmouseover="mouseoverTabContent(d3.select(this))"
                     onmouseleave="mouseleaveTabContent(d3.select(this))"
                     onclick="mouseclickTabContent(d3.select(this), 'age', 2)" data-toggle="tooltip" data-bs-placement="right"
                     title="30 - 38: 10135 cases">

                    <div id="ageCol2" class="detail-basis" style="width: 80%;"></div>
                    <!--    <label data-v-89716f00="" class="discrete-label label">Aarhus University</label>-->

                    <div class="geoSubTabContentChoiceDivWrap discrete-label normalContent" style="position:absolute;">
                        <div class="geoSubTabContentChoiceBox" style="position:absolute; background-color: #7da9cc"></div>
                        <p class="geoSubTabContentChoice">30 - 38</p>
                    </div>

                </div>

                <div class="detail-outside" style="margin-bottom: 1px; margin-top: .4rem;" onmouseover="mouseoverTabContent(d3.select(this))"
                     onmouseleave="mouseleaveTabContent(d3.select(this))"
                     onclick="mouseclickTabContent(d3.select(this), 'age', 3)" data-toggle="tooltip" data-bs-placement="right"
                     title="38+ : 6435 cases">

                    <div id="ageCol3" class="detail-basis" style="width: 80%;"></div>
                    <!--    <label data-v-89716f00="" class="discrete-label label">Aarhus University</label>-->

                    <div class="geoSubTabContentChoiceDivWrap discrete-label normalContent" style="position:absolute;">
                        <div class="geoSubTabContentChoiceBox" style="position:absolute; background-color: #7da9cc"></div>
                        <p class="geoSubTabContentChoice">38+</p>
                    </div>

                </div>

                <div class="detail-outside" style="margin-bottom: 1px; margin-top: .4rem;" onmouseover="mouseoverTabContent(d3.select(this))"
                     onmouseleave="mouseleaveTabContent(d3.select(this))"
                     onclick="mouseclickTabContent(d3.select(this), 'age', 4)" data-toggle="tooltip" data-bs-placement="right"
                     title="unknown: 46783 cases">

                    <div id="ageCol4" class="detail-basis" style="width: 80%;"></div>
                    <!--    <label data-v-89716f00="" class="discrete-label label">Aarhus University</label>-->

                    <div class="geoSubTabContentChoiceDivWrap discrete-label normalContent" style="position:absolute;">
                        <div class="geoSubTabContentChoiceBox" style="position:absolute; background-color: #7da9cc"></div>
                        <p class="geoSubTabContentChoice">unknown</p>
                    </div>

                </div>


            </div>

            <!--means of control-->
            <div class="geoSubTabContent" style="width: 9rem">

                <div class="detail-outside" style="margin-bottom: 1px; margin-top: .4rem;" onmouseover="mouseoverTabContent(d3.select(this))"
                     onmouseleave="mouseleaveTabContent(d3.select(this))"
                     onclick="mouseclickTabContent(d3.select(this), 'means', 0)" data-toggle="tooltip" data-bs-placement="right"
                     title="restricts movement/medical care: 13731 cases">

                    <div id="crlCol0" class="detail-basis" style="width: 80%;"></div>
                    <!--    <label data-v-89716f00="" class="discrete-label label">Aarhus University</label>-->

                    <div class="geoSubTabContentChoiceDivWrap discrete-label normalContent" style="position:absolute;">
                        <div class="geoSubTabContentChoiceBox" style="position:absolute; background-color: #7da9cc"></div>
                        <p class="geoSubTabContentChoice">restricts movement/medical care</p>
                    </div>

                </div>


                <div class="detail-outside" style="margin-bottom: 1px; margin-top: .4rem;" onmouseover="mouseoverTabContent(d3.select(this))"
                     onmouseleave="mouseleaveTabContent(d3.select(this))"
                     onclick="mouseclickTabContent(d3.select(this), 'means', 1)" data-toggle="tooltip" data-bs-placement="right"
                     title="debt bondage: 4065 cases">

                    <div id="crlCol1" class="detail-basis" style="width: 80%;"></div>
                    <!--    <label data-v-89716f00="" class="discrete-label label">Aarhus University</label>-->

                    <div class="geoSubTabContentChoiceDivWrap discrete-label normalContent" style="position:absolute;">
                        <div class="geoSubTabContentChoiceBox" style="position:absolute; background-color: rgba(222,227,231,0.4)"></div>
                        <p class="geoSubTabContentChoice">debt bondage</p>
                    </div>

                </div>

                <div class="detail-outside" style="margin-bottom: 1px; margin-top: .4rem;" onmouseover="mouseoverTabContent(d3.select(this))"
                     onmouseleave="mouseleaveTabContent(d3.select(this))"
                     onclick="mouseclickTabContent(d3.select(this), 'means', 2)" data-toggle="tooltip" data-bs-placement="right"
                     title="take earnings: 8853 cases">

                    <div id="crlCol2" class="detail-basis" style="width: 80%;"></div>
                    <!--    <label data-v-89716f00="" class="discrete-label label">Aarhus University</label>-->

                    <div class="geoSubTabContentChoiceDivWrap discrete-label normalContent" style="position:absolute;">
                        <div class="geoSubTabContentChoiceBox" style="position:absolute; background-color: rgba(222,227,231,0.4)"></div>
                        <p class="geoSubTabContentChoice">take earnings</p>
                    </div>

                </div>

                <div class="detail-outside" style="margin-bottom: 1px; margin-top: .4rem;" onmouseover="mouseoverTabContent(d3.select(this))"
                     onmouseleave="mouseleaveTabContent(d3.select(this))"
                     onclick="mouseclickTabContent(d3.select(this), 'means', 3)" data-toggle="tooltip" data-bs-placement="right"
                     title="threats: 17431 cases">

                    <div id="crlCol3" class="detail-basis" style="width: 80%;"></div>
                    <!--    <label data-v-89716f00="" class="discrete-label label">Aarhus University</label>-->

                    <div class="geoSubTabContentChoiceDivWrap discrete-label normalContent" style="position:absolute;">
                        <div class="geoSubTabContentChoiceBox" style="position:absolute; background-color: rgba(222,227,231,0.4)"></div>
                        <p class="geoSubTabContentChoice">threats</p>
                    </div>

                </div>

                <div class="detail-outside" style="margin-bottom: 1px; margin-top: .4rem;" onmouseover="mouseoverTabContent(d3.select(this))"
                     onmouseleave="mouseleaveTabContent(d3.select(this))"
                     onclick="mouseclickTabContent(d3.select(this), 'means', 4)" data-toggle="tooltip" data-bs-placement="right"
                     title="psychological abuse: 12313 cases">

                    <div id="crlCol4" class="detail-basis" style="width: 80%;"></div>
                    <!--    <label data-v-89716f00="" class="discrete-label label">Aarhus University</label>-->

                    <div class="geoSubTabContentChoiceDivWrap discrete-label normalContent" style="position:absolute;">
                        <div class="geoSubTabContentChoiceBox" style="position:absolute; background-color: rgba(222,227,231,0.4)"></div>
                        <p class="geoSubTabContentChoice">psychological abuse</p>
                    </div>

                </div>

                <div class="detail-outside" style="margin-bottom: 1px; margin-top: .4rem;" onmouseover="mouseoverTabContent(d3.select(this))"
                     onmouseleave="mouseleaveTabContent(d3.select(this))"
                     onclick="mouseclickTabContent(d3.select(this), 'means', 5)" data-toggle="tooltip" data-bs-placement="right"
                     title="physical/sexual abuse: 12662 cases">

                    <div id="crlCol5" class="detail-basis" style="width: 80%;"></div>
                    <!--    <label data-v-89716f00="" class="discrete-label label">Aarhus University</label>-->

                    <div class="geoSubTabContentChoiceDivWrap discrete-label normalContent" style="position:absolute;">
                        <div class="geoSubTabContentChoiceBox" style="position:absolute; background-color: rgba(222,227,231,0.4)"></div>
                        <p class="geoSubTabContentChoice">physical/sexual abuse</p>
                    </div>

                </div>

                <div class="detail-outside" style="margin-bottom: 1px; margin-top: .4rem;" onmouseover="mouseoverTabContent(d3.select(this))"
                     onmouseleave="mouseleaveTabContent(d3.select(this))"
                     onclick="mouseclickTabContent(d3.select(this), 'means', 6)" data-toggle="tooltip" data-bs-placement="right"
                     title="false promises: 6177 cases">

                    <div id="crlCol6" class="detail-basis" style="width: 80%;"></div>
                    <!--    <label data-v-89716f00="" class="discrete-label label">Aarhus University</label>-->

                    <div class="geoSubTabContentChoiceDivWrap discrete-label normalContent" style="position:absolute;">
                        <div class="geoSubTabContentChoiceBox" style="position:absolute; background-color: rgba(222,227,231,0.4)"></div>
                        <p class="geoSubTabContentChoice">false promises</p>
                    </div>

                </div>

                <div class="detail-outside" style="margin-bottom: 1px; margin-top: .4rem;" onmouseover="mouseoverTabContent(d3.select(this))"
                     onmouseleave="mouseleaveTabContent(d3.select(this))"
                     onclick="mouseclickTabContent(d3.select(this), 'means', 7)" data-toggle="tooltip" data-bs-placement="right"
                     title="psychoactive substances: 6072 cases">

                    <div id="crlCol7" class="detail-basis" style="width: 80%;"></div>
                    <!--    <label data-v-89716f00="" class="discrete-label label">Aarhus University</label>-->

                    <div class="geoSubTabContentChoiceDivWrap discrete-label normalContent" style="position:absolute;">
                        <div class="geoSubTabContentChoiceBox" style="position:absolute; background-color: rgba(222,227,231,0.4)"></div>
                        <p class="geoSubTabContentChoice">psychoactive substances</p>
                    </div>

                </div>

                <div class="detail-outside" style="margin-bottom: 1px; margin-top: .4rem;" onmouseover="mouseoverTabContent(d3.select(this))"
                     onmouseleave="mouseleaveTabContent(d3.select(this))"
                     onclick="mouseclickTabContent(d3.select(this), 'means', 8)" data-toggle="tooltip" data-bs-placement="right"
                     title="excessive working hours: 6222 cases">

                    <div id="crlCol8" class="detail-basis" style="width: 80%;"></div>
                    <!--    <label data-v-89716f00="" class="discrete-label label">Aarhus University</label>-->

                    <div class="geoSubTabContentChoiceDivWrap discrete-label normalContent" style="position:absolute;">
                        <div class="geoSubTabContentChoiceBox" style="position:absolute; background-color: rgba(222,227,231,0.4)"></div>
                        <p class="geoSubTabContentChoice">excessive working hours</p>
                    </div>

                </div>

                <div class="detail-outside" style="margin-bottom: 1px; margin-top: .4rem;" onmouseover="mouseoverTabContent(d3.select(this))"
                     onmouseleave="mouseleaveTabContent(d3.select(this))"
                     onclick="mouseclickTabContent(d3.select(this), 'means', 9)" data-toggle="tooltip" data-bs-placement="right"
                     title="withhold necessities/documents: 10140 cases">

                    <div id="crlCol9" class="detail-basis" style="width: 80%;"></div>
                    <!--    <label data-v-89716f00="" class="discrete-label label">Aarhus University</label>-->

                    <div class="geoSubTabContentChoiceDivWrap discrete-label normalContent" style="position:absolute;">
                        <div class="geoSubTabContentChoiceBox" style="position:absolute; background-color: rgba(222,227,231,0.4)"></div>
                        <p class="geoSubTabContentChoice">withhold necessities/documents</p>
                    </div>

                </div>

                <div class="detail-outside" style="margin-bottom: 1px; margin-top: .4rem;" onmouseover="mouseoverTabContent(d3.select(this))"
                     onmouseleave="mouseleaveTabContent(d3.select(this))"
                     onclick="mouseclickTabContent(d3.select(this), 'means', 10)" data-toggle="tooltip" data-bs-placement="right"
                     title="other/unknown: 58912 cases">

                    <div id="crlCol10" class="detail-basis" style="width: 80%;"></div>
                    <!--    <label data-v-89716f00="" class="discrete-label label">Aarhus University</label>-->

                    <div class="geoSubTabContentChoiceDivWrap discrete-label normalContent" style="position:absolute;">
                        <div class="geoSubTabContentChoiceBox" style="position:absolute; background-color: rgba(222,227,231,0.4)"></div>
                        <p class="geoSubTabContentChoice">other/unknown</p>
                    </div>

                </div>


            </div>

            <!--type of exploit-->
            <div class="geoSubTabContent" style="width: 8rem">

                <div class="detail-outside" style="margin-bottom: 1px; margin-top: .4rem;" onmouseover="mouseoverTabContent(d3.select(this))"
                     onmouseleave="mouseleaveTabContent(d3.select(this))"
                     onclick="mouseclickTabContent(d3.select(this), 'exploit', 0)" data-toggle="tooltip" data-bs-placement="right"
                     title="forced labor: 19980 cases">

                    <div id="expCol0" class="detail-basis" style="width: 80%;"></div>
                    <!--    <label data-v-89716f00="" class="discrete-label label">Aarhus University</label>-->

                    <div class="geoSubTabContentChoiceDivWrap discrete-label normalContent" style="position:absolute;">
                        <div class="geoSubTabContentChoiceBox" style="position:absolute; background-color: #7da9cc"></div>
                        <p class="geoSubTabContentChoice">forced labor</p>
                    </div>

                </div>

                <div class="detail-outside" style="margin-bottom: 1px; margin-top: .4rem;" onmouseover="mouseoverTabContent(d3.select(this))"
                     onmouseleave="mouseleaveTabContent(d3.select(this))"
                     onclick="mouseclickTabContent(d3.select(this), 'exploit', 1)" data-toggle="tooltip" data-bs-placement="right"
                     title="sexual exploit: 45582 cases">

                    <div id="expCol1" class="detail-basis" style="width: 80%;"></div>
                    <!--    <label data-v-89716f00="" class="discrete-label label">Aarhus University</label>-->

                    <div class="geoSubTabContentChoiceDivWrap discrete-label normalContent" style="position:absolute;">
                        <div class="geoSubTabContentChoiceBox" style="position:absolute; background-color: #7da9cc"></div>
                        <p class="geoSubTabContentChoice">sexual exploit</p>
                    </div>

                </div>

                <div class="detail-outside" style="margin-bottom: 1px; margin-top: .4rem;" onmouseover="mouseoverTabContent(d3.select(this))"
                     onmouseleave="mouseleaveTabContent(d3.select(this))"
                     onclick="mouseclickTabContent(d3.select(this), 'exploit', 2)" data-toggle="tooltip" data-bs-placement="right"
                     title="slavery & practices: 385 cases">

                    <div id="expCol2" class="detail-basis" style="width: 80%;"></div>
                    <!--    <label data-v-89716f00="" class="discrete-label label">Aarhus University</label>-->

                    <div class="geoSubTabContentChoiceDivWrap discrete-label normalContent" style="position:absolute;">
                        <div class="geoSubTabContentChoiceBox" style="position:absolute; background-color: #7da9cc"></div>
                        <p class="geoSubTabContentChoice">slavery & practices</p>
                    </div>

                </div>

                <div class="detail-outside" style="margin-bottom: 1px; margin-top: .4rem;" onmouseover="mouseoverTabContent(d3.select(this))"
                     onmouseleave="mouseleaveTabContent(d3.select(this))"
                     onclick="mouseclickTabContent(d3.select(this), 'exploit', 3)" data-toggle="tooltip" data-bs-placement="right"
                     title="forced marriage: 242 cases">

                    <div id="expCol3" class="detail-basis" style="width: 80%;"></div>
                    <!--    <label data-v-89716f00="" class="discrete-label label">Aarhus University</label>-->

                    <div class="geoSubTabContentChoiceDivWrap discrete-label normalContent" style="position:absolute;">
                        <div class="geoSubTabContentChoiceBox" style="position:absolute; background-color: #7da9cc"></div>
                        <p class="geoSubTabContentChoice">forced marriage</p>
                    </div>

                </div>

                <div class="detail-outside" style="margin-bottom: 1px; margin-top: .4rem;" onmouseover="mouseoverTabContent(d3.select(this))"
                     onmouseleave="mouseleaveTabContent(d3.select(this))"
                     onclick="mouseclickTabContent(d3.select(this), 'exploit', 4)" data-toggle="tooltip" data-bs-placement="right"
                     title="sex & labour: 1412 cases">

                    <div id="expCol4" class="detail-basis" style="width: 80%;"></div>
                    <!--    <label data-v-89716f00="" class="discrete-label label">Aarhus University</label>-->

                    <div class="geoSubTabContentChoiceDivWrap discrete-label normalContent" style="position:absolute;">
                        <div class="geoSubTabContentChoiceBox" style="position:absolute; background-color: #7da9cc"></div>
                        <p class="geoSubTabContentChoice">sex & labour</p>
                    </div>

                </div>

                <div class="detail-outside" style="margin-bottom: 1px; margin-top: .4rem;" onmouseover="mouseoverTabContent(d3.select(this))"
                     onmouseleave="mouseleaveTabContent(d3.select(this))"
                     onclick="mouseclickTabContent(d3.select(this), 'exploit', 5)" data-toggle="tooltip" data-bs-placement="right"
                     title="other/unknown: 7105 cases">

                    <div id="expCol5" class="detail-basis" style="width: 80%;"></div>
                    <!--    <label data-v-89716f00="" class="discrete-label label">Aarhus University</label>-->

                    <div class="geoSubTabContentChoiceDivWrap discrete-label normalContent" style="position:absolute;">
                        <div class="geoSubTabContentChoiceBox" style="position:absolute; background-color: #7da9cc"></div>
                        <p class="geoSubTabContentChoice">other/unknown</p>
                    </div>

                </div>

            </div>

            <!--type of labour-->
            <div class="geoSubTabContent" style="width: 9rem">

                <div class="detail-outside" style="margin-bottom: 1px; margin-top: .4rem;" onmouseover="mouseoverTabContent(d3.select(this))"
                     onmouseleave="mouseleaveTabContent(d3.select(this))"
                     onclick="mouseclickTabContent(d3.select(this), 'labor', 0)" data-toggle="tooltip" data-bs-placement="right"
                     title="agriculture: 3580 cases">

                    <div id="labCol0" class="detail-basis" style="width: 80%;"></div>
                    <!--    <label data-v-89716f00="" class="discrete-label label">Aarhus University</label>-->

                    <div class="geoSubTabContentChoiceDivWrap discrete-label normalContent" style="position:absolute;">
                        <div class="geoSubTabContentChoiceBox" style="position:absolute; background-color: #7da9cc"></div>
                        <p class="geoSubTabContentChoice">agriculture</p>
                    </div>

                </div>

                <div class="detail-outside" style="margin-bottom: 1px; margin-top: .4rem;" onmouseover="mouseoverTabContent(d3.select(this))"
                     onmouseleave="mouseleaveTabContent(d3.select(this))"
                     onclick="mouseclickTabContent(d3.select(this), 'labor', 1)" data-toggle="tooltip" data-bs-placement="right"
                     title="construction: 2020 cases">

                    <div id="labCol1" class="detail-basis" style="width: 80%;"></div>
                    <!--    <label data-v-89716f00="" class="discrete-label label">Aarhus University</label>-->

                    <div class="geoSubTabContentChoiceDivWrap discrete-label normalContent" style="position:absolute;">
                        <div class="geoSubTabContentChoiceBox" style="position:absolute; background-color: #7da9cc"></div>
                        <p class="geoSubTabContentChoice">construction</p>
                    </div>

                </div>

                <div class="detail-outside" style="margin-bottom: 1px; margin-top: .4rem;" onmouseover="mouseoverTabContent(d3.select(this))"
                     onmouseleave="mouseleaveTabContent(d3.select(this))"
                     onclick="mouseclickTabContent(d3.select(this), 'labor', 2)" data-toggle="tooltip" data-bs-placement="right"
                     title="domestic work: 3505 cases">

                    <div id="labCol2" class="detail-basis" style="width: 80%;"></div>
                    <!--    <label data-v-89716f00="" class="discrete-label label">Aarhus University</label>-->

                    <div class="geoSubTabContentChoiceDivWrap discrete-label normalContent" style="position:absolute;">
                        <div class="geoSubTabContentChoiceBox" style="position:absolute; background-color: #7da9cc"></div>
                        <p class="geoSubTabContentChoice">domestic work</p>
                    </div>

                </div>

                <div class="detail-outside" style="margin-bottom: 1px; margin-top: .4rem;" onmouseover="mouseoverTabContent(d3.select(this))"
                     onmouseleave="mouseleaveTabContent(d3.select(this))"
                     onclick="mouseclickTabContent(d3.select(this), 'labor', 3)" data-toggle="tooltip" data-bs-placement="right"
                     title="manufacturing: 760 cases">

                    <div id="labCol3" class="detail-basis" style="width: 80%;"></div>
                    <!--    <label data-v-89716f00="" class="discrete-label label">Aarhus University</label>-->

                    <div class="geoSubTabContentChoiceDivWrap discrete-label normalContent" style="position:absolute;">
                        <div class="geoSubTabContentChoiceBox" style="position:absolute; background-color: #7da9cc"></div>
                        <p class="geoSubTabContentChoice">manufacturing</p>
                    </div>

                </div>
                <div class="detail-outside" style="margin-bottom: 1px; margin-top: .4rem;" onmouseover="mouseoverTabContent(d3.select(this))"
                     onmouseleave="mouseleaveTabContent(d3.select(this))"
                     onclick="mouseclickTabContent(d3.select(this), 'labor', 4)" data-toggle="tooltip" data-bs-placement="right"
                     title="hospitality: 821 cases">

                    <div id="labCol4" class="detail-basis" style="width: 80%;"></div>
                    <!--    <label data-v-89716f00="" class="discrete-label label">Aarhus University</label>-->

                    <div class="geoSubTabContentChoiceDivWrap discrete-label normalContent" style="position:absolute;">
                        <div class="geoSubTabContentChoiceBox" style="position:absolute; background-color: #7da9cc"></div>
                        <p class="geoSubTabContentChoice">hospitality</p>
                    </div>

                </div>

                <div class="detail-outside" style="margin-bottom: 1px; margin-top: .4rem;" onmouseover="mouseoverTabContent(d3.select(this))"
                     onmouseleave="mouseleaveTabContent(d3.select(this))"
                     onclick="mouseclickTabContent(d3.select(this), 'labor', 5)" data-toggle="tooltip" data-bs-placement="right"
                     title="other/unknown: 6054 cases">

                    <div id="labCol5" class="detail-basis" style="width: 80%;"></div>
                    <!--    <label data-v-89716f00="" class="discrete-label label">Aarhus University</label>-->

                    <div class="geoSubTabContentChoiceDivWrap discrete-label normalContent" style="position:absolute;">
                        <div class="geoSubTabContentChoiceBox" style="position:absolute; background-color: #7da9cc"></div>
                        <p class="geoSubTabContentChoice">other/unknown</p>
                    </div>

                </div>


            </div>

            <!--type of sex-->
            <div class="geoSubTabContent" style="border-top-right-radius: 0.3rem; width: 9rem">

                <div class="detail-outside" style="margin-bottom: 1px; margin-top: .4rem;" onmouseover="mouseoverTabContent(d3.select(this))"
                     onmouseleave="mouseleaveTabContent(d3.select(this))"
                     onclick="mouseclickTabContent(d3.select(this), 'sex', 0)" data-toggle="tooltip" data-bs-placement="right"
                     title="prostitution: 13287 cases">

                    <div id="sexCol0" class="detail-basis" style="width: 80%;"></div>
                    <!--    <label data-v-89716f00="" class="discrete-label label">Aarhus University</label>-->

                    <div class="geoSubTabContentChoiceDivWrap discrete-label normalContent" style="position:absolute;">
                        <div class="geoSubTabContentChoiceBox" style="position:absolute; background-color: #7da9cc"></div>
                        <p class="geoSubTabContentChoice">prostitution</p>
                    </div>

                </div>


                <div class="detail-outside" style="margin-bottom: 1px; margin-top: .4rem;" onmouseover="mouseoverTabContent(d3.select(this))"
                     onmouseleave="mouseleaveTabContent(d3.select(this))"
                     onclick="mouseclickTabContent(d3.select(this), 'sex', 1)" data-toggle="tooltip" data-bs-placement="right"
                     title="pornography: 1866 cases">

                    <div id="sexCol1" class="detail-basis" style="width: 80%;"></div>
                    <!--    <label data-v-89716f00="" class="discrete-label label">Aarhus University</label>-->

                    <div class="geoSubTabContentChoiceDivWrap discrete-label normalContent" style="position:absolute;">
                        <div class="geoSubTabContentChoiceBox" style="position:absolute; background-color: #7da9cc"></div>
                        <p class="geoSubTabContentChoice">pornography</p>
                    </div>

                </div>


                <div class="detail-outside" style="margin-bottom: 1px; margin-top: .4rem;" onmouseover="mouseoverTabContent(d3.select(this))"
                     onmouseleave="mouseleaveTabContent(d3.select(this))"
                     onclick="mouseclickTabContent(d3.select(this), 'sex', 2)" data-toggle="tooltip" data-bs-placement="right"
                     title="other: 605 cases">

                    <div id="sexCol2" class="detail-basis" style="width: 80%;"></div>
                    <!--    <label data-v-89716f00="" class="discrete-label label">Aarhus University</label>-->

                    <div class="geoSubTabContentChoiceDivWrap discrete-label normalContent" style="position:absolute;">
                        <div class="geoSubTabContentChoiceBox" style="position:absolute; background-color: #7da9cc"></div>
                        <p class="geoSubTabContentChoice">other/unknown</p>
                    </div>

                </div>


            </div>
        </div>
    </div>

    <div style="display: flex; justify-content: center; z-index: 2">
        <div style="display: flex; flex-direction: row; justify-content: center;" onclick="showSubTabContent()">
            <div id="geoSubTabLeftMost" class="geoSubTab"
                 style="border-bottom-left-radius: 0.3rem; border-top-left-radius: 0.3rem; width: 5rem">
                <p class="normalContent" style="margin: 0rem"> YEAR </p>
            </div>
            <div class="geoSubTab" style="width: 5rem">
                <p class="normalContent" style="margin: 0rem"> GENDER </p>
            </div>
            <div class="geoSubTab" style="width: 5rem">
                <p class="normalContent" style="margin: 0rem"> AGE </p>
            </div>
            <div class="geoSubTab" style="width: 9rem">
                <p class="normalContent" style="margin: 0rem"> MEANS OF CONTROL </p>
            </div>
            <div class="geoSubTab" style="width: 8rem">
                <p class="normalContent" style="margin: 0rem"> TYPE OF EXPLOIT </p>
            </div>
            <div class="geoSubTab" style="width: 9rem">
                <p class="normalContent" style="margin: 0rem"> TYPE OF LABOUR </p>
            </div>
            <div id="geoSubTabRightMost" class="geoSubTab"
                 style="border-bottom-right-radius: 0.3rem; border-top-right-radius: 0.3rem; width: 9rem">
                <p class="normalContent" style="margin: 0rem"> TYPE OF SEX </p>
            </div>
        </div>
    </div>
</div>


<!--blockdiv-->
<div id="ctdcMapDiv" style="display: none; position: fixed; z-index: -1" onclick="hideSubTabContent()"></div>






<!--------------------- 反思 ---------------------->

<div style="margin-left: 20rem; margin-right: 20rem; margin-top: 16rem; margin-bottom: 15rem; ">
    <img src="asset/img/wenge.png"
         style="position: absolute; width: 20rem; transform: translate(-20rem, 8rem); margin-top: -5rem">
    <img src="asset/img/arr1.png"
         style="position: absolute; width: 20rem; transform: translate(-14rem, 11rem)scale(0.15)rotate(45deg); margin-top: -5rem; opacity: .6">
    <p class="captionContent"
       style="position: absolute; width: 12rem;transform: translate(-16rem, 22rem); margin-top: -5rem">The Great
        Proletarian Cultural Revolution, the darkest age of Modern China, when millions of people suffered from
        political persecution</p>
    <img src="asset/img/postTruth.png"
         style="position: absolute; right: 0; width: 15rem;margin-top: -2rem; transform: translate(-2rem, 25rem);opacity: .7">
    <img src="asset/img/arr2.png"
         style="position: absolute; width: 20rem; transform: translate(25rem, 10rem)scale(0.1); margin-top: -5rem; opacity: .6">
    <div class="captionContent"
         style="position: absolute; width: 12rem;transform: translate(37rem, 42rem); margin-top: -5rem">
        <p style="margin-bottom: .5rem">
            Post-truth is a time when "objective facts are less influential in shaping public opinion than appeals to emotion and personal
            belief" <a href="https://languages.oup.com/word-of-the-year/2016/" target="_blank" class="fontHighlight">(by Oxford dictionaries)</a>
        </p>
        <p>
            (credit: cartoon from <a class="fontHighlight" href="https://twitter.com/martinshovel/status/804968341471457280" target="_blank" >Martin Shovel</a> on Twitter)
        </p>

    </div>



    <p class="h2title" style="text-align: center; margin-bottom: 8rem"><span class="fontGrad45">REFLECTION</span></p>

    <p class="h3title fontWhite_light" style="margin-bottom: 2rem; text-align: center; text-decoration: underline">
        Public Opinion and State Governance Complement Each Other</p>
    <p class="normalContent"><span class="normalContentHighlight">"We don't have enough to eat".</span> My grandfather
        spent 10 years in jail simply because he spoke out true condition of their lives.</p>
    <p class="normalContent">Today no wonder we live in a society that allows more freedom of speech. Yet we still see
        authorities censor politically sensitive topics heavily by deleting posts and accounts, banning articles,
        controlling trendings, etc. </p>
    <p class="normalContent">Instead of being afraid of or turning a deaf ear to public voices, the government should
        embrace them, and make positive changes. Public voice CAN make a difference, <span
                class="normalContentHighlight">it's not just about saving victims of human trafficking, it's about eliminating social injustice and prejudice.</span>
    </p>

    <p class="h3title fontWhite_light"
       style="margin-bottom: 2rem; text-align: center; margin-top: 4rem; text-decoration: underline">Think Twice of What
        You Say</p>
    <p class="normalContent">Powerful as public voice is, we should remind ourselves not to fall into the trap of <span
            class="normalContentHighlight">post-truth</span>.
        And let our <span class="normalContentHighlight">rationality</span> and <span class="normalContentHighlight">conscience</span> guide us, rather than irrational emotion and bias.</p>

</div>


<!--------------------- method ---------------------->

<div style="margin-left: 20rem; margin-right: 20rem; margin-top: 16rem; margin-bottom: 15rem; border: 1px solid rgba(255, 255, 255, 0.75); padding: 2rem">
    <p class="h3title fontWhite_light" style="text-align: center; margin-bottom: 2rem">DATA & METHODS</p>
    <p class="normalContent">
        This visualization work mainly utilized data of 4,725 posts, 142 hashtags, and over 97,750 victims of human trafficking.
    </p>

    <p class="normalContent">
        I collected popular posts with the keyword "丰县(fengxian)" and hashtags with over 10k views on Weibo by <span class="normalContentHighlight">Python crawler script</span>. You can view the raw data <a class="fontHighlight" href="https://github.com/YueChengPeng/Fengxian_Visualization_Project_2022/tree/master/data" target="_blank">here</a> on my Github page. For posts, I
        used <a class="fontHighlight" href="https://ai.baidu.com/tech/nlp_apply/sentiment_classify" target="_blank">Baidu open AI platform</a> to predict their text sentiment. Posts and hashtags were both grouped into 8 classes based on which official report they related to.
    </p>

    <p class="normalContent">
        The data of human trafficking victims are from <a class="fontHighlight" href="https://www.ctdatacollaborative.org/global-k-anonymized-dataset" target="_blank">the counter trafficking data collaborative</a> (the 2021-12-14 version of the global K-anonymized dataset).

    </p>

    <p class="normalContent">
        To learn more about my design process and tech details, please visit <a class="fontHighlight" href="https://yuechengpeng.github.io/Fengxian_Visualization_Project_2022/portfolio/">the portfolio page</a> of this project.
    </p>

</div>


<!-------------------------------最后致谢------------------------------>

<div style="margin-left: 20rem; margin-right: 20rem; margin-top: 4rem; margin-bottom: 8rem; ">
    <p class="handContent" style="color: rgba(255, 255, 255, .8)">
        This project is for my <span class="fontHighlight">beloved grandfather</span>,
    </p>
    <p class="handContent" style="color: rgba(255, 255, 255, .8)">
        and others who dare to wield the power of public opinions,
    </p>
    <p class="handContent" style="color: rgba(255, 255, 255, .8)">
        even in the darkest times.
    </p>
</div>


<!---------------------js 脚本 ---------------------->

<!--bootstrap5 tooltip 属性设置-->
<script>
    $(function () {
        $("[data-toggle='tooltip']").tooltip();

        //设置tooltip为点击之后隐藏
        $('[data-toggle="tooltip"]').click(function () {
            $('[data-toggle="tooltip"]').tooltip("hide");

        });
    });
</script>


<!--初始变量和函数-->
<script>
    var heiScaleRatio = 1 / 886 * window.innerHeight;

    var widScaleRatio = 1 / 1728 * window.innerWidth;

    var addSemi = function (num) {
        let numStr = num.toString();
        let cnt = 0;
        let resLst = [];

        for (let i = numStr.length - 1; i >= 0; i--) {

            resLst.push(numStr[i]);
            cnt += 1;
            if (cnt % 3 == 0) {
                cnt = 0;
                resLst.push(',');
            }
        }

        let res = "";
        for (let i = resLst.length - 1; i >= 0; i--) {
            res += resLst[i];
        }
        if (res[0] == ",")
            res = res.substring(1,);
        return res;
    }

    var transNum = function (x) //转化数字格式
    {
        if (x < 1000)
            return x.toString();
        else if (x < 10000)
            return x.toString()[0] + ',' + x.toString().substring(1); //补上千位的逗号
        else if (x < 1000000)
            if ((x / 1000).toFixed(1)[(x / 1000).toFixed(1).length - 1] == "0") //如果末尾为0，舍去最后两位
                return (x / 1000).toFixed(1).substring(0, (x / 1000).toFixed(1).length - 2) + "K"
            else
                return (x / 1000).toFixed(1) + "K"
        else if (x < 1000000000)
            if ((x / 1000000).toFixed(1)[(x / 1000000).toFixed(1).length - 1] == "0") //如果末尾为0，舍去最后两位
                return (x / 1000000).toFixed(1).substring(0, (x / 1000000).toFixed(1).length - 2) + "M"
            else
                return (x / 1000000).toFixed(1) + "M"
        else if ((x / 1000000000).toFixed(1)[(x / 1000000000).toFixed(1).length - 1] == "0") //如果末尾为0，舍去最后两位
            return (x / 1000000000).toFixed(1).substring(0, (x / 1000000000).toFixed(1).length - 2) + "B"
        else
            return (x / 1000000000).toFixed(1) + "B"
    }

    const $setJumpNumber = (startNum, targetNum, time = 1, selector) => {

        let dom = document.querySelector(selector);

        let originNum = startNum;

        let stepNum = 0;

        let timeNum = time;

        dom.innerHTML = startNum;

        let timeId = setInterval(() => {

            if (originNum < targetNum) {

                timeNum -= 0.001;

                let strNum = originNum.toString();

                // 数字比较少的时候直接用 + 1; 数字很大直接 +1 要很久才能调到最对应的数字，所有后三位数随机跳动的方式进行模拟生成

                if (targetNum.toString().length <= 6) {

                    stepNum += 10; // 这样才可以实现越跳越快的效果

                    originNum = originNum + stepNum;

                    dom.innerHTML = addSemi(originNum);

                } else if (targetNum.toString().length >= 12) {

                    stepNum += 1000000; // 这样才可以实现越跳越快的效果

                    originNum = originNum + stepNum;

                    dom.innerHTML = addSemi(strNum.substring(0, strNum.length - 6) + Math.floor(Math.random() * 10) + Math.floor(Math.random() * 10) + Math.floor(Math.random() * 10) + Math.floor(Math.random() * 10) + Math.floor(Math.random() * 10) + Math.floor(Math.random() * 10));

                } else {
                    stepNum += 200; // 这样才可以实现越跳越快的效果

                    originNum = originNum + stepNum;

                    dom.innerHTML = addSemi(strNum.substring(0, strNum.length - 6) + Math.floor(Math.random() * 10) + Math.floor(Math.random() * 10) + Math.floor(Math.random() * 10) + Math.floor(Math.random() * 10) + Math.floor(Math.random() * 10) + Math.floor(Math.random() * 10));

                }

            } else {

                dom.innerHTML = addSemi(targetNum);

                clearInterval(timeId);

            }

        }, timeNum);

    };

    function geneSeed_Tp_Intro(tooltipSvg, tooltipDef, index, cx, cy, followercat, emo_neg_prob, commentCat, isVlevelOn, vlevel, gScale, like, comment, retweet,) {
        var scaleLengthId;
        var scaleWidthId;

        //like的映射计算; like的max值为2457804; 计算scaleWidthId
        let likeScale = d3.scaleLinear()
            .domain([0, 2.7])
            .range([1, 3]); //映射到的scaleWid范围
        if (like <= 5000) {
            scaleWidthId = 1;
        } else {
            scaleWidthId = likeScale(Math.log(like / 5000) / Math.log(10)) //取以10为底的对数
        }

        //retweet的映射计算；retweet的max值为418438；计算scaleLengthId
        let retweetScale = d3.scaleLinear()
            .domain([0, 3])
            .range([1, 3]); //映射到的scaleLen范围
        if (retweet <= 500) {
            scaleLengthId = 1;
        } else {
            scaleLengthId = retweetScale(Math.log(retweet / 500) / Math.log(10)) //取以10为底的对数
        }


        var group1 = tooltipSvg
            .append("g")
            .attr("id", `Tp_seed_Intro${index}`)
            .attr("transform", `translate(${cx}, ${cy}), rotate(-30) ,scale(${gScale})`) //rotate(-20,300,400)
        //.attr("transform","rotate(30,600,400)");

        //叶子宽度参数调整
        group1.append("path")
            .attr("d", `M ${185.11 * scaleLengthId} 23 ` +
                `C ${192.21 * scaleLengthId} 34.23 ${156.54 * 1.2 * scaleLengthId} ${57.89 * scaleWidthId} ${132.11 * scaleLengthId} ${57.89 * scaleWidthId} ` +
                `C ${100.6 * scaleLengthId} ${57.89 * scaleWidthId} ${75.04 * 0.8 * scaleLengthId} 30.79 38.58 30.79 ` +
                "C 50.93 16.55 69 8.67 69 8.67 " +
                `S ${162.94 * scaleLengthId} -12.13 ${185.11 * scaleLengthId} 23 ` +
                "Z")
            .style("fill", "#FFCA36")
            .style("opacity", "0.2")
            .style("stroke", "none");

        //评论数量调整纹理
        if (commentCat == 1) {

            group1.append("path")
                .attr("d", `M ${92.56 * (1.2 - 0.2 * scaleLengthId) * scaleLengthId} ${4.3} C ${109.32 * (1.2 - 0.2 * scaleLengthId) * scaleLengthId} ${4.3} ${119.8 * (1.2 - 0.2 * scaleLengthId) * scaleLengthId} ${18.52 * scaleWidthId} ${121.61 * (1.2 - 0.2 * scaleLengthId) * scaleLengthId} ${32.74 * scaleWidthId}`)
                .style("stroke-linecap", "round")
                .attr("stroke-width", "2")
                .attr("opacity", "0.2")
                .attr("fill", "none")
                .attr("class", `Tp_seedleaf_Intro${index}`)
                .style("stroke", "#FFCA36");

            group1.append("path")
                .attr("d", `M${125.75 * scaleLengthId},2.55 C ${142.51 * scaleLengthId},2.55,${153 * scaleLengthId},${16.77 * scaleWidthId},${154.8 * scaleLengthId},${31 * scaleWidthId}`)
                // .attr("stroke", "#FFCA36")
                .style("stroke-linecap", "round")
                .attr("stroke-width", "2")
                .attr("opacity", "0.2")
                .attr("fill", "none")
                .attr("class", `Tp_seedleaf_Intro${index}`)
                .style("stroke", "#FFCA36");

        } else if (commentCat == 2) {

            group1.append("path")
                .attr("d", `M ${83.27 * (1.2 - 0.2 * scaleLengthId) * scaleLengthId} ${5.93 - Math.min(2, 2 * (scaleLengthId - 1))} C ${100.04 * (1.2 - 0.2 * scaleLengthId) * scaleLengthId} ${5.93 - Math.min(2, 2 * (scaleLengthId - 1))} ${110.52 * (1.2 - 0.2 * scaleLengthId) * scaleLengthId} ${20.15 * 0.8 * scaleWidthId} ${112.33 * (1.2 - 0.2 * scaleLengthId) * scaleLengthId} ${34.37 * 0.8 * scaleWidthId}`)
                .style("stroke-linecap", "round")
                .attr("stroke-width", "2")
                .attr("opacity", "0.2")
                .attr("fill", "none")
                .attr("class", `Tp_seedleaf_Intro${index}`)
                .style("stroke", "#FFCA36");

            group1.append("path")
                .attr("d", `M ${107.93 * (1.1 - 0.1 * scaleLengthId) * scaleLengthId} 2.55 C ${124.7 * (1.1 - 0.1 * scaleLengthId) * scaleLengthId} 2.55 ${138.45 * (1.1 - 0.1 * scaleLengthId) * scaleLengthId} ${16.77 * scaleWidthId} ${140.99 * (1.1 - 0.1 * scaleLengthId) * scaleLengthId} ${39.41 * scaleWidthId}`)
                .style("stroke-linecap", "round")
                .attr("stroke-width", "2")
                .attr("opacity", "0.2")
                .attr("fill", "none")
                .attr("class", `Tp_seedleaf_Intro${index}`)
                .style("stroke", "#FFCA36");

            group1.append("path")
                .attr("d", `M ${134 * scaleLengthId} 2.55 C ${150.76 * scaleLengthId} 2.55 ${159.2 * scaleLengthId} ${16.77 * scaleWidthId} ${161 * scaleLengthId} ${30.99 * scaleWidthId}`)
                .style("stroke-linecap", "round")
                .attr("stroke-width", "2")
                .attr("opacity", "0.2")
                .attr("fill", "none")
                .attr("class", `Tp_seedleaf_Intro${index}`)
                .style("stroke", "#FFCA36");


        } else {

            group1.append("path")
                .attr("d", `M ${71.86 * scaleLengthId} ${7.82 - Math.min(4, 4 * (scaleLengthId - 1))} C ${88.62 * scaleLengthId} 7.82 ${97.72 * scaleLengthId} ${24 * scaleWidthId} ${99.53 * scaleLengthId} ${38.19 * scaleWidthId}`)
                .style("stroke-linecap", "round")
                .attr("stroke-width", "2")
                .attr("opacity", "0.2")
                .attr("fill", "none")
                .attr("class", `Tp_seedleaf_Intro${index}`)
                .style("stroke", "#FFCA36");

            group1.append("path")
                .attr("d", `M ${97.8 * scaleLengthId} ${4.3 - Math.min(1.2, 1.2 * (scaleLengthId - 1))} C ${114.57 * scaleLengthId} 4.3 ${122.31 * scaleLengthId} ${29.05 * scaleWidthId} ${124.12 * scaleLengthId} ${43.3 * scaleWidthId}`)
                .style("stroke-linecap", "round")
                .attr("stroke-width", "2")
                .attr("opacity", "0.2")
                .attr("fill", "none")
                .attr("class", `Tp_seedleaf_Intro${index}`)
                .style("stroke", "#FFCA36");

            group1.append("path")
                .attr("d", `M ${119.78 * scaleLengthId} 2.55 C ${136.55 * scaleLengthId} 2.55 ${144.29 * scaleLengthId} ${27.3 * scaleWidthId} ${146.09 * scaleLengthId} ${41.55 * scaleWidthId}`)
                .style("stroke-linecap", "round")
                .attr("stroke-width", "2")
                .attr("opacity", "0.2")
                .attr("fill", "none")
                .attr("class", `Tp_seedleaf_Intro${index}`)
                .style("stroke", "#FFCA36");

            group1.append("path")
                .attr("d", `M ${140.49 * scaleLengthId} ${2.55 + Math.min(2.5, 2.5 * (scaleLengthId - 1))} C ${157.26 * scaleLengthId} 2.55 ${163.49 * scaleLengthId} ${22.83 * scaleWidthId} ${164.84 * scaleLengthId} ${33.67 * scaleWidthId}`)
                .style("stroke-linecap", "round")
                .attr("stroke-width", "2")
                .attr("opacity", "0.2")
                .attr("fill", "none")
                .attr("class", `Tp_seedleaf_Intro${index}`)
                .style("stroke", "#FFCA36");
        }

        //悬停交互
        var mouseover = function (d) {
            console.log(d3.select(this)
                .attr("id")
                .split("Tp_tooltipCircle_Intro")[1]
            )

            d3.select(`#Tp_emo_grad_end_Intro${d3.select(this)
                .attr("id")
                .split("Tp_tooltipCircle_Intro")[1]}`)
                .transition()
                .duration(500)
                .attr("offset", "1")
                .style("stop-opacity", "100%")

            d3.select(`#Tp_emo_grad_start_Intro${d3.select(this)
                .attr("id")
                .split("Tp_tooltipCircle_Intro")[1]}`)
                .transition()
                .duration(500)
                // .attr("offset", "1")
                .style("stop-color", "#ffca36");

            d3.selectAll(`.Tp_seedleaf_Intro${d3.select(this)
                .attr("id")
                .split("Tp_tooltipCircle_Intro")[1]}`)
                .transition()
                .duration(500)
                // .attr("offset", "1")
                .attr("opacity", "100%");

        }
        var mousemove = function (d) {

        }
        var mouseleave = function (d) {

            d3.select(`#Tp_emo_grad_end_Intro${d3.select(this)
                .attr("id")
                .split("Tp_tooltipCircle_Intro")[1]}`)
                .transition()
                .duration(500)
                .attr("offset", "0.1")
                .style("stop-opacity", "0")

            d3.select(`#Tp_emo_grad_start_Intro${d3.select(this)
                .attr("id")
                .split("Tp_tooltipCircle_Intro")[1]}`)
                .transition()
                .duration(500)
                // .attr("offset", "1")
                .style("stop-color", d3.select(
                    `#Tp_emo_grad_end_Intro${d3.select(this)
                        .attr("id")
                        .split("Tp_tooltipCircle_Intro")[1]}`)
                    .style("stop-color"));

            d3.selectAll(`.Tp_seedleaf_Intro${d3.select(this)
                .attr("id")
                .split("Tp_tooltipCircle_Intro")[1]}`)
                .transition()
                .duration(500)
                // .attr("offset", "1")
                .attr("opacity", "0.2");
        }


        //叶子长度参数调整; 粉丝数影响头部大小
        if (followercat == 1) {
            group1.append("path")
                .attr("d", "M 57.6 6.89 " +
                    "C 46 7.89 29.85 6.42 20.6 6.77 " +
                    `C 9.22 7.2 ${-1.68} 9.24 ${0.22} 18.61` +
                    `C 2.28 28.77 8.25 ${37} 21.44 ${37} ` +
                    "C 44 37 57.07 12.5 75 8.92 " +
                    `S ${162.06 * scaleLengthId} -6 ${185.11 * scaleLengthId} 23 ` +
                    `C ${181.44 * scaleLengthId} ${11.63 + 1 * scaleLengthId} ${157.88 * scaleLengthId} 0 ${126.41 * (1.2 - 0.2 * scaleLengthId) * (scaleLengthId)} 0 ` +
                    "S 81.12 4.86 57.6 6.89 " +
                    "Z")
                .attr("id", `Tp_seedStem_Intro${index}`)
                .style("fill", "#FFCA36")
                .style("stroke", "none");

            group1.append("circle")
                .attr("cx", 24)
                .attr("cy", 26)
                .attr("r", 18)
                .attr("id", `Tp_tooltipCircle_Intro${index}`)
                .attr("fill", "#000")
                .attr("opacity", "0")
                .on("mouseover", mouseover)
                .on("mousemove", mousemove)
                .on("mouseleave", mouseleave);

        } else if (followercat == 2) {

            group1.append("path")
                .attr("d", "M 57.6 6.89 " +
                    "C 46 7.89 29.85 6.42 20.6 6.77 " +
                    "C 9.22 7.2 -16.088 6.503 -14.043 25.517 " +
                    "C -12.048 39.53 -3.46 53.836 19.941 52.99 " +
                    "C 48.698 50.735 57.07 12.5 75 8.92 " +
                    `S ${162.06 * scaleLengthId} -6 ${185.11 * scaleLengthId} 23 ` +
                    `C ${181.44 * scaleLengthId} ${11.63 + 1 * scaleLengthId} ${157.88 * scaleLengthId} 0 ${126.41 * (1.2 - 0.2 * scaleLengthId) * (scaleLengthId)} 0 ` +
                    "S 81.12 4.86 57.6 6.89 " +
                    "Z")
                .attr("id", `Tp_seedStem_Intro${index}`)
                .style("fill", "#FFCA36")
                .style("stroke", "none");

            group1.append("circle")
                .attr("cx", 18)
                .attr("cy", 32)
                .attr("r", 25)
                .attr("id", `Tp_tooltipCircle_Intro${index}`)
                .attr("fill", "#000")
                .attr("opacity", "0")
                .on("mouseover", mouseover)
                .on("mousemove", mousemove)
                .on("mouseleave", mouseleave);

        } else {

            group1.append("path")
                .attr("d", "M 57.6 6.89 C 46 7.89 29.85 6.42 20.6 6.77 C 9.22 7.2 -41.583 4.467 -40.905 37.759 C -39.289 56.31 -25.731 82.914 10.897 81.111 C 57.311 75.993 52.579 16.323 75 8.92" +
                    `S ${162.06 * scaleLengthId} -6 ${185.11 * scaleLengthId} 23 ` +
                    `C ${181.44 * scaleLengthId} ${11.63 + 1 * scaleLengthId} ${157.88 * scaleLengthId} 0 ${126.41 * (1.2 - 0.2 * scaleLengthId) * (scaleLengthId)} 0 ` +
                    "S 81.12 4.86 57.6 6.89 " +
                    "Z")
                .attr("id", `Tp_seedStem_Intro${index}`)
                .style("fill", "#FFCA36")
                .style("stroke", "none");

            group1.append("circle")
                .attr("cx", 15)
                .attr("cy", 35)
                .attr("r", 30)
                .attr("id", `Tp_tooltipCircle_Intro${index}`)
                .attr("fill", "#000")
                .attr("opacity", "0")
                .on("mouseover", mouseover)
                .on("mousemove", mousemove)
                .on("mouseleave", mouseleave);
        }

        //定义情感的线性渐变
        {
            //目前：为每一个帖子定制一个defs：长度不同（x2不同）；末端颜色不同
            let emo_grad = tooltipDef.append("linearGradient")
                .attr("id", `Tp_emo_grad_Intro${index}`)
                .attr("gradientUnits", "userSpaceOnUse")
                .attr("x1", "57.6")
                .attr("y1", "6.89")
                .attr("x2", `${185.11 * scaleLengthId}`)
                .attr("y2", "23");

            //内容情感
            if (emo_neg_prob <= 0.5) {
                // console.log("a")
                let a = d3.rgb(129, 233, 59);	//积极一端的颜色
                let b = d3.rgb(255, 202, 54);	//橙色
                let linear = d3.scaleLinear()
                    .domain([0, 0.5])
                    .range([0, 1])
                let compute = d3.interpolate(a, b);
                let endColor = compute(linear(emo_neg_prob))

                let stop1 = emo_grad.append("stop")
                    .attr("id", `Tp_emo_grad_start_Intro${index}`)
                    .attr("offset", "0")
                    .style("stop-color", endColor);

                let stop2 = emo_grad.append("stop")
                    .attr("id", `Tp_emo_grad_end_Intro${index}`)
                    .attr("offset", "0.1")
                    .style("stop-opacity", "0")
                    .style("stop-color", endColor);

                d3.select(`#Tp_seedStem_Intro${index}`)
                    .style("fill", "url(#" + emo_grad.attr("id") + ")");

            } else {
                let a = d3.rgb(237, 28, 36);	//消极一端的颜色
                let b = d3.rgb(255, 202, 54);	//橙色
                let linear = d3.scaleLinear()
                    .domain([0.5, 1])
                    .range([0, 1])
                let compute = d3.interpolate(b, a);
                let endColor = compute(linear(emo_neg_prob))

                let stop1 = emo_grad.append("stop")
                    .attr("id", `Tp_emo_grad_start_Intro${index}`)
                    .attr("offset", "0")
                    .style("stop-color", endColor);

                let stop2 = emo_grad.append("stop")
                    .attr("id", `Tp_emo_grad_end_Intro${index}`)
                    .attr("offset", "0.1")
                    .style("stop-opacity", "0")
                    .style("stop-color", endColor);

                d3.select(`#Tp_seedStem_Intro${index}`)
                    .style("fill", "url(#" + emo_grad.attr("id") + ")");

            }
        }


        if (isVlevelOn) {
            // 微博等级
            if (vlevel == "normal") {
                group1.append("circle")
                    .attr("cx", "8")
                    .attr("cy", "-5")
                    .attr("r", "10")
                    .attr("stroke", "none")
                    .attr("fill", "#FFCA36")
                    .attr("opacity", "0.3")
            } else if (vlevel == "yellow") {
                group1.append("circle")
                    .attr("cx", "8")
                    .attr("cy", "-5")
                    .attr("r", "10")
                    .attr("stroke", "none")
                    .attr("fill", "#FFCA36")
                    .attr("opacity", "0.5")
                group1.append("circle")
                    .attr("cx", "32")
                    .attr("cy", "-8")
                    .attr("r", "10")
                    .attr("stroke", "none")
                    .attr("fill", "#FFCA36")
                    .attr("opacity", "0.3")
            } else if (vlevel == "gold") {
                group1.append("circle")
                    .attr("cx", "8")
                    .attr("cy", "-5")
                    .attr("r", "10")
                    .attr("stroke", "none")
                    .attr("fill", "#FFCA36")
                    .attr("opacity", "0.8")
                group1.append("circle")
                    .attr("cx", "32")
                    .attr("cy", "-8")
                    .attr("r", "10")
                    .attr("stroke", "none")
                    .attr("fill", "#FFCA36")
                    .attr("opacity", "0.5")
                group1.append("circle")
                    .attr("cx", "56")
                    .attr("cy", "-8")
                    .attr("r", "10")
                    .attr("stroke", "none")
                    .attr("fill", "#FFCA36")
                    .attr("opacity", "0.3")
            } else {
                group1.append("circle")
                    .attr("cx", "8")
                    .attr("cy", "-5")
                    .attr("r", "10")
                    .attr("stroke", "none")
                    .attr("fill", "#3694ff")
                    .attr("opacity", "0.8")
            }
        }

    }



</script>




<!--设置windline video初始大小-->
<script>

    //等待hashtagNodes加载完成再进行交互绑定
    var loadWindInteraction = function()
    {
        //加载风glyph
        d3.xml("asset/svg/windGlyph.svg")
            .then(data => {
                d3.select("#windAnimSvgOverlayDiv").node().append(data.documentElement)

                //绑定windline交互事件
                for (let index = 1; index <= 8; index++) {
                    d3.select(`#windCat${index}`)
                        .on("mouseover", function (d, i) {

                            // d3.select("#hashtagTooltip_wind")
                            //     .style("display", "block")
                            //     .style("top", `${d3.pointer(d)[1]}px`)
                            //     .style("left", `${d3.pointer(d)[0]}px`)

                            //更改名称：Hashtag Group · X
                            d3.select("#hashtagGroupNum_wind")
                                .html(`Hashtag Group · ${index}`);

                            //改变简介内容
                            d3.select("#hashtagGroupSubtitle_wind")
                                .html(hashtagNodes[index - 1]["event"])


                            //改变view数量
                            d3.select("#windView")
                                .html(transNum(hashtagNodes[index - 1]["view"]))

                            //改变discussion数量
                            d3.select("#windComment")
                                .html(transNum(hashtagNodes[index - 1]["discussion"]))

                            //改变original数量
                            d3.select("#windOriginal")
                                .html(transNum(hashtagNodes[index - 1]["original"]))


                            //改变hashtag内容
                            d3.select("#hashtagGroupInclude_wind")
                                .html(function () {
                                    let res = "";
                                    for (let j = 0; j < 4; j++) {
                                        res += hashtagNodes[index - 1]["hashtags"][j]
                                        res += "<br>"
                                    }
                                    return res;
                                })
                                .attr("content", function () {
                                    let res = "";
                                    for (let j = 0; j < hashtagNodes[index - 1]["hashtags"].length; j++) {
                                        res += hashtagNodes[index - 1]["hashtags"][j]
                                        res += "<br>"
                                    }
                                    return res;
                                })

                            //改变emotion scaleBox位置
                            let emoScale = d3.scaleLinear()
                                .domain([1, 0])
                                .range([0, 186 * widScaleRatio]);

                            d3.select("#emotionScaleBox_wind")
                                .style("left", `${emoScale(parseFloat(hashtagNodes[index - 1]["sentiment"]))}px`)

                        })

                        .on("mousemove", function (d, i) {
                            let posScaleWid = d3.scaleLinear()
                                .domain([0, window.innerWidth])
                                .range([20 * 24 * widScaleRatio, 42 * 24 * widScaleRatio]);

                            let posScaleHei = d3.scaleLinear()
                                .domain([0, window.innerHeight])
                                .range([10 * 24 * heiScaleRatio, 15 * 24 * heiScaleRatio]);


                            d3.select("#hashtagTooltip_wind")
                                .style("display", "block")
                                .style("top", `${posScaleHei(d3.pointer(d)[1])}px`)
                                .style("left", `${posScaleWid(d3.pointer(d)[0])}px`)
                        })

                        .on("mouseleave", function () {
                            if (!isTooltipFixed_wind) {
                                d3.select("#hashtagTooltip_wind")
                                    .style("display", "none")
                            }
                        })
                        .on("click", function () {
                            isTooltipFixed_wind = true;
                            d3.select("#tooltipInvisibleBlockDiv_wind")
                                .style("display", "block")
                        });
                }

                if(window.innerWidth / window.innerHeight > 1920 / 1080)
                {
                    d3.select("#windAnimVideo")
                        .style("height", `${window.innerHeight}px`)
                        .style("top", "0px")
                        .style("left", `${(window.innerWidth - 1920 / 1080 * window.innerHeight) / 2}px`)

                    d3.select("#windAnimSvgOverlay")
                        .style("right", `${(window.innerWidth - 1920 / 1080 * window.innerHeight) / 2 + 1920 / 1080 * window.innerHeight * 0.086}px`)
                        .style("top", `${window.innerHeight * 0.255}px`)
                        .style("width", `${1920 / 1080 * window.innerHeight * .405}px`)

                }
                else{
                    d3.select("#windAnimVideo")
                        .style("width", `${window.innerWidth}px`)
                        .style("left", "0px")
                        .style("top", `${(window.innerHeight - 1080 / 1920 * window.innerWidth) / 2}px`)

                    d3.select("#windAnimSvgOverlay")
                        .style("right", `${window.innerWidth * 0.088}px`)
                        .style("top", `${(window.innerHeight - 1080 / 1920 * window.innerWidth) / 2 + 1080 / 1920 * window.innerWidth * 0.254}px`)
                        .style("height", `${1080 / 1920 * window.innerWidth * .44}px`)
                }


            });
    }


</script>

<!--读取hashtag 的json数据-->
<script>
    let hashtagNodes;

    //读取hashtag相关数据
    d3.json("asset/json/hashtagGroup_unlinked.json").then(function (data) {

        hashtagNodes = d3.range(1, 8 + 1).map(function (d, i) {
            return {
                event: data[d.toString()]["event"],
                hashtags: data[d.toString()]["hashtags"],
                sentiment: data[d.toString()]["sentiment"],
                view: data[d.toString()]["view"],
                discussion: data[d.toString()]["discussion"],
                original: data[d.toString()]["original"],
            }
        });

        loadWindInteraction();

    });

</script>

<!--wind tooltip的遮挡交互-->
<script>
    d3.select("#tooltipInvisibleBlockDiv_wind")
        .style("height", `${window.innerHeight}px`)
        .style("width", `${window.innerWidth}px`);


    var tooltipInvisibleBlockDiv_wind_click = function () {
        isTooltipFixed_wind = false;
        //隐藏div阻挡栏
        d3.select("#tooltipInvisibleBlockDiv_wind")
            .style("display", "none")
        //隐藏tooltip
        d3.select("#hashtagTooltip_wind")
            .style("display", "none")

        //初始化为show more
        isshowFullHashtag_wind = false;
        d3.select("#showFullHashtag_wind").html("show more");
    }

    var isTooltipFixed_wind = false;

    var isshowFullHashtag_wind = false;
    var showFullHashtag_wind = function () {
        if (!isshowFullHashtag_wind) {
            //交换长短内容的位置
            let str = d3.select("#hashtagGroupInclude_wind").attr("content");

            d3.select("#hashtagGroupInclude_wind")
                .attr("content", d3.select("#hashtagGroupInclude_wind").html());

            d3.select("#hashtagGroupInclude_wind")
                .html(str);

            d3.select("#showFullHashtag_wind").html("show less");

            isshowFullHashtag_wind = true;
        } else {
            //交换长短内容的位置
            let str = d3.select("#hashtagGroupInclude_wind").attr("content");

            d3.select("#hashtagGroupInclude_wind")
                .attr("content", d3.select("#hashtagGroupInclude_wind").html());

            d3.select("#hashtagGroupInclude_wind")
                .html(str);

            d3.select("#showFullHashtag_wind").html("show more");

            isshowFullHashtag_wind = false;
        }

    }
</script>


<!--seed点击"i"的tooltip-->
<script>

    //seed部分整体tooltip大小
    d3.select("#overlayTooltipIntroPart_seed")
        // .style("width", `${0.74 * window.innerWidth}px`)
        // .style("height", `${640 / 886 * window.innerHeight}px`)
        .style("top", `${(window.innerHeight - document.getElementById('overlayTooltipIntroPart_seed').offsetHeight) / 2}px`)
        .style("left", `${(window.innerWidth - document.getElementById('overlayTooltipIntroPart_seed').offsetWidth) / 2}px`)

    //设置遮挡div大小
    d3.select("#invisibleBlock_Intro")
        .style("height", `${window.innerHeight}px`)
        .style("width", `${window.innerWidth}px`)
        .style("opacity", 0.6)
        .style("background-color", "#141414")


    //seed部分TOOLTIP svg生成
    {
        //follower部分tooltip
        var followerSvg = d3.select("#followerTooltipIntro")
            .append("svg")
            .attr("width", `100%`)
            .attr("height", `${2}rem`)

        var followerDefs = followerSvg.append("defs");

        geneSeed_Tp_Intro(followerSvg, followerDefs, 1, 100 * widScaleRatio, 30 * heiScaleRatio, 1, 0.5, 1, false, "normal", 0.3 * widScaleRatio, 1, 1, 1);
        geneSeed_Tp_Intro(followerSvg, followerDefs, 2, 280 * widScaleRatio, 27.5 * heiScaleRatio, 2, 0.5, 1, false, "yellow", 0.3 * widScaleRatio, 1, 1, 1);
        geneSeed_Tp_Intro(followerSvg, followerDefs, 3, 460 * widScaleRatio, 25 * heiScaleRatio, 3, 0.5, 1, false, "yellow", 0.3 * widScaleRatio, 1, 1, 1);


        //vlevel部分tooltip
        var vlevelSvg = d3.select("#vlevelTooltipIntro")
            .append("svg")
            .attr("width", `100%`)
            .attr("height", `${2}rem`)

        var vlevelDefs = vlevelSvg.append("defs");

        geneSeed_Tp_Intro(vlevelSvg, vlevelDefs, 4, 42 * widScaleRatio, 30 * heiScaleRatio, 1, 0.5, 1, true, "normal", 0.3 * widScaleRatio, 1, 1, 1);
        geneSeed_Tp_Intro(vlevelSvg, vlevelDefs, 5, 170 * widScaleRatio, 30 * heiScaleRatio, 1, 0.5, 1, true, "yellow", 0.3 * widScaleRatio, 1, 1, 1);
        geneSeed_Tp_Intro(vlevelSvg, vlevelDefs, 6, 320 * widScaleRatio, 30 * heiScaleRatio, 1, 0.5, 1, true, "gold", 0.3 * widScaleRatio, 1, 1, 1);
        geneSeed_Tp_Intro(vlevelSvg, vlevelDefs, 7, 470 * widScaleRatio, 30 * heiScaleRatio, 1, 0.5, 1, true, "blue", 0.3 * widScaleRatio, 1, 1, 1);

        //retweet部分tooltip
        var retweetSvg = d3.select("#retweetTooltipIntro")
            .append("svg")
            .attr("width", `100%`)
            .attr("height", `${2}rem`)

        var retweetDefs = retweetSvg.append("defs");

        geneSeed_Tp_Intro(retweetSvg, retweetDefs, 8, 100 * widScaleRatio, 30 * heiScaleRatio, 1, 0.5, 1, false, "normal", 0.3 * widScaleRatio, 1, 1, 1);
        geneSeed_Tp_Intro(retweetSvg, retweetDefs, 9, 320 * widScaleRatio, 32 * heiScaleRatio, 1, 0.5, 1, false, "yellow", 0.3 * widScaleRatio, 1, 1, 500);
        //滑条：cy从30到42；retweet从500到5k

        //likes部分tooltip
        var likeSvg = d3.select("#likeTooltipIntro")
            .append("svg")
            .attr("width", `100%`)
            .attr("height", `${2}rem`)

        var likeDefs = likeSvg.append("defs");

        geneSeed_Tp_Intro(likeSvg, likeDefs, 10, 100 * widScaleRatio, 30 * heiScaleRatio, 1, 0.5, 1, false, "normal", 0.3 * widScaleRatio, 1, 1, 1);
        geneSeed_Tp_Intro(likeSvg, likeDefs, 11, 320 * widScaleRatio, 32 * heiScaleRatio, 1, 0.5, 1, false, "yellow", 0.3 * widScaleRatio, 1, 1, 500);

        //comment部分tooltip
        var commentSvg = d3.select("#commentTooltipIntro")
            .append("svg")
            .attr("width", `100%`)
            .attr("height", `${2}rem`)

        var commentDefs = commentSvg.append("defs");

        geneSeed_Tp_Intro(commentSvg, commentDefs, 12, 100 * widScaleRatio, 30 * heiScaleRatio, 1, 0.5, 1, false, "normal", 0.3 * widScaleRatio, 1, 1, 1);
        geneSeed_Tp_Intro(commentSvg, commentDefs, 13, 270 * widScaleRatio, 30 * heiScaleRatio, 1, 0.5, 2, false, "yellow", 0.3 * widScaleRatio, 1, 100, 1);
        geneSeed_Tp_Intro(commentSvg, commentDefs, 14, 460 * widScaleRatio, 30 * heiScaleRatio, 1, 0.5, 3, false, "yellow", 0.3 * widScaleRatio, 1, 200, 1);

        //emotion部分tooltip
        var emotionSvg = d3.select("#emotionTooltipIntro")
            .append("svg")
            .attr("width", `100%`)
            .attr("height", `${2}rem`)

        var emotionDefs = emotionSvg.append("defs");

        geneSeed_Tp_Intro(emotionSvg, emotionDefs, 15, 210 * widScaleRatio, 30 * heiScaleRatio, 1, 0.5, 3, false, "yellow", 0.3 * widScaleRatio, 1, 200, 1);

    }




    var isShowTooltipOverlayIntro = false;
    //点击右下角图标事件
    var showTooltipOverlayIntro = function () {
        if (!isShowTooltipOverlayIntro) {
            d3.select("#invisibleBlock_Intro")
                .style("display", "block");

            d3.select("#overlayTooltipIntroPart_seed")
                .style("display", "block")
                .style("top", `${(window.innerHeight - document.getElementById('overlayTooltipIntroPart_seed').offsetHeight) / 2}px`)
                .style("left", `${(window.innerWidth - document.getElementById('overlayTooltipIntroPart_seed').offsetWidth) / 2}px`);

            isShowTooltipOverlayIntro = true;

        }
    }

    var isShowTooltipOverlayIntro_wind = false;
    //点击右下角图标事件
    var showTooltipOverlayIntro_wind = function () {
        if (!isShowTooltipOverlayIntro_wind) {
            d3.select("#invisibleBlock_Intro")
                .style("display", "block");

            d3.select("#overlayTooltipIntroPart_wind")
                .style("display", "block")
                .style("top", `${(window.innerHeight - document.getElementById('overlayTooltipIntroPart_wind').offsetHeight) / 2}px`)
                .style("left", `${(window.innerWidth - document.getElementById('overlayTooltipIntroPart_wind').offsetWidth) / 2}px`)

            isShowTooltipOverlayIntro_wind = true;

        }
    }

    //点击遮挡div
    var invisibleBlock_Intro_click = function () {
        if (isShowTooltipOverlayIntro) {
            d3.select("#invisibleBlock_Intro")
                .style("display", "none");

            d3.select("#overlayTooltipIntroPart_seed")
                .style("display", "none");

            isShowTooltipOverlayIntro = false;
        }

        if (isShowTooltipOverlayIntro_wind) {
            d3.select("#invisibleBlock_Intro")
                .style("display", "none");

            d3.select("#overlayTooltipIntroPart_wind")
                .style("display", "none");

            isShowTooltipOverlayIntro_wind = false;
        }

    }
</script>

<!--wind点击"i"的tooltip-->
<script>
    //seed部分整体tooltip大小
    d3.select("#overlayTooltipIntroPart_wind")
        // .style("width", `${0.74 * window.innerWidth}px`)
        // .style("height", `${640 / 886 * window.innerHeight}px`)
        .style("top", `${(window.innerHeight - document.getElementById('overlayTooltipIntroPart_wind').offsetHeight) / 2}px`)
        .style("left", `${(window.innerWidth - document.getElementById('overlayTooltipIntroPart_wind').offsetWidth) / 2}px`)

    //设置遮挡div大小
    d3.select("#invisibleBlock_Intro")
        .style("height", `${window.innerHeight}px`)
        .style("width", `${window.innerWidth}px`)
        .style("opacity", 0.6)
        .style("background-color", "#141414")

</script>



<!--前面scroll magic动画-->
<script>
    var controller = new ScrollMagic.Controller();

    //圆圈windline入场
    var divStayedScene = new ScrollMagic.Scene({
        triggerElement: "#postIntroEnter",
        duration: 14 * 24 * heiScaleRatio,
        offset: -4 * 24 * heiScaleRatio
    })
        .on("progress", function (event){
            const scale = d3.scaleLinear()
                .domain([0, 1])
                .range([0, 300])

            d3.select("#windCurve1").attr("stroke-dashoffset", 1000 - event.progress * 1800)
                .attr("transform", `translate(${100 * widScaleRatio}, ${scale(event.progress) * heiScaleRatio}), scale(${2 * widScaleRatio})`)

            // .attr("transform", "translate(" + windcenterX + ", " + (windcenterY + event.progress / 10 * windowHei) + "), scale(" + windscaleId + ")")

        })
        // .addIndicators({name: "line"}) // add indicators (requires plugin)
        .addTo(controller);

    const seedIntroXIndex = 0;

    //seed进场
    var divStayedScene = new ScrollMagic.Scene({
        triggerElement: "#postIntroEnter",
        duration: 6 * 24 * heiScaleRatio,
        offset: 12 * 24 * heiScaleRatio
    })
        .on("progress", function (event){

            //`translate(${cx}, ${cy}), rotate(-30) ,scale(${gScale})`
            //cx = 200 * widscaleratio; cy = 450 * heiscaleratio, gscale = 1.5 * widscaleratio
            d3.select("#Tp_seed_IntroseedIntro")
                .style("opacity", event.progress)

            const xscaleScale = d3.scaleLinear()
                .domain([0, 1])
                .range([0 , 1 * widScaleRatio])

            const xScale = d3.scaleLinear()
                .domain([0, 1])
                .range([100 * widScaleRatio, 0])


            d3.select("#Tp_seed_IntroseedIntroGroup")
                .attr("transform", `translate(${xScale(event.progress)}, 0), scale(${xscaleScale(event.progress)}, 1)`);

        })
        // .addIndicators({name: "pin"}) // add indicators (requires plugin)
        .addTo(controller);

    //svg setPin
    var divStayedScene = new ScrollMagic.Scene({
        triggerElement: "#postIntroEnter",
        duration: 100 * 24 * heiScaleRatio,
        offset: 12 * 24 * heiScaleRatio
    })
        .setPin("#divFixedSeedIntro1")
        // .addIndicators({name: "pin"}) // add indicators (requires plugin)
        .addTo(controller);

    var windAnimVideo = document.getElementById("windAnimVideo");

    var windAnimVideoTimeScaleEnter = d3.scaleLinear()
        .domain([0, 1])
        .range([0, 3.1]);

    //视频播放进场
    var divStayedScene = new ScrollMagic.Scene({
        triggerElement: "#windCarryEnter",
        duration: 24 * 24 * heiScaleRatio,
        offset: -12 * 24 * heiScaleRatio
    })
        .on("progress", function(event){
            windAnimVideo.currentTime = windAnimVideoTimeScaleEnter(event.progress);

            //设置悬停响应的svg的出现与消失
            if(event.progress > 0.9)
            {
                d3.select("#windAnimSvgOverlayDiv")
                    .style("display", "block");
            }
            else{
                d3.select("#windAnimSvgOverlayDiv")
                    .style("display", "none");
            }

            //seed退场
            d3.select("#Tp_seed_IntroseedIntro")
                .style("opacity", 1 - event.progress)


            const xscaleScale = d3.scaleLinear()
                .domain([0, 1])
                .range([1 * widScaleRatio, 0.1 * widScaleRatio])

            const xScale = d3.scaleLinear()
                .domain([0, 1])
                .range([0, 500 * widScaleRatio])


            d3.select("#Tp_seed_IntroseedIntroGroup")
                .attr("transform", `translate(${xScale(event.progress)}, 0), scale(${xscaleScale(event.progress)}, 1)`);



        })
        //结束，触发的svg出现
        .on("end", function (event){
            d3.select("#windAnimSvgOverlayDiv")
                .style("display", "block");
        })

        // .addIndicators({name: "1 (duration: windowHei)"}) // add indicators (requires plugin)
        .addTo(controller);

    var windAnimVideoTimeScaleExit = d3.scaleLinear()
        .domain([0, 1])
        .range([3.5, 7]);


    //视频播放退场; 以及windLineBg的block和none
    var divStayedScene = new ScrollMagic.Scene({
        triggerElement: "#moveCloserExit",
        duration: 24 * 24 * heiScaleRatio,
        offset: -12 * 24 * heiScaleRatio
    })
        .on("progress", function(event){
            //设置悬停响应的svg的出现与消失
            if(event.progress < 0.1)
            {
                d3.select("#windAnimSvgOverlayDiv")
                    .style("display", "block");
            }
            else{
                d3.select("#windAnimSvgOverlayDiv")
                    .style("display", "none");
            }

            if(event.progress < 0.9)
            {
                d3.select("#windLineBg")
                    .style("display", "none");

                d3.select("#timelineSvgFixedItems")
                    .style("display", "none");
            }else{
                d3.select("#windLineBg")
                    .style("display", "block");

                d3.select("#timelineSvgFixedItems")
                    .style("display", "block");
            }

            windAnimVideo.currentTime = windAnimVideoTimeScaleExit(event.progress);

        })
        // .addIndicators({name: "1 (duration: windowHei)"}) // add indicators (requires plugin)
        .addTo(controller);

</script>

<!--前面svg画布绘制-->
<script>

    var svg1 = d3.select("#svg1")
        .attr("width", "120%")
        .attr("height", 0.9 * window.innerHeight);

    var defs = svg1.append("defs");

    var svg1Group = svg1.append("g")
        .attr("id", "Tp_seed_IntroseedIntroGroup")
        // .attr("transform", "scale(.4, 1)");

    geneSeed_Tp_Intro(svg1Group, defs, "seedIntro", 150 * widScaleRatio, 450 * heiScaleRatio, 1, 0.5, 1, true, "yellow", 1.5 * widScaleRatio, 1, 1, 1);
    //种子初始设置为透明
    d3.select("#Tp_seed_IntroseedIntro")
        .style("opacity", 0)

    var windCurve1 = svg1.append("g")
        .attr("id", "windCurve1")
        .attr("transform", `translate(${100 * widScaleRatio}, ${0 * heiScaleRatio}), scale(${2 * widScaleRatio})`)
        .attr("stroke", "#FFCA36")
        .attr("stroke-width", "2")
        .attr("stroke-dasharray", "1000")
        .attr("stroke-dashoffset", "-1800")
        .attr("stroke-linecap", "round")
        .attr("opacity", "0.6")
        .attr("fill", "none");

    windCurve1.append("path")
        .attr("d", "M.1,4.82C168.21-12.49,216.21,32.53,112,69.17s-115.58-1-45.58-12.53c64.8-10.73,124.52,26.89-4.4,62.12")


</script>


<!----------------------分割线 以下为主体时间线部分脚本---------------------->

<!--时间线内部悬浮故事版脚本-->
<script>
    var closeTimelineStoryBoard = function (storyId){
        d3.select(`#timelineStoryBoard${storyId}`)
            .style("visibility", "hidden");
    }

    var showTimelineStoryBoard = function (){
        d3.selectAll(`.timelineNote`)
            .style("visibility", "visible");
    }

    var timelinePanelStoryDisX = [-200 * heiScaleRatio, -100 * heiScaleRatio, 1700 * heiScaleRatio, 7000 * heiScaleRatio, 7600 * heiScaleRatio, 7800 * heiScaleRatio, 8000 * heiScaleRatio, 10300 * heiScaleRatio, 10500 * heiScaleRatio, 11400 * heiScaleRatio, 12300 * heiScaleRatio, 13300 * heiScaleRatio, 13500 * heiScaleRatio, 14700 * heiScaleRatio, 15500 * heiScaleRatio, 16300 * heiScaleRatio, 18600 * heiScaleRatio, 19200 * heiScaleRatio, ]
    var timelinePanelStoryDisY = [600 * widScaleRatio, 400 * widScaleRatio, 500 * widScaleRatio, 600 * widScaleRatio, 300 * widScaleRatio, 800 * widScaleRatio, 700 * widScaleRatio, 700 * widScaleRatio, 800 * widScaleRatio, 800 * widScaleRatio, 800 * widScaleRatio, 800 * widScaleRatio, 700 * widScaleRatio, 200 * widScaleRatio, 300 * widScaleRatio, 300 * widScaleRatio, 850 * widScaleRatio, 400 * widScaleRatio, ]

    // const timelinePanelStoryDisScale = d3.scaleLinear()
    //     .domain([1, 0.6422121896162528])
    //     .range([1, 0.97])

    var timelineStoryContent = [
        "At the end of 2021, a story about an eight-children father at Fengxian(丰县), Xuzhou attracted many vloggers to visit and record videos to propagate father's love and local poverty alleviation policies.<br><br> On Jan 27 2022, a TikTok video went viral and sparked outrage and shock. In this video, the mother was tied to her neck by a chain in a worn-out hub.",

        `On Jan 28, Fengxian released the first report, claiming <span class='normalContentHighlight'>“there is no human trafficking”</span> without many details or evidences. This short report roiled the Internet, triggered widespread scepticism. Some claimed that this chained women resembled a missing women named Ying Li in Sichuan.`,

        `On Jan 30, Fengxian released the second report, but still <span class="normalContentHighlight">insisting that there is no human trafficking in this case</span>, and that the mother was homeless and took in by Dong. This report failed to convince netizens, and many Internet sleuths kept digging up key details about her case.`,

        `On Feb 6, the director of the Blind Mountain (a movie about human trafficking in China) gave up copyright to fight trafficking of women.`,

        `On Feb 7, two criminal law experts started a debate on whether the punishment for the crime of buying women and children should be increased on the Internet.`,

        `Many netizens went to Fengxian in search of the truth, but were blocked by the police. And the father of eight children started to endorse commercials.`,

        `As public opinion continued to ferment, the investigation level rose from county to city. On Feb 7, Xuzhou released the third official report, providing more details of the mother. However, <span class="normalContentHighlight">there is still no conclusion regarding whether the mother was abducted</span>.`,

        `With increasing doubts from netizens, Xuzhou released the fourth official report, in which the mother was <span class="normalContentHighlight">finally confirmed a victim of human trafficking</span>, whose true name is Xiao Huamei. But netizens still further questioned about the exact age of the mother, the process of trafficking, and other details.`,

        `In later videos, the mother repeated that <span class="normalContentHighlight">"this world don’t want me anymore"</span>. More who wanted to learn the truth were stopped by more than 100 police in Fengxian. And two supporters from Weibo who came to Fengxian were detained for no apparent reason.`,

        `On Feb 12, former journalist Tiemu visited the native place of Xiao Huamei, in search of the true identity of the mother, and later released a podcast on his findings.`,

        `Weibo continued to block comments from KOLs, along with videos that criticized local officials.`,

        `On Feb 15, reporter Fei Deng exposed the marriage certificate of the mother, but the appearance of woman on the certificate and the mother poled apart. Though authorities have confirmed the identity of the mother using the DNA match, <span class="normalContentHighlight">this photo still sparked doubts regarding her true identity on the Internet</span>.`,

        `On Feb 15, <span class="normalContentHighlight">the first official media</span> stood out and questioned that the Fengxian court did not allow abducted women to divorce.`,

        `Under the pressure of public opinion, <span class="normalContentHighlight">provincial government</span> set up investigation teams towards this incident on Feb 17.`,

        `On Feb 18, after being silent for over 20 days, many official media finally released the first report on this incident. Interestingly, these official media rushed to report the news of a pianist caught whoring early in the 2022.`,

        `On Feb 19, the village where the mother lived was blocked, thwarting media and civilian investigations.`,

        `On Feb 22, the "husband" of the mother was arrested on suspicion of torture.`,

        `Ob Feb 23, authorities released the last report, concerning the identity of the mother, process of trafficking, current mental and physical condition of the mother, and punishment of 17 officials. Only at this time were there a burst in reports from official media. `
    ];

    var timelineStoryDivContentTotal = ""

    for(let i = 0; i < timelineStoryContent.length; i++)
    {
        timelineStoryDivContentTotal += `<div id="timelineStoryBoard${i+1}" class="timelineNote" style=" top:${timelinePanelStoryDisX[i] }px; left:${timelinePanelStoryDisY[i]}px" >
            <p  class="normalContent" style="margin: 0rem">
                ${timelineStoryContent[i]}
            </p>
            <img src="asset/svg/close.svg" style="height: .8rem; position: absolute; top: .2rem; right: .2rem;" onclick="closeTimelineStoryBoard(1)">
        </div>`
    }

    document.getElementById("timelineStoryDiv")
        .innerHTML = timelineStoryDivContentTotal;


</script>



<!--fixed元素出现 & 消失-->
<script>
    var divStayedScene = new ScrollMagic.Scene({
        triggerElement: "#moveCloserExit",
        duration: 10 * 24 * heiScaleRatio,
        offset: 12 * 24 * heiScaleRatio
    })
        .on("progress", function(event){
            d3.select("#timelineSvgFixedItems")
                .style("opacity", event.progress);

            d3.select("#samaraTimeline")
                .style("opacity", event.progress);
        })
        // .addIndicators({name: "1 (duration: windowHei)"}) // add indicators (requires plugin)
        .addTo(controller);



    var divStayedScene = new ScrollMagic.Scene({
        triggerElement: "#samaraTimelineExit",
        duration: 10 * 24 * heiScaleRatio,
        offset: -14 * 24 * heiScaleRatio
    })
        .on("progress", function(event){
            d3.select("#timelineSvgFixedItems")
                .style("opacity", 1 - event.progress);

            d3.select("#samaraTimeline")
                .style("opacity", 1 - event.progress);
        })
        // .addIndicators({name: "1 (duration: windowHei)"}) // add indicators (requires plugin)
        .addTo(controller);

    var divStayedScene = new ScrollMagic.Scene({
        triggerElement: "#samaraTimelineExit",
        duration: 2 * 24 * heiScaleRatio,
        offset: -4 * 24 * heiScaleRatio
    })
        .on("progress", function(event){
            if(event.progress > 0.5)
            {
                d3.select("#timelineSvgFixedItems")
                    .style("display", "none");
            }
            else{
                d3.select("#timelineSvgFixedItems")
                    .style("display", "block");
            }
        })
        // .addIndicators({name: "1 (duration: windowHei)"}) // add indicators (requires plugin)
        .addTo(controller);


</script>


<!--jump to related hashtag tooltip-->
<script>
    $(function () {
        $("[data-toggle='tooltip']").tooltip();

        //设置tooltip为点击之后隐藏
        $('[data-toggle="tooltip"]').click(function () {
            $('[data-toggle="tooltip"]').tooltip("hide");

        });

    });
</script>

<!--seedtooltip的拖动操作设置-->
<script>
    // 拖拽功能(主要是触发三个事件：onmousedown\onmousemove\onmouseup)
    var drag = document.getElementById('seedTooltip')

    // 点击某物体时，用drag对象即可，move和up是全局区域，也就是整个文档通用，应该使用document对象而不是drag对象(否则，采用drag对象时物体只能往右方或下方移动)
    drag.onmousedown = function (e) {
        var e = e || window.event // 兼容ie浏览器
        var diffX = e.clientX - drag.offsetLeft // 鼠标点击物体那一刻相对于物体左侧边框的距离=点击时的位置相对于浏览器最左边的距离-物体左边框相对于浏览器最左边的距离
        var diffY = e.clientY - drag.offsetTop

        /* 低版本ie bug:物体被拖出浏览器可是窗口外部时，还会出现滚动条，
                解决方法是采用ie浏览器独有的2个方法setCapture()\releaseCapture(),这两个方法，
                可以让鼠标滑动到浏览器外部也可以捕获到事件，而我们的bug就是当鼠标移出浏览器的时候，
                限制超过的功能就失效了。用这个方法，即可解决这个问题。注：这两个方法用于onmousedown和onmouseup中 */
        if (typeof drag.setCapture !== 'undefined') {
            drag.setCapture()
        }

        document.onmousemove = function (e) {
            var e = e || window.event // 兼容ie浏览器
            var left = e.clientX - diffX
            var top = e.clientY - diffY

            // 控制拖拽物体的范围只能在浏览器视窗内，不允许出现滚动条
            if (left < 0) {
                left = 0
            } else if (left > window.innerWidth - drag.offsetWidth) {
                left = window.innerWidth - drag.offsetWidth
            }
            if (top < 0) {
                top = 0
            } else if (top > window.innerHeight - drag.offsetHeight) {
                top = window.innerHeight - drag.offsetHeight
            }

            // 移动时重新得到物体的距离，解决拖动时出现晃动的现象
            drag.style.left = left + 'px'
            drag.style.top = top + 'px'
        }
        document.onmouseup = function (e) { // 当鼠标弹起来的时候不再移动
            console.log('this', this)
            this.onmousemove = null
            this.onmouseup = null // 预防鼠标弹起来后还会循环（即预防鼠标放上去的时候还会移动）

            // 修复低版本ie bug
            if (typeof drag.releaseCapture !== 'undefined') {
                drag.releaseCapture()
            }
        }
    }


</script>

<!--vaneTooltip拖动操作设置-->
<script>
    // 拖拽功能(主要是触发三个事件：onmousedown\onmousemove\onmouseup)
    var dragVane = document.getElementById('vaneTooltip')

    // 点击某物体时，用drag对象即可，move和up是全局区域，也就是整个文档通用，应该使用document对象而不是drag对象(否则，采用drag对象时物体只能往右方或下方移动)
    dragVane.onmousedown = function (e) {
        var e = e || window.event // 兼容ie浏览器
        var diffX = e.clientX - dragVane.offsetLeft // 鼠标点击物体那一刻相对于物体左侧边框的距离=点击时的位置相对于浏览器最左边的距离-物体左边框相对于浏览器最左边的距离
        var diffY = e.clientY - dragVane.offsetTop

        /* 低版本ie bug:物体被拖出浏览器可是窗口外部时，还会出现滚动条，
                解决方法是采用ie浏览器独有的2个方法setCapture()\releaseCapture(),这两个方法，
                可以让鼠标滑动到浏览器外部也可以捕获到事件，而我们的bug就是当鼠标移出浏览器的时候，
                限制超过的功能就失效了。用这个方法，即可解决这个问题。注：这两个方法用于onmousedown和onmouseup中 */
        if (typeof dragVane.setCapture !== 'undefined') {
            dragVane.setCapture()
        }

        document.onmousemove = function (e) {
            var e = e || window.event // 兼容ie浏览器
            var left = e.clientX - diffX
            var top = e.clientY - diffY

            // 控制拖拽物体的范围只能在浏览器视窗内，不允许出现滚动条
            if (left < 0) {
                left = 0
            } else if (left > window.innerWidth - dragVane.offsetWidth) {
                left = window.innerWidth - dragVane.offsetWidth
            }
            if (top < 0) {
                top = 0
            } else if (top > window.innerHeight - dragVane.offsetHeight) {
                top = window.innerHeight - dragVane.offsetHeight
            }

            // 移动时重新得到物体的距离，解决拖动时出现晃动的现象
            dragVane.style.left = left + 'px'
            dragVane.style.top = top + 'px'
        }
        document.onmouseup = function (e) { // 当鼠标弹起来的时候不再移动
            console.log('this', this)
            this.onmousemove = null
            this.onmouseup = null // 预防鼠标弹起来后还会循环（即预防鼠标放上去的时候还会移动）

            // 修复低版本ie bug
            if (typeof dragVane.releaseCapture !== 'undefined') {
                dragVane.releaseCapture()
            }
        }
    }


</script>

<!--hashtagTooltip拖动操作设置-->
<script>
    // 拖拽功能(主要是触发三个事件：onmousedown\onmousemove\onmouseup)
    var dragHashtag = document.getElementById('hashtagTooltip')

    // 点击某物体时，用drag对象即可，move和up是全局区域，也就是整个文档通用，应该使用document对象而不是drag对象(否则，采用drag对象时物体只能往右方或下方移动)
    dragHashtag.onmousedown = function (e) {
        var e = e || window.event // 兼容ie浏览器
        var diffX = e.clientX - dragHashtag.offsetLeft // 鼠标点击物体那一刻相对于物体左侧边框的距离=点击时的位置相对于浏览器最左边的距离-物体左边框相对于浏览器最左边的距离
        var diffY = e.clientY - dragHashtag.offsetTop

        /* 低版本ie bug:物体被拖出浏览器可是窗口外部时，还会出现滚动条，
                解决方法是采用ie浏览器独有的2个方法setCapture()\releaseCapture(),这两个方法，
                可以让鼠标滑动到浏览器外部也可以捕获到事件，而我们的bug就是当鼠标移出浏览器的时候，
                限制超过的功能就失效了。用这个方法，即可解决这个问题。注：这两个方法用于onmousedown和onmouseup中 */
        if (typeof dragHashtag.setCapture !== 'undefined') {
            dragHashtag.setCapture()
        }

        document.onmousemove = function (e) {
            var e = e || window.event // 兼容ie浏览器
            var left = e.clientX - diffX
            var top = e.clientY - diffY

            // 控制拖拽物体的范围只能在浏览器视窗内，不允许出现滚动条
            if (left < 0) {
                left = 0
            } else if (left > window.innerWidth - dragHashtag.offsetWidth) {
                left = window.innerWidth - dragHashtag.offsetWidth
            }
            if (top < 0) {
                top = 0
            } else if (top > window.innerHeight - dragHashtag.offsetHeight) {
                top = window.innerHeight - dragHashtag.offsetHeight
            }

            // 移动时重新得到物体的距离，解决拖动时出现晃动的现象
            dragHashtag.style.left = left + 'px'
            dragHashtag.style.top = top + 'px'
        }
        document.onmouseup = function (e) { // 当鼠标弹起来的时候不再移动
            console.log('this', this)
            this.onmousemove = null
            this.onmouseup = null // 预防鼠标弹起来后还会循环（即预防鼠标放上去的时候还会移动）

            // 修复低版本ie bug
            if (typeof dragHashtag.releaseCapture !== 'undefined') {
                dragHashtag.releaseCapture()
            }
        }
    }


</script>

<!--隐形div点击事件：收回所有tooltip-->
<script>
    var keyEventSelectedId;
    var isOverlayTooltipShow = false;

    var blockDivOnClick = function () {
        //如果是overlay Tooltip的收回
        if(isOverlayTooltipShow)
        {
            isOverlayTooltipShow = false;

            d3.select("#overlayTooltip")
                .style("display", "none");

            if(showFixedTooltip) //如果还有其他tooltip展开的
            {
                $("#invisibleBlock")
                    .css("width", 1480 / 1728 * window.innerWidth)
                    .css("height", 773.28 / 886 * window.innerHeight)
                    .css("top", 60 / 886 * window.innerHeight)
                    .css("left", 110 / 1728 * window.innerWidth)
                    .css("opacity", 0)
                    .css("z-index", 0);


            }else if(isVaneTooltipFixed)
            {
                //如果是点击vane出现tooltip，设置隐形div阻挡vane栏
                $("#invisibleBlock")
                    .css("height", 773.28 / 886 * window.innerHeight)
                    .css("top", 60 / 886 * window.innerHeight)
                    .css("width", 1550 / 1728 * window.innerWidth)
                    .css("left", 32 / 1728 * window.innerWidth)
                    .css("opacity", 0)
                    .css("z-index", 0)

            }
            else if(isHashtagTooltipFixed)
            {
                //如果是点击hashtag出现tooltip，设置隐形div阻挡hashtag栏
                $("#invisibleBlock")
                    .css("width", 1480 / 1728 * window.innerWidth)
                    .css("height", 850 / 886 * window.innerHeight)
                    .css("top", 20 / 886 * window.innerHeight)
                    .css("left", 110 / 1728 * window.innerWidth)
                    .css("opacity", 0)
                    .css("z-index", 0)

            }
            else{
                $("#invisibleBlock")
                    .css("display", "none")
                    .css("opacity", 0)
                    .css("z-index", 0)
            }
            return;
        }

        //点击其他部分，退出聚焦div模式
        $("#invisibleBlock").css("display", "none");


        //如果seed内容是展开的，收回
        if (isShowFull) {
            showFull();
        }

        //如果风向标内容是展开的，收回
        if (isShowFullVane) {
            showFullVane();
        }

        //如果hashtag内容是展开的，收回；并且hashtag取消点击状态
        if (isshowFullHashtag) {
            showFullHashtag();
        }


        if (isHashtagTooltipFixed) // 如果是话题tooltip的阻挡
        {
            //streamGraph取消高亮
            d3.selectAll(".myArea").style("opacity", 1).style("stroke", "none")  // 恢复正常

            //seed group高亮
            d3.selectAll(".samaraSeed").style("opacity", 1)


            isHashtagTooltipFixed = false;
            d3.select("#hashtagTooltip")
                .style("display", "none");

            //返回图标未选中的样子
            for(let i = 0; i <=7; i++)
            {
                console.log("aa")
                d3.select(`#hashtagCir${i}`)
                    .attr("fill", "#FFF9F0")
                    .attr("opacity", 0);

                //图标变成前景色
                d3.select(`#hashtag${i}`)
                    .attr("fill", "#ffc000")
                    .attr("opacity", 1);
            }
        }

        if (isVaneTooltipFixed) // 如果是风向标的阻挡
        {
            isVaneTooltipFixed = false;
            d3.select("#vaneTooltip")
                .style("display", "none");
        }

        if (showFixedTooltip) // 如果是因为要阻挡种子
        {
            showFixedTooltip = false; //取消显示fixed div

            seedTooltip
                .style("opacity", 0)
                .style("display", "none")
                .style("z-index", "-10")

            TooltipLine
                .style("opacity", 0);

            d3.select(`#emo_grad_end${selectedSeed
                .attr("id")
                .split("interactCircle")[1]}`)
                .transition()
                .duration(500)
                .attr("offset", "0.1")
                .style("stop-opacity", "0")

            d3.select(`#emo_grad_start${selectedSeed
                .attr("id")
                .split("interactCircle")[1]}`)
                .transition()
                .duration(500)
                // .attr("offset", "1")
                .style("stop-color", d3.select(
                    `#emo_grad_end${selectedSeed
                        .attr("id")
                        .split("interactCircle")[1]}`)
                    .style("stop-color"));

            d3.selectAll(`.seedleaf${selectedSeed
                .attr("id")
                .split("interactCircle")[1]}`)
                .transition()
                .duration(500)
                // .attr("offset", "1")
                .attr("opacity", "0.2");

            //seed叶面渐变动画
            d3.select(`#seedWid${selectedSeed
                .attr("id")
                .split("interactCircle")[1]}`)
                .transition()
                .duration(500)
                .style("opacity", "0.2");

            //streamGraph对应地方取消高亮
            d3.selectAll(".myArea").style("opacity", 1).style("stroke", "none")  // 恢复正常
        }


        //vane图标背景隐藏
        d3.select(`#windVaneBg${keyEventSelectedId}`)
            .attr("opacity", 0);
        //图标颜色更改
        d3.select(`#windVaneBody${keyEventSelectedId}`)
            .attr("fill", "#ffc000")

        d3.select(`#windVaneEye${keyEventSelectedId}`)
            .attr("fill", "#fff8ef")

        d3.select(`#windVaneWing${keyEventSelectedId}`)
            .attr("fill", "#fff8ef")

    }
</script>

<!--隐形div的设置：点击show more之后出现隐形div阻挡鱼眼交互-->
<!--show more 的点击交互函数-->
<script>
    $("#invisibleBlock")
        .css("width", 1480 / 1728 * window.innerWidth)
        .css("height", 773.28 / 886 * window.innerHeight)
        .css("top", 60 / 886 * window.innerHeight)
        .css("left", 110 / 1728 * window.innerWidth);

    var isShowFull = false;
    var showFull = function () {
        if (!isShowFull) //展开全部
        {
            //交换长短内容的位置
            let str = d3.select("#postContent").attr("content");

            d3.select("#postContent")
                .attr("content", d3.select("#postContent").html());

            d3.select("#postContent")
                .html(str);

            d3.select("#showFullaTag").html("show less");

            $("#emotionScaleDiv").css("display", "block");


            //处理如果展开内容会超出浏览器视口情况
            if (document.getElementById("seedTooltip").offsetHeight + parseFloat(d3.select("#seedTooltip").style("top").split("px")[0]) > window.innerHeight)
                d3.select("#seedTooltip").style("top", `${window.innerHeight - document.getElementById("seedTooltip").offsetHeight - 10}px`)

            isShowFull = true;
        } else { //收回全部
            let str = d3.select("#postContent").attr("content");

            d3.select("#postContent")
                .attr("content", d3.select("#postContent").html());

            d3.select("#postContent")
                .html(str);

            d3.select("#showFullaTag").html("show more")

            $("#emotionScaleDiv").css("display", "none");

            isShowFull = false;
        }

    }

    var isShowFullVane = false;
    //风向标的全部显示
    var showFullVane = function () {
        if (!isShowFullVane) {
            //交换长短内容的位置
            let str = d3.select("#vaneContent").attr("content");

            d3.select("#vaneContent")
                .attr("content", d3.select("#vaneContent").html());

            d3.select("#vaneContent")
                .html(str);

            d3.select("#showFullVane").html("show less");

            isShowFullVane = true;
        } else {

            //交换长短内容的位置
            let str = d3.select("#vaneContent").attr("content");

            d3.select("#vaneContent")
                .attr("content", d3.select("#vaneContent").html());

            d3.select("#vaneContent")
                .html(str);

            d3.select("#showFullVane").html("show more");

            isShowFullVane = false;
        }
    }

    var isshowFullHashtag = false;
    var showFullHashtag = function () {
        if (!isshowFullHashtag) {
            //交换长短内容的位置
            let str = d3.select("#hashtagGroupInclude").attr("content");

            d3.select("#hashtagGroupInclude")
                .attr("content", d3.select("#hashtagGroupInclude").html());

            d3.select("#hashtagGroupInclude")
                .html(str);

            d3.select("#showFullHashtag").html("show less");

            isshowFullHashtag = true;
        } else {
            //交换长短内容的位置
            let str = d3.select("#hashtagGroupInclude").attr("content");

            d3.select("#hashtagGroupInclude")
                .attr("content", d3.select("#hashtagGroupInclude").html());

            d3.select("#hashtagGroupInclude")
                .html(str);

            d3.select("#showFullHashtag").html("show more");

            isshowFullHashtag = false;
        }

    }
</script>

<!--滑条视口代码-->
<script>
    // $("#scrollViewBox").css("top", window.innerHeight * 0.08);
    $("#scrollViewBox").css("height", window.innerHeight * 0.96 / 32);
</script>

<!--滑动视口支持拖动-->
<script>

    // 拖拽功能(主要是触发三个事件：onmousedown\onmousemove\onmouseup)
    var dragViewBox = document.getElementById('scrollViewBox')

    //判断是否在拖动viewBox
    var isDragViewBox = false;

    // 点击某物体时，用drag对象即可，move和up是全局区域，也就是整个文档通用，应该使用document对象而不是drag对象(否则，采用drag对象时物体只能往右方或下方移动)
    dragViewBox.onmousedown = function (e) {
        var e = e || window.event // 兼容ie浏览器

        var diffY = e.clientY - dragViewBox.offsetTop

        const timelineTopDist = document.getElementById('samaraTimelineEnter').getBoundingClientRect().top - document.getElementById('pageStart').getBoundingClientRect().top; //timeline距离顶部距离


        var scrollReverseBoxScale = d3.scaleLinear()  // 反向，滚动窗口映射到画布
            .domain([0.08 * window.innerHeight, (0.94 * window.innerHeight - (window.innerHeight * 0.96 / 32))])
            .range([timelineTopDist, timelineTopDist + 31 * 0.98 * window.innerHeight])


        /* 低版本ie bug:物体被拖出浏览器可是窗口外部时，还会出现滚动条，
                解决方法是采用ie浏览器独有的2个方法setCapture()\releaseCapture(),这两个方法，
                可以让鼠标滑动到浏览器外部也可以捕获到事件，而我们的bug就是当鼠标移出浏览器的时候，
                限制超过的功能就失效了。用这个方法，即可解决这个问题。注：这两个方法用于onmousedown和onmouseup中 */
        if (typeof dragViewBox.setCapture !== 'undefined') {
            dragViewBox.setCapture()
        }

        document.onmousemove = function (e) {
            var e = e || window.event // 兼容ie浏览器
            // var left = e.clientX - diffX
            var top = e.clientY - diffY

            // 控制拖拽物体的范围只能在浏览器视窗内，不允许出现滚动条
            //0.02和0.98为滚动条背景的高度范围
            if (top < 0.08 * window.innerHeight) {
                top = 0.08 * window.innerHeight
            } else if (top > 0.94 * window.innerHeight - dragViewBox.offsetHeight) {
                top = 0.94 * window.innerHeight - dragViewBox.offsetHeight
            }

            // 移动时重新得到物体的距离，解决拖动时出现晃动的现象
            dragViewBox.style.top = top + 'px'

            //更新date显示的时间
            // let minTopDelta = ((0.94 * window.innerHeight - dragViewBox.offsetHeight) - 0.08 * window.innerHeight) / 32;
            // let dateLst = ["Jan 28", "Jan 29", "Jan 30", "Jan 31"]
            // for(let i=1; i<=28; i++)
            //     dateLst.push(`Feb ${i}`)
            // dateLst.push("Feb 28")

            // d3.select("#dateDiv")
            //     .html(dateLst[parseInt((top - 0.08 * window.innerHeight) / minTopDelta)] + " ,2022")


            //改变viewBox
            // timelineSvg
            //     .attr("viewBox", `0 ${scrollReverseBoxScale(top)} ${windowWid * 0.96} ${windowHei * 0.98}`);

            window.scrollTo({
                top: scrollReverseBoxScale(top),
                behavior: "instant"
            });
            scrolledDis = scrollReverseBoxScale(top);

            //正在拖动viewbox
            isDragViewBox = true;
        }
        document.onmouseup = function (e) { // 当鼠标弹起来的时候不再移动
            // console.log('this', this)
            this.onmousemove = null
            this.onmouseup = null // 预防鼠标弹起来后还会循环（即预防鼠标放上去的时候还会移动）

            // 修复低版本ie bug
            if (typeof dragViewBox.releaseCapture !== 'undefined') {
                dragViewBox.releaseCapture()
            }

            //停止拖动viewbox
            isDragViewBox = false;
        }
    }

</script>

<!--渐变条绘制-->
<script>
    var windlineSvg = d3.select("#windLineBg")
        .append("svg")
        .attr("height", window.innerHeight * 0.98)
        .attr("width", "100%");
    // .style("top", 0.01 * window.innerHeight)

    //改变fixed元素的上边距
    $("#windLineBg").css("top", 0.01 * window.innerHeight);
    $("#windLineBg").css("left", 0.02 * window.innerWidth);


    var windPosX = [];
    var deltaXOffset = (1 - 0.02 - 120 / 1728) / 10; //0.02是左边距；120/1728是右边距（100是背景条宽度；20是背景条距离右侧边距）；等分为10份

    for (let i = 1; i <= 9; i++) {
        windPosX.push((i * deltaXOffset) * window.innerWidth)
    }

    //绘制渐变条
    {
        function linearAddStop(gradient) {
            var stop1 = gradient.append("stop")
                .attr("offset", "0")
                .style("stop-color", "#ffca36")
                .style("stop-opacity", "0");

            var stop2 = gradient.append("stop")
                .attr("offset", "0.3")
                .style("stop-color", "#ffca36")
                .style("stop-opacity", "0.4");

            var stop3 = gradient.append("stop")
                .attr("offset", "0.5")
                .style("stop-color", "#ffca36")
                .style("stop-opacity", "0.5");

            var stop2 = gradient.append("stop")
                .attr("offset", "0.7")
                .style("stop-color", "#ffca36")
                .style("stop-opacity", "0.4");

            var stop1 = gradient.append("stop")
                .attr("offset", "1")
                .style("stop-color", "#ffca36")
                .style("stop-opacity", "0");

        }

        function linearAddStopNoTag(gradient) {
            var stop1 = gradient.append("stop")
                .attr("offset", "0")
                .style("stop-color", "#bebebe")
                .style("stop-opacity", "0");

            var stop2 = gradient.append("stop")
                .attr("offset", "0.3")
                .style("stop-color", "#bebebe")
                .style("stop-opacity", "0.4");

            var stop3 = gradient.append("stop")
                .attr("offset", "0.5")
                .style("stop-color", "#bebebe")
                .style("stop-opacity", "0.5");

            var stop2 = gradient.append("stop")
                .attr("offset", "0.7")
                .style("stop-color", "#bebebe")
                .style("stop-opacity", "0.4");

            var stop1 = gradient.append("stop")
                .attr("offset", "1")
                .style("stop-color", "#bebebe")
                .style("stop-opacity", "0");
        }


        var defs = windlineSvg.append("defs");

        var windlineGrad = defs.append("linearGradient")
            .attr("id", "windlineGrad")
            .attr("gradientUnits", "userSpaceOnUse");
        linearAddStop(windlineGrad);

        windlineGrad
            .attr("x1", 0.2 * window.innerWidth)
            .attr("x2", 0.2 * window.innerWidth)
            .attr("y1", 0.05 * window.innerHeight)
            .attr("y2", 0.95 * window.innerHeight);


        var noTagGrad = defs.append("linearGradient")
            .attr("id", "noTagGrad")
            .attr("gradientUnits", "userSpaceOnUse");
        linearAddStopNoTag(noTagGrad);

        noTagGrad
            .attr("x1", 0.2 * window.innerWidth)
            .attr("x2", 0.2 * window.innerWidth)
            .attr("y1", 0.05 * window.innerHeight)
            .attr("y2", 0.95 * window.innerHeight);


        var wind1 = windlineSvg.append("line")
            .attr("x1", windPosX[0])
            .attr("x2", windPosX[0])
            .attr("y1", 0.05 * window.innerHeight)
            .attr("y2", 0.95 * window.innerHeight)
            .attr("stroke-width", "2")
            .attr("stroke", "url(#" + windlineGrad.attr("id") + ")")

        var wind2 = windlineSvg.append("line")
            .attr("x1", windPosX[1])
            .attr("x2", windPosX[1])
            .attr("y1", 0.05 * window.innerHeight)
            .attr("y2", 0.95 * window.innerHeight)
            .attr("stroke-width", "2")
            .attr("stroke", "url(#" + windlineGrad.attr("id") + ")")

        var wind3 = windlineSvg.append("line")
            .attr("x1", windPosX[2])
            .attr("x2", windPosX[2])
            .attr("y1", 0.05 * window.innerHeight)
            .attr("y2", 0.95 * window.innerHeight)
            .attr("stroke-width", "2")
            .attr("stroke", "url(#" + windlineGrad.attr("id") + ")")

        var wind4 = windlineSvg.append("line")
            .attr("x1", windPosX[3])
            .attr("x2", windPosX[3])
            .attr("y1", 0.05 * window.innerHeight)
            .attr("y2", 0.95 * window.innerHeight)
            .attr("stroke-width", "2")
            .attr("stroke", "url(#" + windlineGrad.attr("id") + ")")

        var wind5 = windlineSvg.append("line")
            .attr("x1", windPosX[4])
            .attr("x2", windPosX[4])
            .attr("y1", 0.05 * window.innerHeight)
            .attr("y2", 0.95 * window.innerHeight)
            .attr("stroke-width", "2")
            .attr("stroke", "url(#" + windlineGrad.attr("id") + ")")

        var wind6 = windlineSvg.append("line")
            .attr("x1", windPosX[5])
            .attr("x2", windPosX[5])
            .attr("y1", 0.05 * window.innerHeight)
            .attr("y2", 0.95 * window.innerHeight)
            .attr("stroke-width", "2")
            .attr("stroke", "url(#" + windlineGrad.attr("id") + ")")

        var wind7 = windlineSvg.append("line")
            .attr("x1", windPosX[6])
            .attr("x2", windPosX[6])
            .attr("y1", 0.05 * window.innerHeight)
            .attr("y2", 0.95 * window.innerHeight)
            .attr("stroke-width", "2")
            .attr("stroke", "url(#" + windlineGrad.attr("id") + ")")

        var wind8 = windlineSvg.append("line")
            .attr("x1", windPosX[7])
            .attr("x2", windPosX[7])
            .attr("y1", 0.05 * window.innerHeight)
            .attr("y2", 0.95 * window.innerHeight)
            .attr("stroke-width", "2")
            .attr("stroke", "url(#" + windlineGrad.attr("id") + ")")


        var wind9NoTag = windlineSvg.append("line")
            .attr("x1", windPosX[8])
            .attr("x2", windPosX[8])
            .attr("y1", 0.05 * window.innerHeight)
            .attr("y2", 0.95 * window.innerHeight)
            .attr("stroke-width", "2")
            .attr("stroke", "url(#" + noTagGrad.attr("id") + ")")

    }
</script>


<!--绘制主要时间线-->
<script>
    var windowHei = window.innerHeight;
    var windowWid = window.innerWidth;

    //设置主div的宽度
    $("#samaraTimeline").css("width", windowWid * 0.96);

    var timelineSvg = d3.select("#samaraTimeline")
        .append("svg")
        .attr("id", "timelineSvg")
        .attr("width", "100%") //使用viewBox参数，就不用height width了
        .attr("height", windowHei * 32 * 0.98)

    var seedGroup = timelineSvg.append("g")
        .attr("id", "seedGroup"); //存放生成seed的group

    //绘制顶部和底部的过渡渐变矩形
    {//设置渐变过度条高度
        $("#gradRectBg").css("width", windowWid * 0.96);
        $("#gradRectBg").css("left", windowWid * 0.02);

        $("#gradRectBg2").css("width", windowWid * 0.96);
        $("#gradRectBg2").css("left", windowWid * 0.02);


        var gradRectSvg1 = d3.select("#gradRectBg")
            .attr("id", "gradRectSvg1")
            .append("svg")
            .attr("width", "100%")
            .attr("height", 0.12 * windowHei)

        var gradRectSvg2 = d3.select("#gradRectBg2")
            .attr("id", "gradRectSvg2")
            .append("svg")
            .attr("width", "100%")
            .attr("height", 0.1 * windowHei)

        //遮脚线div设置
        d3.select("#gradRectBg3")
            .append("svg")
            .attr("width", 0.92 * windowWid)
            .attr("height", 0.02 * windowHei)
            .append("rect")
            .attr("x", "0")
            .attr("y", "0")
            .attr("width", 0.92 * windowWid)
            .attr("height", 0.02 * windowHei)
            .attr("fill", "#141414")


        //设置过渡矩形渐变
        var gradRect1 = defs.append("linearGradient")
            .attr("id", "gradRect1")
            .attr("gradientUnits", "userSpaceOnUse")
            .attr("x1", "0")
            .attr("x2", "0")
            .attr("y1", "0")
            .attr("y2", 0.12 * windowHei);

        gradRect1.append("stop")
            .attr("offset", "0.5")
            .style("stop-color", "#141414")
            .style("stop-opacity", "1");

        gradRect1.append("stop")
            .attr("offset", "1")
            .style("stop-color", "#141414")
            .style("stop-opacity", "0");


        var gradRect2 = defs.append("linearGradient")
            .attr("id", "gradRect2")
            .attr("gradientUnits", "userSpaceOnUse")
            .attr("x1", "0")
            .attr("x2", "0")
            .attr("y1", 0.1 * windowHei)
            .attr("y2", 0);

        gradRect2.append("stop")
            .attr("offset", "0.5")
            .style("stop-color", "#141414")
            .style("stop-opacity", "1");

        gradRect2.append("stop")
            .attr("offset", "1")
            .style("stop-color", "#141414")
            .style("stop-opacity", "0");


        //过渡矩形设置
        gradRectSvg1.append("rect")
            .attr("x", "0")
            .attr("y", "0")
            .attr("width", 0.92 * windowWid)
            .attr("height", 0.12 * windowHei)
            .attr("fill", "url(#" + gradRect1.attr("id") + ")")

        gradRectSvg2.append("rect")
            .attr("x", "0")
            .attr("y", "0")
            .attr("width", 0.92 * windowWid)
            .attr("height", 0.1 * windowHei)
            .attr("fill", "url(#" + gradRect2.attr("id") + ")")
    }


    var interactCirGroup = timelineSvg.append("g")
        .attr("id", "interactCirGroup"); //存放生成seed的group


</script>

<!--hashtag绘制-->
<script>

    var hashtagTooltip = d3.select("#hashtagTooltip")

    let hashtagTooltipMouseover = function (d) {

        let hashtagGroupIndex;

        if (d3.select(this).attr("id").indexOf("hashtagCir") > -1) // id是hashtagCir__
        {
            hashtagGroupIndex = parseInt(d3.select(this).attr("id").split("hashtagCir")[1]);

        } else {
            hashtagGroupIndex = parseInt(d3.select(this).attr("id").split("hashtag")[1]);
        }

        //高亮streamGraph
        d3.selectAll(".myArea").style("opacity", .3) //其他变半透明
        d3.select(`#streamGraph${hashtagGroupIndex}`)
            //.style("stroke", "black")
            .style("opacity", 1)

        //seed group高亮
        d3.selectAll(".samaraSeed").style("opacity", .3)
        console.log(`.seedWindLineGroup${hashtagGroupIndex+1}`)
        d3.selectAll(`.seedWindLineGroup${hashtagGroupIndex+1}`).style("opacity", 1)


        //如果是最后两个话题，不显示jump to key event
        if(hashtagGroupIndex == 6 || hashtagGroupIndex == 7)
        {
            d3.select("#jumpToKeyEventSvg")
                .style("display", "none")
        }
        else{
            d3.select("#jumpToKeyEventSvg")
                .style("display", "inline")
        }

        //显示tooltip，定位
        hashtagTooltip
            .style("left", `${windPosX[hashtagGroupIndex] - 116 * widScaleRatio}px`)
            .style("top", `${windowWid * 0.04}px`)
            .style("display", "block");

        //更改名称：Hashtag Group · X
        d3.select("#hashtagGroupNum")
            .html(`Hashtag Group · ${hashtagGroupIndex + 1}`);

        //subtitle内容更新
        d3.select("#hashtagGroupSubtitle")
            .html(hashtagNodes[hashtagGroupIndex]["event"]);

        let fullHashtags;
        let maxNumofHashtag = 4;

        fullHashtags = "included hashtags:<br>"
        for (let i = 0; i < hashtagNodes[hashtagGroupIndex]["hashtags"].length; i++) {
            fullHashtags += hashtagNodes[hashtagGroupIndex]["hashtags"][i]
            fullHashtags += "<br>"
        }
        if (hashtagNodes[hashtagGroupIndex]["hashtags"].length <= maxNumofHashtag) { //内容最多显示4条
            d3.select("#hashtagGroupInclude")
                .html(fullHashtags)
                .attr("content", fullHashtags);
        } else {
            d3.select("#hashtagGroupInclude")
                .attr("content", fullHashtags);

            d3.select("#hashtagGroupInclude")
                .html(function () {
                    let res;

                    res = "included hashtags:<br>"
                    for (let i = 0; i < 4; i++) {
                        res += hashtagNodes[hashtagGroupIndex]["hashtags"][i]
                        if (i != 3) // 最后不加换行了
                            res += "<br>"
                    }
                    return res;

                })
        }


    }

    var isHashtagTooltipFixed = false;

    let hashtagTooltipMouseleave = function (d) {
        if (!isHashtagTooltipFixed) {
            hashtagTooltip
                .style("display", "none");
            //streamGraph取消高亮
            d3.selectAll(".myArea").style("opacity", 1).style("stroke", "none")  // 恢复正常

            //seed取消高亮
            d3.selectAll(".samaraSeed").style("opacity", 1)


        }


    }

    let hashtagTooltipMouseClick = function (d) {

        //先收回所有tooltip
        blockDivOnClick();

        $("#invisibleBlock").css("display", "block");
        isHashtagTooltipFixed = true;

        //如果是点击hashtag出现tooltip，设置隐形div阻挡hashtag栏
        $("#invisibleBlock")
            .css("width", 1480 / 1728 * window.innerWidth)
            .css("height", 850 / 886 * window.innerHeight)
            .css("top", 20 / 886 * window.innerHeight)
            .css("left", 110 / 1728 * window.innerWidth);



        //点击hashtag图标，图标更改为选中状态

        let hashtagGroupIndex;

        if (d3.select(this).attr("id").indexOf("hashtagCir") > -1) // id是hashtagCir__
        {
            hashtagGroupIndex = parseInt(d3.select(this).attr("id").split("hashtagCir")[1]);

        } else {
            hashtagGroupIndex = parseInt(d3.select(this).attr("id").split("hashtag")[1]);
        }

        //高亮streamGraph
        d3.selectAll(".myArea").style("opacity", .2) //其他变半透明
        d3.select(`#streamGraph${hashtagGroupIndex}`)
            //.style("stroke", "black")
            .style("opacity", 1)

        //标记当前选中的hashtagId
        hashtagSelectedId = hashtagGroupIndex;

        //背景变成填充色
        d3.select(`#hashtagCir${hashtagGroupIndex}`)
            .attr("fill", "#ffc000")
            .attr("opacity", 1);

        //图标变成前景色
        d3.select(`#hashtag${hashtagGroupIndex}`)
            .attr("fill", "#FFF9F0")
            .attr("opacity", 1);

    }

    for (let i = 0; i <= 7; i++) {

        //背景的圆形
        gradRectSvg1.append("circle")
            .attr("id", `hashtagCir${i}`)
            .attr("cx", windPosX[i])
            .attr("cy", 44 * heiScaleRatio)  //井号svg高为28.5
            .attr("r", windowWid * 0.012)
            .attr("fill", "#ffc000")
            .attr("opacity", 0)
            .on("mouseover", hashtagTooltipMouseover)
            .on("mouseleave", hashtagTooltipMouseleave)
            .on("click", hashtagTooltipMouseClick);


        gradRectSvg1.append("g")
            .attr("transform", `translate(${(windPosX[i] - 10 * widScaleRatio)}, ${30 * heiScaleRatio}), scale(${widScaleRatio})`) // 井号svg的宽度为20， /2 =10
            .append("path")
            .attr("id", `hashtag${i}`)
            .attr("d", "M3.32,20.09H0V16.43H3.74l.66-5.29H.89V7.44h4L5.82,0H9.1L8.21,7.44h4.86L14,0h3.31l-.89,7.44h3.48v3.7H16l-.65,5.29h3.7v3.66H14.92l-1,8.37H10.53l1-8.37H6.71l-1,8.37H2.31ZM12,16.43l.66-5.29H7.75l-.66,5.29Z")
            .attr("fill", "#ffc000")
            .on("mouseover", hashtagTooltipMouseover)
            .on("mouseleave", hashtagTooltipMouseleave)
            .on("click", hashtagTooltipMouseClick)
    }


    let keyEventYIndexScale = 1 / 886 * window.innerHeight;

    //制作点击跳转到相关key event的链接
    var keyEventYIndex = [0 * keyEventYIndexScale, 2150 * keyEventYIndexScale,
        9050 * keyEventYIndexScale, 11460 * keyEventYIndexScale, 17100 * keyEventYIndexScale,
        22200 * keyEventYIndexScale]; // 点击需要跳转到的页面高度

    //keyEventYIndex还需要加上上面页面的距离
    for(let i = 0; i < keyEventYIndex.length; i++)
    {
        keyEventYIndex[i] += document.getElementById('samaraTimelineEnter').getBoundingClientRect().top - document.getElementById('pageStart').getBoundingClientRect().top;
    }

    var hashtagSelectedId;
    var jumpToKeyEvent = function (){

        //如果是点击vane出现tooltip，设置隐形div阻挡vane栏
        $("#invisibleBlock")
            .css("height", 773.28 / 886 * window.innerHeight)
            .css("top", 60 / 886 * window.innerHeight)
            .css("width", 1550 / 1728 * window.innerWidth)
            .css("left", 32 / 1728 * window.innerWidth);

        //收回tooltip；相当于点击了一下隐形div
        blockDivOnClick();

        //展开新的tooltip
        {
            let maxLength = 100;

            isVaneTooltipFixed = true;

            d3.select("#vaneTooltip")
                .style("opacity", 0)
                .transition()
                .duration(1000)
                .style("opacity", 1); //制作渐入动画


            d3.select("#vaneTooltip")
                .style("display", "flex");

            let vanetitleGroup = ["Investigation Report 1 · county level", "Investigation Report 2 · county level",
                "Investigation Report 3 · city level", "Investigation Report 4 · city level",
                "Investigation Report 5 · provincial level", "Investigation Report 6 · provincial level"]

            d3.select("#vaneTitle")
                .html(`${vanetitleGroup[hashtagSelectedId]}`);

            d3.select("#vaneSubTitle")
                .html(keyEvents[hashtagSelectedId].subtitle);

            //关键事件内容填充
            if (keyEvents[hashtagSelectedId].content.length > maxLength) {
                d3.select("#showFullVane")
                    .style("display", "inline-flex");

                d3.select("#vaneContent")
                    .attr("content", keyEvents[hashtagSelectedId].content);

                d3.select("#vaneContent")
                    .html(keyEvents[hashtagSelectedId].content.substring(0, maxLength + 1) + "...");
            } else {
                d3.select("#showFullVane")
                    .style("display", "none");

                d3.select("#vaneContent")
                    .attr("content", keyEvents[hashtagSelectedId].content);

                d3.select("#vaneContent")
                    .html(keyEvents[hashtagSelectedId].content);
            }

            d3.select("#vaneFrom")
                .html(keyEvents[hashtagSelectedId].from);

            d3.select("#vaneDate")
                .html(keyEvents[hashtagSelectedId].date);


            $("#invisibleBlock").css("display", "block");

            d3.select("#vaneTooltip")
                .style("display", "flex");

        }

        //更改vane图标的颜色
        d3.select(`#windVaneBg${hashtagSelectedId}`)
            .attr("opacity", 1)

        d3.select(`#windVaneBody${hashtagSelectedId}`)
            .attr("fill", "#fff8ef")

        d3.select(`#windVaneEye${hashtagSelectedId}`)
            .attr("fill", "#ffc000")

        d3.select(`#windVaneWing${hashtagSelectedId}`)
            .attr("fill", "#ffc000")



        //更新选中的key event id
        keyEventSelectedId = hashtagSelectedId;

        //窗口滚动
        window.scrollTo({
            top: keyEventYIndex[hashtagSelectedId],
            // behavior: "smooth"
        });

        let scrollTop = document.documentElement.scrollTop || document.body.scrollTop;

        if(hashtagSelectedId == 0) //如果是第一个标签；顶部挡住了不能居中，所以tooltip显示在上端
        {
            d3.select("#vaneTooltip")
                .style("top", `${ 100 }px`) // 选择悬停物体的父元素（g标签）
        }else{
            d3.select("#vaneTooltip")
                .style("top", `${window.innerHeight / 2 - 150}px`) // 选择悬停物体的父元素（g标签）
        }


    }
</script>

<!--风向标绘制-->
<script>
    var vaneDis = [100 * heiScaleRatio, 2550 * heiScaleRatio, 9450 * heiScaleRatio, 11850 * heiScaleRatio, 17480 * heiScaleRatio, 22580 * heiScaleRatio]
    var keyEvents;
    var isVaneTooltipFixed = false; // 是否被隐形div阻挡

    //读取key event 数据
    d3.json("asset/json/key_event.json").then(function (data) {
        keyEvents = d3.range(1, 6 + 1).map(function (d, i) {
            return {
                subtitle: data[d.toString()]["subtitle"],
                content: data[d.toString()]["content"],
                from: data[d.toString()]["from"],
                date: data[d.toString()]["date"],
            }
        });
    });

    var vanemouseover = function (d) {

        let maxLength = 100;

        d3.select("#vaneTooltip")
            .style("display", "flex");

        let scrollTop = document.documentElement.scrollTop || document.body.scrollTop;

        let topDis = document.getElementById(d3.select(this).attr("id")).getBoundingClientRect().top - document.getElementById('vaneTooltip').offsetHeight / 2;
        if(topDis < 0)
        {
            topDis = 0;
        }
        else if(topDis > window.innerHeight - document.getElementById('vaneTooltip').offsetHeight)
        {
            topDis = window.innerHeight - document.getElementById('vaneTooltip').offsetHeight;
        }
        d3.select("#vaneTooltip")
            .style("top", `${ topDis }px`) // 选择悬停物体的父元素（g标签）

        let vanetitleGroup = ["Investigation Report 1 · county level", "Investigation Report 2 · county level",
            "Investigation Report 3 · city level", "Investigation Report 4 · city level",
            "Investigation Report 5 · provincial level", "Investigation Report 6 · provincial level"]

        d3.select("#vaneTitle")
            .html(`${vanetitleGroup[parseInt(d3.select(this.parentNode).attr("id").split("vane")[1])]}`);

        d3.select("#vaneSubTitle")
            .html(keyEvents[parseInt(d3.select(this.parentNode).attr("id").split("vane")[1])].subtitle);

        //关键事件内容填充
        if (keyEvents[parseInt(d3.select(this.parentNode).attr("id").split("vane")[1])].content.length > maxLength) {
            d3.select("#showFullVane")
                .style("display", "inline-flex");

            d3.select("#vaneContent")
                .attr("content", keyEvents[parseInt(d3.select(this.parentNode).attr("id").split("vane")[1])].content);

            d3.select("#vaneContent")
                .html(keyEvents[parseInt(d3.select(this.parentNode).attr("id").split("vane")[1])].content.substring(0, maxLength + 1) + "...");
        } else {
            //隐藏show more
            d3.select("#showFullVane")
                .style("display", "none");

            d3.select("#vaneContent")
                .attr("content", keyEvents[parseInt(d3.select(this.parentNode).attr("id").split("vane")[1])].content);

            d3.select("#vaneContent")
                .html(keyEvents[parseInt(d3.select(this.parentNode).attr("id").split("vane")[1])].content);
        }

        d3.select("#vaneFrom")
            .html(keyEvents[parseInt(d3.select(this.parentNode).attr("id").split("vane")[1])].from);

        d3.select("#vaneDate")
            .html(keyEvents[parseInt(d3.select(this.parentNode).attr("id").split("vane")[1])].date);


    }

    var vanemouseleave = function (d) {
        if (!isVaneTooltipFixed) {
            d3.select("#vaneTooltip")
                .style("display", "none");
        }

    }

    var vanmouseclick = function (d) {

        //先收回所有tooltip
        blockDivOnClick();

        keyEventSelectedId = parseInt(d3.select(this.parentNode).attr("id").split("vane")[1])//设置当前选中的keyEvent

        isVaneTooltipFixed = true;

        $("#invisibleBlock").css("display", "block");

        //如果是点击vane出现tooltip，设置隐形div阻挡vane栏
        $("#invisibleBlock")
            .css("height", 773.28 / 886 * window.innerHeight)
            .css("top", 60 / 886 * window.innerHeight)
            .css("width", 1550 / 1728 * window.innerWidth)
            .css("left", 32 / 1728 * window.innerWidth);

        //显示tooltip
        d3.select("#vaneTooltip")
            .style("display", "flex");

        //图标背景出现
        d3.select(`#windVaneBg${keyEventSelectedId}`)
            .attr("opacity", 1);
        //图标颜色更改
        d3.select(`#windVaneBody${keyEventSelectedId}`)
            .attr("fill", "#fff8ef")

        d3.select(`#windVaneEye${keyEventSelectedId}`)
            .attr("fill", "#ffc000")

        d3.select(`#windVaneWing${keyEventSelectedId}`)
            .attr("fill", "#ffc000")


    }

    for (let i = 0; i < vaneDis.length; i++) {


        let windVaneGroup = d3.select("#timelineSvg")
            .append("g")
            .attr("transform", `translate(0, ${vaneDis[i]})`)
            .attr("id", `vane${i}`)

        //vane图标背景色块
        windVaneGroup.append("path")
            .attr("id", `windVaneBg${i}`)
            .attr("d", "M0,0H60.79a29,29,0,0,1,29,29v0a29,29,0,0,1-29,29H0a0,0,0,0,1,0,0V0A0,0,0,0,1,0,0Z")
            .attr("fill", "#ffc000")
            .attr("opacity", 0)
            .attr("transform", `translate(0, -2), scale(${widScaleRatio})`)

        windVaneGroup.append("path")
            .attr("id", `windVaneBody${i}`)
            .attr("d", "M80.8,37.28a1,1,0,0,1-1,1H76.72l2.15,2.16a1,1,0,0,1,0,1.41,1,1,0,0,1-1.41,0l-2.22-2.22a4.54,4.54,0,0,1-3.88,2.18h-.45v3.85a1.5,1.5,0,0,1-3,0V41.81H60a15.28,15.28,0,0,1-15.11-13H37V48.49l3.09-1.12A26.08,26.08,0,0,0,36,54.72a25.83,25.83,0,0,0-4.09-7.35L35,48.49V28.86H26.54a4.47,4.47,0,0,1-8.42,0H0v-3H18.12a4.47,4.47,0,0,1,8.42,0H35V6.5a7.48,7.48,0,0,0-1.55-1.31V0A8.86,8.86,0,0,1,36,2.45,9,9,0,0,1,38.57,0V5.19A6.7,6.7,0,0,0,37,6.5V25.86h7.66A15.28,15.28,0,0,1,60,11.22h1.49V32.71h9.92a4.54,4.54,0,0,1,3.89,2.21l2.21-2.21a1,1,0,0,1,1.41,0,1,1,0,0,1,0,1.42l-2.15,2.15H79.8A1,1,0,0,1,80.8,37.28Z")
            .attr("fill", "#ffc000")
            .attr("transform", `scale(${widScaleRatio})`)
            .on("mouseover", vanemouseover)
            .on("mouseleave", vanemouseleave)
            .on("click", vanmouseclick);

        windVaneGroup.append("circle")
            .attr("id", `windVaneEye${i}`)
            .attr("cx", "69.96")
            .attr("cy", "37.3")
            .attr("r", "2")
            .attr("fill", "#fff8ef")
            .attr("transform", `scale(${widScaleRatio})`)
            .on("mouseover", vanemouseover)
            .on("mouseleave", vanemouseleave)
            .on("click", vanmouseclick);

        windVaneGroup.append("path")
            .attr("id", `windVaneWing${i}`)
            .attr("d", "M54.88,30.74a5.29,5.29,0,1,1,0-10.58.75.75,0,0,1,0,1.5,3.79,3.79,0,1,0,0,7.58.75.75,0,0,1,0,1.5Z")
            .attr("fill", "#fff8ef")
            .attr("transform", `scale(${widScaleRatio})`)
            .on("mouseover", vanemouseover)
            .on("mouseleave", vanemouseleave)
            .on("click", vanmouseclick);

    }

    var jumpToHashtag = function (){

        //图标背景出现
        d3.select(`#windVaneBg${keyEventSelectedId}`)
            .attr("opacity", 0);
        //图标颜色更改
        d3.select(`#windVaneBody${keyEventSelectedId}`)
            .attr("fill", "#ffc000")

        d3.select(`#windVaneEye${keyEventSelectedId}`)
            .attr("fill", "#fff8ef")

        d3.select(`#windVaneWing${keyEventSelectedId}`)
            .attr("fill", "#fff8ef")

        //如果是点击hashtag出现tooltip，设置隐形div阻挡hashtag栏
        $("#invisibleBlock")
            .css("width", 1480 / 1728 * window.innerWidth)
            .css("height", 850 / 886 * window.innerHeight)
            .css("top", 20 / 886 * window.innerHeight)
            .css("left", 110 / 1728 * window.innerWidth);

        //隐藏当前vane的tooltip
        d3.select("#vaneTooltip")
            .style("display", "none");

        //显示hashtag，相当于hashtag图标的悬停事件
        {
            //如果是最后两个话题，不显示jump to key event
            if(keyEventSelectedId == 6 || keyEventSelectedId == 7)
            {
                d3.select("#jumpToKeyEventSvg")
                    .style("display", "none")
            }
            else{
                d3.select("#jumpToKeyEventSvg")
                    .style("display", "inline")
            }

            //显示tooltip，定位
            hashtagTooltip
                .style("left", `${windPosX[keyEventSelectedId] - 116}px`)
                .style("top", `${windowWid * 0.04}px`)
                .style("display", "block");

            //更改名称：Hashtag Group · X
            d3.select("#hashtagGroupNum")
                .html(`Hashtag Group · ${keyEventSelectedId + 1}`);

            //subtitle内容更新
            d3.select("#hashtagGroupSubtitle")
                .html(hashtagNodes[keyEventSelectedId]["event"]);

            let fullHashtags;
            let maxNumofHashtag = 4;

            fullHashtags = "included hashtags:<br>"
            for (let i = 0; i < hashtagNodes[keyEventSelectedId]["hashtags"].length; i++) {
                fullHashtags += hashtagNodes[keyEventSelectedId]["hashtags"][i]
                fullHashtags += "<br>"
            }

            if (hashtagNodes[keyEventSelectedId]["hashtags"].length <= maxNumofHashtag) { //内容最多显示4条
                d3.select("#hashtagGroupInclude")
                    .html(fullHashtags)
                    .attr("content", fullHashtags);
            } else {
                d3.select("#hashtagGroupInclude")
                    .attr("content", fullHashtags);

                d3.select("#hashtagGroupInclude")
                    .html(function () {
                        let res;

                        res = "included hashtags:<br>"
                        for (let i = 0; i < 4; i++) {
                            res += hashtagNodes[keyEventSelectedId]["hashtags"][i]
                            if (i != 3) // 最后不加换行了
                                res += "<br>"
                        }
                        return res;

                    })
            }


        }

        //固定hashtag，相当于hashtag图标的点击事件
        {
            $("#invisibleBlock").css("display", "block");
            isHashtagTooltipFixed = true;

            //点击hashtag图标，图标更改为选中状态

            //背景变成填充色
            d3.select(`#hashtagCir${keyEventSelectedId}`)
                .attr("fill", "#ffc000")
                .attr("opacity", 1);

            //图标变成前景色
            d3.select(`#hashtag${keyEventSelectedId}`)
                .attr("fill", "#FFF9F0")
                .attr("opacity", 1);
        }

        //更新选中的hashtag id
        hashtagSelectedId = keyEventSelectedId;

    }


</script>

<!--时间标识绘制-->
<script>

    {
        let dateLst = ["Jan 28", "Jan 29", "Jan 30", "Jan 31"]
        for(let i=1; i<=28; i++)
            dateLst.push(`Feb ${i}`)

        let timeGroup = d3.select("#timelineSvg")
            .append("g")
            .attr("transform", `translate(0, ${0 * heiScaleRatio})`)
            .attr("id", `timelineTimeStamp`)

        for(let i = 0; i < dateLst.length; i++)
        {
            if(i == 0)
            {
                timeGroup
                    .append('text')
                    .attr("x", 0)
                    .attr("y", 30 * heiScaleRatio) //一天的height占据0.98屏幕高度
                    .style('font-weight', 300)
                    .style("font-size", ".7rem")
                    .style('font-family', 'noto-sans, sans-serif')
                    .style('fill', 'rgba(255,192,0,0.9)')
                    .text(dateLst[i])
            }
            else {
                timeGroup
                    .append('text')
                    .attr("x", 0)
                    .attr("y", i * window.innerHeight * 0.98) //一天的height占据0.98屏幕高度
                    .style('font-weight', 300)
                    .style("font-size", ".7rem")
                    .style('font-family', 'noto-sans, sans-serif')
                    .style('fill', 'rgba(255,192,0,0.9)')
                    .text(dateLst[i])
            }

        }

    }



</script>

<!--右侧滑块滚动; 判断是否滑动到圆形，是否高亮显示-->
<script>

    // var defsSeed = timelineSvg.append("defs");
    var scrolledDis = 0;
    const timelineTopDist = document.getElementById('samaraTimelineEnter').getBoundingClientRect().top - document.getElementById('pageStart').getBoundingClientRect().top; //timeline距离顶部距离
    var scrollBoxScale = d3.scaleLinear()
        .domain([timelineTopDist, timelineTopDist + 31 * 0.98 * window.innerHeight])
        .range([0.08 * window.innerHeight, (0.94 * window.innerHeight - (window.innerHeight * 0.96 / 32))])

    window.onscroll = function () {
        //为了保证兼容性，这里取两个值，哪个有值取哪一个
        //scrollTop就是触发滚轮事件时滚轮的高度
        var scrollTop = document.documentElement.scrollTop || document.body.scrollTop;
        // console.log("滚动距离" + scrollTop);

        let dragVBTopDis = scrollBoxScale(scrollTop);

        if(dragVBTopDis < 0.08 * window.innerHeight)
        {
            dragVBTopDis = 0.08 * window.innerHeight;
        }
        else if(dragVBTopDis > (0.94 * window.innerHeight - (window.innerHeight * 0.96 / 32)))
        {
            dragVBTopDis = (0.94 * window.innerHeight - (window.innerHeight * 0.96 / 32));
        }

        //右侧滚动视口改变位置
        if(!isDragViewBox)  // 如果没有在拖动viewbox
            $("#scrollViewBox").css("top", dragVBTopDis);


        //更新date显示的时间
        // let minTopDelta = ((0.94 * window.innerHeight - dragViewBox.offsetHeight) - 0.08 * window.innerHeight) / 32;
        // let dateLst = ["Jan 28", "Jan 29", "Jan 30", "Jan 31"]
        // for(let i=1; i<=28; i++)
        //     dateLst.push(`Feb ${i}`)
        // dateLst.push("Feb 28")




        //滑条滑到keyevent的时候圆形高亮
        let deltaRange = 300 * heiScaleRatio; //正副deltaRange的范围内认为是在这个circle内

        for(let i = 0; i < 6 ; i++)
        {
            if( keyEventYIndex[i] - deltaRange < scrollTop && scrollTop < keyEventYIndex[i] + deltaRange )
                d3.select(`#keyEventCir${i}`)
                    .style("border-bottom-left-radius", ".15rem")
                    .style("border-top-left-radius", ".15rem")
                    .style("opacity", 1);
            else
                d3.select(`#keyEventCir${i}`)
                    .style("border-bottom-left-radius", ".25rem")
                    .style("border-top-left-radius", ".25rem")
                    .style("opacity", 0.4);
        }



    }
</script>

<!--读取json数据，绘制可视化主体部分-->
<script>
    var lineGravity = 100; // 相对基准线的偏移：(0.5 - 消极概率) * 置信度 * lineGravity；MAX偏移值为 0.5 * 1 * lineGravity
    var numNodes = 4725;
    var nodes;
    var deltaXOffset = 0.08;
    var rightStrat = 0.84;

    //生成[m, n]的随机数
    function randomNum(minNum, maxNum) {
        switch (arguments.length) {
            case 1:
                return parseInt(Math.random() * minNum + 1, 10);
                break;
            case 2:
                return parseInt(Math.random() * (maxNum - minNum + 1) + minNum, 10);
                break;
            default:
                return 0;
                break;
        }
    }


    //读取json数据，返回nodes，计算力引导布局
    var samaraGroups; //存储生成samara seed的groups
    var circleGroups; //存储交互圆形的groups

    //读取seed位置
    let seedPosition;
    d3.json("asset/json/seedPos.json").then(function (data) {

        seedPosition = d3.range(0, 4725).map(function (d, i) {
            return {
                cx: data[i][0] * widScaleRatio,
                cy: data[i][1] * heiScaleRatio,
            }
        });

    });

    d3.json("asset/json/data_final.json").then(function (data) {
        var xDimScalelow = d3.scaleLinear()
            .domain([0, 11])
            .range([windowHei * 0.98 * 0, windowHei * 0.98 * 0 + windowHei * 0.98 * 0.1]);

        var xDimScalehigh = d3.scaleLinear()
            .domain([11, 24])
            .range([windowHei * 0.98 * 0 + windowHei * 0.98 * 0.1, windowHei * 0.98 * 1]);

        var corDate = ["01月28", "01月29", "01月30", "01月31", "02月01", "02月02", "02月03", "02月04", "02月05",
            "02月06", "02月07", "02月08", "02月09", "02月10", "02月11", "02月12", "02月13", "02月14", "02月15", "02月16",
            "02月17", "02月18", "02月19", "02月20", "02月21", "02月22", "02月23", "02月24", "02月25", "02月26", "02月27", "02月28"];


        nodes = d3.range(1, numNodes + 1).map(function (d, i) {

            // 找到数组中对应日期的下标
            var dateId = corDate.findIndex((element) => element == data[d.toString()]["time"].split("日")[0]);

            //根据是第几天更改线性映射; 11点前发布占10%；后发布占90%
            xDimScalelow.range([windowHei * 0.98 * dateId, windowHei * 0.98 * dateId + windowHei * 0.98 * 0.1]);
            xDimScalehigh.range([windowHei * 0.98 * dateId + windowHei * 0.98 * 0.1, windowHei * 0.98 * (dateId + 1)]);

            //消极情绪概率
            let negaEmo = data[d.toString()]["negative_prob"];
            let confidence = data[d.toString()]["senti_confidence"];
            let gravity = 80;
            let vlevel = data[d.toString()]["vlevel"];
            let like = data[d.toString()]["like"];
            let comment = data[d.toString()]["comment"];
            let retweet = data[d.toString()]["retweet"];
            let follower = data[d.toString()]["followers"];
            let hashtagfirstcat = data[d.toString()]["hashtagfirstcat"];
            let content = data[d.toString()]["content"];
            let time = data[d.toString()]["time"];
            let postname = data[d.toString()]["postname"];

            //计算是几点发布的
            var yIndex = parseFloat(data[d.toString()]["time"].split("日")[1].split(":")[0]) + parseFloat(data[d.toString()]["time"].split("日")[1].split(":")[1] / 60);
            //计算点的y坐标
            if (yIndex <= 11)  // 早于11点发布的
            {
                yIndex = xDimScalelow(yIndex);
                if (yIndex < 100) //处理最上面无法交互的点
                    yIndex = 150;
            } else  // 晚于11点发布点
            {
                yIndex = xDimScalehigh(yIndex);
            }

            var xIndex;
            if (negaEmo <= 0.5) {
                xIndex = windPosX[(data[d.toString()]["hashtagfirstcat"] + 8) % 9] + (0.7 - negaEmo) * (gravity + randomNum(20, 30)); // firsttag = 0时，数组下标需要 = 8; 加入随机化因数
            } else {
                xIndex = windPosX[(data[d.toString()]["hashtagfirstcat"] + 8) % 9] + (0.5 - negaEmo) * (gravity + randomNum(10, 20)); // firsttag = 0时，数组下标需要 = 8; 加入随机化因数
            }

            var hashtagXIndex = windPosX[(data[d.toString()]["hashtagfirstcat"] + 8) % 9];

            return {
                xIndex: xIndex,
                yIndex: yIndex,
                negaEmo: negaEmo,
                confidence: confidence,
                vlevel: vlevel,
                like: like,
                comment: comment,
                retweet: retweet,
                follower: follower,
                hashtagXIndex: hashtagXIndex,
                hashtagfirstcat: hashtagfirstcat,
                content: content,
                time: time,
                postname: postname,
            }
        });


        function drawSeed() {

            samaraGroups = d3.select('#seedGroup')
                .selectAll('g.samaraSeed')
                .data(nodes)
                .enter()
                .append('g')
                .datum( function(d, i) {
                    return {x: parseFloat(seedPosition[i]["cx"]), y: parseFloat(seedPosition[i]["cy"]), hashtagfirstcat: d.hashtagfirstcat}
                })
                .attr("class", function (d, i){
                    return `samaraSeed seedWindLineGroup${d.hashtagfirstcat}`;
                })
                .attr("id", function (d, i) {
                    return `seed${i}`
                })

            circleGroups = d3.select('#interactCirGroup')
                .selectAll('g.interactCircle')
                .data(nodes)
                .enter()
                .append('g')
                .datum( function(d, i) {
                    return {x: parseFloat(seedPosition[i]["cx"]), y: parseFloat(seedPosition[i]["cy"])}
                })
                .attr("class", "interactCircle")
                .attr("id", function (d, i) {
                    return `interactCircle${i}`
                })

            // console.log("end!")
            for (let i = 0; i < 4725; i++) {
                // console.log($(`#seedHead3.svg${i}`).attr("vlevel"))
                geneSeed(i, parseFloat(seedPosition[i]["cx"]), parseFloat(seedPosition[i]["cy"]), nodes[i].negaEmo, nodes[i].confidence, nodes[i].vlevel, nodes[i].like, nodes[i].comment, nodes[i].retweet,
                    nodes[i].follower, nodes[i].hashtagXIndex, nodes[i].hashtagfirstcat, widScaleRatio);

                geneCir(i, parseFloat(seedPosition[i]["cx"]), parseFloat(seedPosition[i]["cy"]), nodes[i].negaEmo, nodes[i].confidence, nodes[i].follower, nodes[i].hashtagfirstcat, nodes[i].hashtagXIndex);
                console.log("finish")

                // seedPosition.push([$(`#seedHead3.svg${i}`).attr("cx"), $(`#seedHead3.svg${i}`).attr("cy")]);
            }
            updateSvgOnMouseMove();
        }

        drawSeed();

    });

    //制作鱼眼效果
    var fisheye = d3.fisheye.circular().radius(100);

    function updateSvgOnMouseMove() {
        //界面生成完之后再进行移动事件的绑定
        timelineSvg.on("mousemove", function () {
            fisheye.focus(d3.pointer(event, this));

            // 位置一起变化
            // groups.each(function(d) { d.fisheye = fisheye(d); })
            //         .attr("transform", function (d){ return `translate(${d.fisheye.x}, ${d.fisheye.y}),scale(${d.fisheye.z})`; })

            samaraGroups.each(function (d) {
                d.fisheye = fisheye(d);
            })
                //.attr("transform", `translate(${cx}, ${cy}),rotate(${negascale(negaEmo * confidence)}),scale(-0.1, 0.1)`) //rotate(-20,300,400)
                .attr("transform", function (d) {
                    if (d3.select(this).attr("transform").split("scale")[1].indexOf(",") != -1) // 存在scale(-0.1, 0.1)的情况
                    {
                        let rotStr = d3.select(this).attr("transform").split("rotate")[1].split(",")[0];
                        // console.log(d3.select(this).attr("transform"));

                        return `translate(${d.fisheye.x}, ${d.fisheye.y}),` + `rotate${rotStr},` + `scale(${-0.12 * d.fisheye.z * widScaleRatio}, ${0.12 * d.fisheye.z * widScaleRatio})`
                    } else {
                        let rotStr = d3.select(this).attr("transform").split("rotate")[1].split(",")[0]
                        return `translate(${d.fisheye.x}, ${d.fisheye.y}),` + `rotate${rotStr},` + `scale(${0.12 * d.fisheye.z * widScaleRatio})`
                    }

                });

            circleGroups.each(function (d) {
                d.fisheye = fisheye(d);
            })
                .attr("transform", function (d) {
                    if (d3.select(this).attr("transform").split("scale")[1].indexOf(",") != -1) // 存在scale(-0.1, 0.1)的情况
                    {
                        return `translate(${d.fisheye.x}, ${d.fisheye.y}),`  + `scale(${-0.12 * d.fisheye.z * widScaleRatio}, ${0.12 * d.fisheye.z * widScaleRatio})`

                        // return d3.select(this).attr("transform").split("scale")[0] + `scale(${-0.12 * d.fisheye.z * widScaleRatio}, ${0.12 * d.fisheye.z * widScaleRatio})`
                    } else {

                        return `translate(${d.fisheye.x}, ${d.fisheye.y}),` + `scale(${0.12 * d.fisheye.z * widScaleRatio})`

                        // return d3.select(this).attr("transform").split("scale")[0] + `scale(${0.12 * d.fisheye.z * widScaleRatio})`
                    }

                });


        });

        //在上方过渡矩形内移动，取消鱼眼效果
        gradRectSvg1.on("mousemove", function () {
            fisheye.focus(d3.pointer(event, this));

            // 位置一起变化
            // groups.each(function(d) { d.fisheye = fisheye(d); })
            //         .attr("transform", function (d){ return `translate(${d.fisheye.x}, ${d.fisheye.y}),scale(${d.fisheye.z})`; })

            samaraGroups.each(function (d) {
                d.fisheye = fisheye(d);
            })
                //.attr("transform", `translate(${cx}, ${cy}),rotate(${negascale(negaEmo * confidence)}),scale(-0.1, 0.1)`) //rotate(-20,300,400)
                .attr("transform", function (d) {
                    if (d3.select(this).attr("transform").split("scale")[1].indexOf(",") != -1) // 存在scale(-0.1, 0.1)的情况
                    {
                        let rotStr = d3.select(this).attr("transform").split("rotate")[1].split(",")[0];
                        // console.log(d.fisheye.x);

                        return `translate(${d.fisheye.x}, ${d.fisheye.y}),` + `rotate${rotStr},` + `scale(${-0.12 * d.fisheye.z * widScaleRatio}, ${0.12 * d.fisheye.z * widScaleRatio})`
                    } else {
                        let rotStr = d3.select(this).attr("transform").split("rotate")[1].split(",")[0]
                        return `translate(${d.fisheye.x}, ${d.fisheye.y}),` + `rotate${rotStr},` + `scale(${0.12 * d.fisheye.z * widScaleRatio})`
                    }

                });

            circleGroups.each(function (d) {
                d.fisheye = fisheye(d);
            })
                .attr("transform", function (d) {
                    if (d3.select(this).attr("transform").split("scale")[1].indexOf(",") != -1) // 存在scale(-0.1, 0.1)的情况
                    {
                        return d3.select(this).attr("transform").split("scale")[0] + `scale(${-0.12 * d.fisheye.z * widScaleRatio}, ${0.12 * d.fisheye.z * widScaleRatio})`
                    } else {
                        return d3.select(this).attr("transform").split("scale")[0] + `scale(${0.12 * d.fisheye.z * widScaleRatio})`
                    }

                });

        });

    }


</script>

<!--绘制种子函数-->
<script>
    //定义tooltip
    // var Tooltip = d3.select("#samaraTimeline")
    //     .append("div")
    //     .style("opacity", 0)
    //     .attr("class", "tooltip")
    //     // .style("border", "solid")
    //     // .style("border-width", "2px")
    //     .style("width", `${window.innerWidth * 0.1}px`)
    //     .style("height", `${window.innerWidth * 0.1}px`)

    var seedTooltip = d3.select("#seedTooltip")

    var TooltipLine = d3.select("#timelineSvg")
        .append("line")
        .attr("stroke", "#ffc000")
        .attr("stroke-width", 2)
        .attr("stroke-dasharray", "5,5")
        .style("opacity", 0);

    //定义moveToFront 置于顶层
    d3.selection.prototype.moveToFront = function () {
        return this.each(function () {
            this.parentNode.appendChild(this);
        });
    };

    function transNum(x) //转化数字格式
    {
        if (x < 1000)
            return x.toString();
        else if (x < 10000)
            return x.toString()[0] + ',' + x.toString().substring(1); //补上千位的逗号
        else if (x < 1000000)
            if ((x / 1000).toFixed(1)[(x / 1000).toFixed(1).length - 1] == "0") //如果末尾为0，舍去最后两位
                return (x / 1000).toFixed(1).substring(0, (x / 1000).toFixed(1).length - 2) + "K"
            else
                return (x / 1000).toFixed(1) + "K"
        else if (x < 1000000000)
            if ((x / 1000000).toFixed(1)[(x / 1000000).toFixed(1).length - 1] == "0") //如果末尾为0，舍去最后两位
                return (x / 1000000).toFixed(1).substring(0, (x / 1000000).toFixed(1).length - 2) + "M"
            else
                return (x / 1000000).toFixed(1) + "M"
        else if ((x / 1000000000).toFixed(1)[(x / 1000000000).toFixed(1).length - 1] == "0") //如果末尾为0，舍去最后两位
            return (x / 1000000000).toFixed(1).substring(0, (x / 1000000000).toFixed(1).length - 2) + "B"
        else
            return (x / 1000000000).toFixed(1) + "B"
    }

    function transDate(x) //转化日期格式
    {
        //01月28日19:01
        //&nbsp 7:23 PM · Apr 14, 2022

        //取月份缩写值：Jan Feb
        let month;
        if (x.split("月")[0] == "01")
            month = "Jan"
        else
            month = "Feb"
        let date = x.split("月")[1].split("日")[0]
        let time = x.split("日")[1]

        return ` ${time} · ${month} ${date}, 2022`
    }

    function transContent(x) //内容缩略
    {
        let maxPostLen = 100; //定义帖子显示的最长长度

        if (x.length <= maxPostLen)
            return x
        else
            return x.substring(0, maxPostLen) + "..."
    }

    function geneSeed(index, cx, cy, negaEmo, confidence, vlevel, like, comment, retweet, follower, hashtagXIndex, hashtagfirstcat, gScale) {
        //帖子可视化的关键参数
        var scaleLengthId;
        var scaleWidthId;
        // var vlevel = "blue"

        //like的映射计算; like的max值为2457804; 计算scaleWidthId
        let likeScale = d3.scaleLinear()
            .domain([0, 2.7])
            .range([1, 3]); //映射到的scaleWid范围
        if (like <= 5000) {
            scaleWidthId = 1;
        } else {
            scaleWidthId = likeScale(Math.log(like / 5000) / Math.log(10)) //取以10为底的对数
        }

        //comment分类
        let commentCat; //评论数量分在第几类
        //comment的分组
        if (comment <= 10)
            commentCat = 1
        else if (comment <= 100)
            commentCat = 2
        else
            commentCat = 3

        //粉丝数分类
        let followerCat;
        //粉丝数的分组
        if (follower <= 10000)
            followerCat = 1
        else if (follower <= 1000000)
            followerCat = 2
        else
            followerCat = 3


        //retweet的映射计算；retweet的max值为418438；计算scaleLengthId
        let retweetScale = d3.scaleLinear()
            .domain([0, 3])
            .range([1, 3]); //映射到的scaleLen范围
        if (retweet <= 500) {
            scaleLengthId = 1;
        } else {
            scaleLengthId = retweetScale(Math.log(retweet / 500) / Math.log(10)) //取以10为底的对数
        }


        var group1;

        //消极在负半轴，积极在正半轴，确定g的位置以及旋转参数
        if (negaEmo <= 0.5) {
            let negascale = d3.scaleLinear()
                .domain([0, 1])
                .range([-30, -10]); //积极：30度，消极：10度

            group1 = d3.select(`#seed${index}`)
                .attr("transform", `translate(${cx}, ${cy}),rotate(${negascale(negaEmo * confidence)}),scale(${0.12 * gScale})`) //rotate(-20,300,400)
        } else {
            let negascale = d3.scaleLinear()
                .domain([0, 1])
                .range([30, 10]); //积极：30度，消极：10度

            group1 = d3.select(`#seed${index}`)
                .attr("transform", `translate(${cx}, ${cy}),rotate(${negascale(negaEmo * confidence)}),scale(${-0.12 * gScale}, ${0.12 * gScale})`) //rotate(-20,300,400)
        }

        //叶面绘制；叶子宽度参数调整
        group1.append("path")
            .attr("d", `M ${185.11 * scaleLengthId} 23 ` +
                `C ${192.21 * scaleLengthId} 34.23 ${156.54 * 1.2 * scaleLengthId} ${57.89 * scaleWidthId} ${132.11 * scaleLengthId} ${57.89 * scaleWidthId} ` +
                `C ${100.6 * scaleLengthId} ${57.89 * scaleWidthId} ${75.04 * 0.8 * scaleLengthId} 30.79 38.58 30.79 ` +
                "C 50.93 16.55 69 8.67 69 8.67 " +
                `S ${162.94 * scaleLengthId} -12.13 ${185.11 * scaleLengthId} 23 ` +
                "Z")
            .attr("id", `seedWid${index}`)
            .style("fill", "#ffe7a1")
            .style("opacity", "0.2")
            .style("stroke", "none");


        //评论数量调整纹理
        if (commentCat == 1) {

            group1.append("path")
                .attr("d", `M ${92.56 * (1.2 - 0.2 * scaleLengthId) * scaleLengthId} ${4.3} C ${109.32 * (1.2 - 0.2 * scaleLengthId) * scaleLengthId} ${4.3} ${119.8 * (1.2 - 0.2 * scaleLengthId) * scaleLengthId} ${18.52 * scaleWidthId} ${121.61 * (1.2 - 0.2 * scaleLengthId) * scaleLengthId} ${32.74 * scaleWidthId}`)
                .style("stroke-linecap", "round")
                .attr("stroke-width", "2")
                .attr("opacity", "0.2")
                .attr("fill", "none")
                .attr("class", `seedleaf${index}`)
                .style("stroke", "#FFCA36");

            group1.append("path")
                .attr("d", `M${125.75 * scaleLengthId},2.55 C ${142.51 * scaleLengthId},2.55,${153 * scaleLengthId},${16.77 * scaleWidthId},${154.8 * scaleLengthId},${31 * scaleWidthId}`)
                // .attr("stroke", "#FFCA36")
                .style("stroke-linecap", "round")
                .attr("stroke-width", "2")
                .attr("opacity", "0.2")
                .attr("fill", "none")
                .attr("class", `seedleaf${index}`)
                .style("stroke", "#FFCA36");

        } else if (commentCat == 2) {

            group1.append("path")
                .attr("d", `M ${83.27 * (1.2 - 0.2 * scaleLengthId) * scaleLengthId} ${5.93 - Math.min(2, 2 * (scaleLengthId - 1))} C ${100.04 * (1.2 - 0.2 * scaleLengthId) * scaleLengthId} ${5.93 - Math.min(2, 2 * (scaleLengthId - 1))} ${110.52 * (1.2 - 0.2 * scaleLengthId) * scaleLengthId} ${20.15 * 0.8 * scaleWidthId} ${112.33 * (1.2 - 0.2 * scaleLengthId) * scaleLengthId} ${34.37 * 0.8 * scaleWidthId}`)
                .style("stroke-linecap", "round")
                .attr("stroke-width", "2")
                .attr("opacity", "0.2")
                .attr("fill", "none")
                .attr("class", `seedleaf${index}`)
                .style("stroke", "#FFCA36");

            group1.append("path")
                .attr("d", `M ${107.93 * (1.1 - 0.1 * scaleLengthId) * scaleLengthId} 2.55 C ${124.7 * (1.1 - 0.1 * scaleLengthId) * scaleLengthId} 2.55 ${138.45 * (1.1 - 0.1 * scaleLengthId) * scaleLengthId} ${16.77 * scaleWidthId} ${140.99 * (1.1 - 0.1 * scaleLengthId) * scaleLengthId} ${39.41 * scaleWidthId}`)
                .style("stroke-linecap", "round")
                .attr("stroke-width", "2")
                .attr("opacity", "0.2")
                .attr("fill", "none")
                .attr("class", `seedleaf${index}`)
                .style("stroke", "#FFCA36");

            group1.append("path")
                .attr("d", `M ${134 * scaleLengthId} 2.55 C ${150.76 * scaleLengthId} 2.55 ${159.2 * scaleLengthId} ${16.77 * scaleWidthId} ${161 * scaleLengthId} ${30.99 * scaleWidthId}`)
                .style("stroke-linecap", "round")
                .attr("stroke-width", "2")
                .attr("opacity", "0.2")
                .attr("fill", "none")
                .attr("class", `seedleaf${index}`)
                .style("stroke", "#FFCA36");


        } else {

            group1.append("path")
                .attr("d", `M ${71.86 * scaleLengthId} ${7.82 - Math.min(4, 4 * (scaleLengthId - 1))} C ${88.62 * scaleLengthId} 7.82 ${97.72 * scaleLengthId} ${24 * scaleWidthId} ${99.53 * scaleLengthId} ${38.19 * scaleWidthId}`)
                .style("stroke-linecap", "round")
                .attr("stroke-width", "2")
                .attr("opacity", "0.2")
                .attr("fill", "none")
                .attr("class", `seedleaf${index}`)
                .style("stroke", "#FFCA36");

            group1.append("path")
                .attr("d", `M ${97.8 * scaleLengthId} ${4.3 - Math.min(1.2, 1.2 * (scaleLengthId - 1))} C ${114.57 * scaleLengthId} 4.3 ${122.31 * scaleLengthId} ${29.05 * scaleWidthId} ${124.12 * scaleLengthId} ${43.3 * scaleWidthId}`)
                .style("stroke-linecap", "round")
                .attr("stroke-width", "2")
                .attr("opacity", "0.2")
                .attr("fill", "none")
                .attr("class", `seedleaf${index}`)
                .style("stroke", "#FFCA36");

            group1.append("path")
                .attr("d", `M ${119.78 * scaleLengthId} 2.55 C ${136.55 * scaleLengthId} 2.55 ${144.29 * scaleLengthId} ${27.3 * scaleWidthId} ${146.09 * scaleLengthId} ${41.55 * scaleWidthId}`)
                .style("stroke-linecap", "round")
                .attr("stroke-width", "2")
                .attr("opacity", "0.2")
                .attr("fill", "none")
                .attr("class", `seedleaf${index}`)
                .style("stroke", "#FFCA36");

            group1.append("path")
                .attr("d", `M ${140.49 * scaleLengthId} ${2.55 + Math.min(2.5, 2.5 * (scaleLengthId - 1))} C ${157.26 * scaleLengthId} 2.55 ${163.49 * scaleLengthId} ${22.83 * scaleWidthId} ${164.84 * scaleLengthId} ${33.67 * scaleWidthId}`)
                .style("stroke-linecap", "round")
                .attr("stroke-width", "2")
                .attr("opacity", "0.2")
                .attr("fill", "none")
                .attr("class", `seedleaf${index}`)
                .style("stroke", "#FFCA36");
        }
        ;


        //叶子长度参数调整; 粉丝数影响头部大小
        if (followerCat == 1) {
            group1.append("path")
                .attr("d", "M 57.6 6.89 " +
                    "C 46 7.89 29.85 6.42 20.6 6.77 " +
                    `C 9.22 7.2 ${-1.68} 9.24 ${0.22} 18.61` +
                    `C 2.28 28.77 8.25 ${37} 21.44 ${37} ` +
                    "C 44 37 57.07 12.5 75 8.92 " +
                    `S ${162.06 * scaleLengthId} -6 ${185.11 * scaleLengthId} 23 ` +
                    `C ${181.44 * scaleLengthId} ${11.63 + 1 * scaleLengthId} ${157.88 * scaleLengthId} 0 ${126.41 * (1.2 - 0.2 * scaleLengthId) * (scaleLengthId)} 0 ` +
                    "S 81.12 4.86 57.6 6.89 " +
                    "Z")
                .attr("id", `seedStem${index}`)
                .style("fill", "#FFCA36")
                .style("stroke", "none");

        } else if (followerCat == 2) {

            group1.append("path")
                .attr("d", "M 57.6 6.89 " +
                    "C 46 7.89 29.85 6.42 20.6 6.77 " +
                    "C 9.22 7.2 -16.088 6.503 -14.043 25.517 " +
                    "C -12.048 39.53 -3.46 53.836 19.941 52.99 " +
                    "C 48.698 50.735 57.07 12.5 75 8.92 " +
                    `S ${162.06 * scaleLengthId} -6 ${185.11 * scaleLengthId} 23 ` +
                    `C ${181.44 * scaleLengthId} ${11.63 + 1 * scaleLengthId} ${157.88 * scaleLengthId} 0 ${126.41 * (1.2 - 0.2 * scaleLengthId) * (scaleLengthId)} 0 ` +
                    "S 81.12 4.86 57.6 6.89 " +
                    "Z")
                .attr("id", `seedStem${index}`)
                .style("fill", "#FFCA36")
                .style("stroke", "none");


        } else {

            group1.append("path")
                .attr("d", "M 57.6 6.89 C 46 7.89 29.85 6.42 20.6 6.77 C 9.22 7.2 -41.314 7.718 -40.555 33.026 C -39.289 56.31 -25.731 82.914 10.897 81.111 C 57.311 75.993 52.579 16.323 75 8.92 "+
                    `S ${162.06 * scaleLengthId} -6 ${185.11 * scaleLengthId} 23 ` +
                    `C ${181.44 * scaleLengthId} ${11.63 + 1 * scaleLengthId} ${157.88 * scaleLengthId} 0 ${126.41 * (1.2 - 0.2 * scaleLengthId) * (scaleLengthId)} 0 ` +
                    "S 81.12 4.86 57.6 6.89 " +
                    "Z")
                .attr("id", `seedStem${index}`)
                .style("fill", "#FFCA36")
                .style("stroke", "none");

        }

        //定义情感的线性渐变
        {
            //目前：为每一个帖子定制一个defs：长度不同（x2不同）；末端颜色不同
            let emo_grad = defs.append("linearGradient")
                .attr("id", `emo_grad${index}`)
                .attr("gradientUnits", "userSpaceOnUse")
                .attr("x1", "57.6")
                .attr("y1", "6.89")
                .attr("x2", `${185.11 * scaleLengthId}`)
                .attr("y2", "23");


            // let stop1 = emo_grad.append("stop")
            //     .attr("offset", "0")
            //     .attr("")
            //     .style("stop-color", "#ffca36");


            //内容情感
            if (negaEmo <= 0.5) {
                // console.log("a")
                let a = d3.rgb(129, 233, 59);	//积极一端的颜色
                let b = d3.rgb(255, 202, 54);	//橙色
                let linear = d3.scaleLinear()
                    .domain([0, 0.5])
                    .range([0, 1])
                let compute = d3.interpolate(a, b);
                let endColor = compute(linear(negaEmo))

                let stop1 = emo_grad.append("stop")
                    .attr("id", `emo_grad_start${index}`)
                    .attr("offset", "0")
                    .style("stop-color", endColor);

                let stop2 = emo_grad.append("stop")
                    .attr("id", `emo_grad_end${index}`)
                    .attr("offset", "0.1")
                    .style("stop-opacity", "0")
                    .style("stop-color", endColor);

                d3.select(`#seedStem${index}`)
                    .style("fill", "url(#" + emo_grad.attr("id") + ")");

            } else {
                let a = d3.rgb(237, 28, 36);	//消极一端的颜色
                let b = d3.rgb(255, 202, 54);	//橙色
                let linear = d3.scaleLinear()
                    .domain([0.5, 1])
                    .range([0, 1])
                let compute = d3.interpolate(b, a);
                let endColor = compute(linear(negaEmo))

                let stop1 = emo_grad.append("stop")
                    .attr("id", `emo_grad_start${index}`)
                    .attr("offset", "0")
                    .style("stop-color", endColor);

                let stop2 = emo_grad.append("stop")
                    .attr("id", `emo_grad_end${index}`)
                    .attr("offset", "0.1")
                    .style("stop-opacity", "0")
                    .style("stop-color", endColor);

                d3.select(`#seedStem${index}`)
                    .style("fill", "url(#" + emo_grad.attr("id") + ")");

            }
        }


        //微博等级
        if (vlevel == "normal") {
            group1.append("circle")
                .attr("cx", "8")
                .attr("cy", "-5")
                .attr("r", "10")
                .attr("stroke", "none")
                .attr("fill", "#FFCA36")
                .attr("opacity", "0.5")
        } else if (vlevel == "yellow") {
            group1.append("circle")
                .attr("cx", "8")
                .attr("cy", "-5")
                .attr("r", "10")
                .attr("stroke", "none")
                .attr("fill", "#FFCA36")
                .attr("opacity", "0.7")
            group1.append("circle")
                .attr("cx", "32")
                .attr("cy", "-8")
                .attr("r", "10")
                .attr("stroke", "none")
                .attr("fill", "#FFCA36")
                .attr("opacity", "0.5")
        } else if (vlevel == "gold") {
            group1.append("circle")
                .attr("cx", "8")
                .attr("cy", "-5")
                .attr("r", "10")
                .attr("stroke", "none")
                .attr("fill", "#FFCA36")
                .attr("opacity", "0.9")
            group1.append("circle")
                .attr("cx", "32")
                .attr("cy", "-8")
                .attr("r", "10")
                .attr("stroke", "none")
                .attr("fill", "#FFCA36")
                .attr("opacity", "0.7")
            group1.append("circle")
                .attr("cx", "56")
                .attr("cy", "-8")
                .attr("r", "10")
                .attr("stroke", "none")
                .attr("fill", "#FFCA36")
                .attr("opacity", "0.5")
        } else {
            group1.append("circle")
                .attr("cx", "8")
                .attr("cy", "-5")
                .attr("r", "10")
                .attr("stroke", "none")
                .attr("fill", "#3694ff")
                .attr("opacity", "0.9")
        }


    }

    var showFixedTooltip = false
    var selectedSeed;

    function geneCir(index, cx, cy, negaEmo, confidence, follower, hashtagfirstcat, hashtagXIndex) {
        //粉丝数分类
        let followerCat;
        //粉丝数的分组
        if (follower <= 10000)
            followerCat = 1
        else if (follower <= 1000000)
            followerCat = 2
        else
            followerCat = 3

        //悬停交互
        var mouseover = function (d) {
            // console.log(d3.select(this)
            //         .attr("id")
            //     // .split("interactCircle")[1]
            // )

            d3.select(`#seed${d3.select(this)
                .attr("id")
                .split("interactCircle")[1]
            }`).moveToFront();

            var scrollTop = document.documentElement.scrollTop || document.body.scrollTop;

            //获取话题类别以及消极情绪概率
            let hashtagfirstcat = nodes[d3.select(this)
                .attr("id")
                .split("interactCircle")[1]].hashtagfirstcat
            let negaEmo = nodes[d3.select(this)
                .attr("id")
                .split("interactCircle")[1]].negaEmo

            //显示retweet数量
            d3.select("#postRetweet")
                .html(transNum(nodes[d3.select(this)
                    .attr("id")
                    .split("interactCircle")[1]].retweet))

            //显示like数量
            d3.select("#postLike")
                .html(transNum(nodes[d3.select(this)
                    .attr("id")
                    .split("interactCircle")[1]].like))

            //显示comment数量
            d3.select("#postComment")
                .html(transNum(nodes[d3.select(this)
                    .attr("id")
                    .split("interactCircle")[1]].comment))

            //显示帖子内容
            d3.select("#postContent")
                .html(transContent(nodes[d3.select(this)
                    .attr("id")
                    .split("interactCircle")[1]].content));

            //帖子全部内容展示
            d3.select("#postContent")
                .attr("content", nodes[d3.select(this)
                    .attr("id")
                    .split("interactCircle")[1]].content);

            //显示时间
            d3.select("#postTime")
                .html(transDate(nodes[d3.select(this)
                    .attr("id")
                    .split("interactCircle")[1]].time))

            //情感映射
            let emotionScale = d3.scaleLinear()
                .domain([0, 1])
                .range([154, 0]); //最左位置：4px；最右位置：160px

            //加载情感刻度条
            d3.select("#emotionScaleBox")
                .style("left", `${emotionScale(negaEmo)}px`)

            //显示发帖人名字
            d3.select("#posterName")
                .html(`@${nodes[d3.select(this)
                    .attr("id")
                    .split("interactCircle")[1]].postname}`)
            //显示粉丝数量
            d3.select("#postFollower")
                .html(`${transNum(nodes[d3.select(this)
                    .attr("id")
                    .split("interactCircle")[1]].follower)} followers`)

            //显示tooltip框
            seedTooltip.style("display", "flex"); // 先设置为flex之后，才能获取offsetHeight属性

            let divHeight = document.getElementById("seedTooltip").offsetHeight;

            let dis = document.documentElement.scrollTop || document.body.scrollTop - (document.getElementById('samaraTimelineEnter').getBoundingClientRect().top - document.getElementById('pageStart').getBoundingClientRect().top)

            // console.log(`dis:${dis}`);

            // let offdis = dis - parseFloat(cy);
            //
            // console.log(`cy:${parseFloat(cy)}`)
            //
            // let disScale  = d3.scaleLinear()
            //     .domain([7400 * heiScaleRatio, 6400 * heiScaleRatio])
            //     .range([windowHei * -0.2, windowHei * 0.7])
            //
            // console.log(`offdis:${(offdis)}`)

            // let divTopDistance = disScale(offdis);

            let divTopDistance = document.getElementById(d3.select(this).attr("id")).getBoundingClientRect().top - document.getElementById('seedTooltip').offsetHeight / 2;

            if(divTopDistance < 0)
            {
                divTopDistance = 0;
            }
            else if(divTopDistance > window.innerHeight - document.getElementById('seedTooltip').offsetHeight)
            {
                divTopDistance = window.innerHeight - document.getElementById('seedTooltip').offsetHeight;
            }

            if (hashtagfirstcat == 0 || (hashtagfirstcat == 8 && negaEmo < 0.5)) //最后两个话题类别
                seedTooltip
                    .style("left", `${parseFloat(cx) - 400 * widScaleRatio}px`)
                    .style("top", `${divTopDistance}px`)
                    .style("opacity", 1)
                    .style("z-index", "1");
            else
                seedTooltip
                    .style("left", `${parseFloat(cx) + 90 * widScaleRatio}px`)
                    .style("top", `${divTopDistance}px`)
                    .style("opacity", 1)
                    .style("z-index", "1");


            //显示对应线条
            TooltipLine
                .attr("x1", cx)
                .attr("y1", (cy))
                .attr("x2", hashtagXIndex)
                .attr("y2", (cy))
                .style("opacity", 1);

            //seed主干渐变动画
            d3.select(`#emo_grad_end${d3.select(this)
                .attr("id")
                .split("interactCircle")[1]}`)
                .transition()
                .duration(500)
                .attr("offset", "1")
                .style("stop-opacity", "100%")

            d3.select(`#emo_grad_start${d3.select(this)
                .attr("id")
                .split("interactCircle")[1]}`)
                .transition()
                .duration(500)
                // .attr("offset", "1")
                .style("stop-color", "#ffca36");

            //seed纹理渐变动画
            d3.selectAll(`.seedleaf${d3.select(this)
                .attr("id")
                .split("interactCircle")[1]}`)
                .transition()
                .duration(500)
                // .attr("offset", "1")
                .attr("opacity", "100%");

            //seed叶面渐变动画
            d3.select(`#seedWid${d3.select(this)
                .attr("id")
                .split("interactCircle")[1]}`)
                .transition()
                .duration(500)
                .style("opacity", "1");

        }

        var mousemove = function (d) {
            // console.log(d3.pointer(event, this))
            // Tooltip
            //     .style("opacity", 1)
            //     .style("display", "block")
            //     .style("left", `${cx + 200}px`)
            //     .style("top", `${cy}px`);

            // streamGraph高亮显示
            d3.selectAll(".myArea").style("opacity", 0.2) //其他变半透明
            d3.select(`#streamGraph${(hashtagfirstcat + 8) % 9}`)  // hashtagfirstcat=0时，id为streamGraph8（other是最后一类标签）
                // .style("stroke", "black")
                // .style("stroke-width", "2")
                .style("opacity", 1)




        }
        var mouseleave = function (d) {
            if (!showFixedTooltip) //如果鼠标离开，并且不是显示固定tooltip的时候
            {
                seedTooltip
                    .style("opacity", 0)
                    .style("display", "none")
                    .style("z-index", "-10")

                TooltipLine
                    .style("opacity", 0);

                d3.select(`#emo_grad_end${d3.select(this)
                    .attr("id")
                    .split("interactCircle")[1]}`)
                    .transition()
                    .duration(500)
                    .attr("offset", "0.1")
                    .style("stop-opacity", "0")

                d3.select(`#emo_grad_start${d3.select(this)
                    .attr("id")
                    .split("interactCircle")[1]}`)
                    .transition()
                    .duration(500)
                    // .attr("offset", "1")
                    .style("stop-color", d3.select(
                        `#emo_grad_end${d3.select(this)
                            .attr("id")
                            .split("interactCircle")[1]}`)
                        .style("stop-color"));

                d3.selectAll(`.seedleaf${d3.select(this)
                    .attr("id")
                    .split("interactCircle")[1]}`)
                    .transition()
                    .duration(500)
                    // .attr("offset", "1")
                    .attr("opacity", "0.2");

                //seed叶面渐变动画
                d3.select(`#seedWid${d3.select(this)
                    .attr("id")
                    .split("interactCircle")[1]}`)
                    .transition()
                    .duration(500)
                    .style("opacity", "0.2");

                //streamGraph对应地方取消高亮
                d3.selectAll(".myArea").style("opacity", 1).style("stroke", "none")  // 恢复正常
            }

        }
        var mouseclick = function (d) {
            selectedSeed = d3.select(this);
            showFixedTooltip = true;
            // mousemove(d);
            $("#invisibleBlock").css("display", "block");
        }


        let group1;

        if (negaEmo <= 0.5) {
            let negascale = d3.scaleLinear()
                .domain([0, 1])
                .range([-30, -10]); //积极：30度，消极：10度

            group1 = d3.select(`#interactCircle${index}`)
                .attr("transform", `translate(${cx}, ${cy}),rotate(${negascale(negaEmo * confidence)}),scale(0.12)`) //rotate(-20,300,400)
        } else {
            let negascale = d3.scaleLinear()
                .domain([0, 1])
                .range([30, 10]); //积极：30度，消极：10度

            group1 = d3.select(`#interactCircle${index}`)
                .attr("transform", `translate(${cx}, ${cy}),rotate(${negascale(negaEmo * confidence)}),scale(-0.12, 0.12)`) //rotate(-20,300,400)
        }

        //叶子长度参数调整; 粉丝数影响头部大小
        if (followerCat == 1) {
            group1.append("circle")
                .attr("cx", 24 * widScaleRatio)
                .attr("cy", 26 * heiScaleRatio)
                .attr("r", 20)
                .attr("id", `interactCircle${index}`)
                .attr("fill", "#fff")
                .attr("opacity", "0")
                .on("mouseover", mouseover)
                .on("mousemove", mousemove)
                .on("mouseleave", mouseleave)
                .on("click", mouseclick);

        } else if (followerCat == 2) {

            group1.append("circle")
                .attr("cx", 18 * widScaleRatio)
                .attr("cy", 32 * heiScaleRatio)
                .attr("r", 28)
                .attr("id", `interactCircle${index}`)
                .attr("fill", "#fff")
                .attr("opacity", "0")
                .on("mouseover", mouseover)
                .on("mousemove", mousemove)
                .on("mouseleave", mouseleave)
                .on("click", mouseclick);


        } else {

            group1.append("circle")
                .attr("cx", 15 * widScaleRatio)
                .attr("cy", 35 * heiScaleRatio)
                .attr("r", 34)
                .attr("id", `interactCircle${index}`)
                .attr("fill", "#fff")
                .attr("opacity", "0")
                .on("mouseover", mouseover)
                .on("mousemove", mousemove)
                .on("mouseleave", mouseleave)
                .on("click", mouseclick);

        }
    }
</script>

<!--滑动条部分圆形hint提示-->
<script>

    //滚动条总高度为0.96windowHei
    // var vaneDis = [100, 2550, 9450, 11850, 17480, 22580]

    // let keyEventCirScale = d3.scaleLinear()
    //     .domain([0, 31 * 0.98 * window.innerHeight]) //一共31天，mainSvg的高度为0.98windowHei
    //     .range([0.02 * window.innerHeight, 0.98 * window.innerHeight]);

    let keyEventCirScaleId = 1 / 886 * windowHei; //缩放的比例系数

    var keyEventCirDis = [78 * keyEventCirScaleId, 137 * keyEventCirScaleId, 325 * keyEventCirScaleId, 391 * keyEventCirScaleId, 545 * keyEventCirScaleId, 685 * keyEventCirScaleId];

    $(".keyEventCir")
        .css("right", 108 / 1728 * window.innerWidth) //距离右边界124px，根据窗口宽度自动调整

    for(let i=0; i<6; i++)
    {
        $(`#keyEventCir${i}`).css("top", keyEventCirDis[i]);
    }

    var keyEventCirClick = function (CirNum){

        //图标背景出现
        d3.select(`#windVaneBg${CirNum}`)
            .attr("opacity", 1);
        //图标颜色更改
        d3.select(`#windVaneBody${CirNum}`)
            .attr("fill", "#fff8ef")

        d3.select(`#windVaneEye${CirNum}`)
            .attr("fill", "#ffc000")

        d3.select(`#windVaneWing${CirNum}`)
            .attr("fill", "#ffc000")

        hashtagSelectedId = CirNum; //相当于选中这个对应的hashtag，并跳转到对应的KeyEvent
        jumpToKeyEvent();

    }

</script>

<!--绘制滑条-->
<script>
    let domain_max_scale = [40, 200000000, 150000, 3500] //切换stream graph的时候需要用到不同的比例尺
    let trans_hori_ = [46, 46, 46, 46]
    var streamGraphTitlesId = 0;

    d3.select("#streamGraphScroll")
        .style("top", `${0.08 * window.innerHeight}px`) //总高度0.9Hei, 上面距离0.08Hei, 下面距离0.02Hei

    // set the dimensions and margins of the graph
    const margin = {top: 20, right: 30, bottom: 0, left: 10},
        width = 800 - margin.left - margin.right,
        height = 100 - margin.top - margin.bottom;
    var windowHei = window.innerHeight;
    var windowWid = window.innerWidth;

    const svgStreamScroll = d3.select("#streamGraphScroll")
        .append("svg")
        .attr("width", 100 / 1728 * windowWid)
        .attr("height", 0.9 * windowHei)
        .attr("id", "svgStreamScroll");

    //绘制stream graph图例
    const legendGroup = svgStreamScroll.append("g")
        .attr("transform", `translate(0, ${0.87 * window.innerHeight})`)

    //绘制对应图例线条
    legendGroup
        .append("line")
        .attr("x1", 20 * widScaleRatio)
        .attr("x2", 80 * widScaleRatio)
        .attr("y1", 15 * heiScaleRatio)
        .attr("y2", 15 * heiScaleRatio)
        .attr("stroke-width", 2 * widScaleRatio)
        .attr("stroke", "#455A64")

    legendGroup
        .append("line")
        .attr("x1", 20 * widScaleRatio)
        .attr("x2", 20 * widScaleRatio)
        .attr("y1", 10 * heiScaleRatio)
        .attr("y2", 16 * heiScaleRatio)
        .attr("stroke-width", 2 * widScaleRatio)
        .attr("stroke", "#455A64")

    legendGroup
        .append("line")
        .attr("x1", 80 * widScaleRatio)
        .attr("x2", 80 * widScaleRatio)
        .attr("y1", 10 * heiScaleRatio)
        .attr("y2", 16 * heiScaleRatio)
        .attr("stroke-width", 2 * widScaleRatio)
        .attr("stroke", "#455A64")

    //绘制数字
    legendGroup
        .append("text")
        .attr("id", "streamGraphLegendTxt")
        .attr("text-anchor", "middle")
        .style("user-select", "none")
        .attr("x", 50 * widScaleRatio)
        .attr("y", 8 * heiScaleRatio)
        .style('font-weight', 300)
        .style("font-size", ".6rem")
        .style('font-family', 'noto-sans, sans-serif')
        .style('fill', 'rgba(255,255,255,0.7)')
        .text(transNum(domain_max_scale[streamGraphTitlesId] * 8))

    var geneStreamGraph = function(path, domain_max, trans_hori){
        // append the svg object to the body of the page
        const svgStreamScrollGroup = svgStreamScroll
            .append("g")
            // .attr("opacity", "0")
            .attr("id", "svgStreamScrollGroup")


        scrollrect = svgStreamScrollGroup.append("rect")
            .attr("x", "0")
            .attr("y", "0")
            .attr("width", 100 * widScaleRatio) // (/ 1728 * windowWid)
            .attr("height", windowHei * 0.86)
            .attr("rx", `${10 * widScaleRatio}`)
            .attr("ry", `${10 * widScaleRatio}`)
            .attr("fill", "#B0BEC5")
            .attr("opacity", "0.1")
            .attr("id", "scrollrectBackground");


        // Parse the Data
        d3.csv(`${path}.csv`).then(function (data) {
            // console.log(data)
            // List of groups = header of the csv files
            const keys = data.columns.slice(1)//从第二个开始往后切片
            // console.log(keys)

            // Add X axis, 纵向
            const x = d3.scaleLinear()
                .domain(d3.extent(data, function (d) {
                    return parseInt(d.time);
                }))  // 返回data中的year属性，并求值域
                .range([0, windowHei * 0.86]);


            // Add Y axis， 横向宽度
            const y = d3.scaleLinear()
                .domain([0, domain_max])
                .range([5, 0]); //映射范围

            //阅读数：domain[0, 200000000]


            // var colorrange = ["#455A64",
            //     "#455A64", //少区域
            //     "#78909C",
            //     "#B0BEC5",
            //     "#455A64",
            //     "#78909C",
            //     "#B0BEC5",
            //     "#455A64", //少区域
            // ];

            var colorrange = ["#f6752d",
                "#f24d29", //少区域
                "#f8842f",
                "#ef2e26",
                "#f14528",
                "#f03827",
                "#f13f28",
                "#fa9631", //少区域
            ];
            // color palette
            const color = d3.scaleOrdinal()
                .domain(keys)
                .range(colorrange); //d3.schemeDark2

            //stack the data?
            const stackedData = d3.stack()
                .offset(d3.stackOffsetSilhouette)
                .keys(keys) //这样用stack创造出的是函数！还要给他参数（data）
                (data)

            // create a tooltip
            // const Tooltip = svgStreamScrollGroup
            //     .append("text")
            //     .attr("x", 0)
            //     .attr("y", 0)
            //     .style("opacity", 0)
            //     .style("font-size", 17) //在0，0位置显示悬停的名称

            // Three function that change the tooltip when user hover / move / leave a cell
            const mouseover = function (event, d) {
                // Tooltip.style("opacity", 1)
                d3.selectAll(".myArea").style("opacity", .2) //其他变半透明
                d3.select(this)
                    //.style("stroke", "black")
                    .style("opacity", 1)

                let selectedGroupId = parseInt(d3.select(this)
                    .attr("id").split("streamGraph")[1]) + 1;

                d3.selectAll(".samaraSeed").style("opacity", .3)
                d3.selectAll(`.seedWindLineGroup${selectedGroupId}`).style("opacity", 1)

                console.log(`.seedWindLineGroup${selectedGroupId}`)

            }
            const mousemove = function (event, d, i) {

            }
            const mouseleave = function (event, d) {
                // Tooltip.style("opacity", 0)
                d3.selectAll(".myArea").style("opacity", 1).style("stroke", "none")  // 恢复正常

                d3.selectAll(".samaraSeed").style("opacity", 1)

            }

            // Area generator
            const area = d3.area()
                .curve(d3.curveMonotoneY)  //.curve(d3.curveCatmullRom.alpha(0))
                .y(function (d) {
                    return x(d.data.time);
                })
                .x0(function (d) {
                    return y(d[0]);
                })
                .x1(function (d) {
                    return y(d[1]);
                })

            console.log(stackedData)

            // Show the areas
            svgStreamScrollGroup
                .selectAll("mylayers")
                .data(stackedData)
                .join("path")
                .attr("class", "myArea")
                .attr("id", function (d, i) {
                    return `streamGraph${i}`;
                })
                .attr("transform", `translate(${trans_hori / 1728 * windowWid}, ${0})`)
                .style("fill", function (d) {
                    return color(d.key);
                })
                .attr("d", area)
                .on("mouseover", mouseover)
                .on("mousemove", mousemove)
                .on("mouseleave", mouseleave)

        })
    }

    geneStreamGraph("asset/csv/postNum_StreamGraph", domain_max_scale[0], trans_hori_[0]); //一开始默认在postNum_StreamGraph栏目
</script>

<!--切换滑条-->
<script>
    let streamGraphTitles= ["no. of hot posts", "no. of views", "no. of discussions", "no. of original posters"];
    let streamGraphPath = ["asset/csv/postNum_StreamGraph", "asset/csv/阅读数", "asset/csv/讨论数", "asset/csv/原创数"]

    var streamGraphTitlesLeftArr = function (){
        //更新id值
        if(streamGraphTitlesId == 0)
            streamGraphTitlesId = 3;
        else
            streamGraphTitlesId -= 1;

        d3.select("#streamGraphTitle")
            .html(streamGraphTitles[streamGraphTitlesId])

        //删除现有的图
        d3.select("#svgStreamScrollGroup").remove();
        //绘制更新的图
        geneStreamGraph(streamGraphPath[streamGraphTitlesId], domain_max_scale[streamGraphTitlesId], trans_hori_[streamGraphTitlesId])

        //更新图例
        d3.select("#streamGraphLegendTxt")
            .text(transNum(domain_max_scale[streamGraphTitlesId] * 8));

    }

    var streamGraphTitlesRightArr = function (){
        //更新id值
        if(streamGraphTitlesId == 3)
            streamGraphTitlesId = 0;
        else
            streamGraphTitlesId += 1;

        d3.select("#streamGraphTitle")
            .html(streamGraphTitles[streamGraphTitlesId])

        //删除现有的图
        d3.select("#svgStreamScrollGroup").remove();
        //绘制更新的图
        geneStreamGraph(streamGraphPath[streamGraphTitlesId], domain_max_scale[streamGraphTitlesId], trans_hori_[streamGraphTitlesId])

        //更新图例
        d3.select("#streamGraphLegendTxt")
            .text(transNum(domain_max_scale[streamGraphTitlesId] * 8));
    }
</script>

<!--retweet dragbox 拖动-->
<script>
    var retweetDragBox = document.getElementById("retweetDragBox")
    retweetDragBox.onmousedown = function (e){

        //显示tooltip
        d3.select("#retweetNum")
            .style("display", "block")

        var e = e || window.event // 兼容ie浏览器

        // console.log(retweetDragBox.offsetLeft)
        // var diffX = e.clientX - retweetDragBox.offsetLeft

        /* 低版本ie bug:物体被拖出浏览器可是窗口外部时，还会出现滚动条，
                解决方法是采用ie浏览器独有的2个方法setCapture()\releaseCapture(),这两个方法，
                可以让鼠标滑动到浏览器外部也可以捕获到事件，而我们的bug就是当鼠标移出浏览器的时候，
                限制超过的功能就失效了。用这个方法，即可解决这个问题。注：这两个方法用于onmousedown和onmouseup中 */
        if (typeof retweetDragBox.setCapture !== 'undefined') {
            retweetDragBox.setCapture()
        }

        document.onmousemove = function (e) {
            var e = e || window.event // 兼容ie浏览器
            // var left = e.clientX - diffX
            var left = e.clientX - document.getElementById("retweetDragBg").getBoundingClientRect().left  //这里为什么需要-90需要再测试一下不同长宽条件下

            if(left < 0)
                left = 0;
            if(left > 108)
                left = 108;

            let retweetNumScale = d3.scaleLinear()
                .domain([0, 108])
                .range([500, 5000])
            let retweetYScale = d3.scaleLinear()
                .domain([0, 108])
                .range([32 * heiScaleRatio, 40 * heiScaleRatio])

            //更改tooltip内容
            d3.select("#retweetNum")
                .html(parseInt(retweetNumScale(left)))

            //刷新seed
            d3.select("#Tp_seed9")
                .remove();
            geneSeed_Tp(retweetSvg, retweetDefs, 9, 320 * widScaleRatio, retweetYScale(left), 1, 0.5, 1, false, "yellow", 0.3, 1, 1, parseInt(retweetNumScale(left)));


            // 移动时重新得到物体的距离，解决拖动时出现晃动的现象
            retweetDragBox.style.left = left + 'px'

            //改变viewBox
            // timelineSvg
            //     .attr("viewBox", `0 ${scrollReverseBoxScale(top)} ${windowWid * 0.96} ${windowHei * 0.98}`);

        }


        document.onmouseup = function (e) { // 当鼠标弹起来的时候不再移动
            // console.log('this', this)

            d3.select("#retweetNum")
                .style("display", "none")

            this.onmousemove = null
            this.onmouseup = null // 预防鼠标弹起来后还会循环（即预防鼠标放上去的时候还会移动）

            // 修复低版本ie bug
            if (typeof retweetDragBox.releaseCapture !== 'undefined') {
                retweetDragBox.releaseCapture()
            }
        }

    }
</script>

<!--like dragbox 拖动-->
<script>
    var likeDragBox = document.getElementById("likeDragBox")
    likeDragBox.onmousedown = function (e){

        //显示tooltip
        d3.select("#likeNum")
            .style("display", "block")

        var e = e || window.event // 兼容ie浏览器

        console.log(likeDragBox.offsetLeft)
        // var diffX = e.clientX - retweetDragBox.offsetLeft

        /* 低版本ie bug:物体被拖出浏览器可是窗口外部时，还会出现滚动条，
                解决方法是采用ie浏览器独有的2个方法setCapture()\releaseCapture(),这两个方法，
                可以让鼠标滑动到浏览器外部也可以捕获到事件，而我们的bug就是当鼠标移出浏览器的时候，
                限制超过的功能就失效了。用这个方法，即可解决这个问题。注：这两个方法用于onmousedown和onmouseup中 */
        if (typeof likeDragBox.setCapture !== 'undefined') {
            likeDragBox.setCapture()
        }

        document.onmousemove = function (e) {
            var e = e || window.event // 兼容ie浏览器
            // var left = e.clientX - diffX
            var left = e.clientX - document.getElementById("likeDragBg").getBoundingClientRect().left  //这里为什么需要-90需要再测试一下不同长宽条件下

            if(left < 0)
                left = 0;
            if(left > 108)
                left = 108;

            let likeNumScale = d3.scaleLinear()
                .domain([0, 108])
                .range([5000, 50000])
            // let likeYScale = d3.scaleLinear()
            //     .domain([0, 108])
            //     .range([32, 42])

            //更改tooltip内容
            d3.select("#likeNum")
                .html(parseInt(likeNumScale(left)))

            //刷新seed
            d3.select("#Tp_seed11")
                .remove();
            geneSeed_Tp(likeSvg, likeDefs, 11, 320 * widScaleRatio, 32 * heiScaleRatio, 1, 0.5, 1, false, "yellow", 0.3, parseInt(likeNumScale(left)), 1, 1);


            // 移动时重新得到物体的距离，解决拖动时出现晃动的现象
            likeDragBox.style.left = left + 'px'

            //改变viewBox
            // timelineSvg
            //     .attr("viewBox", `0 ${scrollReverseBoxScale(top)} ${windowWid * 0.96} ${windowHei * 0.98}`);

        }


        document.onmouseup = function (e) { // 当鼠标弹起来的时候不再移动
            // console.log('this', this)

            d3.select("#likeNum")
                .style("display", "none")

            this.onmousemove = null
            this.onmouseup = null // 预防鼠标弹起来后还会循环（即预防鼠标放上去的时候还会移动）

            // 修复低版本ie bug
            if (typeof likeDragBox.releaseCapture !== 'undefined') {
                likeDragBox.releaseCapture()
            }
        }

    }
</script>

<!--emotion dragbox 拖动-->
<script>
    var emotionDragBox = document.getElementById("emotionDragBox")
    emotionDragBox.onmousedown = function (e){

        var e = e || window.event // 兼容ie浏览器

        console.log(emotionDragBox.offsetLeft)
        // var diffX = e.clientX - retweetDragBox.offsetLeft

        /* 低版本ie bug:物体被拖出浏览器可是窗口外部时，还会出现滚动条，
                解决方法是采用ie浏览器独有的2个方法setCapture()\releaseCapture(),这两个方法，
                可以让鼠标滑动到浏览器外部也可以捕获到事件，而我们的bug就是当鼠标移出浏览器的时候，
                限制超过的功能就失效了。用这个方法，即可解决这个问题。注：这两个方法用于onmousedown和onmouseup中 */
        if (typeof emotionDragBox.setCapture !== 'undefined') {
            emotionDragBox.setCapture()
        }

        document.onmousemove = function (e) {
            var e = e || window.event // 兼容ie浏览器
            // var left = e.clientX - diffX
            var left = e.clientX - document.getElementById("emotionDragBg").getBoundingClientRect().left  //这里为什么需要-90需要再测试一下不同长宽条件下

            if(left < 0)
                left = 0;
            if(left > 108)
                left = 108;

            let emotionNumScale = d3.scaleLinear()
                .domain([0, 108])
                .range([1, 0])
            // let likeYScale = d3.scaleLinear()
            //     .domain([0, 108])
            //     .range([32, 42])

            // //更改tooltip内容
            // d3.select("#likeNum")
            //     .html(parseInt(likeNumScale(left)))

            //刷新seed
            d3.select("#Tp_seed15")
                .remove();
            d3.select("#Tp_emo_grad15")
                .remove(); //删除渐变
            console.log(`emo${emotionNumScale(left)}`)
            geneSeed_Tp(emotionSvg, emotionDefs, 15, 210 * widScaleRatio, 30 * heiScaleRatio, 1, emotionNumScale(left), 1, false, "yellow", 0.3, 1,200, 1);


            // 移动时重新得到物体的距离，解决拖动时出现晃动的现象
            emotionDragBox.style.left = left + 'px'

            //改变viewBox
            // timelineSvg
            //     .attr("viewBox", `0 ${scrollReverseBoxScale(top)} ${windowWid * 0.96} ${windowHei * 0.98}`);

        }


        document.onmouseup = function (e) { // 当鼠标弹起来的时候不再移动
            // console.log('this', this)


            this.onmousemove = null
            this.onmouseup = null // 预防鼠标弹起来后还会循环（即预防鼠标放上去的时候还会移动）

            // 修复低版本ie bug
            if (typeof emotionDragBox.releaseCapture !== 'undefined') {
                emotionDragBox.releaseCapture()
            }
        }

    }
</script>

<!--tooltip面板绘制-->
<script>
    //info icon 绘制
    d3.select("#showTooltipOverlayImg")
        .style("right", `${160 / 1728 * window.innerWidth}px`)
        .style("top", `${0.91 * window.innerHeight}px`)

    //story panel icon 绘制
    d3.select("#showStoryPanelsImg")
        .style("right", `${240 / 1728 * window.innerWidth}px`)
        .style("top", `${0.91 * window.innerHeight}px`)

    //点击后tooltip显示
    var showTooltipOverlay = function ()
    {
        isOverlayTooltipShow = true;

        d3.select("#overlayTooltip")
            .style("display", "block")
            .style("top", `${(window.innerHeight - document.getElementById('overlayTooltip').offsetHeight) / 2}px`)
            .style("left", `${(window.innerWidth - document.getElementById('overlayTooltip').offsetWidth) / 2}px`);

        //底部page翻页标识位置刷新
        d3.select("#timelineOverlayTooltipPage")
            .style("top", `${window.innerHeight * .9}px`)
            .style("left", `${(window.innerWidth - document.getElementById('timelineOverlayTooltipPage').offsetWidth) / 2}px`)


        $("#invisibleBlock")
            .css("width", window.innerWidth)
            .css("height", window.innerHeight)
            .css("top", 0)
            .css("left", 0)
            .css("display", "block")
            .css("background-color", "#000")
            .css("opacity", 0.3)
            .css("z-index", 1)

    }

    //主要时间线翻页显示
    d3.select("#timelineOverlayTooltipPage")
        .style("top", `${window.innerHeight * .9}px`)
        .style("left", `${(window.innerWidth - document.getElementById('timelineOverlayTooltipPage').offsetWidth) / 2}px`)


    //设置overlay tooltip大小
    d3.select("#overlayTooltip")
        .style("top", `${(window.innerHeight - document.getElementById('overlayTooltip').offsetHeight) / 2}px`)
        .style("left", `${(window.innerWidth - document.getElementById('overlayTooltip').offsetWidth) / 2}px`)

    //主体时间线tooltip svg 生成
    {
        //follower部分tooltip
        var followerSvg = d3.select("#followerTooltip")
            .append("svg")
            .attr("width", `100%`)
            .attr("height", `${2}rem`)

        var followerDefs = followerSvg.append("defs");

        geneSeed_Tp(followerSvg, followerDefs, 1, 100 * widScaleRatio, 30 * heiScaleRatio, 1, 0.5, 1, false, "normal", 0.3, 1, 1, 1);
        geneSeed_Tp(followerSvg, followerDefs, 2, 280 * widScaleRatio, 27.5 * heiScaleRatio, 2, 0.5, 1, false, "yellow", 0.3, 1, 1, 1);
        geneSeed_Tp(followerSvg, followerDefs, 3, 460 * widScaleRatio, 25 * heiScaleRatio, 3, 0.5, 1, false, "yellow", 0.3, 1, 1, 1);


        //vlevel部分tooltip
        var vlevelSvg = d3.select("#vlevelTooltip")
            .append("svg")
            .attr("width", `100%`)
            .attr("height", `${2}rem`)

        var vlevelDefs = vlevelSvg.append("defs");

        geneSeed_Tp(vlevelSvg, vlevelDefs, 4, 42 * widScaleRatio, 30 * heiScaleRatio, 1, 0.5, 1, true, "normal", 0.3, 1, 1, 1);
        geneSeed_Tp(vlevelSvg, vlevelDefs, 5, 170 * widScaleRatio, 30 * heiScaleRatio, 1, 0.5, 1, true, "yellow", 0.3, 1, 1, 1);
        geneSeed_Tp(vlevelSvg, vlevelDefs, 6, 320 * widScaleRatio, 30 * heiScaleRatio, 1, 0.5, 1, true, "gold", 0.3, 1, 1, 1);
        geneSeed_Tp(vlevelSvg, vlevelDefs, 7, 470 * widScaleRatio, 30 * heiScaleRatio, 1, 0.5, 1, true, "blue", 0.3, 1, 1, 1);

        //retweet部分tooltip
        var retweetSvg = d3.select("#retweetTooltip")
            .append("svg")
            .attr("width", `100%`)
            .attr("height", `${2}rem`)

        var retweetDefs = retweetSvg.append("defs");

        geneSeed_Tp(retweetSvg, retweetDefs, 8, 100 * widScaleRatio, 30 * heiScaleRatio, 1, 0.5, 1, false, "normal", 0.3, 1, 1, 1);
        geneSeed_Tp(retweetSvg, retweetDefs, 9, 320 * widScaleRatio, 32 * heiScaleRatio, 1, 0.5, 1, false, "yellow", 0.3, 1, 1, 500);
        //滑条：cy从30到42；retweet从500到5k

        //likes部分tooltip
        var likeSvg = d3.select("#likeTooltip")
            .append("svg")
            .attr("width", `100%`)
            .attr("height", `${2}rem`)

        var likeDefs = likeSvg.append("defs");

        geneSeed_Tp(likeSvg, likeDefs, 10, 100 * widScaleRatio, 30 * heiScaleRatio, 1, 0.5, 1, false, "normal", 0.3, 1, 1, 1);
        geneSeed_Tp(likeSvg, likeDefs, 11, 320 * widScaleRatio, 32 * heiScaleRatio, 1, 0.5, 1, false, "yellow", 0.3, 1, 1, 500);

        //comment部分tooltip
        var commentSvg = d3.select("#commentTooltip")
            .append("svg")
            .attr("width", `100%`)
            .attr("height", `${2}rem`)

        var commentDefs = commentSvg.append("defs");

        geneSeed_Tp(commentSvg, commentDefs, 12, 100 * widScaleRatio, 30 * heiScaleRatio, 1, 0.5, 1, false, "normal", 0.3, 1, 1, 1);
        geneSeed_Tp(commentSvg, commentDefs, 13, 270 * widScaleRatio, 30 * heiScaleRatio, 1, 0.5, 2, false, "yellow", 0.3, 1, 100, 1);
        geneSeed_Tp(commentSvg, commentDefs, 14, 460 * widScaleRatio, 30 * heiScaleRatio, 1, 0.5, 3, false, "yellow", 0.3, 1, 200, 1);

        //emotion部分tooltip
        var emotionSvg = d3.select("#emotionTooltip")
            .append("svg")
            .attr("width", `100%`)
            .attr("height", `${2}rem`)

        var emotionDefs = emotionSvg.append("defs");

        geneSeed_Tp(emotionSvg, emotionDefs, 15, 210 * widScaleRatio, 30 * heiScaleRatio, 1, 0.5, 3, false, "yellow", 0.3, 1, 200, 1);

    }


    function geneSeed_Tp(tooltipSvg, tooltipDef, index, cx, cy, followercat, emo_neg_prob, commentCat, isVlevelOn, vlevel, gScale, like, comment, retweet,) {
        var scaleLengthId;
        var scaleWidthId;

        //like的映射计算; like的max值为2457804; 计算scaleWidthId
        let likeScale = d3.scaleLinear()
            .domain([0, 2.7])
            .range([1, 3]); //映射到的scaleWid范围
        if (like <= 5000) {
            scaleWidthId = 1;
        } else {
            scaleWidthId = likeScale(Math.log(like / 5000) / Math.log(10)) //取以10为底的对数
        }

        //retweet的映射计算；retweet的max值为418438；计算scaleLengthId
        let retweetScale = d3.scaleLinear()
            .domain([0, 3])
            .range([1, 3]); //映射到的scaleLen范围
        if (retweet <= 500) {
            scaleLengthId = 1;
        } else {
            scaleLengthId = retweetScale(Math.log(retweet / 500) / Math.log(10)) //取以10为底的对数
        }


        var group1 = tooltipSvg
            .append("g")
            .attr("id", `Tp_seed${index}`)
            .attr("transform", `translate(${cx}, ${cy}), rotate(-30) ,scale(${gScale})`) //rotate(-20,300,400)
        //.attr("transform","rotate(30,600,400)");

        //叶子宽度参数调整
        group1.append("path")
            .attr("d", `M ${185.11 * scaleLengthId} 23 ` +
                `C ${192.21 * scaleLengthId} 34.23 ${156.54 * 1.2 * scaleLengthId} ${57.89 * scaleWidthId} ${132.11 * scaleLengthId} ${57.89 * scaleWidthId} ` +
                `C ${100.6 * scaleLengthId} ${57.89 * scaleWidthId} ${75.04 * 0.8 * scaleLengthId} 30.79 38.58 30.79 ` +
                "C 50.93 16.55 69 8.67 69 8.67 " +
                `S ${162.94 * scaleLengthId} -12.13 ${185.11 * scaleLengthId} 23 ` +
                "Z")
            .style("fill", "#FFCA36")
            .style("opacity", "0.2")
            .style("stroke", "none");

        //评论数量调整纹理
        if (commentCat == 1) {

            group1.append("path")
                .attr("d", `M ${92.56 * (1.2 - 0.2 * scaleLengthId) * scaleLengthId} ${4.3} C ${109.32 * (1.2 - 0.2 * scaleLengthId) * scaleLengthId} ${4.3} ${119.8 * (1.2 - 0.2 * scaleLengthId) * scaleLengthId} ${18.52 * scaleWidthId} ${121.61 * (1.2 - 0.2 * scaleLengthId) * scaleLengthId} ${32.74 * scaleWidthId}`)
                .style("stroke-linecap", "round")
                .attr("stroke-width", "2")
                .attr("opacity", "0.2")
                .attr("fill", "none")
                .attr("class", `Tp_seedleaf${index}`)
                .style("stroke", "#FFCA36");

            group1.append("path")
                .attr("d", `M${125.75 * scaleLengthId},2.55 C ${142.51 * scaleLengthId},2.55,${153 * scaleLengthId},${16.77 * scaleWidthId},${154.8 * scaleLengthId},${31 * scaleWidthId}`)
                // .attr("stroke", "#FFCA36")
                .style("stroke-linecap", "round")
                .attr("stroke-width", "2")
                .attr("opacity", "0.2")
                .attr("fill", "none")
                .attr("class", `Tp_seedleaf${index}`)
                .style("stroke", "#FFCA36");

        } else if (commentCat == 2) {

            group1.append("path")
                .attr("d", `M ${83.27 * (1.2 - 0.2 * scaleLengthId) * scaleLengthId} ${5.93 - Math.min(2, 2 * (scaleLengthId - 1))} C ${100.04 * (1.2 - 0.2 * scaleLengthId) * scaleLengthId} ${5.93 - Math.min(2, 2 * (scaleLengthId - 1))} ${110.52 * (1.2 - 0.2 * scaleLengthId) * scaleLengthId} ${20.15 * 0.8 * scaleWidthId} ${112.33 * (1.2 - 0.2 * scaleLengthId) * scaleLengthId} ${34.37 * 0.8 * scaleWidthId}`)
                .style("stroke-linecap", "round")
                .attr("stroke-width", "2")
                .attr("opacity", "0.2")
                .attr("fill", "none")
                .attr("class", `Tp_seedleaf${index}`)
                .style("stroke", "#FFCA36");

            group1.append("path")
                .attr("d", `M ${107.93 * (1.1 - 0.1 * scaleLengthId) * scaleLengthId} 2.55 C ${124.7 * (1.1 - 0.1 * scaleLengthId) * scaleLengthId} 2.55 ${138.45 * (1.1 - 0.1 * scaleLengthId) * scaleLengthId} ${16.77 * scaleWidthId} ${140.99 * (1.1 - 0.1 * scaleLengthId) * scaleLengthId} ${39.41 * scaleWidthId}`)
                .style("stroke-linecap", "round")
                .attr("stroke-width", "2")
                .attr("opacity", "0.2")
                .attr("fill", "none")
                .attr("class", `Tp_seedleaf${index}`)
                .style("stroke", "#FFCA36");

            group1.append("path")
                .attr("d", `M ${134 * scaleLengthId} 2.55 C ${150.76 * scaleLengthId} 2.55 ${159.2 * scaleLengthId} ${16.77 * scaleWidthId} ${161 * scaleLengthId} ${30.99 * scaleWidthId}`)
                .style("stroke-linecap", "round")
                .attr("stroke-width", "2")
                .attr("opacity", "0.2")
                .attr("fill", "none")
                .attr("class", `Tp_seedleaf${index}`)
                .style("stroke", "#FFCA36");


        } else {

            group1.append("path")
                .attr("d", `M ${71.86 * scaleLengthId} ${7.82 - Math.min(4, 4 * (scaleLengthId - 1))} C ${88.62 * scaleLengthId} 7.82 ${97.72 * scaleLengthId} ${24 * scaleWidthId} ${99.53 * scaleLengthId} ${38.19 * scaleWidthId}`)
                .style("stroke-linecap", "round")
                .attr("stroke-width", "2")
                .attr("opacity", "0.2")
                .attr("fill", "none")
                .attr("class", `Tp_seedleaf${index}`)
                .style("stroke", "#FFCA36");

            group1.append("path")
                .attr("d", `M ${97.8 * scaleLengthId} ${4.3 - Math.min(1.2, 1.2 * (scaleLengthId - 1))} C ${114.57 * scaleLengthId} 4.3 ${122.31 * scaleLengthId} ${29.05 * scaleWidthId} ${124.12 * scaleLengthId} ${43.3 * scaleWidthId}`)
                .style("stroke-linecap", "round")
                .attr("stroke-width", "2")
                .attr("opacity", "0.2")
                .attr("fill", "none")
                .attr("class", `Tp_seedleaf${index}`)
                .style("stroke", "#FFCA36");

            group1.append("path")
                .attr("d", `M ${119.78 * scaleLengthId} 2.55 C ${136.55 * scaleLengthId} 2.55 ${144.29 * scaleLengthId} ${27.3 * scaleWidthId} ${146.09 * scaleLengthId} ${41.55 * scaleWidthId}`)
                .style("stroke-linecap", "round")
                .attr("stroke-width", "2")
                .attr("opacity", "0.2")
                .attr("fill", "none")
                .attr("class", `Tp_seedleaf${index}`)
                .style("stroke", "#FFCA36");

            group1.append("path")
                .attr("d", `M ${140.49 * scaleLengthId} ${2.55 + Math.min(2.5, 2.5 * (scaleLengthId - 1))} C ${157.26 * scaleLengthId} 2.55 ${163.49 * scaleLengthId} ${22.83 * scaleWidthId} ${164.84 * scaleLengthId} ${33.67 * scaleWidthId}`)
                .style("stroke-linecap", "round")
                .attr("stroke-width", "2")
                .attr("opacity", "0.2")
                .attr("fill", "none")
                .attr("class", `Tp_seedleaf${index}`)
                .style("stroke", "#FFCA36");
        }

        //悬停交互
        var mouseover = function (d) {
            console.log(d3.select(this)
                .attr("id")
                .split("Tp_tooltipCircle")[1]
            )

            d3.select(`#Tp_emo_grad_end${d3.select(this)
                .attr("id")
                .split("Tp_tooltipCircle")[1]}`)
                .transition()
                .duration(500)
                .attr("offset", "1")
                .style("stop-opacity", "100%")

            d3.select(`#Tp_emo_grad_start${d3.select(this)
                .attr("id")
                .split("Tp_tooltipCircle")[1]}`)
                .transition()
                .duration(500)
                // .attr("offset", "1")
                .style("stop-color", "#ffca36");

            d3.selectAll(`.Tp_seedleaf${d3.select(this)
                .attr("id")
                .split("Tp_tooltipCircle")[1]}`)
                .transition()
                .duration(500)
                // .attr("offset", "1")
                .attr("opacity", "100%");

        }
        var mousemove = function (d) {

        }
        var mouseleave = function (d) {

            d3.select(`#Tp_emo_grad_end${d3.select(this)
                .attr("id")
                .split("Tp_tooltipCircle")[1]}`)
                .transition()
                .duration(500)
                .attr("offset", "0.1")
                .style("stop-opacity", "0")

            d3.select(`#Tp_emo_grad_start${d3.select(this)
                .attr("id")
                .split("Tp_tooltipCircle")[1]}`)
                .transition()
                .duration(500)
                // .attr("offset", "1")
                .style("stop-color", d3.select(
                    `#Tp_emo_grad_end${d3.select(this)
                        .attr("id")
                        .split("Tp_tooltipCircle")[1]}`)
                    .style("stop-color"));

            d3.selectAll(`.Tp_seedleaf${d3.select(this)
                .attr("id")
                .split("Tp_tooltipCircle")[1]}`)
                .transition()
                .duration(500)
                // .attr("offset", "1")
                .attr("opacity", "0.2");
        }


        //叶子长度参数调整; 粉丝数影响头部大小
        if (followercat == 1) {
            group1.append("path")
                .attr("d", "M 57.6 6.89 " +
                    "C 46 7.89 29.85 6.42 20.6 6.77 " +
                    `C 9.22 7.2 ${-1.68} 9.24 ${0.22} 18.61` +
                    `C 2.28 28.77 8.25 ${37} 21.44 ${37} ` +
                    "C 44 37 57.07 12.5 75 8.92 " +
                    `S ${162.06 * scaleLengthId} -6 ${185.11 * scaleLengthId} 23 ` +
                    `C ${181.44 * scaleLengthId} ${11.63 + 1 * scaleLengthId} ${157.88 * scaleLengthId} 0 ${126.41 * (1.2 - 0.2 * scaleLengthId) * (scaleLengthId)} 0 ` +
                    "S 81.12 4.86 57.6 6.89 " +
                    "Z")
                .attr("id", `Tp_seedStem${index}`)
                .style("fill", "#FFCA36")
                .style("stroke", "none");

            group1.append("circle")
                .attr("cx", 24)
                .attr("cy", 26)
                .attr("r", 18)
                .attr("id", `Tp_tooltipCircle${index}`)
                .attr("fill", "#000")
                .attr("opacity", "0")
                .on("mouseover", mouseover)
                .on("mousemove", mousemove)
                .on("mouseleave", mouseleave);

        } else if (followercat == 2) {

            group1.append("path")
                .attr("d", "M 57.6 6.89 " +
                    "C 46 7.89 29.85 6.42 20.6 6.77 " +
                    "C 9.22 7.2 -16.088 6.503 -14.043 25.517 " +
                    "C -12.048 39.53 -3.46 53.836 19.941 52.99 " +
                    "C 48.698 50.735 57.07 12.5 75 8.92 " +
                    `S ${162.06 * scaleLengthId} -6 ${185.11 * scaleLengthId} 23 ` +
                    `C ${181.44 * scaleLengthId} ${11.63 + 1 * scaleLengthId} ${157.88 * scaleLengthId} 0 ${126.41 * (1.2 - 0.2 * scaleLengthId) * (scaleLengthId)} 0 ` +
                    "S 81.12 4.86 57.6 6.89 " +
                    "Z")
                .attr("id", `Tp_seedStem${index}`)
                .style("fill", "#FFCA36")
                .style("stroke", "none");

            group1.append("circle")
                .attr("cx", 18)
                .attr("cy", 32)
                .attr("r", 25)
                .attr("id", `Tp_tooltipCircle${index}`)
                .attr("fill", "#000")
                .attr("opacity", "0")
                .on("mouseover", mouseover)
                .on("mousemove", mousemove)
                .on("mouseleave", mouseleave);

        } else {

            group1.append("path")
                .attr("d", "M 57.6 6.89 C 46 7.89 29.85 6.42 20.6 6.77 C 9.22 7.2 -41.583 4.467 -40.905 37.759 C -39.289 56.31 -25.731 82.914 10.897 81.111 C 57.311 75.993 52.579 16.323 75 8.92"+
                    `S ${162.06 * scaleLengthId} -6 ${185.11 * scaleLengthId} 23 ` +
                    `C ${181.44 * scaleLengthId} ${11.63 + 1 * scaleLengthId} ${157.88 * scaleLengthId} 0 ${126.41 * (1.2 - 0.2 * scaleLengthId) * (scaleLengthId)} 0 ` +
                    "S 81.12 4.86 57.6 6.89 " +
                    "Z")
                .attr("id", `Tp_seedStem${index}`)
                .style("fill", "#FFCA36")
                .style("stroke", "none");

            group1.append("circle")
                .attr("cx", 15)
                .attr("cy", 35)
                .attr("r", 30)
                .attr("id", `Tp_tooltipCircle${index}`)
                .attr("fill", "#000")
                .attr("opacity", "0")
                .on("mouseover", mouseover)
                .on("mousemove", mousemove)
                .on("mouseleave", mouseleave);
        }

        //定义情感的线性渐变
        {
            //目前：为每一个帖子定制一个defs：长度不同（x2不同）；末端颜色不同
            let emo_grad = tooltipDef.append("linearGradient")
                .attr("id", `Tp_emo_grad${index}`)
                .attr("gradientUnits", "userSpaceOnUse")
                .attr("x1", "57.6")
                .attr("y1", "6.89")
                .attr("x2", `${185.11 * scaleLengthId}`)
                .attr("y2", "23");

            //内容情感
            if (emo_neg_prob <= 0.5) {
                // console.log("a")
                let a = d3.rgb(129, 233, 59);	//积极一端的颜色
                let b = d3.rgb(255, 202, 54);	//橙色
                let linear = d3.scaleLinear()
                    .domain([0, 0.5])
                    .range([0, 1])
                let compute = d3.interpolate(a, b);
                let endColor = compute(linear(emo_neg_prob))

                let stop1 = emo_grad.append("stop")
                    .attr("id", `Tp_emo_grad_start${index}`)
                    .attr("offset", "0")
                    .style("stop-color", endColor);

                let stop2 = emo_grad.append("stop")
                    .attr("id", `Tp_emo_grad_end${index}`)
                    .attr("offset", "0.1")
                    .style("stop-opacity", "0")
                    .style("stop-color", endColor);

                d3.select(`#Tp_seedStem${index}`)
                    .style("fill", "url(#" + emo_grad.attr("id") + ")");

            } else {
                let a = d3.rgb(237, 28, 36);	//消极一端的颜色
                let b = d3.rgb(255, 202, 54);	//橙色
                let linear = d3.scaleLinear()
                    .domain([0.5, 1])
                    .range([0, 1])
                let compute = d3.interpolate(b, a);
                let endColor = compute(linear(emo_neg_prob))

                let stop1 = emo_grad.append("stop")
                    .attr("id", `Tp_emo_grad_start${index}`)
                    .attr("offset", "0")
                    .style("stop-color", endColor);

                let stop2 = emo_grad.append("stop")
                    .attr("id", `Tp_emo_grad_end${index}`)
                    .attr("offset", "0.1")
                    .style("stop-opacity", "0")
                    .style("stop-color", endColor);

                d3.select(`#Tp_seedStem${index}`)
                    .style("fill", "url(#" + emo_grad.attr("id") + ")");

            }
        }


        if (isVlevelOn)
        {
            // 微博等级
            if (vlevel == "normal") {
                group1.append("circle")
                    .attr("cx", "8")
                    .attr("cy", "-5")
                    .attr("r", "10")
                    .attr("stroke", "none")
                    .attr("fill", "#FFCA36")
                    .attr("opacity", "0.3")
            } else if (vlevel == "yellow") {
                group1.append("circle")
                    .attr("cx", "8")
                    .attr("cy", "-5")
                    .attr("r", "10")
                    .attr("stroke", "none")
                    .attr("fill", "#FFCA36")
                    .attr("opacity", "0.5")
                group1.append("circle")
                    .attr("cx", "32")
                    .attr("cy", "-8")
                    .attr("r", "10")
                    .attr("stroke", "none")
                    .attr("fill", "#FFCA36")
                    .attr("opacity", "0.3")
            } else if (vlevel == "gold") {
                group1.append("circle")
                    .attr("cx", "8")
                    .attr("cy", "-5")
                    .attr("r", "10")
                    .attr("stroke", "none")
                    .attr("fill", "#FFCA36")
                    .attr("opacity", "0.8")
                group1.append("circle")
                    .attr("cx", "32")
                    .attr("cy", "-8")
                    .attr("r", "10")
                    .attr("stroke", "none")
                    .attr("fill", "#FFCA36")
                    .attr("opacity", "0.5")
                group1.append("circle")
                    .attr("cx", "56")
                    .attr("cy", "-8")
                    .attr("r", "10")
                    .attr("stroke", "none")
                    .attr("fill", "#FFCA36")
                    .attr("opacity", "0.3")
            } else {
                group1.append("circle")
                    .attr("cx", "8")
                    .attr("cy", "-5")
                    .attr("r", "10")
                    .attr("stroke", "none")
                    .attr("fill", "#3694ff")
                    .attr("opacity", "0.8")
            }
        }

    }



</script>

<!--主要时间线翻页设置-->
<script>
    var curTimelinePage = 1;
    var changeTimelineTooltipPage = function (direct){
        if (direct == 0 && curTimelinePage == 2)
        {
            d3.select("#timelineTooltipPage2")
                .style("display", "none");
            d3.select("#timelineTooltipPage1")
                .style("display", "block");
            d3.select("#timelineOverlayTooltipPageRightArr")
                .style("opacity", 1)
            d3.select("#timelineOverlayTooltipPageLeftArr")
                .style("opacity", .2)

            d3.select("#timelineOverlayTooltipPageTxt")
                .text("1 / 2")

            curTimelinePage = 1;
        }

        else if (direct == 1 && curTimelinePage == 1)
        {
            d3.select("#timelineTooltipPage1")
                .style("display", "none");
            d3.select("#timelineTooltipPage2")
                .style("display", "block");

            d3.select("#timelineOverlayTooltipPageRightArr")
                .style("opacity", .2)
            d3.select("#timelineOverlayTooltipPageLeftArr")
                .style("opacity", 1)

            d3.select("#timelineOverlayTooltipPageTxt")
                .text("2 / 2")

            curTimelinePage = 2;
        }

    }
</script>

<!-------------------CTDC脚本------------------------>


<!--block div设置-->
<script>
    d3.select("#ctdcMapDiv")
        .style("width", `${window.innerWidth}px`)
        .style("height", `${window.innerHeight}px`)
        .style("top", `${0}px`)
</script>

<!--添加横向条形图-->
<script>
    //year
    {
        const yearCases = [26473, 18836, 10391, 18265, 21312, 1717, 716];
        const yearScale = d3.scaleLinear()
            .domain([d3.min(yearCases), d3.max(yearCases)])
            .range([30, 90])

        for(let i = 0; i <=6; i++)
        {
            d3.select(`#yearColBar${i}`)
                .style("width", `${yearScale(yearCases[i])}%`)
        }
    }

    //gender
    {
        const genderCases = [68083, 21465, 8202];
        const genderScale = d3.scaleLinear()
            .domain([d3.min(genderCases), d3.max(genderCases)])
            .range([30, 90])

        for(let i = 0; i <=2; i++)
        {
            d3.select(`#genderCol${i}`)
                .style("width", `${genderScale(genderCases[i])}%`)
        }
    }

    //age
    {
        const ageCases = [14798, 19599, 10135, 6435, 46783]
        const ageScale = d3.scaleLinear()
            .domain([d3.min(ageCases), d3.max(ageCases)])
            .range([30, 90])

        for(let i = 0; i <=4; i++)
        {
            d3.select(`#ageCol${i}`)
                .style("width", `${ageScale(ageCases[i])}%`)
        }
    }

    //means of control
    {
        const crlCases = [13731, 4065, 8853, 17431, 12313, 12662, 6177, 6072, 6222, 10140, 58912];
        const crlScale = d3.scaleLinear()
            .domain([d3.min(crlCases), d3.max(crlCases)])
            .range([30, 90])

        for(let i = 0; i <=10; i++)
        {
            d3.select(`#crlCol${i}`)
                .style("width", `${crlScale(crlCases[i])}%`)
        }
    }

    //exploit
    {
        const expCases = [19980, 45582, 385, 242, 1412, 7105];
        const expScale = d3.scaleLinear()
            .domain([d3.min(expCases), d3.max(expCases)])
            .range([30, 90])

        for(let i = 0; i <=6; i++)
        {
            d3.select(`#expCol${i}`)
                .style("width", `${expScale(expCases[i])}%`)
        }
    }


    //labor
    {
        const labCases = [3580, 2020, 3505, 760, 821, 6054];
        const labScale = d3.scaleLinear()
            .domain([d3.min(labCases), d3.max(labCases)])
            .range([30, 90])

        for(let i = 0; i <=5; i++)
        {
            d3.select(`#labCol${i}`)
                .style("width", `${labScale(labCases[i])}%`)
        }
    }

    //sex
    {
        const sexCases = [13287, 1866, 605];
        const sexScale = d3.scaleLinear()
            .domain([d3.min(sexCases), d3.max(sexCases)])
            .range([30, 90])

        for(let i = 0; i <=2; i++)
        {
            d3.select(`#sexCol${i}`)
                .style("width", `${sexScale(sexCases[i])}%`)
        }
    }




</script>

<!--各种函数-->
<script>
    var yearSelected = [1, 1, 1, 1, 1, 1, 1];

    var genderSelected = [1, 1, 1]; //Female, Male, Unknown

    var ageBroadSelected = [1, 1, 1, 1, 1];

    var ageBroadStr = [ ["0--8", "9--17"], ["18--20", "21--23", "24--26", "27--29"], "30--38", ["39--47", "48"], "" ]

    var meansOfControlStr =
        [   ["meansOfControlRestrictsMovement", "meansOfControlRestrictsMedicalCare",],
            "meansOfControlDebtBondage",
            "meansOfControlTakesEarnings",
            ["meansOfControlThreats", "meansOfControlThreatOfLawEnforcement",],
            "meansOfControlPsychologicalAbuse",
            ["meansOfControlPhysicalAbuse", "meansOfControlSexualAbuse"],
            "meansOfControlFalsePromises",
            "meansOfControlPsychoactiveSubstances",
            "meansOfControlExcessiveWorkingHours",
            ["meansOfControlWithholdsDocuments", "meansOfControlWithholdsNecessities",],
            ["meansOfControlNotSpecified", "meansOfControlOther", "meansOfControlUsesChildren", "meansOfControlRestrictsFinancialAccess"]]

    var meansOfControlSelected = [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];


    var typeExploitStr =
        ["isForcedLabour", "isSexualExploit", "isSlaveryAndPractices", "isForcedMarriage", "isSexAndLabour", "isOtherExploit"];

    var typeExploitSelected = [1, 1, 1, 1, 1, 1];


    var typeLaborStr =
        ["typeOfLabourAgriculture", "typeOfLabourConstruction", "typeOfLabourDomesticWork", "typeOfLabourManufacturing", "typeOfLabourHospitality",
            ["typeOfLabourOther", "typeOfLabourNotSpecified", "typeOfLabourPeddling", "typeOfLabourIllicitActivities", "typeOfLabourBegging", "typeOfLabourAquafarming"] ];

    var typeLaborSelected = [1, 1, 1, 1, 1, 1];


    var typeSexStr =
        ["typeOfSexProstitution", "typeOfSexPornography",
            ["typeOfSexRemoteInteractiveServices", "typeOfSexPrivateSexualServices"] ];

    var typeSexSelected = [1, 1, 1];







    //判断某一个数据条目是否在选择范围内
    var isSelected = function (data) {
        // data[i].meansOfControlRestrictsMovement!="0" && data[i].meansOfControlRestrictsMovement!=""
        // let selected = true;

        //规定：不同条目（比如year和gender）之间的关系是"并且"；同一条目内的关系（比如means之间的不同选项）是"或者"

        //判断year的属性
        if (data.yearOfRegistration <= 2015 && !yearSelected[0])
            return false
        else if (yearSelected[data.yearOfRegistration - 2015] == 0)
            return false;

        //判断gender的属性
        if ((data.gender == "Female" && genderSelected[0] == 0) || (data.gender == "Male" && genderSelected[1] == 0) || (data.gender == "" && genderSelected[2] == 0))
            return false;

        //判断age的属性
        for(let i = 0; i <= 4; i++)
        {
            if(typeof(ageBroadStr[i]) == "object")
            {
                if(data.ageBroad in ageBroadStr[i] && ageBroadSelected[i] == 0)
                    return false;
            }
            else{
                if(data.ageBroad == ageBroadStr[i] && ageBroadSelected[i] == 0)
                    return false;
            }
        }

        //判断means of control 属性
        {
            let isMeansofCrlIncluded = false;

            //如果选择了"其它"，认为所有空条目都符合
            if (meansOfControlSelected[10] == 1) {

                //正常条目
                for (let j in meansOfControlStr[10]) {
                    if (data[meansOfControlStr[10][j]] == 1) {
                        isMeansofCrlIncluded = true;
                        break;
                    }
                }

                if(isMeansofCrlIncluded == false)
                {
                    //该条目是否为空
                    let isEmpty = true;

                    for(let k = 0; k <= 9; k++)
                    {
                        if (typeof (meansOfControlStr[k]) == "object"){
                            for (let j in meansOfControlStr[k]) {
                                if(data[meansOfControlStr[k][j]] == 1)
                                {
                                    isEmpty = false
                                    break;
                                }
                            }
                        }else{
                            if(data[meansOfControlStr[k]] == 1)
                            {
                                isEmpty = false
                                break;
                            }
                        }
                    }

                    if(isEmpty)
                        isMeansofCrlIncluded = true;

                }
            }

            if (isMeansofCrlIncluded == false) {
                for (let i = 0; i <= 9; i++) {

                    if (meansOfControlSelected[i] == 1) {
                        if (typeof (meansOfControlStr[i]) == "object") {

                            for (let j in meansOfControlStr[i]) {
                                if (data[meansOfControlStr[i][j]] == 1) {
                                    isMeansofCrlIncluded = true;
                                    break;
                                }
                            }

                        } else {

                            if (data[meansOfControlStr[i]] == 1) {
                                isMeansofCrlIncluded = true;
                                break;
                            }

                        }
                    }

                    if (isMeansofCrlIncluded)
                        break;
                }
            }


            if (isMeansofCrlIncluded == false)
                return false;
        }


        //判断type exploit属性
        {
            let isTypeExploitIncluded = false;

            //如果选择了"其它"，认为所有空条目都符合
            if (typeExploitSelected[5] == 1) {

                //正常条目
                if (data[typeExploitStr[5]] == 1) {
                    isTypeExploitIncluded = true;
                }

                if(isTypeExploitIncluded == false)
                {
                    //该条目是否为空
                    let isEmpty = true;

                    for(let k = 0; k <= 4; k++)
                    {
                        if (typeof (typeExploitStr[k]) == "object"){
                            for (let j in typeExploitStr[k]) {
                                if(data[typeExploitStr[k][j]] == 1)
                                {
                                    isEmpty = false
                                    break;
                                }
                            }
                        }else{
                            if(data[typeExploitStr[k]] == 1)
                            {
                                isEmpty = false
                                break;
                            }
                        }
                    }

                    if(isEmpty)
                        isTypeExploitIncluded = true;

                }
            }

            if(isTypeExploitIncluded == false)
            {
                for (let i = 0; i <= 4; i++) {

                    if (typeExploitSelected[i] == 1) {
                        if (data[typeExploitStr[i]] == 1) {
                            isTypeExploitIncluded = true;
                            break;
                        }

                    }

                    if (isTypeExploitIncluded)
                        break;
                }

            }

            if (isTypeExploitIncluded == false)
                return false;
        }

        //判断type of labor属性
        {
            let isTypeLaborIncluded = false;

            //如果选择了"其它"，认为所有空条目都符合
            if (typeLaborSelected[5] == 1) {

                //正常条目
                for (let j in typeLaborStr[5]) {
                    if (data[typeLaborStr[5][j]] == 1) {
                        isTypeLaborIncluded = true;
                        break;
                    }
                }

                if(isTypeLaborIncluded == false)
                {
                    //该条目是否为空
                    let isEmpty = true;

                    for(let k = 0; k <= 4; k++)
                    {
                        if (typeof (typeLaborStr[k]) == "object"){
                            for (let j in typeLaborStr[k]) {
                                if(data[typeLaborStr[k][j]] == 1)
                                {
                                    isEmpty = false
                                    break;
                                }
                            }
                        }else{
                            if(data[typeLaborStr[k]] == 1)
                            {
                                isEmpty = false
                                break;
                            }
                        }
                    }

                    if(isEmpty)
                        isTypeLaborIncluded = true;

                }
            }



            if(isTypeLaborIncluded == false)
            {
                for (let i = 0; i <= 4; i++) {

                    if (typeLaborSelected[i] == 1) {
                        if (typeof (typeLaborStr[i]) == "object") {

                            for (let j in typeLaborStr[i]) {
                                if (data[typeLaborStr[i][j]] == 1) {
                                    isTypeLaborIncluded = true;
                                    break;
                                }
                            }

                        } else {

                            if (data[typeLaborStr[i]] == 1) {
                                isTypeLaborIncluded = true;
                                break;
                            }

                        }
                    }

                    if (isTypeLaborIncluded)
                        break;
                }

            }

            if (isTypeLaborIncluded == false)
                return false;
        }


        //判断type of sex
        {
            let isTypeSexIncluded = false;

            //如果选择了"其它"，认为所有空条目都符合
            if (typeSexSelected[2] == 1) {

                //正常条目
                for (let j in typeSexStr[2]) {
                    if (data[typeSexStr[2][j]] == 1) {
                        isTypeSexIncluded = true;
                        break;
                    }
                }

                if(isTypeSexIncluded == false)
                {
                    //该条目是否为空
                    let isEmpty = true;

                    for(let k = 0; k <= 1; k++)
                    {
                        if (typeof (typeSexStr[k]) == "object"){
                            for (let j in typeSexStr[k]) {
                                if(data[typeSexStr[k][j]] == 1)
                                {
                                    isEmpty = false
                                    break;
                                }
                            }
                        }else{
                            if(data[typeSexStr[k]] == 1)
                            {
                                isEmpty = false
                                break;
                            }
                        }
                    }

                    if(isEmpty)
                        isTypeSexIncluded = true;

                }
            }



            if(isTypeSexIncluded == false)
            {
                for (let i = 0; i <= 1; i++) {

                    if (typeSexSelected[i] == 1) {
                        if (typeof (typeSexStr[i]) == "object") {

                            for (let j in typeSexStr[i]) {
                                if (data[typeSexStr[i][j]] == 1) {
                                    isTypeSexIncluded = true;
                                    break;
                                }
                            }

                        } else {

                            if (data[typeSexStr[i]] == 1) {
                                isTypeSexIncluded = true;
                                break;
                            }

                        }
                    }

                    if (isTypeSexIncluded)
                        break;
                }

            }

            if (isTypeSexIncluded == false)
                return false;
        }


        return true;
    }


    //给数字添加千分的逗号
    var addSemi = function (num) {
        let numStr = num.toString();
        let cnt = 0;
        let resLst = [];

        for (let i = numStr.length - 1; i >= 0; i--) {

            resLst.push(numStr[i]);
            cnt += 1;
            if (cnt % 3 == 0) {
                cnt = 0;
                resLst.push(',');
            }
        }

        let res = "";
        for (let i = resLst.length - 1; i >= 0; i--) {
            res += resLst[i];
        }
        if (res[0] == ",")
            res = res.substring(1,);
        return res;
    }

    var isWindGlyphTpFixed = false;
    var windGlyphBlockDivOnClk = function () {
        isWindGlyphTpFixed = false;
        d3.select("#windGlyphBlockDiv")
            .style("display", "none");
        d3.select("#geoTooltip")
            .style("display", "none");
        d3.selectAll(".geoCircles")
            // .transition()
            // .duration(500)
            .attr("opacity", 1);

        d3.selectAll(".countryMap")
            .style("fill-opacity", .35)
            .style("stroke", "none");
    }

    var showSubTabContent = function () {
        d3.select("#geoSubTabContentDiv")
            .style("visibility", "visible")

        d3.select("#geoSubTabRightMost")
            .transition()
            .duration(200)
            .style("border-top-right-radius", "0.1rem")
        d3.select("#geoSubTabLeftMost")
            .transition()
            .duration(200)
            .style("border-top-left-radius", "0.1rem")

        d3.select("#ctdcMapDiv")
            .style("display", "block");
    }

    var hideSubTabContent = function () {
        d3.select("#geoSubTabContentDiv")
            .style("visibility", "hidden")

        d3.select("#geoSubTabRightMost")
            .transition()
            .duration(200)
            .style("border-top-right-radius", "0.3rem")
        d3.select("#geoSubTabLeftMost")
            .transition()
            .duration(200)
            .style("border-top-left-radius", "0.3rem")

        d3.select("#ctdcMapDiv")
            .style("display", "none");
    }

    var mouseoverTabContent = function (a) {
        a.style("border", "1px solid rgba(114,125,131,0.3)")
    }

    var mouseleaveTabContent = function (a) {
        a.style("border", "1px solid  rgba(114,125,131,0)")
    }

    var mouseclickTabContent = function (ele, str, id) {

        //变换选中框的颜色，并且更新数组
        if (str == "year") {
            if (yearSelected[id - 2015] == 1) {
                ele.selectAll("*").filter(".geoSubTabContentChoiceBox").style("background-color", "rgba(222,227,231,0.4)");
                yearSelected[id - 2015] = 0;
            } else {
                ele.selectAll("*").filter(".geoSubTabContentChoiceBox").style("background-color", "#7da9cc");
                yearSelected[id - 2015] = 1;
            }
        } else if (str == "gender") {
            if (genderSelected[id] == 1) {
                ele.selectAll("*").filter(".geoSubTabContentChoiceBox").style("background-color", "rgba(222,227,231,0.4)");
                genderSelected[id] = 0;
            } else {
                ele.selectAll("*").filter(".geoSubTabContentChoiceBox").style("background-color", "#7da9cc");
                genderSelected[id] = 1;
            }
        } else if (str == "age") {
            if (ageBroadSelected[id] == 1) {
                ele.selectAll("*").filter(".geoSubTabContentChoiceBox").filter(".geoSubTabContentChoiceBox").style("background-color", "rgba(222,227,231,0.4)");
                ageBroadSelected[id] = 0;
            } else {
                ele.selectAll("*").filter(".geoSubTabContentChoiceBox").filter(".geoSubTabContentChoiceBox").style("background-color", "#7da9cc");
                ageBroadSelected[id] = 1;
            }
        } else if (str == "means") {
            if (meansOfControlSelected[id] == 1) {
                ele.selectAll("*").filter(".geoSubTabContentChoiceBox").style("background-color", "rgba(222,227,231,0.4)");
                meansOfControlSelected[id] = 0;
            } else {
                ele.selectAll("*").filter(".geoSubTabContentChoiceBox").style("background-color", "#7da9cc");
                meansOfControlSelected[id] = 1;
            }
        } else if (str == "exploit"){
            if (typeExploitSelected[id] == 1) {
                ele.selectAll("*").filter(".geoSubTabContentChoiceBox").style("background-color", "rgba(222,227,231,0.4)");
                typeExploitSelected[id] = 0;
            } else {
                ele.selectAll("*").filter(".geoSubTabContentChoiceBox").style("background-color", "#7da9cc");
                typeExploitSelected[id] = 1;
            }
        } else if (str == "labor"){
            if (typeLaborSelected[id] == 1) {
                ele.selectAll("*").filter(".geoSubTabContentChoiceBox").style("background-color", "rgba(222,227,231,0.4)");
                typeLaborSelected[id] = 0;
            } else {
                ele.selectAll("*").filter(".geoSubTabContentChoiceBox").style("background-color", "#7da9cc");
                typeLaborSelected[id] = 1;
            }
        } else if (str == "sex"){
            if (typeSexSelected[id] == 1) {
                ele.selectAll("*").filter(".geoSubTabContentChoiceBox").style("background-color", "rgba(222,227,231,0.4)");
                typeSexSelected[id] = 0;
            } else {
                ele.selectAll("*").filter(".geoSubTabContentChoiceBox").style("background-color", "#7da9cc");
                typeSexSelected[id] = 1;
            }
        }


        geneFinalCTDCData()

    }


    /*

    * startNum 代表要跳动的初始数字

    * targetNum 代表要跳动到的数字

    * time  代表要跳动需要花费的时间

    * selector 代表要跳动元素的选择器

    */

    // const $setJumpNumber = (startNum, targetNum, time = 1, selector) => {
    //
    //     let dom = document.querySelector(selector);
    //
    //     let originNum = startNum;
    //
    //     let stepNum = 0;
    //
    //     let timeNum = time;
    //
    //     dom.innerHTML = startNum;
    //
    //     let timeId = setInterval(() => {
    //
    //         if (originNum < targetNum) {
    //
    //             timeNum -= 0.001;
    //
    //             let strNum = originNum.toString();
    //
    //             // 数字比较少的时候直接用 + 1; 数字很大直接 +1 要很久才能调到最对应的数字，所有后三位数随机跳动的方式进行模拟生成
    //
    //             if (targetNum.toString().length < 6) {
    //
    //                 stepNum += 1; // 这样才可以实现越跳越快的效果
    //
    //                 originNum = originNum + stepNum;
    //
    //                 dom.innerHTML = addSemi(originNum);
    //
    //             } else {
    //
    //                 stepNum += 500; // 这样才可以实现越跳越快的效果
    //
    //                 originNum = originNum + stepNum;
    //
    //                 dom.innerHTML = addSemi(strNum.substr(0, strNum.length - 3) + Math.floor(Math.random() * 10) + Math.floor(Math.random() * 10) + Math.floor(Math.random() * 10));
    //
    //             }
    //
    //         } else {
    //
    //             dom.innerHTML = addSemi(targetNum);
    //
    //             clearInterval(timeId);
    //
    //         }
    //
    //     }, timeNum);
    //
    // };


</script>


<!--绘制地图和风glyph-->
<script>

    d3.select("#windGlyphBlockDiv")
        .style("width", `${0.9 * window.innerWidth}px`)
        .style("height", `${0.9 * window.innerHeight}px`)
        .style("top", `${0.05 * window.innerHeight}px`)
        .style("left", `${0.05 * window.innerWidth}px`);

    d3.select("#svgCTDCMap")
        .attr("width", 0.8 * window.innerWidth)
        .attr("height", 0.8 * window.innerHeight)
        .attr("transform", `translate(${0.1 * window.innerWidth}, ${0.05 * window.innerHeight})`);

    // The svg
    const geoSvg = d3.select("#svgCTDCMap"),
        geoWidth = +geoSvg.attr("width"),
        geoHeight = +geoSvg.attr("height");

    const mapSvg = geoSvg.append("g").attr("id", "mapSvg");

    const windGlyphSvg = geoSvg.append("g").attr("id", "windGlyphSvg");

    const windBlockSvg = geoSvg.append("g").attr("id", "windBlockSvg");


    // Map and projection
    const projection = d3.geoMercator()
        .center([0, 20])                // GPS of location to zoom on
        .scale(200 * widScaleRatio)                       // This is like the zoom
        .translate([geoWidth / 2, geoHeight / 2])


    //读取国家iso code以及坐标数据
    var isoCordData = {};
    var isoA3toA2 = {};
    //读取CTDC数据
    //[{isocode: 'DE', homelat: '40.2', homelon: '-74.8', homecontinent: 'North America', n: '33377'}, ... ]
    var geoCTDCData = {};
    var finalCTDCData = [];

    //定义大洲的平均经纬度
    var continentCord = [ [52.531704, -109.457906],  // North America
        [-15.376192, -59.360250],  //"South America":
        [-22.839016, 134.027464],  //"Oceania":
        [5.799385, 20.016929],  //"Africa":
        [-72.000486, -158.325094],  //"Antarctica":
        [56.949627, 23.532554],  // "Europe":
        [49.387926, 108.786460] ];  //"Asia":

    var continentNameCls = {"North America": 0,
        "South America": 1,
        "Oceania": 2,
        "Africa": 3,
        "Antarctica": 4,
        "Europe": 5,
        "Asia": 6};

    var continentLst = ["North America", "South America", "Oceania",
        "Africa", "Antarctica", "Europe", "Asia"]

    //定义国家所属的大洲
    var country_continent = {'AF': 'Asia',
        'AL': 'Europe',
        'AQ': 'Antarctica',
        'DZ': 'Africa',
        'AS': 'Oceania',
        'AD': 'Europe',
        'AO': 'Africa',
        'AG': 'North America',
        'AZ': 'Asia',
        'AR': 'South America',
        'AU': 'Oceania',
        'AT': 'Europe',
        'BS': 'North America',
        'BH': 'Asia',
        'BD': 'Asia',
        'AM': 'Asia',
        'BB': 'North America',
        'BE': 'Europe',
        'BM': 'North America',
        'BT': 'Asia',
        'BO': 'South America',
        'BA': 'Europe',
        'BW': 'Africa',
        'BV': 'Antarctica',
        'BR': 'South America',
        'BZ': 'North America',
        'IO': 'Asia',
        'SB': 'Oceania',
        'VG': 'North America',
        'BN': 'Asia',
        'BG': 'Europe',
        'MM': 'Asia',
        'BI': 'Africa',
        'BY': 'Europe',
        'KH': 'Asia',
        'CM': 'Africa',
        'CA': 'North America',
        'CV': 'Africa',
        'KY': 'North America',
        'CF': 'Africa',
        'LK': 'Asia',
        'TD': 'Africa',
        'CL': 'South America',
        'CN': 'Asia',
        'TW': 'Asia',
        'CX': 'Asia',
        'CC': 'Asia',
        'CO': 'South America',
        'KM': 'Africa',
        'YT': 'Africa',
        'CG': 'Africa',
        'CD': 'Africa',
        'CK': 'Oceania',
        'CR': 'North America',
        'HR': 'Europe',
        'CU': 'North America',
        'CY': 'Asia',
        'CZ': 'Europe',
        'BJ': 'Africa',
        'DK': 'Europe',
        'DM': 'North America',
        'DO': 'North America',
        'EC': 'South America',
        'SV': 'North America',
        'GQ': 'Africa',
        'ET': 'Africa',
        'ER': 'Africa',
        'EE': 'Europe',
        'FO': 'Europe',
        'FK': 'South America',
        'GS': 'Antarctica',
        'FJ': 'Oceania',
        'FI': 'Europe',
        'AX': 'Europe',
        'FR': 'Europe',
        'GF': 'South America',
        'PF': 'Oceania',
        'TF': 'Antarctica',
        'DJ': 'Africa',
        'GA': 'Africa',
        'GE': 'Asia',
        'GM': 'Africa',
        'PS': 'Asia',
        'DE': 'Europe',
        'GH': 'Africa',
        'GI': 'Europe',
        'KI': 'Oceania',
        'GR': 'Europe',
        'GL': 'North America',
        'GD': 'North America',
        'GP': 'North America',
        'GU': 'Oceania',
        'GT': 'North America',
        'GN': 'Africa',
        'GY': 'South America',
        'HT': 'North America',
        'HM': 'Antarctica',
        'VA': 'Europe',
        'HN': 'North America',
        'HK': 'Asia',
        'HU': 'Europe',
        'IS': 'Europe',
        'IN': 'Asia',
        'ID': 'Asia',
        'IR': 'Asia',
        'IQ': 'Asia',
        'IE': 'Europe',
        'IL': 'Asia',
        'IT': 'Europe',
        'CI': 'Africa',
        'JM': 'North America',
        'JP': 'Asia',
        'KZ': 'Asia',
        'JO': 'Asia',
        'KE': 'Africa',
        'KP': 'Asia',
        'KR': 'Asia',
        'KW': 'Asia',
        'KG': 'Asia',
        'LA': 'Asia',
        'LB': 'Asia',
        'LS': 'Africa',
        'LV': 'Europe',
        'LR': 'Africa',
        'LY': 'Africa',
        'LI': 'Europe',
        'LT': 'Europe',
        'LU': 'Europe',
        'MO': 'Asia',
        'MG': 'Africa',
        'MW': 'Africa',
        'MY': 'Asia',
        'MV': 'Asia',
        'ML': 'Africa',
        'MT': 'Europe',
        'MQ': 'North America',
        'MR': 'Africa',
        'MU': 'Africa',
        'MX': 'North America',
        'MC': 'Europe',
        'MN': 'Asia',
        'MD': 'Europe',
        'ME': 'Europe',
        'MS': 'North America',
        'MA': 'Africa',
        'MZ': 'Africa',
        'OM': 'Asia',
        'NA': 'Africa',
        'NR': 'Oceania',
        'NP': 'Asia',
        'NL': 'Europe',
        'AN': 'North America',
        'CW': 'North America',
        'AW': 'North America',
        'SX': 'North America',
        'BQ': 'North America',
        'NC': 'Oceania',
        'VU': 'Oceania',
        'NZ': 'Oceania',
        'NI': 'North America',
        'NE': 'Africa',
        'NG': 'Africa',
        'NU': 'Oceania',
        'NF': 'Oceania',
        'NO': 'Europe',
        'MP': 'Oceania',
        'UM': 'North America',
        'FM': 'Oceania',
        'MH': 'Oceania',
        'PW': 'Oceania',
        'PK': 'Asia',
        'PA': 'North America',
        'PG': 'Oceania',
        'PY': 'South America',
        'PE': 'South America',
        'PH': 'Asia',
        'PN': 'Oceania',
        'PL': 'Europe',
        'PT': 'Europe',
        'GW': 'Africa',
        'TL': 'Asia',
        'PR': 'North America',
        'QA': 'Asia',
        'RE': 'Africa',
        'RO': 'Europe',
        'RU': 'Asia',
        'RW': 'Africa',
        'BL': 'North America',
        'SH': 'Africa',
        'KN': 'North America',
        'AI': 'North America',
        'LC': 'North America',
        'MF': 'North America',
        'PM': 'North America',
        'VC': 'North America',
        'SM': 'Europe',
        'ST': 'Africa',
        'SA': 'Asia',
        'SN': 'Africa',
        'RS': 'Europe',
        'SC': 'Africa',
        'SL': 'Africa',
        'SG': 'Asia',
        'SK': 'Europe',
        'VN': 'Asia',
        'SI': 'Europe',
        'SO': 'Africa',
        'ZA': 'Africa',
        'ZW': 'Africa',
        'ES': 'Europe',
        'SS': 'Africa',
        'EH': 'Africa',
        'SD': 'Africa',
        'SR': 'South America',
        'SJ': 'Europe',
        'SZ': 'Africa',
        'SE': 'Europe',
        'CH': 'Europe',
        'SY': 'Asia',
        'TJ': 'Asia',
        'TH': 'Asia',
        'TG': 'Africa',
        'TK': 'Oceania',
        'TO': 'Oceania',
        'TT': 'North America',
        'AE': 'Asia',
        'TN': 'Africa',
        'TR': 'Asia',
        'TM': 'Asia',
        'TC': 'North America',
        'TV': 'Oceania',
        'UG': 'Africa',
        'UA': 'Europe',
        'MK': 'Europe',
        'EG': 'Africa',
        'GB': 'Europe',
        'GG': 'Europe',
        'JE': 'Europe',
        'IM': 'Europe',
        'TZ': 'Africa',
        'US': 'North America',
        'VI': 'North America',
        'BF': 'Africa',
        'UY': 'South America',
        'UZ': 'Asia',
        'VE': 'South America',
        'WF': 'Oceania',
        'WS': 'Oceania',
        'YE': 'Asia',
        'ZM': 'Africa',
        'XX': 'Oceania',
        'XE': 'Asia',
        'XD': 'Asia',
        'XS': 'Asia'}


    const continentDiv = function (data){
        let cls = [];
        for(let i = 0; i < data.length; i++)
        {
            cls.push(continentNameCls[country_continent[data[i]]]);
        }

        return cls;
    }



    //刷新的时候地图只绘制一次
    var isMapDrawn = false;

    //绘制地图的函数
    var drawMapData = function (finalData) {
        Promise.all([
            d3.json("https://raw.githubusercontent.com/holtzy/D3-graph-gallery/master/DATA/world.geojson"),
            // d3.csv("https://raw.githubusercontent.com/holtzy/D3-graph-gallery/master/DATA/data_gpsLocSurfer.csv")
        ]).then(function (initialize) {
            // console.log(finalData.length)

            let dataGeo = initialize[0]
            // let data = initialize[1]
            // Create a color scale
            // const color = d3.scaleOrdinal()
            //     .domain(data.map(d => d.homecontinent))
            //     .range(d3.schemePaired);

            // Add a scale for bubble size
            const valueExtent = d3.extent(finalData, d => +d.n)

            const size = d3.scaleSqrt()
                .domain(valueExtent)  // What's in the data
                .range([1, 50])  // Size in pixel

            // let windGlyphIndex = 0;


            if (isMapDrawn == false) {
                // 地图绘制
                mapSvg.append("g")
                    .selectAll("path")
                    .data(dataGeo.features)
                    .join("path")
                    .attr("fill", "#373b4f")
                    .style("fill-opacity", .35)
                    .attr("d", d3.geoPath()
                        .projection(projection)
                    )
                    .attr("id", d => isoA3toA2[d.id])
                    .attr("class", "countryMap")
                    .style("stroke", "none");

                isMapDrawn = true;
            }

            //清空windGlyph以及blockDiv的内容
            d3.select("#windGlyphSvg").selectAll("*").remove();
            d3.select("#windBlockSvg").selectAll("*").remove();


            let windGlyphWid = 1196.15;
            let windGlyphHei = 736.5968;
            let windGlyphScale = d3.scaleSqrt()
                .domain(valueExtent)
                .range([.03, 0.25])


            // Add group for svg:
            windGlyphSvg
                .selectAll(".geoCircles")
                .data(finalData) //.sort((a,b) => +b.n - +a.n).filter((d,i) => i<1000)
                .enter()
                .append("g") //circle
                .attr("cx", d => d.cx) //d => projection([+d.homelon, +d.homelat])[0]
                .attr("cy", d => d.cy) //d => projection([+d.homelon, +d.homelat])[1]
                // .attr("r", d => size(+d.n))
                .attr("id", function (d, i) {

                    return `geoWindGlyph${d.id}`
                }) //d=> {if (d.n>2000) {return "black"} else {return "none"}  }
                .attr("class", "geoCircles")
                // .style("fill", "#ff3672")
                // .attr("stroke", "none") //d=> {if (d.n>2000) {return "black"} else {return "none"}  }
                // .attr("stroke-width", 1)
                .attr("transform", d => `translate(${d.cx - windGlyphWid * windGlyphScale(+d.n) / 2}, ${d.cy - windGlyphHei * windGlyphScale(+d.n) / 2}), scale(${windGlyphScale(+d.n)})`)
            // .attr("r", d => size(+d.n))

            // .transition()
            // .duration(1000)
            // .attr("fill-opacity", .4);

            //添加隐形矩形，作为svg悬停的响应
            windBlockSvg
                .append("g")
                .selectAll(".invisiRectWindGlyph")
                .data(finalData)
                .enter()
                .append("rect")
                .attr("x", d => d.cx - windGlyphWid * windGlyphScale(+d.n) / 2)
                .attr("y", d => d.cy - windGlyphHei * windGlyphScale(+d.n) / 2)
                .attr("width", d => windGlyphWid * windGlyphScale(+d.n))
                .attr("height", d => windGlyphHei * windGlyphScale(+d.n))
                .attr("fill", "#000")
                .attr("opacity", "0")
                .on("mouseover", function (event, d) {

                    d3.select("#geoCTDCCasesContinent")
                        .text(`cases in ${d.country.length} countries of ${d.continent}`)

                    // d3.select(this)
                    //     //.style("stroke", "black")
                    //     .style("opacity", 1)
                    // console.log(d)
                    let cx = d3.select(`#geoWindGlyph${d.id}`).attr("cx");
                    let cy = d3.select(`#geoWindGlyph${d.id}`).attr("cy");
                    // let r = d3.select(this).attr("r");
                    let transform = d3.select(`#geoWindGlyph${d.id}`).attr("transform");

                    d3.selectAll(".geoCircles")
                        // .transition()
                        // .duration(500)
                        .attr("opacity", .3);

                    d3.select(`#geoWindGlyph${d.id}`)
                        .attr("opacity", 1)
                    // .attr("stroke-width", 5)
                    // .transition()
                    // .duration(2000)
                    // .attr("transform", transform.split("scale")[0] + `scale(1)`)

                    d3.select("#geoTooltip")
                        .style("display", "block")
                        .style("left", `${cx - windGlyphWid * windGlyphScale(+d.n) / 2 + 0.1 * window.innerWidth - 340 * widScaleRatio}px`) //
                        .style("top", `${cy - 30 * widScaleRatio}px`); //${cy}

                    // d3.select("#geoCountryName")
                    //     .html(d.country);

                    // d3.select("#geoCTDCCases")
                    //     .html(addSemi(d.n));
                    $setJumpNumber(1, d.n, 15, "#geoCTDCCases");


                    //属于此类的国家地图轮廓高亮
                    let countries = d.iso; //["AE", "AU", "RF", ...]
                    let countCases = d.cases; // [12, 30, 50, ...]
                    //其他国家颜色变淡
                    d3.selectAll(".countryMap")
                        .style("fill-opacity", .1)


                    let tpDiv = "";
                    let casesScale = d3.scaleLinear()
                        .domain(d3.extent(countCases))
                        .range([80 * heiScaleRatio, 10 * heiScaleRatio]);
                    let tpDivCountries = [];

                    let colGraphNumScale = d3.scaleLinear()
                        .domain(d3.extent(countCases))
                        .range([70 * heiScaleRatio, 0]);

                    for (let k in countries) {
                        //选中国家高亮
                        d3.select(`#${countries[k]}`)
                            .style("fill-opacity", .35)
                            .style("stroke", "#FFCA36")
                            .style("stroke-opacity", .4)
                            .style("stroke-width", "1.4");

                        //Tooltip添加三角形柱状图
                        tpDiv +=
                            `
                              <div style="display: flex; align-items: center; flex-direction: column; width: 2rem">
                                <div id="${countries[k]}ColGraphNum" class="normalContent" style="opacity: .8; display: block; visibility: hidden; font-size: 0.5em; position: relative; top: ${colGraphNumScale(countCases[k])}px">${countCases[k]}</div>
                                <svg id="${countries[k]}ColGraph" width="2rem" height="4rem" style="margin-bottom: 4px;">
                                    <polygon class="triangle" stroke-linejoin="round" points="${25 * widScaleRatio},${casesScale(countCases[k])} ${10 * widScaleRatio},${90 * heiScaleRatio} ${40 * widScaleRatio},${90 * heiScaleRatio}"/>
                                </svg>
                                <img src="asset/svg/flags/${countries[k]}.svg">
                                <div id="${countries[k]}ColGraphName" class="normalContent" style="opacity: .8; display: block; visibility: hidden; font-size: 0.5em; margin-top: .3rem">${isoCordData[countries[k]][2]}</div>
                              </div>`

                    }

                    document.getElementById("geoTpSvgDiv")
                        .innerHTML = tpDiv;

                    //先将tpDiv的元素放到DOM内，再进行悬停事件的绑定
                    for (let k in countries) {
                        d3.select(`#${countries[k]}ColGraph`)
                            .on("mouseover", function (event, d) {
                                d3.select(`#${countries[k]}ColGraphNum`)
                                    .style("visibility", "visible");
                                d3.select(`#${countries[k]}ColGraphName`)
                                    .style("visibility", "visible");
                            })
                            .on("mouseleave", function (event, d) {
                                d3.select(`#${countries[k]}ColGraphNum`)
                                    .style("visibility", "hidden");
                                d3.select(`#${countries[k]}ColGraphName`)
                                    .style("visibility", "hidden");
                            })
                    }

                })
                .on("click", function () {
                    d3.select("#windGlyphBlockDiv")
                        .style("display", "block");
                    isWindGlyphTpFixed = true;
                    console.log(122222)

                })
                .on("mouseleave", function () {
                    if (!isWindGlyphTpFixed) {
                        d3.select("#geoTooltip")
                            .style("display", "none");
                        d3.selectAll(".geoCircles")
                            // .transition()
                            // .duration(500)
                            .attr("opacity", 1);

                        d3.selectAll(".countryMap")
                            .style("fill-opacity", .35)
                            .style("stroke", "none");
                    }


                })


            for (let i = 0; i < finalData.length; i++) {
                d3.xml("asset/svg/wind4.svg")
                    .then(data => {
                        d3.select(`#geoWindGlyph${i}`).node().append(data.documentElement)
                    });
            }


        });
    };

    //产出finalCTDCData的函数
    var geneFinalCTDCData = function () {
        geoCTDCData = {};
        finalCTDCData = [];

        d3.csv("asset/csv/CTDC.csv").then(function (data) {

            //筛选数据
            for (let i = 0; i < data.length; i++) {
                if (isSelected(data[i])) {
                    if (data[i]["citizenship"] in geoCTDCData) {
                        geoCTDCData[data[i]["citizenship"]] += 1;
                    } else {
                        geoCTDCData[data[i]["citizenship"]] = 1;
                    }
                }
            }

            let geoCTDCDataIso = Object.keys(geoCTDCData) // ["AE", "ED", "AF", ...]
            let geoCTDCDataCases = Object.values(geoCTDCData) // [1, 10, 20, ...]

            //数据从大到小排序
            let geoCTDCDataIsoCases = [];
            for (let i in geoCTDCDataIso) {
                let temp = {};
                temp["iso"] = geoCTDCDataIso[i];
                temp["cases"] = geoCTDCDataCases[i];
                geoCTDCDataIsoCases.push(temp);
            }
            geoCTDCDataIsoCases.sort((a, b) => b.cases - a.cases);

            geoCTDCDataIso = [];
            geoCTDCDataCases = [];
            for (let i in geoCTDCDataIsoCases) {
                geoCTDCDataIso.push(geoCTDCDataIsoCases[i]["iso"]);
                geoCTDCDataCases.push(geoCTDCDataIsoCases[i]["cases"]);
            }


            //geoCTDCData = {"AE": 1, "ED": 10, ...}
            //a: ["AE", "ED", "AF", ...]
            //b: [1, 10, 20, ...]
            //c: countryCordLst [[1, 2], [3, 4], [5, 6], ...]
            //d: countryCordCls [0, 0, 1, ...]
            //a,b,c,d是一系列的：分别对应国家的iso，case数量、国家平均坐标、国家类别

            //不需要国家坐标了
            // let countryCordLst = [];
            // for (let i in geoCTDCDataIso) {
            //     countryCordLst.push([projection([isoCordData[geoCTDCDataIso[i]][1], isoCordData[geoCTDCDataIso[i]][0]])[0],
            //         projection([isoCordData[geoCTDCDataIso[i]][1], isoCordData[geoCTDCDataIso[i]][0]])[1]])
            // }

            //大洲平均坐标
            let continentCordProjection = [];
            for (let i in continentCord) {
                continentCordProjection.push([projection([continentCord[i][1], continentCord[i][0]])[0],
                    projection([continentCord[i][1], continentCord[i][0]])[1]]);
            }

            // console.log(continentCordProjection)


            // --------------- //
            // continent计算归类 //
            // --------------- //
            let countryCordCls = continentDiv(geoCTDCDataIso);

            // console.log(countryCordCls)

            //7大洲
            for (let i = 0; i < 7; i++) {

                let temp = {};

                let casesSum = 0;
                for (let j = 0; j < countryCordCls.length; j++) {
                    if (countryCordCls[j] == i) {
                        casesSum += geoCTDCDataCases[j];

                        if ("iso" in temp) {
                            temp["iso"].push(geoCTDCDataIso[j]);
                            temp["cases"].push(geoCTDCDataCases[j]);
                            temp["country"].push(isoCordData[geoCTDCDataIso[j]][2]);

                        } else {
                            temp["iso"] = [geoCTDCDataIso[j]];
                            temp["cases"] = [geoCTDCDataCases[j]];
                            temp["country"] = [isoCordData[geoCTDCDataIso[j]][2]];

                        }
                    }
                }
                temp["n"] = casesSum;
                temp["cx"] = continentCordProjection[i][0];
                temp["cy"] = continentCordProjection[i][1];
                temp["id"] = finalCTDCData.length;
                temp["continent"] = continentLst[i]

                //这个大洲有案例
                if(casesSum!=0)
                {
                    finalCTDCData.push(temp);
                }
            }




            drawMapData(finalCTDCData);
        });

    };

    //加载iso代码
    d3.csv("asset/csv/countries_codes_and_coordinates.csv").then(function (data) {
        for (let i = 0; i < data.length; i++) {
            isoCordData[data[i]["Alpha2Code"]] = [data[i]["Latitude"], data[i]["Longitude"], data[i]["Country"]];
            isoA3toA2[data[i]["Alpha3Code"]] = data[i]["Alpha2Code"]
        }
        geneFinalCTDCData();
    });


</script>


<!--窗口resize 刷新-->
<script>
    window.onresize = function () {
        location.reload();
    }
</script>


</body>
</html>
