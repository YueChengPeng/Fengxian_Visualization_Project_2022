<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <script src="https://d3js.org/d3.v6.js"></script>
    <script type="text/javascript" src="js/lib/jquery.min.js"></script>
    <script type="text/javascript" src="js/scrollmagic/uncompressed/ScrollMagic.js"></script>
    <script type="text/javascript" src="js/scrollmagic/uncompressed/plugins/debug.addIndicators.js"></script>
    <script type="text/javascript" src="js/lib/greensock/TweenMax.min.js"></script>
    <script type="text/javascript" src="js/scrollmagic/uncompressed/plugins/animation.gsap.js"></script>
    <script src="https://use.typekit.net/nlq1kdt.js"></script>

    <!--    <script src="https://d3js.org/d3-geo-projection.v2.min.js"></script>-->
    <!--    <script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>-->

    <!--    <script src="https://unpkg.com/topojson@3"></script>-->


    <!-- BOOTSTRAP5 最新编译并压缩的 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <!-- 最新编译的 JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
            crossorigin="anonymous"></script>
    <style>
        html {
            font-size: calc(2400vw / 1728); /*rem（font size of the root element）是指相对于根元素的字体大小的单位*/
        }

        @media screen and (min-width: 1920px) {
            html {
                font-size: 30px;
            }
        }

        @media screen and (max-width: 1000px) {
            html {
                font-size: 10px;
            }
        }


        .detail-basis{
            background-color: #444444;
            font-size: .6rem;
            position: relative;
            height: 1rem;
        }



        .detail-outside{
            border: 1px solid transparent;
            height: 1rem;
            position: relative;
            top:1px;
        }
        .discrete-label{
            left: 4px;
            overflow: hidden;
            padding-left: 9px;
            position: absolute;
            text-overflow: ellipsis;
            top: 0;
            white-space: nowrap;
            width: 97%;
        }



        body {
            background: #141414;
        }

        .seedTooltip {
            position: fixed;
            top: .9rem;
            left: .9rem;
            padding: .5rem;
            width: 16rem;
            /*max-width: 500px;*/
            /*height: 300px;*/

            background-color: rgba(24, 24, 24, 1);
            -webkit-box-shadow: #000000 0px 0px 2rem;
            -moz-box-shadow: #000000 0px 0px 2rem;
            box-shadow: #000000 0px 0px 2rem;
            border-radius: .35rem;
        }

        .triangle {
            fill: #FFCA36;
            stroke: #FFCA36;
            stroke-width: 6;
        }


        .geoSubTab {
            display: flex;
            height: fit-content;
            border: rgba(255, 249, 240, 0.4) 1px solid;
            text-align: center;
            justify-content: center;
            background-color: rgba(55, 59, 79, 0.35);
            border-radius: 0.1rem;
        }

        .geoSubTabContent {
            display: flex;
            flex-direction: column;
            height: 10rem;
            width: 180px;
            border: rgba(255, 249, 240, 0.1) 1px solid;
            /*text-align: center;*/
            /*justify-content: center;*/
            background-color: rgba(55, 59, 79, .35);;
            border-radius: 0.1rem;

            font-size: 0.6rem;
            overflow: auto;
        }

        .geoSubTabContentChoice {
            margin: 0px;
            /*color: rgba(79, 79, 79, 0.6);*/

            font-family: noto-sans, sans-serif;
            font-weight: 300;
            font-style: normal;
            font-size: .6rem;
            color: rgba(255, 255, 255, 0.5);
            margin-left: 0.8rem;

            /*超出部分变成小数点*/
            text-overflow: ellipsis;
            overflow: hidden;
            /*white-space: nowrap;*/
        }

        .geoSubTabTitle {
            font-size: 0.7rem;
            color: #ffffff;
            display: flex;
            text-decoration: none;
            margin: 0px;
        }

        .geoSubTabContentChoiceDivWrap {
            flex-direction: row;
            display: flex;
            align-items: center;
            padding-left: .4rem;

        }

        .geoSubTabContentChoiceBox {
            background-color: #dee3e7;
            width: .4rem;
            height: .4rem;
            display: inline-block;
            margin-right: .4rem;
        }


        @font-face {
            font-family: impact;
            src: url("asset/font/Impact.ttf");
        }

        @font-face {
            font-family: hand;
            src: url("asset/font/Hand_Of_Sean.ttf");
        }

        .h1title {
            font-family: impact;
            font-size: 4rem;
        }

        .h2title {
            font-family: impact;
            font-size: 2rem;
        }

        .h3title {
            font-family: impact;
            font-size: 1.2rem;
        }

        .h4title {
            font-family: impact;
            font-size: 1rem;
        }

        .fontGrad45 {
            background-image: -webkit-linear-gradient(45deg, #da7d1e, #ffc000);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .cataGrad {
            background: linear-gradient(45deg, #da7d1e, #ffc000);
            border-radius: 10px;
        }


        .fontWhite {
            color: rgba(255, 255, 255, 0.84);
        }


        .fontWhite_light {
            color: rgba(255, 255, 255, 0.75);

        }

        .fontHighlight {
            color: rgba(255, 192, 0, 0.9);
        }

        .normalContent {
            font-family: noto-sans, sans-serif;
            font-weight: 300;
            font-style: normal;
            font-size: .7rem;
            color: rgba(255, 255, 255, 0.71);
        }

        .normalContentSmallWord {
            font-family: noto-sans, sans-serif;
            font-weight: 300;
            font-style: normal;
            font-size: .6rem;
            color: rgba(255, 255, 255, 0.71);
        }


        .handContent {
            font-family: hand;
            font-weight: 300;
            font-style: normal;
            font-size: 1rem;
            color: rgba(255, 192, 0, 0.9);
        }

        .captionContent {
            font-family: noto-sans, sans-serif;
            font-weight: 200;
            font-style: normal;
            font-size: .4rem;
            color: rgba(255, 255, 255, 0.71);
        }

        .normalContentBigword {
            font-family: noto-sans, sans-serif;
            font-weight: 500;
            font-style: normal;
            font-size: 1rem;
            color: rgba(255, 255, 255, 0.71);
        }

        .normalContentBigwordHighlight {
            font-family: noto-sans, sans-serif;
            font-weight: 500;
            font-style: normal;
            font-size: 1rem;
            color: rgba(255, 192, 0, 0.9);
        }

        .bigNumbers {
            font-family: noto-sans, sans-serif;
            font-weight: 600;
            font-style: normal;
            font-size: 1.2rem;
            color: rgba(255, 192, 0, 0.9);
        }

        .normalContentHighlightLink {
            font-family: noto-sans, sans-serif;
            font-weight: 600;
            font-style: normal;
            font-size: .8rem;
            text-decoration: underline;
            color: rgba(255, 192, 0, 0.9);
        }


        .normalContentHighlight {
            font-family: noto-sans, sans-serif;
            font-weight: 500;
            font-style: normal;
            font-size: .7rem;
            color: rgba(255, 192, 0, 0.9);
        }

        .buttonSelected {
            background-color: #282828;
            border-radius: 4rem;

            border: 1px rgba(68, 68, 68, 0) solid;
            padding: 10px 30px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
        }

        .buttonUnSelected {
            background-color: rgba(40, 40, 40, 0);
            opacity: .4;
            border-radius: 4rem;

            border: 1px rgba(68, 68, 68, 0.9) solid;
            padding: 10px 30px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
        }

        .questionSelected {
            background-color: #282828;
            border-radius: 4rem;

            border: 1px rgba(68, 68, 68, 0) solid;
            padding: 10px 18px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 16px;
        }

        .questionUnSelected {
            background-color: rgba(40, 40, 40, 0);
            opacity: .4;
            border-radius: 4rem;

            border: 1px rgba(68, 68, 68, 0.9) solid;
            padding: 10px 18px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 16px;
        }

        .windCard {
            margin-left: 20rem;
            margin-right: 20rem;
            height: fit-content;
            background-color: rgba(24, 24, 24, 0.5);
            border-radius: 1rem;
            margin-bottom: 10rem;
            padding-top: 2rem;
            padding-bottom: 2rem;
            -webkit-box-shadow: rgba(192, 187, 180, 0.2) 0px 0px 50px;
            -moz-box-shadow: rgba(192, 187, 180, 0.2) 0px 0px 50px;
            box-shadow: rgba(192, 187, 180, 0.2) 0px 0px 50px;
        }

        .postCard {

            height: fit-content;
            background-color: rgba(46, 46, 46, 0.5);
            padding: 3rem;
            margin-top: 2rem;
            margin-bottom: 4rem;
        }

        .postName {
            font-family: noto-sans, sans-serif;
            font-weight: 700;
            font-style: normal;
            font-size: 1.2rem;
            color: rgba(255, 255, 255, 0.84);
        }

        .slider text {
            fill: rgba(255, 255, 255, .4);
        }

        .divider-flex {
            height: 1px;
            border-top: 1px solid rgba(255, 255, 255, 0.2);
            margin-top: .3rem;
            margin-bottom: .3rem;
            border-radius: 1px;
            text-align: center;
            /*stroke-linecap: round;*/
        }

        .introTooltip {
            background-color: rgba(24, 24, 24, 1);
            -webkit-box-shadow: #000000 0px 0px 50px;
            -moz-box-shadow: #000000 0px 0px 50px;
            box-shadow: #000000 0px 0px 50px;
            border-radius: 8px;

            padding: 2rem;
        }

        .seedTooltip {
            position: fixed;
            top: 20px;
            left: 20px;
            padding: .5rem;
            width: 16rem;
            /*max-width: 500px;*/
            /*height: 300px;*/

            background-color: rgba(24, 24, 24, 1);
            -webkit-box-shadow: #000000 0px 0px 50px;
            -moz-box-shadow: #000000 0px 0px 50px;
            box-shadow: #000000 0px 0px 50px;
            border-radius: 8px;
        }

        .tooltip { /*bs5的tooltip样式*/
            font-family: noto-sans, sans-serif;
            font-weight: 300;
            font-style: normal;
            font-size: .6rem;
            color: rgba(255, 255, 255, 0.71);
        }

        .emotionScale {
            height: .4rem;
            width: .2rem;
            background: none;
            border: 1px solid #f1f1f1;
            position: relative;
            top: .35rem;
            -webkit-box-shadow: #c0bbb4 0px 0px 6px;
            -moz-box-shadow: #c0bbb4 0px 0px 6px;
            box-shadow: #c0bbb4 0px 0px 6px;
        }

        #scrollViewBox {
            position: fixed;
            /*top: 10px;*/
            /*right: 20px;*/
            height: 2rem;
            width: calc(100rem / 24);
            box-sizing: border-box; /*改为内侧描边*/
            background-color: rgb(58, 58, 58, .4);
            border: 2px solid rgb(69, 90, 100);
            border-radius: .4rem;

            /*cursor: move;*/
            /*-webkit-box-shadow: black;*/
        }

        /*steamgraph左侧小圆形*/
        .keyEventCir {
            position: fixed;
            right: 5rem;
            top: 2rem;
            width: .5rem;
            height: .5rem;
            border-top-right-radius: .25rem;
            border-bottom-right-radius: .25rem;
            border-bottom-left-radius: .25rem;
            border-top-left-radius: .25rem;
            background: rgb(69, 90, 100);
        }

    </style>
</head>
<body>

<!-- Create an element where the map will take place -->
<div id="windGlyphBlockDiv" style="position:fixed; display: none; z-index: 2" onclick="windGlyphBlockDivOnClk()"></div>

<!--悬停的tooltip-->
<div id="geoTooltip" class="seedTooltip"
     style="height: fit-content; width: 14rem; padding-left: 1rem; padding-right: 1.5rem; display: none; z-index: 3">
    <!--    <p id="geoCountryName">USA</p>-->
    <p id="geoCTDCCases" class="h2title fontGrad45" style="margin-bottom: 0px;">192</p>
    <p id="geoCTDCCasesContinent" class="normalContent" style="margin-bottom: 0px"> cases in these countries</p>
    <div>
<!--        <div class="divider-flex" style="position: relative; top: 34px"></div>-->
        <div id="geoTpSvgDiv"
             style="display: flex; flex-direction: row; max-width: 10rem; overflow: auto; padding-bottom: 1rem; padding-left: 1rem; padding-right: 1rem">
        </div>

        <!--        <d-->
    </div>
</div>

<!--map绘制-->
<div style="z-index: 5" onclick="hideSubTabContent()">
    <svg id="svgCTDCMap"></svg>
</div>

<!--选择框-->
<div style="margin-top: -7rem; top: -8rem; z-index: 2">
    <div id="subContentBox" style="display: flex; justify-content: center;">
        <div id="geoSubTabContentDiv"
             style="display: flex; flex-direction: row; justify-content: center; visibility: hidden">
            <!--YEAR-->
            <div class="geoSubTabContent" style="border-top-left-radius: 0.3rem; width: 5rem;">

                <div class="detail-outside" style="margin-bottom: 1px; margin-top: .4rem;" onmouseover="mouseoverTabContent(d3.select(this))"
                     onmouseleave="mouseleaveTabContent(d3.select(this))"
                     onclick="mouseclickTabContent(d3.select(this), 'year', 2015)" data-toggle="tooltip" data-bs-placement="right"
                     title="2002 - 2015: 20371 cases">

                    <div id="yearColBar0" class="detail-basis" style="width: 80%;"></div>
                    <!--    <label data-v-89716f00="" class="discrete-label label">Aarhus University</label>-->

                    <div class="geoSubTabContentChoiceDivWrap discrete-label normalContent" style="position:absolute;">
                        <div class="geoSubTabContentChoiceBox" style="position:absolute; background-color: #7da9cc"></div>
                        <p class="geoSubTabContentChoice">before 2016</p>
                    </div>

                </div>


                <div class="detail-outside" style="margin-bottom: 1px; margin-top: .4rem;" onmouseover="mouseoverTabContent(d3.select(this))"
                     onmouseleave="mouseleaveTabContent(d3.select(this))"
                     onclick="mouseclickTabContent(d3.select(this), 'year', 2016)"data-toggle="tooltip" data-bs-placement="right"
                     title="2016: 14921 cases">

                    <div id="yearColBar1" class="detail-basis" style="width: 80%;"></div>
                    <!--    <label data-v-89716f00="" class="discrete-label label">Aarhus University</label>-->

                    <div class="geoSubTabContentChoiceDivWrap discrete-label normalContent" style="position:absolute;">
                        <div class="geoSubTabContentChoiceBox" style="position:absolute; background-color: #7da9cc"></div>
                        <p class="geoSubTabContentChoice">2016</p>
                    </div>

                </div>

                <div class="detail-outside" style="margin-bottom: 1px; margin-top: .4rem;" onmouseover="mouseoverTabContent(d3.select(this))"
                     onmouseleave="mouseleaveTabContent(d3.select(this))"
                     onclick="mouseclickTabContent(d3.select(this), 'year', 2017)" data-toggle="tooltip" data-bs-placement="right"
                     title="2017: 4325 cases">

                    <div id="yearColBar2" class="detail-basis" style="width: 80%;"></div>
                    <!--    <label data-v-89716f00="" class="discrete-label label">Aarhus University</label>-->

                    <div class="geoSubTabContentChoiceDivWrap discrete-label normalContent" style="position:absolute;">
                        <div class="geoSubTabContentChoiceBox" style="position:absolute; background-color: #7da9cc"></div>
                        <p class="geoSubTabContentChoice">2017</p>
                    </div>

                </div>

                <div class="detail-outside" style="margin-bottom: 1px; margin-top: .4rem;" onmouseover="mouseoverTabContent(d3.select(this))"
                     onmouseleave="mouseleaveTabContent(d3.select(this))"
                     onclick="mouseclickTabContent(d3.select(this), 'year', 2018)" data-toggle="tooltip" data-bs-placement="right"
                     title="2018: 4748 cases">

                    <div id="yearColBar3" class="detail-basis" style="width: 80%;"></div>
                    <!--    <label data-v-89716f00="" class="discrete-label label">Aarhus University</label>-->

                    <div class="geoSubTabContentChoiceDivWrap discrete-label normalContent" style="position:absolute;">
                        <div class="geoSubTabContentChoiceBox" style="position:absolute; background-color: #7da9cc"></div>
                        <p class="geoSubTabContentChoice">2018</p>
                    </div>

                </div>

                <div class="detail-outside" style="margin-bottom: 1px; margin-top: .4rem;" onmouseover="mouseoverTabContent(d3.select(this))"
                     onmouseleave="mouseleaveTabContent(d3.select(this))"
                     onclick="mouseclickTabContent(d3.select(this), 'year', 2019)" data-toggle="tooltip" data-bs-placement="right"
                     title="2019: 4300 cases">

                    <div id="yearColBar4" class="detail-basis" style="width: 80%;"></div>
                    <!--    <label data-v-89716f00="" class="discrete-label label">Aarhus University</label>-->

                    <div class="geoSubTabContentChoiceDivWrap discrete-label normalContent" style="position:absolute;">
                        <div class="geoSubTabContentChoiceBox" style="position:absolute; background-color: #7da9cc"></div>
                        <p class="geoSubTabContentChoice">2019</p>
                    </div>

                </div>

                <div class="detail-outside" style="margin-bottom: 1px; margin-top: .4rem;" onmouseover="mouseoverTabContent(d3.select(this))"
                     onmouseleave="mouseleaveTabContent(d3.select(this))"
                     onclick="mouseclickTabContent(d3.select(this), 'year', 2020)" data-toggle="tooltip" data-bs-placement="right"
                     title="2020: 1717 cases">

                    <div id="yearColBar5" class="detail-basis" style="width: 80%;"></div>
                    <!--    <label data-v-89716f00="" class="discrete-label label">Aarhus University</label>-->

                    <div class="geoSubTabContentChoiceDivWrap discrete-label normalContent" style="position:absolute;">
                        <div class="geoSubTabContentChoiceBox" style="position:absolute; background-color: #7da9cc"></div>
                        <p class="geoSubTabContentChoice">2020</p>
                    </div>

                </div>

                <div class="detail-outside" style="margin-bottom: 1px; margin-top: .4rem;" onmouseover="mouseoverTabContent(d3.select(this))"
                     onmouseleave="mouseleaveTabContent(d3.select(this))"
                     onclick="mouseclickTabContent(d3.select(this), 'year', 2021)" data-toggle="tooltip" data-bs-placement="right"
                     title="2021: 716 cases">

                    <div id="yearColBar6" class="detail-basis" style="width: 80%;"></div>
                    <!--    <label data-v-89716f00="" class="discrete-label label">Aarhus University</label>-->

                    <div class="geoSubTabContentChoiceDivWrap discrete-label normalContent" style="position:absolute;">
                        <div class="geoSubTabContentChoiceBox" style="position:absolute; background-color: #7da9cc"></div>
                        <p class="geoSubTabContentChoice">2021</p>
                    </div>

                </div>


            </div>

            <!--GENDER-->
            <div class="geoSubTabContent" style="width: 5rem">

                <div class="detail-outside" style="margin-bottom: 1px; margin-top: .4rem;" onmouseover="mouseoverTabContent(d3.select(this))"
                     onmouseleave="mouseleaveTabContent(d3.select(this))"
                     onclick="mouseclickTabContent(d3.select(this), 'gender', 0)" data-toggle="tooltip" data-bs-placement="right"
                     title="male: 4300 cases">

                    <div id="genderCol0" class="detail-basis" style="width: 80%;"></div>
                    <!--    <label data-v-89716f00="" class="discrete-label label">Aarhus University</label>-->

                    <div class="geoSubTabContentChoiceDivWrap discrete-label normalContent" style="position:absolute;">
                        <div class="geoSubTabContentChoiceBox" style="position:absolute; background-color: #7da9cc"></div>
                        <p class="geoSubTabContentChoice">female</p>
                    </div>

                </div>

                <div class="detail-outside" style="margin-bottom: 1px; margin-top: .4rem;" onmouseover="mouseoverTabContent(d3.select(this))"
                     onmouseleave="mouseleaveTabContent(d3.select(this))"
                     onclick="mouseclickTabContent(d3.select(this), 'gender', 1)" data-toggle="tooltip" data-bs-placement="right"
                     title="male: 4300 cases">

                    <div id="genderCol1" class="detail-basis" style="width: 80%;"></div>
                    <!--    <label data-v-89716f00="" class="discrete-label label">Aarhus University</label>-->

                    <div class="geoSubTabContentChoiceDivWrap discrete-label normalContent" style="position:absolute;">
                        <div class="geoSubTabContentChoiceBox" style="position:absolute; background-color: #7da9cc"></div>
                        <p class="geoSubTabContentChoice">male</p>
                    </div>

                </div>

                <div class="detail-outside" style="margin-bottom: 1px; margin-top: .4rem;" onmouseover="mouseoverTabContent(d3.select(this))"
                     onmouseleave="mouseleaveTabContent(d3.select(this))"
                     onclick="mouseclickTabContent(d3.select(this), 'gender', 2)" data-toggle="tooltip" data-bs-placement="right"
                     title="male: 4300 cases">

                    <div id="genderCol2" class="detail-basis" style="width: 80%;"></div>
                    <!--    <label data-v-89716f00="" class="discrete-label label">Aarhus University</label>-->

                    <div class="geoSubTabContentChoiceDivWrap discrete-label normalContent" style="position:absolute;">
                        <div class="geoSubTabContentChoiceBox" style="position:absolute; background-color: #7da9cc"></div>
                        <p class="geoSubTabContentChoice">unknown</p>
                    </div>

                </div>


            </div>

            <!--AGE-->
            <div class="geoSubTabContent" style="width: 5rem">
                <div class="detail-outside" style="margin-bottom: 1px; margin-top: .4rem;" onmouseover="mouseoverTabContent(d3.select(this))"
                     onmouseleave="mouseleaveTabContent(d3.select(this))"
                     onclick="mouseclickTabContent(d3.select(this), 'age', 0)" data-toggle="tooltip" data-bs-placement="right"
                     title="0 - 17: 7446 cases">

                    <div id="ageCol0" class="detail-basis" style="width: 80%;"></div>
                    <!--    <label data-v-89716f00="" class="discrete-label label">Aarhus University</label>-->

                    <div class="geoSubTabContentChoiceDivWrap discrete-label normalContent" style="position:absolute;">
                        <div class="geoSubTabContentChoiceBox" style="position:absolute; background-color: #7da9cc"></div>
                        <p class="geoSubTabContentChoice">0 - 17</p>
                    </div>

                </div>

                <div class="detail-outside" style="margin-bottom: 1px; margin-top: .4rem;" onmouseover="mouseoverTabContent(d3.select(this))"
                     onmouseleave="mouseleaveTabContent(d3.select(this))"
                     onclick="mouseclickTabContent(d3.select(this), 'age', 1)" data-toggle="tooltip" data-bs-placement="right"
                     title="18 - 29: 14143 cases">

                    <div id="ageCol1" class="detail-basis" style="width: 80%;"></div>
                    <!--    <label data-v-89716f00="" class="discrete-label label">Aarhus University</label>-->

                    <div class="geoSubTabContentChoiceDivWrap discrete-label normalContent" style="position:absolute;">
                        <div class="geoSubTabContentChoiceBox" style="position:absolute; background-color: #7da9cc"></div>
                        <p class="geoSubTabContentChoice">18 - 29</p>
                    </div>

                </div>

                <div class="detail-outside" style="margin-bottom: 1px; margin-top: .4rem;" onmouseover="mouseoverTabContent(d3.select(this))"
                     onmouseleave="mouseleaveTabContent(d3.select(this))"
                     onclick="mouseclickTabContent(d3.select(this), 'age', 2)" data-toggle="tooltip" data-bs-placement="right"
                     title="30 - 38: 8449 cases">

                    <div id="ageCol2" class="detail-basis" style="width: 80%;"></div>
                    <!--    <label data-v-89716f00="" class="discrete-label label">Aarhus University</label>-->

                    <div class="geoSubTabContentChoiceDivWrap discrete-label normalContent" style="position:absolute;">
                        <div class="geoSubTabContentChoiceBox" style="position:absolute; background-color: #7da9cc"></div>
                        <p class="geoSubTabContentChoice">30 - 38</p>
                    </div>

                </div>

                <div class="detail-outside" style="margin-bottom: 1px; margin-top: .4rem;" onmouseover="mouseoverTabContent(d3.select(this))"
                     onmouseleave="mouseleaveTabContent(d3.select(this))"
                     onclick="mouseclickTabContent(d3.select(this), 'age', 3)" data-toggle="tooltip" data-bs-placement="right"
                     title="38+ : 5530 cases">

                    <div id="ageCol3" class="detail-basis" style="width: 80%;"></div>
                    <!--    <label data-v-89716f00="" class="discrete-label label">Aarhus University</label>-->

                    <div class="geoSubTabContentChoiceDivWrap discrete-label normalContent" style="position:absolute;">
                        <div class="geoSubTabContentChoiceBox" style="position:absolute; background-color: #7da9cc"></div>
                        <p class="geoSubTabContentChoice">38+</p>
                    </div>

                </div>

                <div class="detail-outside" style="margin-bottom: 1px; margin-top: .4rem;" onmouseover="mouseoverTabContent(d3.select(this))"
                     onmouseleave="mouseleaveTabContent(d3.select(this))"
                     onclick="mouseclickTabContent(d3.select(this), 'age', 4)" data-toggle="tooltip" data-bs-placement="right"
                     title="unknown: 17722 cases">

                    <div id="ageCol4" class="detail-basis" style="width: 80%;"></div>
                    <!--    <label data-v-89716f00="" class="discrete-label label">Aarhus University</label>-->

                    <div class="geoSubTabContentChoiceDivWrap discrete-label normalContent" style="position:absolute;">
                        <div class="geoSubTabContentChoiceBox" style="position:absolute; background-color: #7da9cc"></div>
                        <p class="geoSubTabContentChoice">unknown</p>
                    </div>

                </div>


            </div>

            <!--means of control-->
            <div class="geoSubTabContent" style="width: 9rem">

                <div class="detail-outside" style="margin-bottom: 1px; margin-top: .4rem;" onmouseover="mouseoverTabContent(d3.select(this))"
                     onmouseleave="mouseleaveTabContent(d3.select(this))"
                     onclick="mouseclickTabContent(d3.select(this), 'means', 0)" data-toggle="tooltip" data-bs-placement="right"
                     title="restricts movement: 4903 cases">

                    <div id="crlCol0" class="detail-basis" style="width: 80%;"></div>
                    <!--    <label data-v-89716f00="" class="discrete-label label">Aarhus University</label>-->

                    <div class="geoSubTabContentChoiceDivWrap discrete-label normalContent" style="position:absolute;">
                        <div class="geoSubTabContentChoiceBox" style="position:absolute; background-color: #7da9cc"></div>
                        <p class="geoSubTabContentChoice">restricts movement/medical care</p>
                    </div>

                </div>


                <div class="detail-outside" style="margin-bottom: 1px; margin-top: .4rem;" onmouseover="mouseoverTabContent(d3.select(this))"
                     onmouseleave="mouseleaveTabContent(d3.select(this))"
                     onclick="mouseclickTabContent(d3.select(this), 'means', 1)" data-toggle="tooltip" data-bs-placement="right"
                     title="debt bondage: 2114 cases">

                    <div id="crlCol1" class="detail-basis" style="width: 80%;"></div>
                    <!--    <label data-v-89716f00="" class="discrete-label label">Aarhus University</label>-->

                    <div class="geoSubTabContentChoiceDivWrap discrete-label normalContent" style="position:absolute;">
                        <div class="geoSubTabContentChoiceBox" style="position:absolute; background-color: rgba(222,227,231,0.4)"></div>
                        <p class="geoSubTabContentChoice">debt bondage</p>
                    </div>

                </div>

                <div class="detail-outside" style="margin-bottom: 1px; margin-top: .4rem;" onmouseover="mouseoverTabContent(d3.select(this))"
                     onmouseleave="mouseleaveTabContent(d3.select(this))"
                     onclick="mouseclickTabContent(d3.select(this), 'means', 2)" data-toggle="tooltip" data-bs-placement="right"
                     title="take earnings: 5082 cases">

                    <div id="crlCol2" class="detail-basis" style="width: 80%;"></div>
                    <!--    <label data-v-89716f00="" class="discrete-label label">Aarhus University</label>-->

                    <div class="geoSubTabContentChoiceDivWrap discrete-label normalContent" style="position:absolute;">
                        <div class="geoSubTabContentChoiceBox" style="position:absolute; background-color: rgba(222,227,231,0.4)"></div>
                        <p class="geoSubTabContentChoice">take earnings</p>
                    </div>

                </div>

                <div class="detail-outside" style="margin-bottom: 1px; margin-top: .4rem;" onmouseover="mouseoverTabContent(d3.select(this))"
                     onmouseleave="mouseleaveTabContent(d3.select(this))"
                     onclick="mouseclickTabContent(d3.select(this), 'means', 3)" data-toggle="tooltip" data-bs-placement="right"
                     title="threats: 8577 cases">

                    <div id="crlCol3" class="detail-basis" style="width: 80%;"></div>
                    <!--    <label data-v-89716f00="" class="discrete-label label">Aarhus University</label>-->

                    <div class="geoSubTabContentChoiceDivWrap discrete-label normalContent" style="position:absolute;">
                        <div class="geoSubTabContentChoiceBox" style="position:absolute; background-color: rgba(222,227,231,0.4)"></div>
                        <p class="geoSubTabContentChoice">threats</p>
                    </div>

                </div>

                <div class="detail-outside" style="margin-bottom: 1px; margin-top: .4rem;" onmouseover="mouseoverTabContent(d3.select(this))"
                     onmouseleave="mouseleaveTabContent(d3.select(this))"
                     onclick="mouseclickTabContent(d3.select(this), 'means', 4)" data-toggle="tooltip" data-bs-placement="right"
                     title="psychological abuse: 5600 cases">

                    <div id="crlCol4" class="detail-basis" style="width: 80%;"></div>
                    <!--    <label data-v-89716f00="" class="discrete-label label">Aarhus University</label>-->

                    <div class="geoSubTabContentChoiceDivWrap discrete-label normalContent" style="position:absolute;">
                        <div class="geoSubTabContentChoiceBox" style="position:absolute; background-color: rgba(222,227,231,0.4)"></div>
                        <p class="geoSubTabContentChoice">psychological abuse</p>
                    </div>

                </div>

                <div class="detail-outside" style="margin-bottom: 1px; margin-top: .4rem;" onmouseover="mouseoverTabContent(d3.select(this))"
                     onmouseleave="mouseleaveTabContent(d3.select(this))"
                     onclick="mouseclickTabContent(d3.select(this), 'means', 5)" data-toggle="tooltip" data-bs-placement="right"
                     title="physical/sexual abuse: 5011 cases">

                    <div id="crlCol5" class="detail-basis" style="width: 80%;"></div>
                    <!--    <label data-v-89716f00="" class="discrete-label label">Aarhus University</label>-->

                    <div class="geoSubTabContentChoiceDivWrap discrete-label normalContent" style="position:absolute;">
                        <div class="geoSubTabContentChoiceBox" style="position:absolute; background-color: rgba(222,227,231,0.4)"></div>
                        <p class="geoSubTabContentChoice">physical/sexual abuse</p>
                    </div>

                </div>

                <div class="detail-outside" style="margin-bottom: 1px; margin-top: .4rem;" onmouseover="mouseoverTabContent(d3.select(this))"
                     onmouseleave="mouseleaveTabContent(d3.select(this))"
                     onclick="mouseclickTabContent(d3.select(this), 'means', 6)" data-toggle="tooltip" data-bs-placement="right"
                     title="false promises: 5003 cases">

                    <div id="crlCol6" class="detail-basis" style="width: 80%;"></div>
                    <!--    <label data-v-89716f00="" class="discrete-label label">Aarhus University</label>-->

                    <div class="geoSubTabContentChoiceDivWrap discrete-label normalContent" style="position:absolute;">
                        <div class="geoSubTabContentChoiceBox" style="position:absolute; background-color: rgba(222,227,231,0.4)"></div>
                        <p class="geoSubTabContentChoice">false promises</p>
                    </div>

                </div>

                <div class="detail-outside" style="margin-bottom: 1px; margin-top: .4rem;" onmouseover="mouseoverTabContent(d3.select(this))"
                     onmouseleave="mouseleaveTabContent(d3.select(this))"
                     onclick="mouseclickTabContent(d3.select(this), 'means', 7)" data-toggle="tooltip" data-bs-placement="right"
                     title="psychoactive substances: 1376 cases">

                    <div id="crlCol7" class="detail-basis" style="width: 80%;"></div>
                    <!--    <label data-v-89716f00="" class="discrete-label label">Aarhus University</label>-->

                    <div class="geoSubTabContentChoiceDivWrap discrete-label normalContent" style="position:absolute;">
                        <div class="geoSubTabContentChoiceBox" style="position:absolute; background-color: rgba(222,227,231,0.4)"></div>
                        <p class="geoSubTabContentChoice">psychoactive substances</p>
                    </div>

                </div>

                <div class="detail-outside" style="margin-bottom: 1px; margin-top: .4rem;" onmouseover="mouseoverTabContent(d3.select(this))"
                     onmouseleave="mouseleaveTabContent(d3.select(this))"
                     onclick="mouseclickTabContent(d3.select(this), 'means', 8)" data-toggle="tooltip" data-bs-placement="right"
                     title="excessive working hours: 4085 cases">

                    <div id="crlCol8" class="detail-basis" style="width: 80%;"></div>
                    <!--    <label data-v-89716f00="" class="discrete-label label">Aarhus University</label>-->

                    <div class="geoSubTabContentChoiceDivWrap discrete-label normalContent" style="position:absolute;">
                        <div class="geoSubTabContentChoiceBox" style="position:absolute; background-color: rgba(222,227,231,0.4)"></div>
                        <p class="geoSubTabContentChoice">excessive working hours</p>
                    </div>

                </div>

                <div class="detail-outside" style="margin-bottom: 1px; margin-top: .4rem;" onmouseover="mouseoverTabContent(d3.select(this))"
                     onmouseleave="mouseleaveTabContent(d3.select(this))"
                     onclick="mouseclickTabContent(d3.select(this), 'means', 9)" data-toggle="tooltip" data-bs-placement="right"
                     title="withhold necessities/documents: 6433 cases">

                    <div id="crlCol9" class="detail-basis" style="width: 80%;"></div>
                    <!--    <label data-v-89716f00="" class="discrete-label label">Aarhus University</label>-->

                    <div class="geoSubTabContentChoiceDivWrap discrete-label normalContent" style="position:absolute;">
                        <div class="geoSubTabContentChoiceBox" style="position:absolute; background-color: rgba(222,227,231,0.4)"></div>
                        <p class="geoSubTabContentChoice">withhold necessities/documents</p>
                    </div>

                </div>

                <div class="detail-outside" style="margin-bottom: 1px; margin-top: .4rem;" onmouseover="mouseoverTabContent(d3.select(this))"
                     onmouseleave="mouseleaveTabContent(d3.select(this))"
                     onclick="mouseclickTabContent(d3.select(this), 'means', 10)" data-toggle="tooltip" data-bs-placement="right"
                     title="other/unknown: 31830 cases">

                    <div id="crlCol10" class="detail-basis" style="width: 80%;"></div>
                    <!--    <label data-v-89716f00="" class="discrete-label label">Aarhus University</label>-->

                    <div class="geoSubTabContentChoiceDivWrap discrete-label normalContent" style="position:absolute;">
                        <div class="geoSubTabContentChoiceBox" style="position:absolute; background-color: rgba(222,227,231,0.4)"></div>
                        <p class="geoSubTabContentChoice">other/unknown</p>
                    </div>

                </div>


            </div>

            <!--type of exploit-->
            <div class="geoSubTabContent" style="width: 8rem">

                <div class="detail-outside" style="margin-bottom: 1px; margin-top: .4rem;" onmouseover="mouseoverTabContent(d3.select(this))"
                     onmouseleave="mouseleaveTabContent(d3.select(this))"
                     onclick="mouseclickTabContent(d3.select(this), 'exploit', 0)" data-toggle="tooltip" data-bs-placement="right"
                     title="forced labor: 13402 cases">

                    <div id="expCol0" class="detail-basis" style="width: 80%;"></div>
                    <!--    <label data-v-89716f00="" class="discrete-label label">Aarhus University</label>-->

                    <div class="geoSubTabContentChoiceDivWrap discrete-label normalContent" style="position:absolute;">
                        <div class="geoSubTabContentChoiceBox" style="position:absolute; background-color: #7da9cc"></div>
                        <p class="geoSubTabContentChoice">forced labor</p>
                    </div>

                </div>

                <div class="detail-outside" style="margin-bottom: 1px; margin-top: .4rem;" onmouseover="mouseoverTabContent(d3.select(this))"
                     onmouseleave="mouseleaveTabContent(d3.select(this))"
                     onclick="mouseclickTabContent(d3.select(this), 'exploit', 1)" data-toggle="tooltip" data-bs-placement="right"
                     title="sexual exploit: 11752 cases">

                    <div id="expCol1" class="detail-basis" style="width: 80%;"></div>
                    <!--    <label data-v-89716f00="" class="discrete-label label">Aarhus University</label>-->

                    <div class="geoSubTabContentChoiceDivWrap discrete-label normalContent" style="position:absolute;">
                        <div class="geoSubTabContentChoiceBox" style="position:absolute; background-color: #7da9cc"></div>
                        <p class="geoSubTabContentChoice">sexual exploit</p>
                    </div>

                </div>

                <div class="detail-outside" style="margin-bottom: 1px; margin-top: .4rem;" onmouseover="mouseoverTabContent(d3.select(this))"
                     onmouseleave="mouseleaveTabContent(d3.select(this))"
                     onclick="mouseclickTabContent(d3.select(this), 'exploit', 2)" data-toggle="tooltip" data-bs-placement="right"
                     title="slavery & practices: 371 cases">

                    <div id="expCol2" class="detail-basis" style="width: 80%;"></div>
                    <!--    <label data-v-89716f00="" class="discrete-label label">Aarhus University</label>-->

                    <div class="geoSubTabContentChoiceDivWrap discrete-label normalContent" style="position:absolute;">
                        <div class="geoSubTabContentChoiceBox" style="position:absolute; background-color: #7da9cc"></div>
                        <p class="geoSubTabContentChoice">slavery & practices</p>
                    </div>

                </div>

                <div class="detail-outside" style="margin-bottom: 1px; margin-top: .4rem;" onmouseover="mouseoverTabContent(d3.select(this))"
                     onmouseleave="mouseleaveTabContent(d3.select(this))"
                     onclick="mouseclickTabContent(d3.select(this), 'exploit', 3)" data-toggle="tooltip" data-bs-placement="right"
                     title="forced marriage: 242 cases">

                    <div id="expCol3" class="detail-basis" style="width: 80%;"></div>
                    <!--    <label data-v-89716f00="" class="discrete-label label">Aarhus University</label>-->

                    <div class="geoSubTabContentChoiceDivWrap discrete-label normalContent" style="position:absolute;">
                        <div class="geoSubTabContentChoiceBox" style="position:absolute; background-color: #7da9cc"></div>
                        <p class="geoSubTabContentChoice">forced marriage</p>
                    </div>

                </div>

                <div class="detail-outside" style="margin-bottom: 1px; margin-top: .4rem;" onmouseover="mouseoverTabContent(d3.select(this))"
                     onmouseleave="mouseleaveTabContent(d3.select(this))"
                     onclick="mouseclickTabContent(d3.select(this), 'exploit', 4)" data-toggle="tooltip" data-bs-placement="right"
                     title="sex & labour: 224 cases">

                    <div id="expCol4" class="detail-basis" style="width: 80%;"></div>
                    <!--    <label data-v-89716f00="" class="discrete-label label">Aarhus University</label>-->

                    <div class="geoSubTabContentChoiceDivWrap discrete-label normalContent" style="position:absolute;">
                        <div class="geoSubTabContentChoiceBox" style="position:absolute; background-color: #7da9cc"></div>
                        <p class="geoSubTabContentChoice">sex & labour</p>
                    </div>

                </div>

                <div class="detail-outside" style="margin-bottom: 1px; margin-top: .4rem;" onmouseover="mouseoverTabContent(d3.select(this))"
                     onmouseleave="mouseleaveTabContent(d3.select(this))"
                     onclick="mouseclickTabContent(d3.select(this), 'exploit', 5)" data-toggle="tooltip" data-bs-placement="right"
                     title="other/unknown: 7048 cases">

                    <div id="expCol5" class="detail-basis" style="width: 80%;"></div>
                    <!--    <label data-v-89716f00="" class="discrete-label label">Aarhus University</label>-->

                    <div class="geoSubTabContentChoiceDivWrap discrete-label normalContent" style="position:absolute;">
                        <div class="geoSubTabContentChoiceBox" style="position:absolute; background-color: #7da9cc"></div>
                        <p class="geoSubTabContentChoice">other/unknown</p>
                    </div>

                </div>

            </div>

            <!--type of labour-->
            <div class="geoSubTabContent" style="width: 9rem">

                <div class="detail-outside" style="margin-bottom: 1px; margin-top: .4rem;" onmouseover="mouseoverTabContent(d3.select(this))"
                     onmouseleave="mouseleaveTabContent(d3.select(this))"
                     onclick="mouseclickTabContent(d3.select(this), 'labor', 0)" data-toggle="tooltip" data-bs-placement="right"
                     title="agriculture: 1939 cases">

                    <div id="labCol0" class="detail-basis" style="width: 80%;"></div>
                    <!--    <label data-v-89716f00="" class="discrete-label label">Aarhus University</label>-->

                    <div class="geoSubTabContentChoiceDivWrap discrete-label normalContent" style="position:absolute;">
                        <div class="geoSubTabContentChoiceBox" style="position:absolute; background-color: #7da9cc"></div>
                        <p class="geoSubTabContentChoice">agriculture</p>
                    </div>

                </div>

                <div class="detail-outside" style="margin-bottom: 1px; margin-top: .4rem;" onmouseover="mouseoverTabContent(d3.select(this))"
                     onmouseleave="mouseleaveTabContent(d3.select(this))"
                     onclick="mouseclickTabContent(d3.select(this), 'labor', 1)" data-toggle="tooltip" data-bs-placement="right"
                     title="construction: 1860 cases">

                    <div id="labCol1" class="detail-basis" style="width: 80%;"></div>
                    <!--    <label data-v-89716f00="" class="discrete-label label">Aarhus University</label>-->

                    <div class="geoSubTabContentChoiceDivWrap discrete-label normalContent" style="position:absolute;">
                        <div class="geoSubTabContentChoiceBox" style="position:absolute; background-color: #7da9cc"></div>
                        <p class="geoSubTabContentChoice">construction</p>
                    </div>

                </div>

                <div class="detail-outside" style="margin-bottom: 1px; margin-top: .4rem;" onmouseover="mouseoverTabContent(d3.select(this))"
                     onmouseleave="mouseleaveTabContent(d3.select(this))"
                     onclick="mouseclickTabContent(d3.select(this), 'labor', 2)" data-toggle="tooltip" data-bs-placement="right"
                     title="domestic work: 2995 cases">

                    <div id="labCol2" class="detail-basis" style="width: 80%;"></div>
                    <!--    <label data-v-89716f00="" class="discrete-label label">Aarhus University</label>-->

                    <div class="geoSubTabContentChoiceDivWrap discrete-label normalContent" style="position:absolute;">
                        <div class="geoSubTabContentChoiceBox" style="position:absolute; background-color: #7da9cc"></div>
                        <p class="geoSubTabContentChoice">domestic work</p>
                    </div>

                </div>

                <div class="detail-outside" style="margin-bottom: 1px; margin-top: .4rem;" onmouseover="mouseoverTabContent(d3.select(this))"
                     onmouseleave="mouseleaveTabContent(d3.select(this))"
                     onclick="mouseclickTabContent(d3.select(this), 'labor', 3)" data-toggle="tooltip" data-bs-placement="right"
                     title="manufacturing: 649 cases">

                    <div id="labCol3" class="detail-basis" style="width: 80%;"></div>
                    <!--    <label data-v-89716f00="" class="discrete-label label">Aarhus University</label>-->

                    <div class="geoSubTabContentChoiceDivWrap discrete-label normalContent" style="position:absolute;">
                        <div class="geoSubTabContentChoiceBox" style="position:absolute; background-color: #7da9cc"></div>
                        <p class="geoSubTabContentChoice">manufacturing</p>
                    </div>

                </div>
                <div class="detail-outside" style="margin-bottom: 1px; margin-top: .4rem;" onmouseover="mouseoverTabContent(d3.select(this))"
                     onmouseleave="mouseleaveTabContent(d3.select(this))"
                     onclick="mouseclickTabContent(d3.select(this), 'labor', 4)" data-toggle="tooltip" data-bs-placement="right"
                     title="hospitality: 357 cases">

                    <div id="labCol4" class="detail-basis" style="width: 80%;"></div>
                    <!--    <label data-v-89716f00="" class="discrete-label label">Aarhus University</label>-->

                    <div class="geoSubTabContentChoiceDivWrap discrete-label normalContent" style="position:absolute;">
                        <div class="geoSubTabContentChoiceBox" style="position:absolute; background-color: #7da9cc"></div>
                        <p class="geoSubTabContentChoice">hospitality</p>
                    </div>

                </div>

                <div class="detail-outside" style="margin-bottom: 1px; margin-top: .4rem;" onmouseover="mouseoverTabContent(d3.select(this))"
                     onmouseleave="mouseleaveTabContent(d3.select(this))"
                     onclick="mouseclickTabContent(d3.select(this), 'labor', 5)" data-toggle="tooltip" data-bs-placement="right"
                     title="other/unknown: 2350 cases">

                    <div id="labCol5" class="detail-basis" style="width: 80%;"></div>
                    <!--    <label data-v-89716f00="" class="discrete-label label">Aarhus University</label>-->

                    <div class="geoSubTabContentChoiceDivWrap discrete-label normalContent" style="position:absolute;">
                        <div class="geoSubTabContentChoiceBox" style="position:absolute; background-color: #7da9cc"></div>
                        <p class="geoSubTabContentChoice">other/unknown</p>
                    </div>

                </div>


            </div>

            <!--type of sex-->
            <div class="geoSubTabContent" style="border-top-right-radius: 0.3rem; width: 9rem">

                <div class="detail-outside" style="margin-bottom: 1px; margin-top: .4rem;" onmouseover="mouseoverTabContent(d3.select(this))"
                     onmouseleave="mouseleaveTabContent(d3.select(this))"
                     onclick="mouseclickTabContent(d3.select(this), 'sex', 0)" data-toggle="tooltip" data-bs-placement="right"
                     title="prostitution: 2149 cases">

                    <div id="sexCol0" class="detail-basis" style="width: 80%;"></div>
                    <!--    <label data-v-89716f00="" class="discrete-label label">Aarhus University</label>-->

                    <div class="geoSubTabContentChoiceDivWrap discrete-label normalContent" style="position:absolute;">
                        <div class="geoSubTabContentChoiceBox" style="position:absolute; background-color: #7da9cc"></div>
                        <p class="geoSubTabContentChoice">prostitution</p>
                    </div>

                </div>


                <div class="detail-outside" style="margin-bottom: 1px; margin-top: .4rem;" onmouseover="mouseoverTabContent(d3.select(this))"
                     onmouseleave="mouseleaveTabContent(d3.select(this))"
                     onclick="mouseclickTabContent(d3.select(this), 'sex', 1)" data-toggle="tooltip" data-bs-placement="right"
                     title="remote interactive services: 8093 cases">

                    <div id="sexCol1" class="detail-basis" style="width: 80%;"></div>
                    <!--    <label data-v-89716f00="" class="discrete-label label">Aarhus University</label>-->

                    <div class="geoSubTabContentChoiceDivWrap discrete-label normalContent" style="position:absolute;">
                        <div class="geoSubTabContentChoiceBox" style="position:absolute; background-color: #7da9cc"></div>
                        <p class="geoSubTabContentChoice">remote interactive services</p>
                    </div>

                </div>


                <div class="detail-outside" style="margin-bottom: 1px; margin-top: .4rem;" onmouseover="mouseoverTabContent(d3.select(this))"
                     onmouseleave="mouseleaveTabContent(d3.select(this))"
                     onclick="mouseclickTabContent(d3.select(this), 'sex', 2)" data-toggle="tooltip" data-bs-placement="right"
                     title="other: 27 cases">

                    <div id="sexCol2" class="detail-basis" style="width: 80%;"></div>
                    <!--    <label data-v-89716f00="" class="discrete-label label">Aarhus University</label>-->

                    <div class="geoSubTabContentChoiceDivWrap discrete-label normalContent" style="position:absolute;">
                        <div class="geoSubTabContentChoiceBox" style="position:absolute; background-color: #7da9cc"></div>
                        <p class="geoSubTabContentChoice">other/unknown</p>
                    </div>

                </div>


            </div>
        </div>
    </div>

    <div style="display: flex; justify-content: center; z-index: 2">
        <div style="display: flex; flex-direction: row; justify-content: center;" onclick="showSubTabContent()">
            <div id="geoSubTabLeftMost" class="geoSubTab"
                 style="border-bottom-left-radius: 0.3rem; border-top-left-radius: 0.3rem; width: 5rem">
                <p class="normalContent" style="margin: 0rem"> YEAR </p>
            </div>
            <div class="geoSubTab" style="width: 5rem">
                <p class="normalContent" style="margin: 0rem"> GENDER </p>
            </div>
            <div class="geoSubTab" style="width: 5rem">
                <p class="normalContent" style="margin: 0rem"> AGE </p>
            </div>
            <div class="geoSubTab" style="width: 9rem">
                <p class="normalContent" style="margin: 0rem"> MEANS OF CONTROL </p>
            </div>
            <div class="geoSubTab" style="width: 8rem">
                <p class="normalContent" style="margin: 0rem"> TYPE OF EXPLOIT </p>
            </div>
            <div class="geoSubTab" style="width: 9rem">
                <p class="normalContent" style="margin: 0rem"> TYPE OF LABOUR </p>
            </div>
            <div id="geoSubTabRightMost" class="geoSubTab"
                 style="border-bottom-right-radius: 0.3rem; border-top-right-radius: 0.3rem; width: 9rem">
                <p class="normalContent" style="margin: 0rem"> TYPE OF SEX </p>
            </div>
        </div>
    </div>
</div>


<!--blockdiv-->
<div id="ctdcMapDiv" style="display: none; position: fixed; z-index: -1" onclick="hideSubTabContent()"></div>


<!--bootstrap5 tooltip 属性设置-->
<script>
    $(function () {
        $("[data-toggle='tooltip']").tooltip();

        //设置tooltip为点击之后隐藏
        $('[data-toggle="tooltip"]').click(function () {
            $('[data-toggle="tooltip"]').tooltip("hide");
        });

    });
</script>


<!--block div设置-->
<script>
    d3.select("#ctdcMapDiv")
        .style("width", `${window.innerWidth}px`)
        .style("height", `${window.innerHeight}px`)
        .style("top", `${0}px`)
</script>

<!--添加横向条形图-->
<script>
    //year
    {
        const yearCases = [20371, 14921, 4325, 4748, 4300, 1717, 716];
        const yearScale = d3.scaleLinear()
            .domain([d3.min(yearCases), d3.max(yearCases)])
            .range([30, 90])

        for(let i = 0; i <=6; i++)
        {
            d3.select(`#yearColBar${i}`)
                .style("width", `${yearScale(yearCases[i])}%`)
        }
    }

    //gender
    {
        const genderCases = [34378, 17967, 945];
        const genderScale = d3.scaleLinear()
            .domain([d3.min(genderCases), d3.max(genderCases)])
            .range([30, 90])

        for(let i = 0; i <=2; i++)
        {
            d3.select(`#genderCol${i}`)
                .style("width", `${genderScale(genderCases[i])}%`)
        }
    }

    //age
    {
        const ageCases = [7446, 14143, 8449, 5530, 17722]
        const ageScale = d3.scaleLinear()
            .domain([d3.min(ageCases), d3.max(ageCases)])
            .range([30, 90])

        for(let i = 0; i <=4; i++)
        {
            d3.select(`#ageCol${i}`)
                .style("width", `${ageScale(ageCases[i])}%`)
        }
    }

    //means of control
    {
        const crlCases = [4903, 2114, 5082, 8577, 5600, 5011, 5003, 1376, 4085, 6433, 31830];
        const crlScale = d3.scaleLinear()
            .domain([d3.min(crlCases), d3.max(crlCases)])
            .range([30, 90])

        for(let i = 0; i <=10; i++)
        {
            d3.select(`#crlCol${i}`)
                .style("width", `${crlScale(crlCases[i])}%`)
        }
    }

    //exploit
    {
        const expCases = [13402, 11752, 371, 242, 224, 7048];
        const expScale = d3.scaleLinear()
            .domain([d3.min(expCases), d3.max(expCases)])
            .range([30, 90])

        for(let i = 0; i <=6; i++)
        {
            d3.select(`#expCol${i}`)
                .style("width", `${expScale(expCases[i])}%`)
        }
    }


    //labor
    {
        const labCases = [1939, 1860, 2995, 649, 357, 2350];
        const labScale = d3.scaleLinear()
            .domain([d3.min(labCases), d3.max(labCases)])
            .range([30, 90])

        for(let i = 0; i <=5; i++)
        {
            d3.select(`#labCol${i}`)
                .style("width", `${labScale(labCases[i])}%`)
        }
    }

    //sex
    {
        const sexCases = [2149, 8093, 27];
        const sexScale = d3.scaleLinear()
            .domain([d3.min(sexCases), d3.max(sexCases)])
            .range([30, 90])

        for(let i = 0; i <=2; i++)
        {
            d3.select(`#sexCol${i}`)
                .style("width", `${sexScale(sexCases[i])}%`)
        }
    }




</script>

<!--各种函数-->
<script>

    var heiScaleRatio = 1 / 886 * window.innerHeight;

    var widScaleRatio = 1 / 1728 * window.innerWidth;

    var yearSelected = [1, 1, 1, 1, 1, 1, 1];

    var genderSelected = [1, 1, 1]; //Female, Male, Unknown

    var ageBroadSelected = [1, 1, 1, 1, 1];

    var ageBroadStr = [ ["0--8", "9--17"], ["18--20", "21--23", "24--26", "27--29"], "30--38", ["39--47", "48"], "" ]

    var meansOfControlStr =
        [   ["meansOfControlRestrictsMovement", "meansOfControlRestrictsMedicalCare",],
            "meansOfControlDebtBondage",
            "meansOfControlTakesEarnings",
            ["meansOfControlThreats", "meansOfControlThreatOfLawEnforcement",],
            "meansOfControlPsychologicalAbuse",
            ["meansOfControlPhysicalAbuse", "meansOfControlSexualAbuse"],
            "meansOfControlFalsePromises",
            "meansOfControlPsychoactiveSubstances",
            "meansOfControlExcessiveWorkingHours",
            ["meansOfControlWithholdsDocuments", "meansOfControlWithholdsNecessities",],
            ["meansOfControlNotSpecified", "meansOfControlOther", "meansOfControlUsesChildren", "meansOfControlRestrictsFinancialAccess"]]

    var meansOfControlSelected = [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];


    var typeExploitStr =
        ["isForcedLabour", "isSexualExploit", "isSlaveryAndPractices", "isForcedMarriage", "isSexAndLabour", "isOtherExploit"];

    var typeExploitSelected = [1, 1, 1, 1, 1, 1];


    var typeLaborStr =
        ["typeOfLabourAgriculture", "typeOfLabourConstruction", "typeOfLabourDomesticWork", "typeOfLabourManufacturing", "typeOfLabourHospitality",
            ["typeOfLabourOther", "typeOfLabourNotSpecified", "typeOfLabourPeddling", "typeOfLabourIllicitActivities", "typeOfLabourBegging", "typeOfLabourAquafarming"] ];

    var typeLaborSelected = [1, 1, 1, 1, 1, 1];


    var typeSexStr =
        ["typeOfSexProstitution", "typeOfSexRemoteInteractiveServices",
            ["typeOfSexPornography", "typeOfSexPrivateSexualServices"] ];

    var typeSexSelected = [1, 1, 1];







    //判断某一个数据条目是否在选择范围内
    var isSelected = function (data) {
        // data[i].meansOfControlRestrictsMovement!="0" && data[i].meansOfControlRestrictsMovement!=""
        // let selected = true;

        //规定：不同条目（比如year和gender）之间的关系是"并且"；同一条目内的关系（比如means之间的不同选项）是"或者"

        //判断year的属性
        if (data.yearOfRegistration <= 2015 && !yearSelected[0])
            return false
        else if (yearSelected[data.yearOfRegistration - 2015] == 0)
            return false;

        //判断gender的属性
        if ((data.gender == "Female" && genderSelected[0] == 0) || (data.gender == "Male" && genderSelected[1] == 0) || (data.gender == "" && genderSelected[2] == 0))
            return false;

        //判断age的属性
        for(let i = 0; i <= 4; i++)
        {
            if(typeof(ageBroadStr[i]) == "object")
            {
                if(data.ageBroad in ageBroadStr[i] && ageBroadSelected[i] == 0)
                    return false;
            }
            else{
                if(data.ageBroad == ageBroadStr[i] && ageBroadSelected[i] == 0)
                    return false;
            }
        }

        //判断means of control 属性
        {
            let isMeansofCrlIncluded = false;

            //如果选择了"其它"，认为所有空条目都符合
            if (meansOfControlSelected[10] == 1) {

                //正常条目
                for (let j in meansOfControlStr[10]) {
                    if (data[meansOfControlStr[10][j]] == 1) {
                        isMeansofCrlIncluded = true;
                        break;
                    }
                }

                if(isMeansofCrlIncluded == false)
                {
                    //该条目是否为空
                    let isEmpty = true;

                    for(let k = 0; k <= 9; k++)
                    {
                        if (typeof (meansOfControlStr[k]) == "object"){
                            for (let j in meansOfControlStr[k]) {
                                if(data[meansOfControlStr[k][j]] == 1)
                                {
                                    isEmpty = false
                                    break;
                                }
                            }
                        }else{
                            if(data[meansOfControlStr[k]] == 1)
                            {
                                isEmpty = false
                                break;
                            }
                        }
                    }

                    if(isEmpty)
                        isMeansofCrlIncluded = true;

                }
            }

            if (isMeansofCrlIncluded == false) {
                for (let i = 0; i <= 9; i++) {

                    if (meansOfControlSelected[i] == 1) {
                        if (typeof (meansOfControlStr[i]) == "object") {

                            for (let j in meansOfControlStr[i]) {
                                if (data[meansOfControlStr[i][j]] == 1) {
                                    isMeansofCrlIncluded = true;
                                    break;
                                }
                            }

                        } else {

                            if (data[meansOfControlStr[i]] == 1) {
                                isMeansofCrlIncluded = true;
                                break;
                            }

                        }
                    }

                    if (isMeansofCrlIncluded)
                        break;
                }
            }


            if (isMeansofCrlIncluded == false)
                return false;
        }


        //判断type exploit属性
        {
            let isTypeExploitIncluded = false;

            //如果选择了"其它"，认为所有空条目都符合
            if (typeExploitSelected[5] == 1) {

                //正常条目
                if (data[typeExploitStr[5]] == 1) {
                    isTypeExploitIncluded = true;
                }

                if(isTypeExploitIncluded == false)
                {
                    //该条目是否为空
                    let isEmpty = true;

                    for(let k = 0; k <= 4; k++)
                    {
                        if (typeof (typeExploitStr[k]) == "object"){
                            for (let j in typeExploitStr[k]) {
                                if(data[typeExploitStr[k][j]] == 1)
                                {
                                    isEmpty = false
                                    break;
                                }
                            }
                        }else{
                            if(data[typeExploitStr[k]] == 1)
                            {
                                isEmpty = false
                                break;
                            }
                        }
                    }

                    if(isEmpty)
                        isTypeExploitIncluded = true;

                }
            }

            if(isTypeExploitIncluded == false)
            {
                for (let i = 0; i <= 4; i++) {

                    if (typeExploitSelected[i] == 1) {
                        if (data[typeExploitStr[i]] == 1) {
                            isTypeExploitIncluded = true;
                            break;
                        }

                    }

                    if (isTypeExploitIncluded)
                        break;
                }

            }

            if (isTypeExploitIncluded == false)
                return false;
        }

        //判断type of labor属性
        {
            let isTypeLaborIncluded = false;

            //如果选择了"其它"，认为所有空条目都符合
            if (typeLaborSelected[5] == 1) {

                //正常条目
                for (let j in typeLaborStr[5]) {
                    if (data[typeLaborStr[5][j]] == 1) {
                        isTypeLaborIncluded = true;
                        break;
                    }
                }

                if(isTypeLaborIncluded == false)
                {
                    //该条目是否为空
                    let isEmpty = true;

                    for(let k = 0; k <= 4; k++)
                    {
                        if (typeof (typeLaborStr[k]) == "object"){
                            for (let j in typeLaborStr[k]) {
                                if(data[typeLaborStr[k][j]] == 1)
                                {
                                    isEmpty = false
                                    break;
                                }
                            }
                        }else{
                            if(data[typeLaborStr[k]] == 1)
                            {
                                isEmpty = false
                                break;
                            }
                        }
                    }

                    if(isEmpty)
                        isTypeLaborIncluded = true;

                }
            }



            if(isTypeLaborIncluded == false)
            {
                for (let i = 0; i <= 4; i++) {

                    if (typeLaborSelected[i] == 1) {
                        if (typeof (typeLaborStr[i]) == "object") {

                            for (let j in typeLaborStr[i]) {
                                if (data[typeLaborStr[i][j]] == 1) {
                                    isTypeLaborIncluded = true;
                                    break;
                                }
                            }

                        } else {

                            if (data[typeLaborStr[i]] == 1) {
                                isTypeLaborIncluded = true;
                                break;
                            }

                        }
                    }

                    if (isTypeLaborIncluded)
                        break;
                }

            }

            if (isTypeLaborIncluded == false)
                return false;
        }


        //判断type of sex
        {
            let isTypeSexIncluded = false;

            //如果选择了"其它"，认为所有空条目都符合
            if (typeSexSelected[2] == 1) {

                //正常条目
                for (let j in typeSexStr[2]) {
                    if (data[typeSexStr[2][j]] == 1) {
                        isTypeSexIncluded = true;
                        break;
                    }
                }

                if(isTypeSexIncluded == false)
                {
                    //该条目是否为空
                    let isEmpty = true;

                    for(let k = 0; k <= 1; k++)
                    {
                        if (typeof (typeSexStr[k]) == "object"){
                            for (let j in typeSexStr[k]) {
                                if(data[typeSexStr[k][j]] == 1)
                                {
                                    isEmpty = false
                                    break;
                                }
                            }
                        }else{
                            if(data[typeSexStr[k]] == 1)
                            {
                                isEmpty = false
                                break;
                            }
                        }
                    }

                    if(isEmpty)
                        isTypeSexIncluded = true;

                }
            }



            if(isTypeSexIncluded == false)
            {
                for (let i = 0; i <= 1; i++) {

                    if (typeSexSelected[i] == 1) {
                        if (typeof (typeSexStr[i]) == "object") {

                            for (let j in typeSexStr[i]) {
                                if (data[typeSexStr[i][j]] == 1) {
                                    isTypeSexIncluded = true;
                                    break;
                                }
                            }

                        } else {

                            if (data[typeSexStr[i]] == 1) {
                                isTypeSexIncluded = true;
                                break;
                            }

                        }
                    }

                    if (isTypeSexIncluded)
                        break;
                }

            }

            if (isTypeSexIncluded == false)
                return false;
        }


        return true;
    }


    //给数字添加千分的逗号
    var addSemi = function (num) {
        let numStr = num.toString();
        let cnt = 0;
        let resLst = [];

        for (let i = numStr.length - 1; i >= 0; i--) {

            resLst.push(numStr[i]);
            cnt += 1;
            if (cnt % 3 == 0) {
                cnt = 0;
                resLst.push(',');
            }
        }

        let res = "";
        for (let i = resLst.length - 1; i >= 0; i--) {
            res += resLst[i];
        }
        if (res[0] == ",")
            res = res.substring(1,);
        return res;
    }

    var isWindGlyphTpFixed = false;
    var windGlyphBlockDivOnClk = function () {
        isWindGlyphTpFixed = false;
        d3.select("#windGlyphBlockDiv")
            .style("display", "none");
        d3.select("#geoTooltip")
            .style("display", "none");
        d3.selectAll(".geoCircles")
            // .transition()
            // .duration(500)
            .attr("opacity", 1);

        d3.selectAll(".countryMap")
            .style("fill-opacity", .35)
            .style("stroke", "none");
    }

    var showSubTabContent = function () {
        d3.select("#geoSubTabContentDiv")
            .style("visibility", "visible")

        d3.select("#geoSubTabRightMost")
            .transition()
            .duration(200)
            .style("border-top-right-radius", "0.1rem")
        d3.select("#geoSubTabLeftMost")
            .transition()
            .duration(200)
            .style("border-top-left-radius", "0.1rem")

        d3.select("#ctdcMapDiv")
            .style("display", "block");
    }

    var hideSubTabContent = function () {
        d3.select("#geoSubTabContentDiv")
            .style("visibility", "hidden")

        d3.select("#geoSubTabRightMost")
            .transition()
            .duration(200)
            .style("border-top-right-radius", "0.3rem")
        d3.select("#geoSubTabLeftMost")
            .transition()
            .duration(200)
            .style("border-top-left-radius", "0.3rem")

        d3.select("#ctdcMapDiv")
            .style("display", "none");
    }

    var mouseoverTabContent = function (a) {
        a.style("border", "1px solid rgba(114,125,131,0.3)")
    }

    var mouseleaveTabContent = function (a) {
        a.style("border", "1px solid  rgba(114,125,131,0)")
    }

    var mouseclickTabContent = function (ele, str, id) {

        //变换选中框的颜色，并且更新数组
        if (str == "year") {
            if (yearSelected[id - 2015] == 1) {
                ele.selectAll("*").filter(".geoSubTabContentChoiceBox").style("background-color", "rgba(222,227,231,0.4)");
                yearSelected[id - 2015] = 0;
            } else {
                ele.selectAll("*").filter(".geoSubTabContentChoiceBox").style("background-color", "#7da9cc");
                yearSelected[id - 2015] = 1;
            }
        } else if (str == "gender") {
            if (genderSelected[id] == 1) {
                ele.selectAll("*").filter(".geoSubTabContentChoiceBox").style("background-color", "rgba(222,227,231,0.4)");
                genderSelected[id] = 0;
            } else {
                ele.selectAll("*").filter(".geoSubTabContentChoiceBox").style("background-color", "#7da9cc");
                genderSelected[id] = 1;
            }
        } else if (str == "age") {
            if (ageBroadSelected[id] == 1) {
                ele.selectAll("*").filter(".geoSubTabContentChoiceBox").filter(".geoSubTabContentChoiceBox").style("background-color", "rgba(222,227,231,0.4)");
                ageBroadSelected[id] = 0;
            } else {
                ele.selectAll("*").filter(".geoSubTabContentChoiceBox").filter(".geoSubTabContentChoiceBox").style("background-color", "#7da9cc");
                ageBroadSelected[id] = 1;
            }
        } else if (str == "means") {
            if (meansOfControlSelected[id] == 1) {
                ele.selectAll("*").filter(".geoSubTabContentChoiceBox").style("background-color", "rgba(222,227,231,0.4)");
                meansOfControlSelected[id] = 0;
            } else {
                ele.selectAll("*").filter(".geoSubTabContentChoiceBox").style("background-color", "#7da9cc");
                meansOfControlSelected[id] = 1;
            }
        } else if (str == "exploit"){
            if (typeExploitSelected[id] == 1) {
                ele.selectAll("*").filter(".geoSubTabContentChoiceBox").style("background-color", "rgba(222,227,231,0.4)");
                typeExploitSelected[id] = 0;
            } else {
                ele.selectAll("*").filter(".geoSubTabContentChoiceBox").style("background-color", "#7da9cc");
                typeExploitSelected[id] = 1;
            }
        } else if (str == "labor"){
            if (typeLaborSelected[id] == 1) {
                ele.selectAll("*").filter(".geoSubTabContentChoiceBox").style("background-color", "rgba(222,227,231,0.4)");
                typeLaborSelected[id] = 0;
            } else {
                ele.selectAll("*").filter(".geoSubTabContentChoiceBox").style("background-color", "#7da9cc");
                typeLaborSelected[id] = 1;
            }
        } else if (str == "sex"){
            if (typeSexSelected[id] == 1) {
                ele.selectAll("*").filter(".geoSubTabContentChoiceBox").style("background-color", "rgba(222,227,231,0.4)");
                typeSexSelected[id] = 0;
            } else {
                ele.selectAll("*").filter(".geoSubTabContentChoiceBox").style("background-color", "#7da9cc");
                typeSexSelected[id] = 1;
            }
        }


        geneFinalCTDCData()

    }


    /*

    * startNum 代表要跳动的初始数字

    * targetNum 代表要跳动到的数字

    * time  代表要跳动需要花费的时间

    * selector 代表要跳动元素的选择器

    */

    const $setJumpNumber = (startNum, targetNum, time = 1, selector) => {

        let dom = document.querySelector(selector);

        let originNum = startNum;

        let stepNum = 0;

        let timeNum = time;

        dom.innerHTML = startNum;

        let timeId = setInterval(() => {

            if (originNum < targetNum) {

                timeNum -= 0.001;

                let strNum = originNum.toString();

                // 数字比较少的时候直接用 + 1; 数字很大直接 +1 要很久才能调到最对应的数字，所有后三位数随机跳动的方式进行模拟生成

                if (targetNum.toString().length < 6) {

                    stepNum += 1; // 这样才可以实现越跳越快的效果

                    originNum = originNum + stepNum;

                    dom.innerHTML = addSemi(originNum);

                } else {

                    stepNum += 500; // 这样才可以实现越跳越快的效果

                    originNum = originNum + stepNum;

                    dom.innerHTML = addSemi(strNum.substr(0, strNum.length - 3) + Math.floor(Math.random() * 10) + Math.floor(Math.random() * 10) + Math.floor(Math.random() * 10));

                }

            } else {

                dom.innerHTML = addSemi(targetNum);

                clearInterval(timeId);

            }

        }, timeNum);

    };


</script>

<script>

    d3.select("#windGlyphBlockDiv")
        .style("width", `${0.9 * window.innerWidth}px`)
        .style("height", `${0.9 * window.innerHeight}px`)
        .style("top", `${0.05 * window.innerHeight}px`)
        .style("left", `${0.05 * window.innerWidth}px`);

    d3.select("#svgCTDCMap")
        .attr("width", 0.8 * window.innerWidth)
        .attr("height", 0.8 * window.innerHeight)
        .attr("transform", `translate(${0.1 * window.innerWidth}, ${0.05 * window.innerHeight})`);

    // The svg
    const geoSvg = d3.select("svg"),
        geoWidth = +geoSvg.attr("width"),
        geoHeight = +geoSvg.attr("height");

    const mapSvg = geoSvg.append("g").attr("id", "mapSvg");

    const windGlyphSvg = geoSvg.append("g").attr("id", "windGlyphSvg");

    const windBlockSvg = geoSvg.append("g").attr("id", "windBlockSvg");


    // Map and projection
    const projection = d3.geoMercator()
        .center([0, 20])                // GPS of location to zoom on
        .scale(200 * widScaleRatio)                       // This is like the zoom
        .translate([geoWidth / 2, geoHeight / 2])


    //读取国家iso code以及坐标数据
    var isoCordData = {};
    var isoA3toA2 = {};
    //读取CTDC数据
    //[{isocode: 'DE', homelat: '40.2', homelon: '-74.8', homecontinent: 'North America', n: '33377'}, ... ]
    var geoCTDCData = {};
    var finalCTDCData = [];

    //定义大洲的平均经纬度
    var continentCord = [ [52.531704, -109.457906],  // North America
         [-15.376192, -59.360250],  //"South America":
         [-22.839016, 134.027464],  //"Oceania":
         [5.799385, 20.016929],  //"Africa":
         [-72.000486, -158.325094],  //"Antarctica":
         [56.949627, 23.532554],  // "Europe":
         [49.387926, 108.786460] ];  //"Asia":

    var continentNameCls = {"North America": 0,
        "South America": 1,
        "Oceania": 2,
        "Africa": 3,
        "Antarctica": 4,
        "Europe": 5,
        "Asia": 6};

    var continentLst = ["North America", "South America", "Oceania",
        "Africa", "Antarctica", "Europe", "Asia"]

    //定义国家所属的大洲
    var country_continent = {'AF': 'Asia',
        'AL': 'Europe',
        'AQ': 'Antarctica',
        'DZ': 'Africa',
        'AS': 'Oceania',
        'AD': 'Europe',
        'AO': 'Africa',
        'AG': 'North America',
        'AZ': 'Asia',
        'AR': 'South America',
        'AU': 'Oceania',
        'AT': 'Europe',
        'BS': 'North America',
        'BH': 'Asia',
        'BD': 'Asia',
        'AM': 'Asia',
        'BB': 'North America',
        'BE': 'Europe',
        'BM': 'North America',
        'BT': 'Asia',
        'BO': 'South America',
        'BA': 'Europe',
        'BW': 'Africa',
        'BV': 'Antarctica',
        'BR': 'South America',
        'BZ': 'North America',
        'IO': 'Asia',
        'SB': 'Oceania',
        'VG': 'North America',
        'BN': 'Asia',
        'BG': 'Europe',
        'MM': 'Asia',
        'BI': 'Africa',
        'BY': 'Europe',
        'KH': 'Asia',
        'CM': 'Africa',
        'CA': 'North America',
        'CV': 'Africa',
        'KY': 'North America',
        'CF': 'Africa',
        'LK': 'Asia',
        'TD': 'Africa',
        'CL': 'South America',
        'CN': 'Asia',
        'TW': 'Asia',
        'CX': 'Asia',
        'CC': 'Asia',
        'CO': 'South America',
        'KM': 'Africa',
        'YT': 'Africa',
        'CG': 'Africa',
        'CD': 'Africa',
        'CK': 'Oceania',
        'CR': 'North America',
        'HR': 'Europe',
        'CU': 'North America',
        'CY': 'Asia',
        'CZ': 'Europe',
        'BJ': 'Africa',
        'DK': 'Europe',
        'DM': 'North America',
        'DO': 'North America',
        'EC': 'South America',
        'SV': 'North America',
        'GQ': 'Africa',
        'ET': 'Africa',
        'ER': 'Africa',
        'EE': 'Europe',
        'FO': 'Europe',
        'FK': 'South America',
        'GS': 'Antarctica',
        'FJ': 'Oceania',
        'FI': 'Europe',
        'AX': 'Europe',
        'FR': 'Europe',
        'GF': 'South America',
        'PF': 'Oceania',
        'TF': 'Antarctica',
        'DJ': 'Africa',
        'GA': 'Africa',
        'GE': 'Asia',
        'GM': 'Africa',
        'PS': 'Asia',
        'DE': 'Europe',
        'GH': 'Africa',
        'GI': 'Europe',
        'KI': 'Oceania',
        'GR': 'Europe',
        'GL': 'North America',
        'GD': 'North America',
        'GP': 'North America',
        'GU': 'Oceania',
        'GT': 'North America',
        'GN': 'Africa',
        'GY': 'South America',
        'HT': 'North America',
        'HM': 'Antarctica',
        'VA': 'Europe',
        'HN': 'North America',
        'HK': 'Asia',
        'HU': 'Europe',
        'IS': 'Europe',
        'IN': 'Asia',
        'ID': 'Asia',
        'IR': 'Asia',
        'IQ': 'Asia',
        'IE': 'Europe',
        'IL': 'Asia',
        'IT': 'Europe',
        'CI': 'Africa',
        'JM': 'North America',
        'JP': 'Asia',
        'KZ': 'Asia',
        'JO': 'Asia',
        'KE': 'Africa',
        'KP': 'Asia',
        'KR': 'Asia',
        'KW': 'Asia',
        'KG': 'Asia',
        'LA': 'Asia',
        'LB': 'Asia',
        'LS': 'Africa',
        'LV': 'Europe',
        'LR': 'Africa',
        'LY': 'Africa',
        'LI': 'Europe',
        'LT': 'Europe',
        'LU': 'Europe',
        'MO': 'Asia',
        'MG': 'Africa',
        'MW': 'Africa',
        'MY': 'Asia',
        'MV': 'Asia',
        'ML': 'Africa',
        'MT': 'Europe',
        'MQ': 'North America',
        'MR': 'Africa',
        'MU': 'Africa',
        'MX': 'North America',
        'MC': 'Europe',
        'MN': 'Asia',
        'MD': 'Europe',
        'ME': 'Europe',
        'MS': 'North America',
        'MA': 'Africa',
        'MZ': 'Africa',
        'OM': 'Asia',
        'NA': 'Africa',
        'NR': 'Oceania',
        'NP': 'Asia',
        'NL': 'Europe',
        'AN': 'North America',
        'CW': 'North America',
        'AW': 'North America',
        'SX': 'North America',
        'BQ': 'North America',
        'NC': 'Oceania',
        'VU': 'Oceania',
        'NZ': 'Oceania',
        'NI': 'North America',
        'NE': 'Africa',
        'NG': 'Africa',
        'NU': 'Oceania',
        'NF': 'Oceania',
        'NO': 'Europe',
        'MP': 'Oceania',
        'UM': 'North America',
        'FM': 'Oceania',
        'MH': 'Oceania',
        'PW': 'Oceania',
        'PK': 'Asia',
        'PA': 'North America',
        'PG': 'Oceania',
        'PY': 'South America',
        'PE': 'South America',
        'PH': 'Asia',
        'PN': 'Oceania',
        'PL': 'Europe',
        'PT': 'Europe',
        'GW': 'Africa',
        'TL': 'Asia',
        'PR': 'North America',
        'QA': 'Asia',
        'RE': 'Africa',
        'RO': 'Europe',
        'RU': 'Asia',
        'RW': 'Africa',
        'BL': 'North America',
        'SH': 'Africa',
        'KN': 'North America',
        'AI': 'North America',
        'LC': 'North America',
        'MF': 'North America',
        'PM': 'North America',
        'VC': 'North America',
        'SM': 'Europe',
        'ST': 'Africa',
        'SA': 'Asia',
        'SN': 'Africa',
        'RS': 'Europe',
        'SC': 'Africa',
        'SL': 'Africa',
        'SG': 'Asia',
        'SK': 'Europe',
        'VN': 'Asia',
        'SI': 'Europe',
        'SO': 'Africa',
        'ZA': 'Africa',
        'ZW': 'Africa',
        'ES': 'Europe',
        'SS': 'Africa',
        'EH': 'Africa',
        'SD': 'Africa',
        'SR': 'South America',
        'SJ': 'Europe',
        'SZ': 'Africa',
        'SE': 'Europe',
        'CH': 'Europe',
        'SY': 'Asia',
        'TJ': 'Asia',
        'TH': 'Asia',
        'TG': 'Africa',
        'TK': 'Oceania',
        'TO': 'Oceania',
        'TT': 'North America',
        'AE': 'Asia',
        'TN': 'Africa',
        'TR': 'Asia',
        'TM': 'Asia',
        'TC': 'North America',
        'TV': 'Oceania',
        'UG': 'Africa',
        'UA': 'Europe',
        'MK': 'Europe',
        'EG': 'Africa',
        'GB': 'Europe',
        'GG': 'Europe',
        'JE': 'Europe',
        'IM': 'Europe',
        'TZ': 'Africa',
        'US': 'North America',
        'VI': 'North America',
        'BF': 'Africa',
        'UY': 'South America',
        'UZ': 'Asia',
        'VE': 'South America',
        'WF': 'Oceania',
        'WS': 'Oceania',
        'YE': 'Asia',
        'ZM': 'Africa',
        'XX': 'Oceania',
        'XE': 'Asia',
        'XD': 'Asia',
        'XS': 'Asia'}


    //kmeans均值算法
    const kMeans = (data, k = 1) => {
        const centroids = data.slice(0, k);
        const distances = Array.from({length: data.length}, () =>
            Array.from({length: k}, () => 0)
        );
        const classes = Array.from({length: data.length}, () => -1);
        let itr = true;

        while (itr) {
            itr = false;

            for (let d in data) {
                for (let c = 0; c < k; c++) {
                    distances[d][c] = Math.hypot(
                        ...Object.keys(data[0]).map(key => data[d][key] - centroids[c][key])
                    );
                }
                const m = distances[d].indexOf(Math.min(...distances[d]));
                if (classes[d] !== m) itr = true;
                classes[d] = m;
            }

            for (let c = 0; c < k; c++) {
                centroids[c] = Array.from({length: data[0].length}, () => 0);
                const size = data.reduce((acc, _, d) => {
                    if (classes[d] === c) {
                        acc++;
                        for (let i in data[0]) centroids[c][i] += data[d][i];
                    }
                    return acc;
                }, 0);
                for (let i in data[0]) {
                    centroids[c][i] = parseFloat(Number(centroids[c][i] / size).toFixed(2));
                }
            }
        }

        return classes;
    };

    const continentDiv = function (data){
        let cls = [];
        for(let i = 0; i < data.length; i++)
        {
            cls.push(continentNameCls[country_continent[data[i]]]);
        }

        return cls;
    }



    //刷新的时候地图只绘制一次
    var isMapDrawn = false;

    //绘制地图的函数
    var drawMapData = function (finalData) {
        Promise.all([
            d3.json("https://raw.githubusercontent.com/holtzy/D3-graph-gallery/master/DATA/world.geojson"),
            // d3.csv("https://raw.githubusercontent.com/holtzy/D3-graph-gallery/master/DATA/data_gpsLocSurfer.csv")
        ]).then(function (initialize) {
            // console.log(finalData.length)

            let dataGeo = initialize[0]
            // let data = initialize[1]
            // Create a color scale
            // const color = d3.scaleOrdinal()
            //     .domain(data.map(d => d.homecontinent))
            //     .range(d3.schemePaired);

            // Add a scale for bubble size
            const valueExtent = d3.extent(finalData, d => +d.n)

            const size = d3.scaleSqrt()
                .domain(valueExtent)  // What's in the data
                .range([1, 50])  // Size in pixel

            // let windGlyphIndex = 0;


            if (isMapDrawn == false) {
                // 地图绘制
                mapSvg.append("g")
                    .selectAll("path")
                    .data(dataGeo.features)
                    .join("path")
                    .attr("fill", "#373b4f")
                    .style("fill-opacity", .35)
                    .attr("d", d3.geoPath()
                        .projection(projection)
                    )
                    .attr("id", d => isoA3toA2[d.id])
                    .attr("class", "countryMap")
                    .style("stroke", "none");

                isMapDrawn = true;
            }

            //清空windGlyph以及blockDiv的内容
            d3.select("#windGlyphSvg").selectAll("*").remove();
            d3.select("#windBlockSvg").selectAll("*").remove();


            let windGlyphWid = 1196.15;
            let windGlyphHei = 736.5968;
            let windGlyphScale = d3.scaleSqrt()
                .domain(valueExtent)
                .range([.03, 0.25])


            // Add group for svg:
            windGlyphSvg
                .selectAll(".geoCircles")
                .data(finalData) //.sort((a,b) => +b.n - +a.n).filter((d,i) => i<1000)
                .enter()
                .append("g") //circle
                .attr("cx", d => d.cx) //d => projection([+d.homelon, +d.homelat])[0]
                .attr("cy", d => d.cy) //d => projection([+d.homelon, +d.homelat])[1]
                // .attr("r", d => size(+d.n))
                .attr("id", function (d, i) {

                    return `geoWindGlyph${d.id}`
                }) //d=> {if (d.n>2000) {return "black"} else {return "none"}  }
                .attr("class", "geoCircles")
                // .style("fill", "#ff3672")
                // .attr("stroke", "none") //d=> {if (d.n>2000) {return "black"} else {return "none"}  }
                // .attr("stroke-width", 1)
                .attr("transform", d => `translate(${d.cx - windGlyphWid * windGlyphScale(+d.n) / 2}, ${d.cy - windGlyphHei * windGlyphScale(+d.n) / 2}), scale(${windGlyphScale(+d.n)})`)
            // .attr("r", d => size(+d.n))

            // .transition()
            // .duration(1000)
            // .attr("fill-opacity", .4);

            //添加隐形矩形，作为svg悬停的响应
            windBlockSvg
                .append("g")
                .selectAll(".invisiRectWindGlyph")
                .data(finalData)
                .enter()
                .append("rect")
                .attr("x", d => d.cx - windGlyphWid * windGlyphScale(+d.n) / 2)
                .attr("y", d => d.cy - windGlyphHei * windGlyphScale(+d.n) / 2)
                .attr("width", d => windGlyphWid * windGlyphScale(+d.n))
                .attr("height", d => windGlyphHei * windGlyphScale(+d.n))
                .attr("fill", "#000")
                .attr("opacity", "0")
                .on("mouseover", function (event, d) {

                    d3.select("#geoCTDCCasesContinent")
                        .text(`cases in ${d.country.length} countries of ${d.continent}`)

                    // d3.select(this)
                    //     //.style("stroke", "black")
                    //     .style("opacity", 1)
                    // console.log(d)
                    let cx = d3.select(`#geoWindGlyph${d.id}`).attr("cx");
                    let cy = d3.select(`#geoWindGlyph${d.id}`).attr("cy");
                    // let r = d3.select(this).attr("r");
                    let transform = d3.select(`#geoWindGlyph${d.id}`).attr("transform");

                    d3.selectAll(".geoCircles")
                        // .transition()
                        // .duration(500)
                        .attr("opacity", .3);

                    d3.select(`#geoWindGlyph${d.id}`)
                        .attr("opacity", 1)
                    // .attr("stroke-width", 5)
                    // .transition()
                    // .duration(2000)
                    // .attr("transform", transform.split("scale")[0] + `scale(1)`)

                    d3.select("#geoTooltip")
                        .style("display", "block")
                        .style("left", `${cx - windGlyphWid * windGlyphScale(+d.n) / 2 + 0.1 * window.innerWidth - 340 * widScaleRatio}px`) //
                        .style("top", `${cy - 30 * widScaleRatio}px`); //${cy}

                    // d3.select("#geoCountryName")
                    //     .html(d.country);

                    // d3.select("#geoCTDCCases")
                    //     .html(addSemi(d.n));
                    $setJumpNumber(1, d.n, 15, "#geoCTDCCases");


                    //属于此类的国家地图轮廓高亮
                    let countries = d.iso; //["AE", "AU", "RF", ...]
                    let countCases = d.cases; // [12, 30, 50, ...]
                    //其他国家颜色变淡
                    d3.selectAll(".countryMap")
                        .style("fill-opacity", .1)


                    let tpDiv = "";
                    let casesScale = d3.scaleLinear()
                        .domain(d3.extent(countCases))
                        .range([80 * heiScaleRatio, 10 * heiScaleRatio]);
                    let tpDivCountries = [];

                    let colGraphNumScale = d3.scaleLinear()
                        .domain(d3.extent(countCases))
                        .range([70 * heiScaleRatio, 0]);

                    for (let k in countries) {
                        //选中国家高亮
                        d3.select(`#${countries[k]}`)
                            .style("fill-opacity", .35)
                            .style("stroke", "#FFCA36")
                            .style("stroke-opacity", .4)
                            .style("stroke-width", "1.4");

                        //Tooltip添加三角形柱状图
                        tpDiv +=
                            `
                              <div style="display: flex; align-items: center; flex-direction: column; width: 2rem">
                                <div id="${countries[k]}ColGraphNum" class="normalContent" style="opacity: .8; display: block; visibility: hidden; font-size: 0.5em; position: relative; top: ${colGraphNumScale(countCases[k])}px">${countCases[k]}</div>
                                <svg id="${countries[k]}ColGraph" width="2rem" height="4rem" style="margin-bottom: 4px;">
                                    <polygon class="triangle" stroke-linejoin="round" points="${25 * widScaleRatio},${casesScale(countCases[k])} ${10 * widScaleRatio},${90 * heiScaleRatio} ${40 * widScaleRatio},${90 * heiScaleRatio}"/>
                                </svg>
                                <img src="asset/svg/flags/${countries[k]}.svg">
                                <div id="${countries[k]}ColGraphName" class="normalContent" style="opacity: .8; display: block; visibility: hidden; font-size: 0.5em; margin-top: .3rem">${isoCordData[countries[k]][2]}</div>
                              </div>`

                    }

                    document.getElementById("geoTpSvgDiv")
                        .innerHTML = tpDiv;

                    //先将tpDiv的元素放到DOM内，再进行悬停事件的绑定
                    for (let k in countries) {
                        d3.select(`#${countries[k]}ColGraph`)
                            .on("mouseover", function (event, d) {
                                d3.select(`#${countries[k]}ColGraphNum`)
                                    .style("visibility", "visible");
                                d3.select(`#${countries[k]}ColGraphName`)
                                    .style("visibility", "visible");
                            })
                            .on("mouseleave", function (event, d) {
                                d3.select(`#${countries[k]}ColGraphNum`)
                                    .style("visibility", "hidden");
                                d3.select(`#${countries[k]}ColGraphName`)
                                    .style("visibility", "hidden");
                            })
                    }

                })
                .on("click", function () {
                    d3.select("#windGlyphBlockDiv")
                        .style("display", "block");
                    isWindGlyphTpFixed = true;
                    console.log(122222)

                })
                .on("mouseleave", function () {
                    if (!isWindGlyphTpFixed) {
                        d3.select("#geoTooltip")
                            .style("display", "none");
                        d3.selectAll(".geoCircles")
                            // .transition()
                            // .duration(500)
                            .attr("opacity", 1);

                        d3.selectAll(".countryMap")
                            .style("fill-opacity", .35)
                            .style("stroke", "none");
                    }


                })


            for (let i = 0; i < finalData.length; i++) {
                d3.xml("asset/svg/wind4.svg")
                    .then(data => {
                        d3.select(`#geoWindGlyph${i}`).node().append(data.documentElement)
                    });
            }


        });
    };

    //产出finalCTDCData的函数
    var geneFinalCTDCData = function () {
        geoCTDCData = {};
        finalCTDCData = [];

        d3.csv("asset/csv/CTDC.csv").then(function (data) {

            //筛选数据
            for (let i = 0; i < data.length; i++) {
                if (isSelected(data[i])) {
                    if (data[i]["citizenship"] in geoCTDCData) {
                        geoCTDCData[data[i]["citizenship"]] += 1;
                    } else {
                        geoCTDCData[data[i]["citizenship"]] = 1;
                    }
                }
            }

            let geoCTDCDataIso = Object.keys(geoCTDCData) // ["AE", "ED", "AF", ...]
            let geoCTDCDataCases = Object.values(geoCTDCData) // [1, 10, 20, ...]

            //数据从大到小排序
            let geoCTDCDataIsoCases = [];
            for (let i in geoCTDCDataIso) {
                let temp = {};
                temp["iso"] = geoCTDCDataIso[i];
                temp["cases"] = geoCTDCDataCases[i];
                geoCTDCDataIsoCases.push(temp);
            }
            geoCTDCDataIsoCases.sort((a, b) => b.cases - a.cases);

            geoCTDCDataIso = [];
            geoCTDCDataCases = [];
            for (let i in geoCTDCDataIsoCases) {
                geoCTDCDataIso.push(geoCTDCDataIsoCases[i]["iso"]);
                geoCTDCDataCases.push(geoCTDCDataIsoCases[i]["cases"]);
            }


            //geoCTDCData = {"AE": 1, "ED": 10, ...}
            //a: ["AE", "ED", "AF", ...]
            //b: [1, 10, 20, ...]
            //c: countryCordLst [[1, 2], [3, 4], [5, 6], ...]
            //d: countryCordCls [0, 0, 1, ...]
            //a,b,c,d是一系列的：分别对应国家的iso，case数量、国家平均坐标、国家类别

            //不需要国家坐标了
            // let countryCordLst = [];
            // for (let i in geoCTDCDataIso) {
            //     countryCordLst.push([projection([isoCordData[geoCTDCDataIso[i]][1], isoCordData[geoCTDCDataIso[i]][0]])[0],
            //         projection([isoCordData[geoCTDCDataIso[i]][1], isoCordData[geoCTDCDataIso[i]][0]])[1]])
            // }

            //大洲平均坐标
            let continentCordProjection = [];
            for (let i in continentCord) {
                continentCordProjection.push([projection([continentCord[i][1], continentCord[i][0]])[0],
                    projection([continentCord[i][1], continentCord[i][0]])[1]]);
            }

            // console.log(continentCordProjection)


            // --------------- //
            // continent计算归类 //
            // --------------- //
            let countryCordCls = continentDiv(geoCTDCDataIso);

            // console.log(countryCordCls)

            //7大洲
            for (let i = 0; i < 7; i++) {

                let temp = {};

                let casesSum = 0;
                for (let j = 0; j < countryCordCls.length; j++) {
                    if (countryCordCls[j] == i) {
                        casesSum += geoCTDCDataCases[j];

                        if ("iso" in temp) {
                            temp["iso"].push(geoCTDCDataIso[j]);
                            temp["cases"].push(geoCTDCDataCases[j]);
                            temp["country"].push(isoCordData[geoCTDCDataIso[j]][2]);

                        } else {
                            temp["iso"] = [geoCTDCDataIso[j]];
                            temp["cases"] = [geoCTDCDataCases[j]];
                            temp["country"] = [isoCordData[geoCTDCDataIso[j]][2]];

                        }
                    }
                }
                temp["n"] = casesSum;
                temp["cx"] = continentCordProjection[i][0];
                temp["cy"] = continentCordProjection[i][1];
                temp["id"] = finalCTDCData.length;
                temp["continent"] = continentLst[i]

                //这个大洲有案例
                if(casesSum!=0)
                {
                    finalCTDCData.push(temp);
                }
            }




            drawMapData(finalCTDCData);
        });

    };

    //加载iso代码
    d3.csv("asset/csv/countries_codes_and_coordinates.csv").then(function (data) {
        for (let i = 0; i < data.length; i++) {
            isoCordData[data[i]["Alpha2Code"]] = [data[i]["Latitude"], data[i]["Longitude"], data[i]["Country"]];
            isoA3toA2[data[i]["Alpha3Code"]] = data[i]["Alpha2Code"]
        }
        geneFinalCTDCData();
    });


</script>


<!--窗口resize 刷新-->
<script>
    window.onresize = function () {
        location.reload();
    }
</script>

</body>
</html>